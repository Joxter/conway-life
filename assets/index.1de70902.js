const Ln=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&a(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}};Ln();function Ie(e,t){for(let r in e)t(e[r],r)}function B(e,t){e.forEach(t)}function O(e,t){if(!e)throw Error(t)}function $r(e,t){F={parent:F,value:e,template:R(e,"template")||Ne(),sidRoot:R(e,"sidRoot")||F&&F.sidRoot};try{return t()}finally{F=ce(F)}}function ve({node:e=[],from:t,source:r,parent:a=t||r,to:n,target:l,child:s=n||l,scope:i={},meta:b={},family:k={type:"regular"},regional:h}={}){let u=Ve(a),f=Ve(k.links),p=Ve(k.owners),o=[];B(e,d=>d&&le(o,d));let g={id:Nn(),seq:o,next:Ve(s),meta:b,scope:i,family:{type:k.type||"crosslink",links:f,owners:p}};return B(f,d=>le(Dt(d),g)),B(p,d=>le(Tt(d),g)),B(u,d=>le(d.next,g)),h&&F&&Re(He(F),[g]),g}function T(e,t,r){let a=se,n=null,l=E;if(e.target&&(t=e.params,r=e.defer,a="page"in e?e.page:a,e.stack&&(n=e.stack),l=me(e)||l,e=e.target),l&&E&&l!==E&&(E=null),Array.isArray(e))for(let p=0;p<e.length;p++)Se("pure",a,Q(e[p]),n,t[p],l);else Se("pure",a,Q(e),n,t,l);if(r&&!lt)return;let s,i,b,k,h,u,f={isRoot:lt,currentPage:se,scope:E,isWatch:pt,isPure:dt};lt=0;e:for(;k=Vn();){let{idx:p,stack:o,type:g}=k;b=o.node,se=h=o.page,E=me(o),h?u=h.reg:E&&(u=E.reg);let d=!!h,c=!!E,m={fail:0,scope:b.scope};s=i=0;for(let v=p;v<b.seq.length&&!s;v++){let w=b.seq[v];if(w.order){let{priority:y,barrierID:x}=w.order,$=x?h?`${h.fullID}_${x}`:x:0;if(v!==p||g!==y){x?Nt.has($)||(Nt.add($),Kt(v,o,y,x)):Kt(v,o,y);continue e}x&&Nt.delete($)}switch(w.type){case"mov":{let x,$=w.data;switch($.from){case Me:x=He(o);break;case"a":case"b":x=o[$.from];break;case"value":x=$.store;break;case"store":if(u&&!u[$.store.id])if(d){let _=tn(h,$.store.id);o.page=h=_,_?u=_.reg:c?(Pe(E,$.store,0,1,$.softRead),u=E.reg):u=void 0}else c&&Pe(E,$.store,0,1,$.softRead);x=We(u&&u[$.store.id]||$.store)}switch($.to){case Me:o.value=x;break;case"a":case"b":o[$.to]=x;break;case"store":Hn(h,E,b,$.target).current=x}break}case"compute":let y=w.data;if(y.fn){pt=R(b,"op")==="watch",dt=y.pure;let x=y.safe?(0,y.fn)(He(o),m.scope,o):Wn(m,y.fn,o);y.filter?i=!x:o.value=x,pt=f.isWatch,dt=f.isPure}}s=m.fail||i}if(!s){let v=He(o);B(b.next,y=>{Se("child",h,y,o,v,me(o))});let w=me(o);if(w){R(b,"needFxCounter")&&Se("child",h,w.fxCount,o,v,w),R(b,"storeChange")&&Se("child",h,w.storeChange,o,v,w),R(b,"warnSerialize")&&Se("child",h,w.warnSerializeNode,o,v,w);let y=w.additionalLinks[b.id];y&&B(y,x=>{Se("child",h,x,o,v,w)})}}}lt=f.isRoot,se=f.currentPage,E=me(f)}function Wr(e,t="combine"){let r=t+"(",a="",n=0;return Ie(e,l=>{n<25&&(l!=null&&(r+=a,r+=ge(l)?or(l).fullName:l.toString()),n+=1,a=", ")}),r+")"}function Gr(e,t){let r,a,n=e;if(t){let l=or(t);e.length===0?(r=l.path,a=l.fullName):(r=l.path.concat([e]),a=l.fullName.length===0?e:l.fullName+"/"+e)}else r=e.length===0?[]:[e],a=e;return{shortName:n,fullName:a,path:r}}function Fe(e,t){let r=t?e:e[0];Jr(r);let a=r.or,n=r.and;if(n){let l=t?n:n[0];if(te(l)&&"and"in l){let s=Fe(n,t);e=s[0],a={...a,...s[1]}}else e=n}return[e,a]}function z(e,...t){let r=Ne();if(r){let a=r.handlers[e];if(a)return a(r,...t)}}function S(e,t){let r=(n,...l)=>(_e(!R(r,"derived"),"call of derived event","createEvent"),_e(!dt,"unit call from pure function","operators like sample"),se?((s,i,b,k)=>{let h=se,u=null;if(i)for(u=se;u&&u.template!==i;)u=ce(u);Dr(u);let f=s.create(b,k);return Dr(h),f})(r,a,n,l):r.create(n,l)),a=Ne();return Object.assign(r,{graphite:ve({meta:ln("event",r,e,t),regional:1}),create:n=>(T({target:r,params:n,scope:E}),n),watch:n=>nn(r,n),map:n=>Bt(r,qe,n,[oe()]),filter:n=>Bt(r,"filter",n.fn?n:n.fn,[oe(ir,1)]),filterMap:n=>Bt(r,"filterMap",n,[oe(),J(l=>!H(l),1)]),prepend(n){let l=S("* \u2192 "+r.shortName,{parent:ce(r)});return z("eventPrepend",Q(l)),we(l,r,[oe()],"prepend",n),an(r,l),l}})}function C(e,t){let r=De(e),a=S({named:"updates",derived:1});z("storeBase",r);let n=r.id,l={subscribers:new Map,updates:a,defaultState:e,stateRef:r,getState(){let u,f=r;if(se){let p=se;for(;p&&!p.reg[n];)p=ce(p);p&&(u=p)}return!u&&E&&(Pe(E,r,1),u=E),u&&(f=u.reg[n]),We(f)},setState:u=>T({target:l,params:u,defer:1,scope:E}),reset:(...u)=>(B(u,f=>l.on(f,()=>l.defaultState)),l),on:(u,f)=>(bt(u,".on","first argument"),_e(!R(l,"derived"),".on in derived store","createStore"),B(Array.isArray(u)?u:[u],p=>{l.off(p),ut(l).set(p,rn(Er(p,l,"on",zn,f)))}),l),off(u){let f=ut(l).get(u);return f&&(f(),ut(l).delete(u)),l},map(u,f){let p,o;te(u)&&(p=u,u=u.fn),_e(H(f),"second argument of store.map","updateFilter");let g=l.getState();Ne()?o=null:H(g)||(o=u(g,f));let d=C(o,{name:`${l.shortName} \u2192 *`,derived:1,and:p}),c=Er(l,d,qe,Xt,u);return yt(j(d),{type:qe,fn:u,from:r}),j(d).noInit=1,z("storeMap",r,c),d},watch(u,f){if(!f||!ge(u)){let p=nn(l,u);return z("storeWatch",r,u)||u(l.getState()),p}return O(G(f),"second argument should be a function"),u.watch(p=>f(l.getState(),p))}},s=ln("store",l,t),i=l.defaultConfig.updateFilter;l.graphite=ve({scope:{state:r,fn:i},node:[J((u,f,p)=>(p.scope&&!p.scope.reg[r.id]&&(p.b=1),u)),ie(r),J((u,f,{a:p,b:o})=>!H(u)&&(u!==p||o),1),i&&oe(Xt,1),Y({from:Me,target:r})],child:a,meta:s,regional:1});let b=R(l,"derived"),k=R(l,"serialize")==="ignore",h=R(l,"sid");return h&&(k||Ce(l,"storeChange",1),r.sid=h),h||k||b||Ce(l,"warnSerialize",1),O(b||!H(e),"current state can't be undefined, use null instead"),Re(l,[a]),l}function U(...e){let t,r,a;[e,a]=Fe(e);let n,l,s,i=e[e.length-1];if(G(i)?(r=e.slice(0,-1),t=i):r=e,r.length===1){let b=r[0];V(b)||(n=b,l=1)}if(!l&&(n=r,t)){s=1;let b=t;t=k=>b(...k)}return O(te(n),"shape should be an object"),Qn(Array.isArray(n),!s,n,a,t)}function qn(){let e={};return e.req=new Promise((t,r)=>{e.rs=t,e.rj=r}),e.req.catch(()=>{}),e}function _t(e,t){let r=S(G(e)?{handler:e}:e,t),a=Q(r);Ce(a,"op",r.kind="effect"),r.use=f=>(O(G(f),".use argument should be a function"),k.scope.handler=f,r),r.use.getCurrent=()=>k.scope.handler;let n=r.finally=S({named:"finally",derived:1}),l=r.done=n.filterMap({named:"done",fn({status:f,params:p,result:o}){if(f==="done")return{params:p,result:o}}}),s=r.fail=n.filterMap({named:"fail",fn({status:f,params:p,error:o}){if(f==="fail")return{params:p,error:o}}}),i=r.doneData=l.map({named:"doneData",fn:({result:f})=>f}),b=r.failData=s.map({named:"failData",fn:({error:f})=>f}),k=ve({scope:{handlerId:R(a,"sid"),handler:r.defaultConfig.handler||(()=>O(0,`no handler used in ${r.getType()}`))},node:[J((f,p,o)=>{let g=p,d=g.handler;if(me(o)){let c=me(o).handlers[g.handlerId];c&&(d=c)}return f.handler=d,f},0,1),J(({params:f,req:p,handler:o,args:g=[f]},d,c)=>{let m=kt(f,p,1,n,c),v=kt(f,p,0,n,c),[w,y]=on(o,v,g);w&&(te(y)&&G(y.then)?y.then(m,v):m(y))},0,1)],meta:{op:"fx",fx:"runner"}});a.scope.runner=k,le(a.seq,J((f,{runner:p},o)=>{let g=ce(o)?{params:f,req:{rs(d){},rj(d){}}}:f;return T({target:p,params:g,defer:1,scope:me(o)}),g.params},0,1)),r.create=f=>{let p=qn(),o={params:f,req:p};if(E){if(!pt){let g=E;p.req.finally(()=>{Un(g)}).catch(()=>{})}T({target:r,params:o,scope:E})}else T(r,o);return p.req};let h=r.inFlight=C(0,{serialize:"ignore"}).on(r,f=>f+1).on(n,f=>f-1).map({fn:f=>f,named:"inFlight"});Ce(n,"needFxCounter","dec"),Ce(r,"needFxCounter",1);let u=r.pending=h.map({fn:f=>f>0,named:"pending"});return Re(r,[n,l,s,i,b,u,h]),r}function Rn(e){let t;[e,t]=Fe(e,1);let{source:r,effect:a,mapParams:n}=e,l=_t(e,t);Ce(l,"attached",1);let s,{runner:i}=Q(l).scope,b=J((h,u,f)=>{let p,{params:o,req:g,handler:d}=h,c=l.finally,m=kt(o,g,0,c,f),v=f.a,w=vt(d),y=1;if(n?[y,p]=on(n,m,[o,v]):p=r&&w?v:o,y){if(!w)return h.args=[v,p],1;T({target:d,params:{params:p,req:{rs:kt(o,g,1,c,f),rj:m}},page:f.page,defer:1})}},1,1);if(r){let h;V(r)?(h=r,Re(h,[l])):(h=U(r),Re(l,[h])),s=[ie(j(h)),b]}else s=[b];i.seq.splice(1,0,...s),l.use(a);let k=ce(a);return k&&(Object.assign(or(l),Gr(l.shortName,k)),l.defaultConfig.parent=k),an(a,l,"effect"),l}function Je(e,t){bt(e,"merge","first argument");let r=S({name:Wr(e,"merge"),derived:1,and:t});return we(e,r,[],"merge"),r}function Qr(e,t){let r=0;return B(Kn,a=>{a in e&&(O(e[a]!=null,sn(t,a)),r=1)}),r}function M(...e){let t,r,a,n,[[l,s,i],b]=Fe(e),k=1;return H(s)&&te(l)&&Qr(l,"sample")&&(s=l.clock,i=l.fn,k=!l.greedy,n=l.filter,t=l.target,r=l.name,a=l.sid,l=l.source),dr("sample",s,l,n,t,i,r,b,k,1,0,a)}function ct(...e){let[[t,r],a]=Fe(e);return r||(r=t,t=r.source),Qr(r,"guard"),dr("guard",r.clock,t,r.filter,r.target,null,r.name,a,!r.greedy,0,1)}function Qt(e,t,r){if(V(e))return _e(0,"restore($store)"),e;if(Xr(e)||vt(e)){let n=ce(e),l=C(t,{parent:n,name:e.shortName,and:r});return we(vt(e)?e.doneData:e,l),n&&n.hooks.store(l),l}let a=Array.isArray(e)?[]:{};return Ie(e,(n,l)=>a[l]=V(n)?n:C(n,{name:l})),a}function An(...e){let t,r,a="split",[[n,l],s]=Fe(e),i=!l;i&&(t=n.cases,l=n.match,r=n.clock,n=n.source);let b=V(l),k=!ge(l)&&G(l),h=!b&&!k&&te(l);t||(t={}),i?Ie(t,(g,d)=>Zr(a,g,`cases.${d}`)):(O(h,"match should be an object"),Ie(l,(g,d)=>t[d]=S({derived:1,and:s})),t.__=S({derived:1,and:s}));let u,f=new Set([].concat(n,r||[],Object.values(t))),p=Object.keys(b||k?t:l);if(b||k)b&&f.add(l),u=[b&&ie(j(l),0,1),Ae({safe:b,filter:1,pure:!b,fn(g,d,c){let m=String(b?c.a:l(g));jt(d,Ir(p,m)?m:"__",g,c)}})];else if(h){let g=De({});g.type="shape";let d,c=[];Ie(l,(m,v)=>{if(ge(m)){d=1,le(c,v),f.add(m);let w=we(m,[],[ie(g),J((y,x,{a:$})=>$[v]=y)]);if(V(m)){g.current[v]=m.getState();let y=j(m);yt(g,{from:y,field:v,type:"field"}),z("splitMatchStore",y,w)}}}),d&&z("splitBase",g),u=[d&&ie(g,0,1),oe((m,v,w)=>{for(let y=0;y<p.length;y++){let x=p[y];if(Ir(c,x)?w.a[x]:l[x](m))return void jt(v,x,m,w)}jt(v,"__",m,w)},1)]}else O(0,"expect match to be unit, function or object");let o=ve({meta:{op:a},parent:r?[]:n,scope:t,node:u,family:{owners:Array.from(f)},regional:1});if(r&&dr(a,r,n,null,o,null,a,s,0,0,0),!i)return t}let Pn=typeof Symbol<"u"&&Symbol.observable||"@@observable",qe="map",Me="stack",ge=e=>(G(e)||te(e))&&"kind"in e;const nt=e=>t=>ge(t)&&t.kind===e;let V=nt("store"),Xr=nt("event"),vt=nt("effect"),Kr=nt("domain"),On=nt("scope");var q={__proto__:null,unit:ge,store:V,event:Xr,effect:vt,domain:Kr,scope:On};let Ir=(e,t)=>e.includes(t),Ft=(e,t)=>{let r=e.indexOf(t);r!==-1&&e.splice(r,1)},le=(e,t)=>e.push(t),_e=(e,t,r)=>!e&&console.error(`${t} is deprecated${r?`, use ${r} instead`:""}`),Q=e=>e.graphite||e,Dt=e=>e.family.owners,Tt=e=>e.family.links,j=e=>e.stateRef,He=e=>e.value,ut=e=>e.subscribers,ce=e=>e.parent,me=e=>e.scope,R=(e,t)=>Q(e).meta[t],Ce=(e,t,r)=>Q(e).meta[t]=r,or=e=>e.compositeName;const sr=()=>{let e=0;return()=>""+ ++e};let Fn=sr(),Yr=sr(),Nn=sr(),F=null,Ne=()=>F&&F.template,Bn=e=>(e&&F&&F.sidRoot&&(e=`${F.sidRoot}|${e}`),e),Re=(e,t)=>{let r=Q(e);B(t,a=>{let n=Q(a);r.family.type!=="domain"&&(n.family.type="crosslink"),le(Dt(n),r),le(Tt(r),n)})},Ve=(e=[])=>(Array.isArray(e)?e:[e]).flat().map(Q),te=e=>typeof e=="object"&&e!==null,G=e=>typeof e=="function",H=e=>e===void 0,Jr=e=>O(te(e)||G(e),"expect first argument be an object");const Cr=(e,t,r,a)=>O(!(!te(e)&&!G(e)||!("family"in e)&&!("graphite"in e)),`${t}: expect ${r} to be a unit (store, event or effect)${a}`);let bt=(e,t,r)=>{Array.isArray(e)?B(e,(a,n)=>Cr(a,t,`${n} item of ${r}`,"")):Cr(e,t,r," or array of units")},Zr=(e,t,r="target")=>B(Ve(t),a=>_e(!R(a,"derived"),`${e}: derived unit in "${r}"`,"createEvent/createStore")),Xt=(e,{fn:t},{a:r})=>t(e,r),zn=(e,{fn:t},{a:r})=>t(r,e),ir=(e,{fn:t})=>t(e);const en=(e,t,r,a)=>{let n={id:Yr(),type:e,data:t};return r&&(n.order={priority:r},a&&(n.order.barrierID=++jn)),n};let jn=0,Y=({from:e="store",store:t,target:r,to:a=r?"store":Me,batch:n,priority:l})=>en("mov",{from:e,store:t,to:a,target:r},l,n),Ae=({fn:e,batch:t,priority:r,safe:a=0,filter:n=0,pure:l=0})=>en("compute",{fn:e,safe:a,filter:n,pure:l},r,t),cr=({fn:e})=>Ae({fn:e,priority:"effect"}),J=(e,t,r)=>Ae({fn:e,safe:1,filter:t,priority:r&&"effect"}),ie=(e,t,r)=>Y({store:e,to:t?Me:"a",priority:r&&"sampler",batch:1}),oe=(e=ir,t)=>Ae({fn:e,pure:1,filter:t}),Mr={mov:Y,compute:Ae,filter:({fn:e,pure:t})=>Ae({fn:e,filter:1,pure:t}),run:cr},De=e=>({id:Yr(),current:e}),We=({current:e})=>e,yt=(e,t)=>{e.before||(e.before=[]),le(e.before,t)},Te=null;const ur=(e,t)=>{if(!e)return t;if(!t)return e;let r;return(e.v.type===t.v.type&&e.v.id>t.v.id||Yt(e.v.type)>Yt(t.v.type))&&(r=e,e=t,t=r),r=ur(e.r,t),e.r=e.l,e.l=r,e},pr=[];let _r=0;for(;_r<6;)le(pr,{first:null,last:null,size:0}),_r+=1;const Vn=()=>{for(let e=0;e<6;e++){let t=pr[e];if(t.size>0){if(e===3||e===4){t.size-=1;let a=Te.v;return Te=ur(Te.l,Te.r),a}t.size===1&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},Se=(e,t,r,a,n,l)=>Kt(0,{a:null,b:null,node:r,parent:a,value:n,page:t,scope:l},e),Kt=(e,t,r,a=0)=>{let n=Yt(r),l=pr[n],s={v:{idx:e,stack:t,type:r,id:a},l:null,r:null};n===3||n===4?Te=ur(Te,s):(l.size===0?l.first=s:l.last.r=s,l.last=s),l.size+=1},Yt=e=>{switch(e){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},Nt=new Set;let E,lt=1,pt=0,dt=0,se=null,Un=e=>{E=e},Dr=e=>{se=e};const tn=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=ce(e);if(e)return e}return null};let Hn=(e,t,r,a,n)=>{let l=tn(e,a.id);return l?l.reg[a.id]:t?(Pe(t,a,n),t.reg[a.id]):a},Pe=(e,t,r,a,n)=>{let l=e.reg,s=t.sid;if(l[t.id])return;let i={id:t.id,current:t.current};if(s&&s in e.sidValuesMap&&!(s in e.sidIdMap))i.current=e.sidValuesMap[s];else if(t.before&&!n){let b=0,k=r||!t.noInit||a;B(t.before,h=>{switch(h.type){case qe:{let u=h.from;if(u||h.fn){u&&Pe(e,u,r,a);let f=u&&l[u.id].current;k&&(i.current=h.fn?h.fn(f):f)}break}case"field":b||(b=1,i.current=Array.isArray(i.current)?[...i.current]:{...i.current}),Pe(e,h.from,r,a),k&&(i.current[h.field]=l[l[h.from.id].id].current)}})}s&&(e.sidIdMap[s]=t.id),l[t.id]=i};const Wn=(e,t,r)=>{try{return t(He(r),e.scope,r)}catch(a){console.error(a),e.fail=1}};let Jt=(e,t={})=>(te(e)&&(Jt(e.or,t),Ie(e,(r,a)=>{H(r)||a==="or"||a==="and"||(t[a]=r)}),Jt(e.and,t)),t);const Tr=(e,t)=>{Ft(e.next,t),Ft(Dt(e),t),Ft(Tt(e),t)},Zt=(e,t,r)=>{let a;e.next.length=0,e.seq.length=0,e.scope=null;let n=Tt(e);for(;a=n.pop();)Tr(a,e),(t||r&&R(e,"op")!=="sample"||a.family.type==="crosslink")&&Zt(a,t,R(a,"op")!=="on"&&r);for(n=Dt(e);a=n.pop();)Tr(a,e),r&&a.family.type==="crosslink"&&Zt(a,t,R(a,"op")!=="on"&&r)},ze=e=>e.clear();let Gn=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),V(e))ze(ut(e));else if(Kr(e)){r=1;let a=e.history;ze(a.events),ze(a.effects),ze(a.stores),ze(a.domains)}Zt(Q(e),!!t,r)},rn=e=>{let t=()=>Gn(e);return t.unsubscribe=t,t},we=(e,t,r,a,n)=>ve({node:r,parent:e,child:t,scope:{fn:n},meta:{op:a},family:{owners:[e,t],links:t},regional:1}),nn=(e,t)=>(O(G(t),".watch argument should be a function"),rn(ve({scope:{fn:t},node:[cr({fn:ir})],parent:e,meta:{op:"watch"},family:{owners:e},regional:1}))),an=(e,t,r="event")=>{ce(e)&&ce(e).hooks[r](t)},ln=(e,t,r,a)=>{let n=e==="domain",l=Fn(),s=Jt({or:a,and:typeof r=="string"?{name:r}:r}),{parent:i=null,sid:b=null,named:k=null}=s,h=k||s.name||(n?"":l),u=Gr(h,i),f={op:t.kind=e,name:t.shortName=h,sid:t.sid=Bn(b),named:k,unitId:t.id=l,serialize:s.serialize,derived:s.derived,config:s};if(t.parent=i,t.compositeName=u,t.defaultConfig=s,t.thru=p=>(_e(0,"thru","js pipe"),p(t)),t.getType=()=>u.fullName,!n){t.subscribe=o=>(Jr(o),t.watch(G(o)?o:g=>o.next&&o.next(g))),t[Pn]=()=>t;let p=Ne();p&&(f.nativeTemplate=p)}return f};const Bt=(e,t,r,a)=>{let n;te(r)&&(n=r,r=r.fn);let l=S({name:`${e.shortName} \u2192 *`,derived:1,and:n});return we(e,l,a,t,r),l},Er=(e,t,r,a,n)=>{let l=j(t),s=Y({store:l,to:"a",priority:"read"});r===qe&&(s.data.softRead=1);let i=[s,oe(a)];return z("storeOnMap",l,i,V(e)&&j(e)),we(e,t,i,r,n)},Qn=(e,t,r,a,n)=>{let l=e?o=>o.slice():o=>({...o}),s=e?[]:{},i=l(s),b=De(i),k=De(1);b.type=e?"list":"shape",b.noInit=1,z("combineBase",b,k);let h=C(i,{name:Wr(r),derived:1,and:a}),u=j(h);u.noInit=1,Ce(h,"isCombine",1);let f=ie(b);f.order={priority:"barrier"};let p=[J((o,g,d)=>(d.scope&&!d.scope.reg[b.id]&&(d.c=1),o)),f,Y({store:k,to:"b"}),J((o,{key:g},d)=>{if(d.c||o!==d.a[g])return t&&d.b&&(d.a=l(d.a)),d.a[g]=o,1},1),Y({from:"a",target:b}),Y({from:"value",store:0,target:k}),Y({from:"value",store:1,target:k,priority:"barrier",batch:1}),ie(b,1),n&&oe()];return Ie(r,(o,g)=>{if(!V(o))return O(!ge(o)&&!H(o),`combine expects a store in a field ${g}`),void(i[g]=s[g]=o);s[g]=o.defaultState,i[g]=o.getState();let d=we(o,h,p,"combine",n);d.scope.key=g;let c=j(o);yt(b,{type:"field",field:g,from:c}),z("combineField",c,d)}),h.defaultShape=r,yt(u,{type:qe,from:b,fn:n}),Ne()||(h.defaultState=n?u.current=n(i):s),h};let on=(e,t,r)=>{try{return[1,e(...r)]}catch(a){return t(a),[0,null]}},kt=(e,t,r,a,n)=>l=>T({target:[a,Xn],params:[r?{status:"done",params:e,result:l}:{status:"fail",params:e,error:l},{value:l,fn:r?t.rs:t.rj}],defer:1,page:n.page,scope:me(n)});const Xn=ve({node:[cr({fn:({fn:e,value:t})=>e(t)})],meta:{op:"fx",fx:"sidechain"}}),Kn=["source","clock","target"],sn=(e,t)=>e+`: ${t} should be defined`;let dr=(e,t,r,a,n,l,s,i,b,k,h,u)=>{let f=!!n;O(!H(r)||!H(t),sn(e,"either source or clock"));let p=0;H(r)?p=1:ge(r)||(r=U(r)),H(t)?t=r:(bt(t,e,"clock"),Array.isArray(t)&&(t=Je(t))),p&&(r=t),i||s||(s=r.shortName);let o="none";(h||a)&&(ge(a)?o="unit":(O(G(a),"`filter` should be function or unit"),o="fn")),n?(bt(n,e,"target"),Zr(e,n)):o==="none"&&k&&V(r)&&V(t)?n=C(l?l(We(j(r)),We(j(t))):We(j(r)),{name:s,sid:u,or:i}):(n=S({name:s,derived:1,or:i}),z("sampleTarget",Q(n)));let g=De(),d=[];if(o==="unit"){let[v,w]=Lr(a,n,t,g,e);d=[...zt(w),...zt(v)]}let[c,m]=Lr(r,n,t,g,e);return Re(r,[we(t,n,[z("sampleSourceLoader"),Y({from:Me,target:g}),...zt(m),ie(c,1,b),...d,ie(g),o==="fn"&&oe((v,w,{a:y})=>a(v,y),1),l&&oe(Xt),z("sampleSourceUpward",f)],e,l)]),n};const zt=e=>[ie(e),J((t,r,{a})=>a,1)],Lr=(e,t,r,a,n)=>{let l=V(e),s=l?j(e):De(),i=De(l);return l||ve({parent:e,node:[Y({from:Me,target:s}),Y({from:"value",store:1,target:i})],family:{owners:[e,t,r],links:t},meta:{op:n},regional:1}),z("sampleSource",i,s,a),[s,i]},jt=(e,t,r,a)=>{let n=e[t];n&&T({target:n,params:Array.isArray(n)?n.map(()=>r):r,defer:1,stack:a})};function ft(e,t){e.cursor[t].prev&&(e.cursor[t].prev.cursor[t].next=e.cursor[t].next),e.cursor[t].next&&(e.cursor[t].next.cursor[t].prev=e.cursor[t].prev),e.queue[t].last===e&&(e.queue[t].last=e.cursor[t].prev),e.queue[t].first===e&&(e.queue[t].first=e.cursor[t].next),e.cursor[t].prev=null,e.cursor[t].next=null}function Ge(e){var t,r;e.status="active",t=mt(e),(r=e).cursor.prev&&(r.cursor.prev.cursor.next=r.cursor.next),r.cursor.next&&(r.cursor.next.cursor.prev=r.cursor.prev),t.last===r&&(t.last=r.cursor.prev),t.first===r&&(t.first=r.cursor.next),r.cursor.prev=null,r.cursor.next=null}function mt(e){return e.group.activeChilds[e.priority]}function qr(e,t){t.value.active=t.value.pending=e,t.status!=="active"&&Ge(t)}function W(e,t){if(t.value.active===e)return t.value.pending=e,void(t.status==="pending"&&(Ge(t),mt(t).first||ft(t.group,t.priority)));var r,a,n,l;t.status==="active"&&(t.status="pending",mt(t).first||((n=t.group).queue[l=t.priority].last?(n.cursor[l].prev=n.queue[l].last,n.queue[l].last.cursor[l].next=n,n.queue[l].last=n):n.queue[l].first=n.queue[l].last=n),a=t,(r=mt(t)).last?(a.cursor.prev=r.last,r.last.cursor.next=a,r.last=a):r.first=r.last=a),t.value.pending=e,t.group.queue.rafID||(t.group.queue.rafID=bn(t.group.queue.execQueue))}function Yn(e){$e("execQueue");let t,r,a=ke(),n=0;e:for(;e.props.first||e.tree.first||e.data.first;){if(ke()-a>=1e3){n=1;break e}let l=!!e.props.first;for(l&&$e("props");t=e.props.first;){for(;r=t.activeChilds.props.first;){if(ke()-a>=1e3){n=1,ae("props");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,Ge(r)}ft(t,"props")}l&&ae("props");let s=!!e.tree.first;for(s&&$e("tree");t=e.tree.first;){for(;r=t.activeChilds.tree.first;){if(ke()-a>=1e3){n=1,ae("tree");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,Ge(r)}ft(t,"tree")}s&&ae("tree");let i=!!e.data.first;for(i&&$e("data");t=e.data.first;){for(;r=t.activeChilds.data.first;){if(ke()-a>=1e3){n=1,ae("data");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,Ge(r)}ft(t,"data")}i&&ae("data")}if(ae("execQueue"),n)e.rafID=bn(e.execQueue);else if(e.rafID=null,e.onDrain){let l=e.onDrain;e.onDrain=null,l()}}function Qe({value:e,runOp:t,group:r,priority:a}){return{value:{active:e,pending:e},runOp:t,status:"active",priority:a,group:r,cursor:{prev:null,next:null}}}function Jn({onComplete:e}){let t={props:{first:null,last:null},tree:{first:null,last:null},data:{first:null,last:null},rafID:null,execQueue(){},onDrain:e};return t.execQueue=Yn.bind(null,t),t}function Ze(e){return{ops:[],queue:e,activeChilds:{props:{first:null,last:null},tree:{first:null,last:null},data:{first:null,last:null}},cursor:{props:{prev:null,next:null},tree:{prev:null,next:null},data:{prev:null,next:null}}}}function Zn({value:e,group:t,onInit:r,onChange:a}){let n=Qe({value:e,group:t,runOp(s){l.status="A",a(s)},priority:"data"}),l={status:"IA",value:n.value,ops:{init:Qe({value:0,group:t,runOp(s){l.status="A",r(l.value.active)},priority:"data"}),change:n,terminate:Qe({value:0,group:t,runOp(s){l.status="T"},priority:"data"})}};return W(1,l.ops.init),l}function ea(e){switch(e.status){case"I":case"T":case"AT":return;case"A":e.status="AT",W(1,e.ops.terminate);break;case"AA":e.status="AT",W(1,e.ops.terminate),W(e.value.active,e.ops.change);break;case"IA":e.status="T",W(0,e.ops.init)}}function ta(e,t){switch(t.status){case"I":case"T":return;case"A":t.value.active!==e&&(t.status="AA",W(e,t.ops.change));break;case"AA":t.value.active===e?(t.status="A",W(e,t.ops.change)):t.value.pending!==e&&(t.value.pending=e);break;case"IA":t.value.active=t.value.pending=e}}function ra(e){switch(e=String(e)){case"__proto__":case"__defineGetter__":case"__defineSetter__":case"constructor":case"prototype":case"hasOwnProperty":case"toString":case"valueOf":case"setProperty":case"removeProperty":return"forbidden";default:return e.replace(/[^a-zA-Z0-9\-_]/g,"")}}function cn(e,t){for(let r=0;r<t.length;r++){let{type:a,field:n,value:l}=t[r];ia[a](e,n,l)}}function Et(e){return e!==""&&e!==0&&e!=="0"&&(e==0||e==null)}function un(e,t,r){Et(r)?e.style.removeProperty(`--${t}`):e.style.setProperty(`--${t}`,`${r}`)}function pn(e,t,r){Et(r)?delete e.style[t]:e.style[t]=`${r}`}function dn(e,t,r){t&&t.trim().length>0&&(r?e.classList.add(t):(e.classList.remove(t),e.classList.length===0&&e.removeAttribute("class")))}function fn(e,t,r){Et(r)?delete e.dataset[t]:e.dataset[t]=`${r}`}function mn(e,t,r){if(Et(r)){switch(t){case"value":delete e.value;break;case"checked":e.checked=0;break;case"spellcheck":if(r==0)return void e.setAttribute("spellcheck","false")}e.removeAttribute(t)}else{switch(t){case"value":e.value=`${r}`;break;case"checked":e.checked=`${r}`}e.setAttribute(t,`${r}`)}}function er(e,t){e.replaceData(0,(e.textContent||"").length,String(t))}function Oe({fn:e,state:t={},defer:r=0,name:a="",draft:n,isSvgRoot:l,namespace:s,env:i,isBlock:b=0}){let k=D,h={id:++ua,name:a,plain:[],watch:[],nameMap:{},pages:[],closure:[],childTemplates:[],handlers:ca,upward:Mr.filter({fn(f,p,o){if(!o.page){if(!o.parent||!o.parent.page)return 1;o.page=o.parent.page}if(!o.page.root.activeSpawns.has(o.page.fullID))return console.count("inactive page upward"),0;let g=[o.page.template],d=[o.page];{let c=o.page.parent;for(;c;)d.push(c),g.push(c.template),c=c.parent}return o.node.next.forEach(c=>{let m=c.meta.nativeTemplate;if(m)if(g.includes(m)){let v=d[g.indexOf(m)];T({target:c,params:f,defer:1,page:v,stack:o,scope:o.scope})}else console.error("context drift",{stack:o,node:c});else T({target:c,params:f,defer:1,page:o.page,stack:o,scope:o.scope})}),0}}),loader:Mr.filter({fn(f,p,o){if(o.parent){let g=o.scope?o.scope.graphite.id:null;if(o.page){if(!o.page.root.activeSpawns.has(o.page.fullID))return console.count("inactive page loader"),0;if(o.page.template===h)return 1;if(o.page.root.childSpawns[o.page.fullID][h.id])o.page.root.childSpawns[o.page.fullID][h.id].forEach(d=>{(!g||d.root.scope&&g===d.root.scope.graphite.id)&&T({params:f,target:o.node,page:d,defer:1,scope:o.scope})});else{let d=o.page.fullID,c=o.page.template.name==="rec";h.pages.forEach(m=>{if(!g||m.root.scope&&g===m.root.scope.graphite.id)if(m.fullID===d||m.fullID.startsWith(`${d}_`)){let v=1;if(c){let w=o.page.template.id,y=m.parent;for(;y&&y!==o.page;){if(y.template.id===w){v=0;break}y=y.parent}}v&&T({params:f,target:o.node,page:m,defer:1,scope:o.scope})}else d.startsWith(`${m.fullID}_`)&&T({params:f,target:o.node,page:o.page,defer:1,scope:o.scope})})}}else h.pages.forEach(d=>{(!g||d.root.scope&&g===d.root.scope.graphite.id)&&T({params:f,target:o.node,page:d,defer:1,scope:o.scope})});return 0}return 1}}),parent:k,node:null,api:null,trigger:{mount:S({named:"mount"})},draft:n,isSvgRoot:l,namespace:s,env:i,isBlock:b||!(!k||!k.isBlock)};k&&k.childTemplates.push(h);let u=ve({meta:{template:h}});return h.node=u,D=h,r?h.deferredInit=()=>{let f=D;D=h,h.deferredInit=null;try{$r(u,()=>{let p=Qt(t);h.api=e(p,h.trigger),h.nameMap=p})}finally{D=f}}:$r(u,()=>{let f=Qt(t);h.api=e(f,h.trigger),h.nameMap=f}),D=k,h}function na(e,t){let r;switch(r=t?t.getState(e):e.current,e.type){case"list":return[...r];case"shape":return{...r};default:return r}}function hn(e,t,r){let a=t;for(;a&&!tt(a,e);)a=a.parent;return a?tt(a,e):r?(r.getState(e),r.reg[e.id]):e}function Vt(e,t){tt(t,e)||(t.reg[e.id]=hn(e,t.parent,t.root.scope))}function Rr(e,t,r){t in r||(r[t]=[]),r[t].push(...e)}function wt(e,{values:t={},parentLeaf:r,mountNode:a,svgRoot:n,leafData:l,opGroup:s,domSubtree:i,hydration:b,root:k}){function h(d){if(d.before)for(let c=0;c<d.before.length;c++){let m=d.before[c];switch(m.type){case"map":{let v,w=m.from;if(!m.fn&&!w)break;w&&(Vt(w,p),v=f[w.id].current),f[d.id].current=m.fn?m.fn(v):v;break}case"field":{let v=m.from;Vt(v,p),f[d.id].current[m.field]=f[v.id].current;break}case"closure":Vt(m.of,p)}}}function u(d,c,m){let v;c.stop=1;try{for(;c.i<d.length;)v=d[c.i],c.i++,v.fn(m[v.of.id]?m[v.of.id].current:hn(v.of,p.parent,p.root.scope).current)}catch(w){console.error(w),c.stop=0}}let f={},p={draft:e.draft,svgRoot:n,data:l,parent:r,hydration:b,mountNode:a,root:k,id:++pa,fullID:"",reg:f,template:e};e.pages.push(p);let o=Le;Le=p,r&&Rr([p],e.id,k.childSpawns[r.fullID]),p.fullID=r?`${r.fullID}_${p.id}`:`${p.id}`,k.childSpawns[p.fullID]={},k.activeSpawns.add(p.fullID),k.leafOps[p.fullID]={group:s,domSubtree:i};for(let d=0;d<e.closure.length;d++){let c=e.closure[d],m=c,v=p.parent;e:for(;v;){if(tt(v,c)){m=tt(v,c);break e}v=v.parent}!v&&k.scope&&(k.scope.getState(c),m=k.scope.reg[c.id]),f[c.id]=m}for(let d=0;d<e.plain.length;d++){let c=e.plain[d],m={id:c.id,current:na(c,k.scope)};f[c.id]=m}for(let d in t){let c=e.nameMap[d].stateRef.id;f[c]={id:c,current:t[d]}}e.closure.forEach(h),e.plain.forEach(h);let g={i:0,stop:0};for(;!g.stop;)u(e.watch,g,f);if(r)for(let d in k.childSpawns[p.fullID])Rr(k.childSpawns[p.fullID][d],d,k.childSpawns[r.fullID]);if(fe)fe.steps.push({target:e.trigger.mount,params:p,defer:1,page:p,scope:k.scope});else{let d;fe={parent:fe,steps:[{target:e.trigger.mount,params:p,defer:1,page:p,scope:k.scope}]};do for(;d=fe.steps.shift();)fe={parent:fe,steps:[]},T(d);while(fe=fe.parent)}return Le=o,p}function xt(e){let t=e.parent;for(;t.type!=="element"&&t.type!=="using";)t=t.parent;return t?t.value:null}function St(e){if(!e.visible)return null;switch(e.type){case"text":case"element":return e;case"LF":case"route":case"rec":case"recItem":case"block":case"blockItem":for(let t=e.child.length-1;t>=0;t--){let r=St(e.child[t]);if(r)return r}return null;case"list":{let t=e.lastChild;if(!t)return null;for(;t;){let r=St(t);if(r)return r;t=t.left}return null}default:return null}}function $t(e){switch(e.type){case"using":return null;case"LF":{let t=e.left;for(;t;){let r=St(t);if(r)return r;t=t.left}return $t(e.parent)}case"element":case"text":case"route":case"rec":case"recItem":case"block":case"blockItem":case"list":{let t=e.parent;for(let r=e.index-1;r>=0;r--){let a=t.child[r];if(!a)continue;let n=St(a);if(n)return n}switch(t.type){case"element":case"using":return null}return $t(t)}default:return null}}function tr(e){let t=$t(e);return t?t.value:null}function et(e,t){if(!e)throw Error(t)}function at(e,t){if(!e)throw Error(`${t}() called outside from using() closure`)}function It(e){if(!D)return;let{draft:t}=e;if(t.type!=="listItem"&&t.type!=="rec")switch(D.draft.type){case"element":case"using":case"route":case"list":case"rec":case"recItem":case"block":case"blockItem":t.inParentIndex=D.draft.childCount,D.draft.childCount+=1,D.draft.childTemplates.push(e);break;default:console.warn(`unexpected currentTemplate type ${D.draft.type}`)}}function he(e,{parentBlockFragment:t,leaf:r,node:a,svgRoot:n,values:l}){e.childTemplates.forEach(s=>{fr({parentBlockFragment:t,leaf:r,node:a,svgRoot:n,values:l,actor:s})})}function fr({parentBlockFragment:e,leaf:t,node:r=t.mountNode,actor:a,svgRoot:n,values:l}){let s;et(da.includes(e.type),`incorrect parent ${e.type}`);let{draft:i}=a,{queue:b}=t.root.leafOps[t.fullID].group,k=Ze(b),h=t.root.leafOps[t.fullID].domSubtree,u=h;switch(i.type){case"route":{let p={type:"route",parent:e,child:[],visible:0,index:i.inParentIndex};e.child[i.inParentIndex]=p,s={type:"route",block:p,ops:{},initialized:0,pendingInit:null};break}case"element":{let p;if(a.isBlock){let g,d,c=t;for(;c&&(!d||!g);){c.template.env&&(g=c.template.env);let{draft:m}=c;m.type==="element"&&(m.tag==="svg"?d="svg":m.tag==="foreignObject"&&(d="html")),c=c.parent}d||(d="html"),g&&(p=d==="svg"?g.document.createElementNS("http://www.w3.org/2000/svg",i.tag):g.document.createElement(i.tag),cn(p,i.staticSeq))}else p=i.stencil.cloneNode();let o={type:"element",parent:e,child:[],value:p,visible:0,index:i.inParentIndex};e.child[i.inParentIndex]=o,s={type:"element",block:o,ops:{visible:Qe({value:0,priority:"tree",runOp(g){if(g){gn(o);let d=s;d.needToCallNode&&(d.needToCallNode=0,T({target:Ct,params:{element:o.value,fns:i.node},page:f,scope:t.root.scope})),o.visible=1}else o.value.remove(),o.visible=0},group:h})},needToCallNode:i.node.length>0},u=Ze(b);break}case"list":{let p={type:"list",parent:e,child:[],lastChild:null,visible:1,index:i.inParentIndex};e.child[i.inParentIndex]=p,s={type:"list",draft:i,block:p,records:[],pendingUpdate:null};break}case"using":case"listItem":break;case"rec":{let p={type:"rec",parent:e,child:[],visible:1,index:i.inParentIndex};e.child[i.inParentIndex]=p,s={type:"rec",block:p};break}case"recItem":{let p={type:"recItem",parent:e,child:[],visible:1,index:i.inParentIndex};e.child[i.inParentIndex]=p,s={type:"rec item",block:p};break}case"block":{let p={type:"block",parent:e,child:[],visible:1,index:i.inParentIndex};e.child[i.inParentIndex]=p,s={type:"block",block:p};break}case"blockItem":{let p={type:"blockItem",parent:e,child:[],visible:1,index:i.inParentIndex};e.child[i.inParentIndex]=p,s={type:"block item",block:p};break}default:console.warn(`unexpected draft type ${i.type}`)}let f=wt(a,{values:l,parentLeaf:t,mountNode:r,svgRoot:n||t.svgRoot,leafData:s,opGroup:k,domSubtree:u,hydration:t.hydration,root:t.root})}function gn(e){let t=tr(e);t?t.after(e.value):xt(e).prepend(e.value),e.visible=1}function Ee({mount:e,state:t,onMount:r,onState:a}){return{onMount:M({source:t,clock:e,fn:r,greedy:1}),onState:M({source:e,clock:t,fn:a,greedy:1})}}function Xe(e,t){for(let r in e)t(e[r],r)}function Ar(e,t){if(!D)return;let r=D.draft;et(r.type==="element",`"handler" extension can be used only with element nodes, got "${r.type}"`),t===void 0&&(t=e,e={});for(let i in t)et(q.unit(t[i]),`handler for "${i}" should be event`);let{passive:a=0,capture:n=0,prevent:l=0,stop:s=0}=e;r.handler.push({options:{prevent:l,stop:s},domConfig:{passive:l?0:a,capture:n},map:t})}function Z(e){at(D,"spec");let t=D.draft;switch(t.type){case"list":return void(e.visible&&(t.itemVisible=e.visible));case"listItem":case"using":case"route":case"rec":case"recItem":case"block":case"blockItem":return}if(e.attr&&t.attr.push(e.attr),e.data&&t.data.push(e.data),"text"in e){let n=e.text,l=t.childCount;Array.isArray(n)?(t.text.push(...n.map((s,i)=>({index:i+l,value:s}))),t.childCount+=n.length):(t.text.push({index:l,value:n}),t.childCount+=1)}if(e.style){let n={};for(let l in e.style)n[ra(l)]=e.style[l];t.style.push(n)}var r,a;if(e.classList&&(r=e.classList,a=n=>t.classList.push(n),Array.isArray(r)?r.forEach(n=>{let l=typeof n=="string"?n:n.map(i=>i||""),s=typeof n=="string"?1:n.map(i=>i!==null);a({name:l,enabled:s})}):Xe(r,(n,l)=>{a({name:l,enabled:n})})),e.styleVar&&t.styleVar.push(e.styleVar),e.visible&&(t.visible=e.visible),e.handler){let n=e.handler;typeof n.on=="object"?Ar(n.config||{},n.on):Ar(n)}e.\u0254&&Z(e.\u0254)}function Ut(e,{initCtx:t,runOp:r,hooks:{onMount:a,onState:n}}){let l=e.opsAmount++;a.watch(({value:s,leaf:i})=>{let b=t(s,i),k=Qe({value:s,priority:"props",runOp(h){r(h,b)},group:i.root.leafOps[i.fullID].group});i.root.leafOps[i.fullID].group.ops[l]=k}),n.watch(({value:s,leaf:i})=>{W(s,i.root.leafOps[i.fullID].group.ops[l])})}function ot(e,t,r){e[t].forEach(a=>{Xe(a,(n,l)=>{switch(t){case"data":case"styleVar":r[t][l]=n;break;case"attr":r.attr[l==="xlink:href"?"href":l]=n;break;case"style":l.startsWith("--")?r.styleVar[l.slice(2)]=n:r.style[l]=n}})})}function Pr(e,t,r){let a=e.data.block,n={type:"text",parent:a,visible:0,index:r,value:null};if(a.child[r]=n,e.hydration){let l=$t(n);if(l)switch(l.type){case"text":n.value=e.root.env.document.createTextNode(t),l.value.after(n.value);break;case"element":n.value=l.value.nextSibling,er(n.value,t)}else{let s=xt(n);n.value=s.firstChild,er(n.value,t)}n.visible=1}else n.value=e.root.env.document.createTextNode(t),gn(n);return n}function je(e){let t=e.stateRef,r=D;r.plain.includes(t)||r.closure.includes(t)||r.closure.push(t)}function I(e,t){let r,a=0,n=0;typeof t=="function"?(a=1,r=t):t&&(n=1,t.fn&&(a=1,r=t.fn),t.\u0254&&(typeof t.\u0254=="function"?(a=1,r=t.\u0254):typeof t.\u0254.fn=="function"&&(a=1,r=t.\u0254.fn))),at(D,"h");let l,s=D.env,i=D.namespace,b=i,k="html";b=k=i==="svg"?"svg":"html",e==="svg"&&(k="svg",b="svg"),D.isBlock||(l=k==="svg"?s.document.createElementNS("http://www.w3.org/2000/svg",e):s.document.createElement(e));let h=l,u={type:"element",tag:e,attr:[],data:[],text:[],style:[],styleVar:[],classList:[],handler:[],stencil:h,seq:[],staticSeq:[],childTemplates:[],childCount:0,inParentIndex:-1,opsAmount:1,node:[]};i==="foreignObject"?(u.attr.push({xmlns:"http://www.w3.org/1999/xhtml"}),b="html"):e==="svg"?(u.attr.push({xmlns:"http://www.w3.org/2000/svg"}),b="svg"):e==="foreignObject"&&(b="foreignObject");let f=Oe({name:"element",draft:u,isSvgRoot:e==="svg",namespace:b,fn(p,{mount:o}){let g=S({named:"domElementCreated"});a&&r(),n&&Z(t),q.unit(u.visible)&&(u.seq.push({type:"visible",value:u.visible}),je(u.visible));let d={attr:{},data:{},style:{},styleVar:{}};ot(u,"attr",d),ot(u,"data",d),ot(u,"style",d),ot(u,"styleVar",d),Xe(d,(c,m)=>{Xe(c,(v,w)=>{q.unit(v)?(u.seq.push({type:m,field:w,value:v}),je(v)):u.staticSeq.push({type:m,field:w,value:v})})}),u.classList.forEach(c=>{if(q.unit(c.name)||q.unit(c.enabled)){let m=q.unit(c.name)?c.name:C(c.name),v=q.unit(c.enabled)?c.enabled:C(c.enabled);u.seq.push({type:"classList",field:m,value:v}),je(m),je(v)}else q.unit(c.name)||u.staticSeq.push({type:"classList",field:c.name,value:c.enabled})}),u.text.forEach(c=>{c.value!==null&&(q.unit(c.value)?(u.seq.push({type:"dynamicText",value:c.value,childIndex:c.index}),je(c.value)):u.seq.push({type:"staticText",value:String(c.value),childIndex:c.index}))}),u.handler.forEach(c=>{Xe(c.map,(m,v)=>{u.seq.push({type:"handler",for:v,handler:m,options:c.options,domConfig:c.domConfig})})}),h&&cn(h,u.staticSeq),u.seq.forEach(c=>{switch(c.type){case"visible":{let{onMount:m,onState:v}=Ee({mount:o,state:c.value,onMount:(w,y)=>({leaf:y,value:w,hydration:y.hydration}),onState:(w,y)=>({leaf:w,value:y,hydration:0})});m.watch(({leaf:w,value:y,hydration:x})=>{let $=w.data,_=$.block;if(x&&(qr(y,$.ops.visible),y)){let L,P=tr(_);if(L=P?P.nextSibling:xt(_).firstChild,L.nodeName==="#text"){let ue=L;L=L.nextSibling,ue.remove()}_.value=L,_.visible=1}he(u,{parentBlockFragment:_,leaf:w,node:_.value,svgRoot:f.isSvgRoot?_.value:null}),y&&$.needToCallNode&&($.needToCallNode=0,T({target:Ct,params:{element:$.block.value,fns:u.node},page:w,defer:1,scope:w.root.scope})),T({target:g,params:w,defer:1,page:w,scope:w.root.scope})}),Je([v,m]).watch(({leaf:w,value:y,hydration:x})=>{x||W(y,w.data.ops.visible)});break}case"attr":case"data":case"style":case"styleVar":{let m=zr[c.type],v=fa.some(({type:y,field:x})=>c.type===y&&c.field===x),w=Ee({mount:g,state:c.value,onMount:(y,x)=>({leaf:x,value:y}),onState:(y,x)=>({leaf:y,value:x})});v?Je([w.onState,w.onMount]).watch(({leaf:y,value:x})=>{m(st(y),c.field,x)}):Ut(u,{initCtx(y,x){let $=st(x);return m($,c.field,y),$},runOp(y,x){m(x,c.field,y)},hooks:w});break}case"classList":{let m=zr.classList,v=C({prev:"",curr:c.field.getState()}).on(c.field,({curr:y},x)=>({prev:y,curr:x})),w=Ee({mount:g,state:U({name:v,enabled:c.value}),onMount:(y,x)=>({leaf:x,value:y}),onState:(y,x)=>({leaf:y,value:x})});Ut(u,{initCtx(y,x){let $=st(x);return m($,y.name.curr,y.enabled),$},runOp(y,x){y.name.prev!==y.name.curr&&m(x,y.name.prev,0),m(x,y.name.curr,y.enabled)},hooks:w});break}case"dynamicText":Ut(u,{initCtx:(m,v)=>Pr(v,m,c.childIndex),runOp(m,v){er(v.value,m)},hooks:Ee({mount:g,state:c.value,onMount:(m,v)=>({leaf:v,value:String(m)}),onState:(m,v)=>({leaf:m,value:String(v)})})});break;case"staticText":g.watch(m=>{Pr(m,c.value,c.childIndex)});break;case"handler":{let m=c.handler.graphite.meta.nativeTemplate||null;g.watch(v=>{let w=null;if(m){let y=0,x=v;for(;!y&&x;)x.template===m?(y=1,w=x):x=x.parent}else w=null;st(v).addEventListener(c.for,y=>{c.options.prevent&&y.preventDefault(),c.options.stop&&y.stopPropagation(),T({target:c.handler,params:y,page:w,scope:v.root.scope})},c.domConfig)});break}}}),o.watch(c=>{let m=c.data;if(!u.visible){let v=m.ops.visible,w=m.block;if(c.hydration){qr(1,v);let y,x=tr(w);if(y=x?x.nextSibling:xt(w).firstChild,y.nodeName==="#text"){let $=y;y=y.nextSibling,$.remove()}w.value=y,w.visible=1}he(u,{parentBlockFragment:w,leaf:c,node:w.value,svgRoot:f.isSvgRoot?w.value:null}),T({target:g,params:c,defer:1,page:c,scope:c.root.scope}),c.hydration?m.needToCallNode&&(m.needToCallNode=0,T({target:Ct,params:{element:m.block.value,fns:u.node},page:c,defer:1,scope:c.root.scope})):W(1,v)}})},env:s});It(f)}function Or(){if(typeof document<"u")return{document};throw Error("your environment has no document")}function aa(e,t){let r,a,n,l,s,i;if(typeof t=="function")r=t,n=Or(),l=0;else{if(!t)throw Error("using() second argument is missing");r=t.fn,n=t.env?t.env:Or(),l=t.hydrate,a=t.onComplete,s=t.onRoot,i=t.scope}et(e,"using() first argument is missing");let b={scope:i,env:n,activeSpawns:new Set,childSpawns:{},leafOps:{}},k=e.namespaceURI,h=e.tagName.toLowerCase(),u={type:"using",childTemplates:[],childCount:0,inParentIndex:-1},f=Oe({name:"using",draft:u,isSvgRoot:h==="svg",namespace:k==="http://www.w3.org/2000/svg"?"svg":h==="foreignobject"?"foreignObject":"html",fn(d,{mount:c}){r(),c.watch(hr.using)},env:n}),p={type:"using",child:[],value:e},o=Jn({onComplete:a}),g=wt(f,{parentLeaf:Le||null,mountNode:e,svgRoot:f.isSvgRoot?e:Le?Le.svgRoot:null,leafData:{type:"using",draft:u,element:e,block:p},opGroup:Ze(o),domSubtree:Ze(o),hydration:l,root:b});if(s&&s({template:f,leaf:g}),o.onDrain&&!o.rafID){let d=o.onDrain;o.onDrain=null,d()}}function rr(e,t){let r=e.root.childSpawns[e.fullID];for(let a in r){let n=r[a];for(let l=0;l<n.length;l++)t(n[l])}}function vn(e,t){let r=a=>{let n=a.data;if(e&&n.type==="list"&&n.pendingUpdate){let l=n.pendingUpdate;n.pendingUpdate=null,T({target:a.template.api.pendingUpdate,params:l,defer:1,page:a,scope:a.root.scope})}if(e&&n.type==="route"){if(n.pendingInit){let l=n.pendingInit.value;n.pendingInit=null,T({target:a.template.api.pendingInit,params:l,defer:1,page:a,scope:a.root.scope})}else if(!n.block.visible)return}switch(n.type){case"element":W(e,n.ops.visible);break;case"route":case"list":case"list item":rr(a,r);break;default:console.log("unsupported type",n.type)}};rr(t,r)}function Ht(e){e.root.activeSpawns.delete(e.fullID),rr(e,mr)}function Wt(e){Ke(e,e.root.childSpawns[e.parent.fullID][e.template.id]),Ke(e,e.template.pages)}function mr(e){let{data:t,root:r}=e;switch(t.type){case"element":Ke(e,r.childSpawns[e.parent.fullID][e.template.id]),function a(n){r.activeSpawns.delete(n.fullID);let l=r.childSpawns[n.fullID];delete r.childSpawns[n.fullID],delete r.leafOps[n.fullID],Ke(n,n.template.pages);for(let s in l)l[s].forEach(a)}(e),W(0,t.ops.visible);break;case"list":{let a=t.records;for(let n=0;n<a.length;n++){let l=a[n];l.instance&&mr(l.instance),l.active=0}e.root.activeSpawns.delete(e.fullID),Wt(e);break}case"list item":{let a=t.block;Ke(a,a.parent.child);let n=a.left,l=a.right;n&&(n.right=l,l||a.parent.lastChild!==a||(a.parent.lastChild=n)),l&&(l.left=n),n||l||a.parent.lastChild!==a||(a.parent.lastChild=null),a.left=null,a.right=null,Ht(e),Wt(e);break}case"route":Ht(e),Wt(e);break;case"block":case"block item":case"rec":case"rec item":Ht(e)}delete r.childSpawns[e.fullID],delete r.leafOps[e.fullID]}function Ke(e,t){if(!t)return;let r=t.indexOf(e);r!==-1&&t.splice(r,1)}function la(e,t){if(Array.isArray(t))return t.map(r=>e.map(a=>a[r]));if(typeof t=="object"&&t!==null){let r={};for(let a in t){let n=t[a];r[a]=e.map(typeof n=="function"?l=>n(l):l=>l[n])}return r}return e.map(r=>r[t])}function ht(e,t){at(D,"list"),typeof t=="function"&&(q.unit(e)?e={source:e,fn:t}:e.fn=t);let{fn:r,key:a,source:n,fields:l=[]}=e,s=a!==void 0?typeof a=="function"?a:h=>h[a]:(h,u)=>u,i={type:"list",key:q.store(e)?{type:"index"}:{type:"key",key:e.key},childTemplates:[],childCount:0,inParentIndex:-1},{env:b,namespace:k}=D;It(Oe({name:"list",draft:i,isSvgRoot:0,namespace:k,fn(h,{mount:u}){let f=Oe({name:"list item",state:{id:-1,store:null},draft:i,isSvgRoot:0,namespace:k,fn({id:m,store:v},{mount:w}){r({store:v,key:m,fields:la(v,l)});let y=S({named:"itemUpdater"});if(v.on(y,(x,$)=>$),i.itemVisible){let{onMount:x,onState:$}=Ee({mount:w,state:i.itemVisible,onMount:(_,L)=>({visible:_,leaf:L}),onState:(_,L)=>({visible:L,leaf:_})});x.watch(({visible:_,leaf:L})=>{let P=L.data.block;P.visible=_,P.childInitialized=_,_&&he(i,{parentBlockFragment:P,leaf:L})}),$.watch(({visible:_,leaf:L})=>{let P=L.data.block;P.visible=_,P.childInitialized?vn(_,L):_&&(P.childInitialized=1,he(i,{parentBlockFragment:P,leaf:L}))})}else w.watch(hr.listItem);return{itemUpdater:y}},env:b}),p=C([]),o=n.map(m=>m),g=M({source:n,clock:u,fn:(m,v)=>({updates:m,leaf:v,hydration:v.hydration}),greedy:1}),d=S(),c=M({source:g,clock:[o,d],fn:({leaf:m},v)=>({updates:v,leaf:m,hydration:0}),greedy:1});return M({source:p,clock:[g,c],greedy:1,fn(m,{updates:v,leaf:w,hydration:y}){let x=w.data,$=w;for(;$;){if($.data.type==="route"&&!$.data.block.visible)return void(x.pendingUpdate=v);$=$.parent}let _=x.block;$e("list update ["+n.shortName+"]");let L=Array(v.length).fill(0),P=v.map(s),ue=[];for(let pe=0;pe<m.length;pe++){let re=m[pe],be=P.indexOf(re.key);be!==-1?(ue.push(re),L[be]=1,ta(v[be],re.asyncValue)):(re.active=0,re.instance&&mr(re.instance),ea(re.asyncValue))}for(let pe=0;pe<v.length;pe++){if(L[pe])continue;let re=v[pe],be=P[pe],Pt=Ze(w.root.leafOps[w.fullID].group.queue),ye={type:"LF",parent:_,child:[],childInitialized:0,visible:0,left:null,right:null},ne={type:"listItem",key:be,index:be,active:1,leafData:{type:"list item",block:ye,listDraft:i},asyncValue:Zn({value:re,group:Pt,onChange(xe){ne.instance&&T({target:ne.instance.template.api.itemUpdater,params:xe,defer:1,page:ne.instance,scope:ne.instance.root.scope})},onInit(xe){ne.active&&(y||(ne.instance=wt(f,{values:{id:be,store:xe},parentLeaf:w,mountNode:w.mountNode,svgRoot:w.svgRoot,leafData:ne.leafData,opGroup:Pt,domSubtree:w.root.leafOps[w.fullID].domSubtree,hydration:y,root:w.root})))}})},xr=ue.length;ue.push(ne);let Sr=xr>0?ue[xr-1].leafData:null;if(_.child.push(ye),Sr){let xe=Sr.block;ye.left=xe;let Ot=xe.right;Ot?(Ot.left=ye,ye.right=Ot):_.lastChild=ye,xe.right=ye}else _.lastChild=ye;y&&(ne.instance=wt(f,{values:{id:be,store:re},parentLeaf:w,mountNode:w.mountNode,svgRoot:w.svgRoot,leafData:ne.leafData,opGroup:Pt,domSubtree:w.root.leafOps[w.fullID].domSubtree,hydration:y,root:w.root}))}return ae("list update ["+n.shortName+"]"),ue.length===0&&(_.lastChild=null),x.records=ue,ue},target:p}),{pendingUpdate:d}},env:b}))}function Fr({source:e,visible:t,fn:r}){at(D,"route");let{env:a,namespace:n}=D,l=Oe({name:"route",isSvgRoot:0,namespace:n,env:a,draft:{type:"route",childTemplates:[],childCount:0,inParentIndex:-1},fn(s,{mount:i}){let b;if(q.store(t))b=U({value:e,visible:t});else{let o=t;b=e.map(g=>({value:g,visible:o(g)}))}let k=Oe({name:"route item",isSvgRoot:0,namespace:n,env:a,draft:{type:"route",childTemplates:[],childCount:0,inParentIndex:-1},state:{store:null},fn({store:o},{mount:g}){let d=S({named:"itemUpdater"});o.on(d,(m,v)=>v),r({store:o});let c=M({source:g,clock:b,fn:(m,{visible:v,value:w})=>({leaf:m,visible:v,value:w}),greedy:1});g.watch(hr.routeItem),c.watch(({leaf:m,visible:v,value:w})=>{if(m.data.block.visible=v,v&&T({target:d,params:w,defer:1,page:m,scope:m.root.scope}),v){let y=m.parent;for(;y;){if(y.data.type==="route"&&!y.data.block.visible)return;y=y.parent}}vn(v,m)})}});It(k);let{onMount:h,onState:u}=Ee({mount:i,state:b,onMount:({visible:o,value:g},d)=>({leaf:d,visible:o,value:g}),onState:(o,{visible:g,value:d})=>({leaf:o,visible:g,value:d})}),f=S(),p=M({source:i,clock:f,greedy:1,fn:(o,g)=>({leaf:o,value:g,visible:1})});return Je([h,u,p]).watch(({leaf:o,visible:g,value:d})=>{let c=o.data;if(c.block.visible=g,g||c.initialized||!c.pendingInit){if(g&&!c.initialized){let m=o.parent;for(;m;){if(m.data.type==="route"&&!m.data.block.visible)return void(c.pendingInit={value:d});m=m.parent}}g&&!c.initialized&&(fr({parentBlockFragment:c.block,leaf:o,actor:k,values:{store:d}}),c.initialized=1)}else c.pendingInit=null}),{pendingInit:f}}});It(l)}function oa({source:e,cases:t,key:r}){let a;at(D,"variant"),et(q.unit(e),"variant({source}) should be unit"),a=typeof r=="function"?r:r==null?l=>String(l):l=>String(l[r]);let n=0;for(let l in t)l!=="__"?Fr({source:e,visible:s=>a(s)===l,fn:t[l]}):n=1;if(n){let l=Object.keys(t);Fr({source:e,visible:s=>!l.includes(a(s)),fn:t.__})}}function sa(e,t){if(t.length===0)return e;let r=[e[0]];for(let a=0;a<t.length;a++)r.push(t[a],e[a+1]);return r}function X(e,...t){Array.isArray(e)?Z({text:sa(e,t)}):Z({text:e})}let ke;ke=typeof performance<"u"&&performance.now?()=>performance.now():typeof process<"u"&&process.hrtime?()=>{let e=process.hrtime();return(1e9*e[0]+e[1])/1e6}:()=>Date.now();let nr=new Map;const Ue=[],Nr=e=>{let t=nr.get(e);t||(t={calls:0,time:0,label:e,childTime:0},nr.set(e,t)),t.calls+=1,Ue.push({bucket:t,pendingStart:ke()})},Br=e=>{let t=nr.get(e),r=Ue.pop().pendingStart,a=ke()-r;t.time+=a,Ue.length>0&&(Ue[Ue.length-1].bucket.childTime+=a)};let $e,ae;typeof performance<"u"&&performance.mark?($e=e=>{performance.mark("\u2604\uFE0F "+e+" start"),Nr(e)},ae=e=>{Br(e);try{performance.measure("\u2604\uFE0F "+e,"\u2604\uFE0F "+e+" start")}catch{}performance.clearMarks("\u2604\uFE0F "+e+" start"),performance.clearMeasures("\u2604\uFE0F "+e)}):($e=e=>{Nr(e)},ae=e=>{Br(e)});let bn=typeof requestAnimationFrame<"u"?requestAnimationFrame:e=>setTimeout(e,0);const ia={attr:mn,data:fn,style:pn,styleVar:un,classList:dn},de=(e,t)=>e.includes(t);let ca={storeBase(e,t){e.plain.push(t)},storeOnMap(e,t,r,a){var n,l;r.unshift(e.loader),r.push(e.upward),a&&(de(e.plain,a)||(de(e.closure,a)||e.closure.push(a),l={type:"closure",of:a},(n=t).before||(n.before=[]),n.before.push(l)))},storeMap(e,t,r){de(e.plain,t)||de(r.seq,e.loader)||r.seq.unshift(e.loader)},storeWatch:(e,t,r)=>(e.watch.push({of:t,fn:r}),1),eventPrepend(e,t){t.seq.push(e.upward)},combineBase(e,t,r){e.plain.push(t,r)},combineField(e,t,r){de(e.plain,t)||r.seq.unshift(e.loader)},splitBase(e,t){e.plain.push(t)},splitMatchStore(e,t,r){de(e.plain,t)||r.seq.unshift(e.loader)},sampleSource(e,t,r,a){t.current?de(e.plain,r)||de(e.closure,r)||e.closure.push(r):e.plain.push(r),e.plain.push(t),de(e.plain,a)||e.plain.push(a)},sampleTarget(e,t){t.seq.push(e.loader)},sampleSourceLoader:e=>e.loader,sampleSourceUpward:(e,t)=>t&&e.upward},ua=0,pa=0,D=null,Le=null;const tt=(e,t)=>e.reg[t.id];let fe=null;const da=["LF","using","element","recItem","rec","block","blockItem","route"];let Ct=S({named:"onMount"});Ct.watch(({fns:e,element:t})=>{e.forEach(r=>{r(t)})});const fa=[{type:"attr",field:"value"},{type:"attr",field:"checked"},{type:"attr",field:"min"},{type:"attr",field:"max"}],zr={attr:mn,data:fn,style:pn,styleVar:un,classList:dn},st=e=>e.data.block.value;let hr={using(e){let t=e.data;he(t.draft,{parentBlockFragment:t.block,leaf:e})},routeItem(e){let t=e.draft,r=e.data;r.block.visible=1,he(t,{parentBlockFragment:r.block,leaf:e})},block(e){he(e.draft,{parentBlockFragment:e.data.block,leaf:e})},blockItem(e){fr({parentBlockFragment:e.data.block,leaf:e,actor:e.draft.itemOf})},rec(e){he(e.draft,{parentBlockFragment:e.data.block,leaf:e})},listItem(e){let t=e.data,r=t.block;r.visible=1,r.childInitialized=1,he(t.listDraft,{parentBlockFragment:r,leaf:e})}};const ar="#5583e5",yn="#79e555",jr=[1,35],ma=20;function ha(e,t){let r=Math.floor(e.clientY/t),a=Math.floor(e.clientX/t);return{row:r,col:a,shift:e.shiftKey}}function ga(e){return""}function va(e){console.warn("TODO saveToLS")}function ba(e){const[t,r]=e.split("|");return[+t,+r]}function ya(){try{return(JSON.parse(localStorage.getItem("history")||"null")||[]).map(({fauna:r,name:a})=>{let n=new Map;return r.forEach(([l,s])=>{const[i,b]=ba(l);n.has(i)||n.set(i,new Map),n.get(i).set(b,s)}),{fauna:n,name:a}})}catch(e){return console.error(e),[]}}function kn(){return{width:window.visualViewport.width,height:window.visualViewport.height}}function ka(e){let t=0,r=0,a=0;return e.size===0?{col:t,row:r}:(e.forEach((n,l)=>{a+=n.size,n.forEach((s,i)=>{t+=l,r+=i})}),{col:Math.round(t/a),row:Math.round(r/a)})}function wa(e){let t=new Map;const r="b",a="o",n="$";let l="",s=0,i=0;for(let b=0;b<e.length;b++){let k=e[b];if(k.charCodeAt(0)>=48&&k.charCodeAt(0)<=57)l+=k;else{let h=+l||1;if(k===r)i+=h;else if(k===a)for(let u=0;u<h;u++)t.has(i)||t.set(i,new Map),t.get(i).set(s,1),i++;else k===n&&(s+=h,i=0);l=""}}return t}function xa(){return{currentBp:C(null)}}const Vr=kn();function Sa(){const e=jr,t=C(ma),r=t.map(s=>({height:Math.ceil(Vr.height/s),width:Math.ceil(Vr.width/s)})),a=S(),n=S();return t.on(n,s=>{let i=s-1;return Math.max(jr[0],i)}).on(a,s=>s+1),{options:e,$cellSize:t,$fieldSize:r,plus:a,minus:n}}function $a(){const e=C(!1),t=S();return e.on(t,(a,n)=>n),{$isOn:e,changed:t}}function Ia(e){const t=S(),r=S(),a=C(null,{updateFilter:(l,s)=>!(l&&s&&l.row===s.row&&l.col===s.col)});return a.on(r,()=>null),M({source:e,clock:t,fn:(l,s)=>ha(s,l),target:a}),{$cell:a,fieldMouseLeaved:r,fieldMouseMoved:t}}function Ca(e,t){const r=C(null),a=C(null),n=C(null),l=S(),s=S(),i=S(),b=S(),k=S(),h=S();function u(){document.addEventListener("mousedown",l),document.addEventListener("mouseup",s)}const f=e.map(o=>o!==null),p=e.map(o=>o==null);return n.on(l,()=>Date.now()),M({source:t,clock:l,filter:f,target:r}),M({source:e,clock:l,filter:f,target:a}),M({source:{currentHovered:e,initHovered:a,startTime:n},clock:s,filter:o=>!!o.initHovered&&!!o.currentHovered&&!!o.startTime,fn:({currentHovered:o,initHovered:g,startTime:d})=>({start:{col:o.col,row:o.row},finish:g,duration:Date.now()-d}),target:i}),M({source:{currentHovered:e,initFocus:r,initHovered:a},clock:e,filter:o=>!!o.initHovered&&!!o.initFocus&&!!o.currentHovered,fn:({currentHovered:o,initHovered:g,initFocus:d})=>({col:d.col+(o.col-g.col),row:d.row+(o.row-g.row)}),target:h}),An({source:i,match:o=>o.start.col===o.finish.col&&o.start.row===o.finish.row?"click":"dragEnd",cases:{click:b,dragEnd:k}}),r.reset(i,p),a.reset(i,p),n.reset(i,p),{focusMoved:h,initEvents:u,clicked:b}}function wn(e){var{timeout:t,start:r,stop:a,leading:n=!1,trailing:l=!1}=e,s=S({name:"tick",sid:"uo9p3s"}),i=C(!1,{name:"$isRunning",sid:"-wxesi8"}),b=Ma(t),k=i.map(d=>!d),h=S({name:"saveTimeout",sid:"as5clk"}),u=C(null,{name:"$timeoutId",sid:"-bh90bo"}).on(h,(d,c)=>c),f=S({name:"saveReject",sid:"-64swis"}),p=C(()=>{},{name:"$rejecter",sid:"eabbu7"}).on(f,(d,c)=>c),o=_t(d=>new Promise((c,m)=>{var v=setTimeout(c,d);h(v),f(m)}),{name:"timeoutFx",sid:"7lc3mj"}),g=Rn({and:{source:[u,p],effect:d=>{var[c,m]=d;m(),c&&clearTimeout(c)}},or:{name:"cleanupFx",sid:"pcn5jq"}});return ct({and:[{clock:r,source:b,filter:k,target:o}],or:{sid:"-w5qmwp"}}),n&&ct({and:[{clock:r,filter:k,target:s}],or:{sid:"-vpslni"}}),M({and:[{clock:r,fn:()=>!0,target:i}],or:{sid:"-vaed34"}}),ct({and:[{clock:o.done,source:b,filter:i,target:o}],or:{sid:"-v73liy"}}),M({and:[{clock:o.done,fn:()=>{},target:s}],or:{sid:"-urpcwu"}}),a&&(l&&M({and:[{clock:a,target:s}],or:{sid:"-uanqf7"}}),i.on(a,()=>!1),M({and:[{clock:a,target:g}],or:{sid:"6lcmyy"}})),{tick:s,isRunning:i}}function Ma(e){if(q.store(e,{sid:"6p7767"}))return e;if(typeof e=="number")return C(e,{and:{name:"$timeout"},sid:"5hw6se"});throw new TypeError('timeout parameter in interval method should be number or Store. "'.concat(typeof e,'" was passed'))}function Ur(e){var{source:t,timeout:r,target:a=S({name:"target",sid:"r328r6"},{name:"target",sid:"r328r6"})}=e;if(!q.unit(t))throw new TypeError("source must be unit from effector");var n=_a(r),l=_t(i=>new Promise(b=>setTimeout(b,i)),{name:"timerFx",sid:"-pyjx8k"}),s=ct({and:[{clock:t,filter:l.pending.map(i=>!i)}],or:{name:"start",sid:"-p67kgr"}});return M({and:[{source:n,clock:s,target:l}],or:{sid:"-ievrvf"}}),M({and:[{source:t,clock:l.done,target:a}],or:{sid:"-i01buo"}}),a}function _a(e){if(q.store(e,{sid:"-hl6vqh"}))return e;if(typeof e=="number"){if(e<0||!Number.isFinite(e))throw new Error('timeout must be positive number or zero. Received: "'.concat(e,'"'));return C(e,{and:{name:"$timeout"},sid:"pu8pon"})}throw new TypeError('timeout parameter should be number or Store. "'.concat(typeof e,'" was passed'))}function Da(e,t,r){const a=C(0),n=C({prev:0,delta:0}).reset(t),l=S(),s=S(),i=Ur({source:l,timeout:100}),b=Ur({source:r,timeout:300}),k=wn({timeout:1e3,start:s});a.on(i,(f,p)=>p),M({source:{stepsPerSec:n,steps:e},clock:k.tick,fn:({stepsPerSec:f,steps:p})=>({prev:p,delta:p-f.prev}),target:n});const h=[];s(),u();function u(){window.requestAnimationFrame(()=>{const f=performance.now();for(;h.length>0&&h[0]<=f-1e3;)h.shift();h.push(f),u()}),l(h.length)}return{$fps:a,$stepsPerSec:n.map(f=>f.delta),$time:Qt(b,0)}}function Ta(e,t){const r=S(),a=S(),n=S(),l=S(),s=S(),i=S(),b=C(!1),k=C(0),h=[1,60],u=C(30),f=u.map(c=>1e3/c),p=S(),o=S(),g=C(null),d=wn({timeout:f,start:a,stop:Je([l,n,i])});return M({clock:[d.tick,a,s],filter:U(b,t,(c,m)=>c&&!m),target:r}),M({clock:s,target:r}),M({source:e,clock:a,fn:c=>new Map(c),target:g}),b.on(a,()=>!0).on([n,l],()=>!1).reset(i),u.on(p,c=>Math.min(c+5,h[1])).on(o,c=>Math.max(c-5,h[0])).reset(i),g.on(i,()=>null),k.on(r,c=>c+1).on(n,()=>0).reset(i),{$currentStep:k,$expectedStepsPerSec:u,$isRunning:b,$startFauna:g,start:a,stop:n,pause:l,incExpectedStepsPerSec:p,decExpectedStepsPerSec:o,speedRange:h,gameTick:r,reset:i,oneStep:s}}const A=Sa(),lr=$a(),Mt=Ia(A.$cellSize),xn=xa(),ee=C({fauna:new Map,time:0,size:0}),Ea=C([]),Sn=C(!1),gr=S(),Lt=S();Sn.on(gr,()=>!0).on(Lt,()=>!1);const N=Ta(ee.map(e=>e.fauna),Sn),Gt=Da(N.$currentStep,N.reset,Lt.map(e=>e.time)),Be=C({col:0,row:0}),La=S(),vr=S(),Ye=C(1),gt=S();Ye.on(gt,(e,t)=>t);const br=S(),yr=Ca(Mt.$cell,Be),qa=U(lr.$isOn,A.$cellSize,(e,t)=>e?"elsa":t),kr=U(A.$fieldSize,ee,Be,({width:e,height:t},{fauna:r},a)=>{const n=[];return r.forEach((l,s)=>{l.forEach((i,b)=>{const k=s+a.col,h=b+a.row;k>=0&&k<e&&h>=0&&h<t&&n.push({col:k,row:h,val:i})})}),n}),Hr=U(kr,ee,(e,t)=>({fieldCellsAmount:e.length,faunaCellsAmount:t.size})),Ra=U(A.$fieldSize,Ea,Be,({width:e,height:t},r,a)=>{const n=[];return r.forEach(({col:l,row:s,label:i})=>{const b=l+a.col,k=s+a.row;b>=0&&b<e&&k>=0&&k<t&&n.push({col:b,row:k,label:i})}),n}),Aa=U(kr,A.$cellSize,(e,t)=>e.map(({val:r,col:a,row:n})=>({val:r,y:n*t,x:a*t}))),Pa=U(Mt.$cell,A.$cellSize,xn.currentBp,(e,t,r)=>e?[{y:e.row*t+"px",x:e.col*t+"px"}]:[]),Oa=U(Ra,A.$cellSize,(e,t)=>e.map(({row:r,col:a,label:n})=>({y:r*t+"px",x:a*t+"px",label:n})));M({source:ee,clock:N.gameTick,fn:e=>e.fauna,target:gr});ee.on(Lt,(e,t)=>t).reset(br);Be.on(yr.focusMoved,(e,t)=>t).reset(La);M({source:{faunaData:ee,fieldSize:A.$fieldSize},clock:vr,fn:({faunaData:e,fieldSize:t})=>{const r=ka(e.fauna);return{col:Math.round(t.width/2-r.col),row:Math.round(t.height/2-r.row)}},target:Be});M({source:{faunaData:ee,color:Ye,focus:Be,currentBp:xn.currentBp},clock:yr.clicked,fn:({color:e,faunaData:t,focus:r,currentBp:a},{start:{col:n,row:l}})=>{const s=new Map(t.fauna);if(!a){const i=n-r.col,b=l-r.row;s.has(i)||s.set(i,new Map),s.get(i).get(b)===e?s.get(i).delete(b):s.get(i).set(b,e)}return{...t,fauna:s}},target:ee});function Fa(e){I("label",{text:e.label,fn:()=>{I("input",{attr:{type:"checkbox",checked:e.value},handler:{change:e.onChange.prepend(t=>t.target.checked)}})}})}const Na="_roundBox_hgest_1",Ba="_history_hgest_9",za="_colorBtn_hgest_15",ja="_currentColor_hgest_22",Va="_arrowBtn_hgest_26",Ua="_whiteBox_hgest_54",K={roundBox:Na,history:Ba,colorBtn:za,currentColor:ja,arrowBtn:Va,whiteBox:Ua};function Ha(){Fa({label:"Elsa",value:lr.$isOn,onChange:lr.changed}),I("div",{style:{display:"flex",gap:"8px"},fn(){I("button",{classList:{[K.colorBtn]:!0,[K.currentColor]:Ye.map(e=>e===1)},style:{backgroundColor:ar},handler:{click:gt.prepend(()=>1)}}),I("button",{classList:{[K.colorBtn]:!0,[K.currentColor]:Ye.map(e=>e===2)},style:{backgroundColor:yn},handler:{click:gt.prepend(()=>2)}}),I("button",{classList:{[K.colorBtn]:!0,[K.currentColor]:Ye.map(e=>!e)},handler:{click:gt.prepend(()=>0)}})}})}const Wa=""+new URL("heart-line-icon.ca853df2.svg",import.meta.url).href,Ga="_field_oqxfw_1",Qa="_cell_oqxfw_13",Xa="_on1_oqxfw_21",Ka="_on2_oqxfw_24",Ya="_hoveredCell_oqxfw_28",Ja="_heartMode_oqxfw_32",Za="_label_oqxfw_40",it={field:Ga,cell:Qa,on1:Xa,on2:Ka,hoveredCell:Ya,heartMode:Ja,label:Za};function el(e){const t=`
<svg viewBox='0 0 ${e} ${e}' xmlns='http://www.w3.org/2000/svg'>
<line x1='0' y1='0' x2='0' y2='${e}' stroke='#b4b6b8' />
<line x1='0' y1='0' x2='${e}' y2='0' stroke='#b4b6b8' />
</svg>`;return"data:image/svg+xml;base64,"+btoa(t.replace(/\n/g,""))}function tl(){I("div",{classList:[it.field],styleVar:{cellSize:A.$cellSize.map(e=>e+"px"),color1:ar,color2:yn},style:{backgroundImage:qa.map(e=>`url("${e==="elsa"?Wa:el(e)}")`),backgroundSize:A.$cellSize.map(e=>`${e}px ${e}px`)},handler:{mousemove:Mt.fieldMouseMoved,mouseleave:Mt.fieldMouseLeaved},fn(){const e=kn();I("svg",{attr:{width:e.width,height:e.height,viewBox:`0 0 ${e.width} ${e.height}`,xmlns:"http://www.w3.org/2000/svg"},fn:()=>{ht(Aa,({store:t})=>{I("rect",{attr:{x:t.map(r=>r.x),y:t.map(r=>r.y),width:A.$cellSize,height:A.$cellSize,fill:ar}})})}}),ht(Pa,({store:t})=>{I("div",{style:{left:t.map(r=>r?r.x:"-100px"),top:t.map(r=>r?r.y:"-100px")},classList:[it.cell,it.hoveredCell]})}),ht(Oa,({store:t})=>{I("div",{style:{left:t.map(r=>r.x),top:t.map(r=>r.y)},text:t.map(r=>r.label),classList:[it.label]})})}})}const qt=C(ya()||[]),rt=C(new Set),$n=S(),In=S(),Cn=S(),Mn=S(),Rt=S(),_n=S();rt.on(In,(e,t)=>{let r=new Set(e);return r.add(t),r}).on(Cn,(e,t)=>{let r=new Set(e);return r.delete(t),r});qt.on($n,(e,t)=>{let a=(e[e.length-1]?.name||"0").match(/(\d+)/),n=a&&+a[1]||0;return[...e,{fauna:t,name:`save #${n+1}`}]}).on(Mn,(e,t)=>e.filter(r=>!t.includes(r.name)));M({source:qt,target:_t(e=>{va()})});window.addEventListener("beforeunload",()=>{Mn([...rt.getState()])});const rl=U(qt,rt,(e,t)=>e.map(r=>({...r,toRemove:t.has(r.name)})));function nl(){I("div",{classList:[K.history],fn(){I("p",{text:"History: ",style:{margin:"0"}}),ht(rl,({store:e})=>{const t=S(),r=S();M({source:{historyEl:e,itemsToRemove:rt},clock:t,filter:({historyEl:a,itemsToRemove:n})=>n.has(a.name),fn:({historyEl:a})=>a.name,target:Cn}),M({source:{historyEl:e,itemsToRemove:rt},clock:t,filter:({historyEl:a,itemsToRemove:n})=>!n.has(a.name),fn:({historyEl:a})=>a.name,target:Rt}),M({clock:r,source:e.map(a=>a.name),target:In}),I("div",()=>{I("button",()=>{Z({handler:{click:t}}),X`${e.map(a=>a.toRemove?`restore (${a.name})`:a.name)}`}),I("button",()=>{Z({handler:{click:r}}),X`x`})})}),I("button",{style:{marginLeft:"auto"},text:"Save",handler:{click:_n}})}})}function Dn(e){const[t,r]=e.range;I("div",()=>{Z({classList:e.classList}),I("button",{handler:{click:e.onMinusClicked},text:"-",attr:{disabled:e.value.map(a=>a<=t)}}),X` ${e.value} `,I("button",{handler:{click:e.onPlusClicked},text:"+",attr:{disabled:e.value.map(a=>a>=r)}})})}function al(){yr.initEvents(),I("button",{classList:[K.arrowBtn],handler:{click:vr},text:"to center"}),I("div",()=>{Z({style:{position:"absolute",right:"150px",bottom:"20px",zIndex:1}}),Dn({value:A.$cellSize,onPlusClicked:A.plus,onMinusClicked:A.minus,range:A.options,classList:[K.roundBox]})})}function ll(){I("div",()=>{Z({classList:[K.whiteBox],style:{position:"absolute",display:"grid",bottom:"10px",left:"130px"}}),I("span",()=>{X`FPS: ${Gt.$fps}`}),I("span",()=>{X`STEPS PER SEC: ${Gt.$stepsPerSec}`}),I("span",()=>{X`EXPECTED STEPS:`}),Dn({value:N.$expectedStepsPerSec,onPlusClicked:N.incExpectedStepsPerSec,onMinusClicked:N.decExpectedStepsPerSec,range:N.speedRange}),I("span",()=>{X`CALC TIME: ${Gt.$time} msec`}),I("span",()=>{X`CELLS: ${Hr.map(e=>e.faunaCellsAmount)}`}),I("span",()=>{X`CELLS ON SCREEN: ${Hr.map(e=>e.fieldCellsAmount)}`})})}function ol(){I("p",()=>{Z({classList:[K.whiteBox],style:{position:"absolute",display:"flex",gap:"8px"}}),I("button",{text:"Step",handler:{click:N.oneStep}}),X` timer: `,oa({source:N.$isRunning.map(e=>({show:e?"1":"0"})),key:"show",cases:{1:()=>{I("button",{text:"Stop",style:{color:"#f8f8f8",backgroundColor:"#de4040",border:"0"},handler:{click:N.pause}})},0:()=>{I("button",{text:"Start",style:{color:"#f8f8f8",backgroundColor:"#50c40e",border:"0"},handler:{click:N.start}})}}}),X`steps: ${N.$currentStep}`})}const At=C(""),Tn=S(),En=S(),wr=S();At.on(Tn,(e,t)=>t);M({source:ee,clock:_n,fn:e=>e.fauna,target:$n});M({source:qt,clock:Rt,fn:(e,t)=>{const r=e.find(n=>n.name===t).fauna;return{fauna:new Map(r),time:0,size:0}},target:ee});M({clock:[Rt,br,En,wr],target:N.reset});M({clock:Rt,target:vr});M({source:kr,clock:En,fn:ga,target:At});M({source:At,clock:wr,fn:e=>({fauna:wa(e),time:0,size:0}),target:ee});function sl(){I("div",()=>{al(),tl(),I("div",{style:{position:"absolute",width:"100%",backgroundColor:"rgba(255,255,255, 0.9)"},fn(){I("h1",{text:"Game of Life"}),nl(),Ha(),ol()}}),ll(),I("button",{text:"Reset",style:{position:"absolute",bottom:"20px",left:"20px"},handler:{click:br}}),I("div",()=>{Z({style:{position:"absolute",bottom:"50px",left:"20px"}}),I("button",{text:"Import",handler:{click:wr}}),I("br",{}),I("textarea",{style:{fontSize:"8px",width:"100%",height:"100px",lineHeight:1},text:At,handler:{change:Tn.prepend(e=>e.target.value)}})})})}aa(document.querySelector("#app"),sl);il();function il(){const e=new Worker("./webworkerGo.js");e.addEventListener("message",t=>{Lt(t.data)}),e.addEventListener("error",t=>{console.log("main.error err",t)}),gr.watch(t=>{e.postMessage(t)})}
