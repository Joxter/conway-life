(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const Kr=(e,t)=>e===t,Ye={equals:Kr};let dr=gr;const ce=1,Ge=2,pr={owned:null,cleanups:null,context:null,owner:null};var P=null;let ht=null,A=null,z=null,oe=null,it=0;function Jr(e,t){const r=A,n=P,o=e.length===0,s=t===void 0?n:t,i=o?pr:{owned:null,cleanups:null,context:s?s.context:null,owner:s},l=o?e:()=>e(()=>se(()=>lt(i)));P=i,A=null;try{return Me(l,!0)}finally{A=r,P=n}}function Qr(e,t){t=t?Object.assign({},Ye,t):Ye;const r={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=o=>(typeof o=="function"&&(o=o(r.value)),hr(r,o));return[mr.bind(r),n]}function V(e,t,r){const n=Tt(e,t,!1,ce);qe(n)}function Zr(e,t,r){dr=an;const n=Tt(e,t,!1,ce);(!r||!r.render)&&(n.user=!0),oe?oe.push(n):qe(n)}function Ke(e,t,r){r=r?Object.assign({},Ye,r):Ye;const n=Tt(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=r.equals||void 0,qe(n),mr.bind(n)}function en(e){return Me(e,!1)}function se(e){if(A===null)return e();const t=A;A=null;try{return e()}finally{A=t}}function tn(e){Zr(()=>se(e))}function Wt(e){return P===null||(P.cleanups===null?P.cleanups=[e]:P.cleanups.push(e)),e}function rn(e,t){const r=Symbol("context");return{id:r,Provider:un(r),defaultValue:e}}function nn(e){return P&&P.context&&P.context[e.id]!==void 0?P.context[e.id]:e.defaultValue}function on(e){const t=Ke(e),r=Ke(()=>_t(t()));return r.toArray=()=>{const n=r();return Array.isArray(n)?n:n!=null?[n]:[]},r}function mr(){if(this.sources&&this.state)if(this.state===ce)qe(this);else{const e=z;z=null,Me(()=>Qe(this),!1),z=e}if(A){const e=this.observers?this.observers.length:0;A.sources?(A.sources.push(this),A.sourceSlots.push(e)):(A.sources=[this],A.sourceSlots=[e]),this.observers?(this.observers.push(A),this.observerSlots.push(A.sources.length-1)):(this.observers=[A],this.observerSlots=[A.sources.length-1])}return this.value}function hr(e,t,r){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&Me(()=>{for(let o=0;o<e.observers.length;o+=1){const s=e.observers[o],i=ht&&ht.running;i&&ht.disposed.has(s),(i?!s.tState:!s.state)&&(s.pure?z.push(s):oe.push(s),s.observers&&yr(s)),i||(s.state=ce)}if(z.length>1e6)throw z=[],new Error},!1)),t}function qe(e){if(!e.fn)return;lt(e);const t=P,r=A,n=it;A=P=e,sn(e,e.value,n),A=r,P=t}function sn(e,t,r){let n;try{n=e.fn(t)}catch(o){return e.pure&&(e.state=ce,e.owned&&e.owned.forEach(lt),e.owned=null),e.updatedAt=r+1,vr(o)}(!e.updatedAt||e.updatedAt<=r)&&(e.updatedAt!=null&&"observers"in e?hr(e,n):e.value=n,e.updatedAt=r)}function Tt(e,t,r,n=ce,o){const s={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:P,context:P?P.context:null,pure:r};return P===null||P!==pr&&(P.owned?P.owned.push(s):P.owned=[s]),s}function Je(e){if(e.state===0)return;if(e.state===Ge)return Qe(e);if(e.suspense&&se(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<it);)e.state&&t.push(e);for(let r=t.length-1;r>=0;r--)if(e=t[r],e.state===ce)qe(e);else if(e.state===Ge){const n=z;z=null,Me(()=>Qe(e,t[0]),!1),z=n}}function Me(e,t){if(z)return e();let r=!1;t||(z=[]),oe?r=!0:oe=[],it++;try{const n=e();return ln(r),n}catch(n){r||(oe=null),z=null,vr(n)}}function ln(e){if(z&&(gr(z),z=null),e)return;const t=oe;oe=null,t.length&&Me(()=>dr(t),!1)}function gr(e){for(let t=0;t<e.length;t++)Je(e[t])}function an(e){let t,r=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[r++]=n:Je(n)}for(t=0;t<r;t++)Je(e[t])}function Qe(e,t){e.state=0;for(let r=0;r<e.sources.length;r+=1){const n=e.sources[r];if(n.sources){const o=n.state;o===ce?n!==t&&(!n.updatedAt||n.updatedAt<it)&&Je(n):o===Ge&&Qe(n,t)}}}function yr(e){for(let t=0;t<e.observers.length;t+=1){const r=e.observers[t];r.state||(r.state=Ge,r.pure?z.push(r):oe.push(r),r.observers&&yr(r))}}function lt(e){let t;if(e.sources)for(;e.sources.length;){const r=e.sources.pop(),n=e.sourceSlots.pop(),o=r.observers;if(o&&o.length){const s=o.pop(),i=r.observerSlots.pop();n<o.length&&(s.sourceSlots[i]=n,o[n]=s,r.observerSlots[n]=i)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)lt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function cn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function vr(e,t=P){throw cn(e)}function _t(e){if(typeof e=="function"&&!e.length)return _t(e());if(Array.isArray(e)){const t=[];for(let r=0;r<e.length;r++){const n=_t(e[r]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function un(e,t){return function(n){let o;return V(()=>o=se(()=>(P.context={...P.context,[e]:n.value},on(()=>n.children))),void 0),o}}function ne(e,t){return se(()=>e(t||{}))}const fn=e=>`Stale read from <${e}>.`;function Vt(e){const t=e.keyed,r=Ke(()=>e.when,void 0,{equals:(n,o)=>t?n===o:!n==!o});return Ke(()=>{const n=r();if(n){const o=e.children;return typeof o=="function"&&o.length>0?se(()=>o(t?n:()=>{if(!se(r))throw fn("Show");return e.when})):o}return e.fallback},void 0,void 0)}function dn(e,t,r){let n=r.length,o=t.length,s=n,i=0,l=0,c=t[o-1].nextSibling,f=null;for(;i<o||l<s;){if(t[i]===r[l]){i++,l++;continue}for(;t[o-1]===r[s-1];)o--,s--;if(o===i){const p=s<n?l?r[l-1].nextSibling:r[s-l]:c;for(;l<s;)e.insertBefore(r[l++],p)}else if(s===l)for(;i<o;)(!f||!f.has(t[i]))&&t[i].remove(),i++;else if(t[i]===r[s-1]&&r[l]===t[o-1]){const p=t[--o].nextSibling;e.insertBefore(r[l++],t[i++].nextSibling),e.insertBefore(r[--s],p),t[o]=r[s]}else{if(!f){f=new Map;let m=l;for(;m<s;)f.set(r[m],m++)}const p=f.get(t[i]);if(p!=null)if(l<p&&p<s){let m=i,h=1,u;for(;++m<o&&m<s&&!((u=f.get(t[m]))==null||u!==p+h);)h++;if(h>p-l){const d=t[i];for(;l<p;)e.insertBefore(r[l++],d)}else e.replaceChild(r[l++],t[i++])}else i++;else t[i++].remove()}}}const Xt="_$DX_DELEGATE";function pn(e,t,r,n={}){let o;return Jr(s=>{o=s,t===document?e():M(t,e(),t.firstChild?null:void 0,r)},n.owner),()=>{o(),t.textContent=""}}function ae(e,t,r){let n;const o=()=>{const i=document.createElement("template");return i.innerHTML=e,r?i.content.firstChild.firstChild:i.content.firstChild},s=t?()=>se(()=>document.importNode(n||(n=o()),!0)):()=>(n||(n=o())).cloneNode(!0);return s.cloneNode=s,s}function at(e,t=window.document){const r=t[Xt]||(t[Xt]=new Set);for(let n=0,o=e.length;n<o;n++){const s=e[n];r.has(s)||(r.add(s),t.addEventListener(s,hn))}}function Yt(e,t,r){r==null?e.removeAttribute(t):e.setAttribute(t,r)}function Ie(e,t){t==null?e.removeAttribute("class"):e.className=t}function pe(e,t,r,n){if(n)Array.isArray(r)?(e[`$$${t}`]=r[0],e[`$$${t}Data`]=r[1]):e[`$$${t}`]=r;else if(Array.isArray(r)){const o=r[0];e.addEventListener(t,r[0]=s=>o.call(e,r[1],s))}else e.addEventListener(t,r)}function Gt(e,t,r={}){const n=Object.keys(t||{}),o=Object.keys(r);let s,i;for(s=0,i=o.length;s<i;s++){const l=o[s];!l||l==="undefined"||t[l]||(Kt(e,l,!1),delete r[l])}for(s=0,i=n.length;s<i;s++){const l=n[s],c=!!t[l];!l||l==="undefined"||r[l]===c||!c||(Kt(e,l,!0),r[l]=c)}return r}function mn(e,t,r){return se(()=>e(t,r))}function M(e,t,r,n){if(r!==void 0&&!n&&(n=[]),typeof t!="function")return Ze(e,t,n,r);V(o=>Ze(e,t(),o,r),n)}function Kt(e,t,r){const n=t.trim().split(/\s+/);for(let o=0,s=n.length;o<s;o++)e.classList.toggle(n[o],r)}function hn(e){const t=`$$${e.type}`;let r=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==r&&Object.defineProperty(e,"target",{configurable:!0,value:r}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return r||document}});r;){const n=r[t];if(n&&!r.disabled){const o=r[`${t}Data`];if(o!==void 0?n.call(r,o,e):n.call(r,e),e.cancelBubble)return}r=r._$host||r.parentNode||r.host}}function Ze(e,t,r,n,o){for(;typeof r=="function";)r=r();if(t===r)return r;const s=typeof t,i=n!==void 0;if(e=i&&r[0]&&r[0].parentNode||e,s==="string"||s==="number")if(s==="number"&&(t=t.toString()),i){let l=r[0];l&&l.nodeType===3?l.data=t:l=document.createTextNode(t),r=we(e,r,n,l)}else r!==""&&typeof r=="string"?r=e.firstChild.data=t:r=e.textContent=t;else if(t==null||s==="boolean")r=we(e,r,n);else{if(s==="function")return V(()=>{let l=t();for(;typeof l=="function";)l=l();r=Ze(e,l,r,n)}),()=>r;if(Array.isArray(t)){const l=[],c=r&&Array.isArray(r);if(kt(l,t,r,o))return V(()=>r=Ze(e,l,r,n,!0)),()=>r;if(l.length===0){if(r=we(e,r,n),i)return r}else c?r.length===0?Jt(e,l,n):dn(e,r,l):(r&&we(e),Jt(e,l));r=l}else if(t.nodeType){if(Array.isArray(r)){if(i)return r=we(e,r,n,t);we(e,r,null,t)}else r==null||r===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);r=t}else console.warn("Unrecognized value. Skipped inserting",t)}return r}function kt(e,t,r,n){let o=!1;for(let s=0,i=t.length;s<i;s++){let l=t[s],c=r&&r[s],f;if(!(l==null||l===!0||l===!1))if((f=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))o=kt(e,l,c)||o;else if(f==="function")if(n){for(;typeof l=="function";)l=l();o=kt(e,Array.isArray(l)?l:[l],Array.isArray(c)?c:[c])||o}else e.push(l),o=!0;else{const p=String(l);c&&c.nodeType===3&&c.data===p?e.push(c):e.push(document.createTextNode(p))}}return o}function Jt(e,t,r=null){for(let n=0,o=t.length;n<o;n++)e.insertBefore(t[n],r)}function we(e,t,r,n){if(r===void 0)return e.textContent="";const o=n||document.createTextNode("");if(t.length){let s=!1;for(let i=t.length-1;i>=0;i--){const l=t[i];if(o!==l){const c=l.parentNode===e;!s&&!i?c?e.replaceChild(o,l):e.insertBefore(o,r):c&&l.remove()}else s=!0}}else e.insertBefore(o,r);return[o]}function me(e,t){for(let r in e)t(e[r],r)}function B(e,t){e.forEach(t)}function j(e,t){if(!e)throw Error(t)}function ee({node:e=[],from:t,source:r,parent:n=t||r,to:o,target:s,child:i=o||s,scope:l={},meta:c={},family:f={type:"regular"},regional:p}={}){let m=Fe(n),h=Fe(f.links),u=Fe(f.owners),d=[];B(e,g=>g&&U(d,g));let a={id:Sn(),seq:d,next:Fe(i),meta:c,scope:l,family:{type:f.type||"crosslink",links:h,owners:u}};return B(h,g=>U(ct(g),a)),B(u,g=>U(ut(g),a)),B(m,g=>U(g.next,a)),p&&xe&&Ce(Le(xe),[a]),a}function ie(e,t,r){let n,o=J,s=null,i=C;if(e.target&&(t=e.params,r=e.defer,n=e.meta,o="page"in e?e.page:o,e.stack&&(s=e.stack),i=de(e)||i,e=e.target),i&&C&&i!==C&&(C=null),Array.isArray(e))for(let d=0;d<e.length;d++)fe("pure",o,H(e[d]),s,t[d],i,n);else fe("pure",o,H(e),s,t,i,n);if(r&&!He)return;let l,c,f,p,m,h,u={isRoot:He,currentPage:J,scope:C,isWatch:Ve,isPure:Xe};He=0;e:for(;p=Pn();){let{idx:d,stack:a,type:g}=p;f=a.node,J=m=a.page,C=de(a),m?h=m.reg:C&&(h=C.reg);let v=!!m,w=!!C,S={fail:0,scope:f.scope};l=c=0;for(let b=d;b<f.seq.length&&!l;b++){let $=f.seq[b];if($.order){let{priority:_,barrierID:k}=$.order,T=k?m?`${m.fullID}_${k}`:k:0;if(b!==d||g!==_){k?yt.has(T)||(yt.add(T),Pt(b,a,_,k)):Pt(b,a,_);continue e}k&&yt.delete(T)}switch($.type){case"mov":{let k,T=$.data;switch(T.from){case he:k=Le(a);break;case"a":case"b":k=a[T.from];break;case"value":k=T.store;break;case"store":if(h&&!h[T.store.id])if(v){let mt=jr(m,T.store.id);a.page=m=mt,mt?h=mt.reg:w?(Ee(C,T.store,0,1,T.softRead),h=C.reg):h=void 0}else w&&Ee(C,T.store,0,1,T.softRead);k=Re(h&&h[T.store.id]||T.store)}switch(T.to){case he:a.value=k;break;case"a":case"b":a[T.to]=k;break;case"store":An(m,C,f,T.target).current=k}break}case"compute":let _=$.data;if(_.fn){Ve=N(f,"op")==="watch",Xe=_.pure;let k=_.safe?(0,_.fn)(Le(a),S.scope,a):Tn(S,_.fn,a);_.filter?c=!k:a.value=k,Ve=u.isWatch,Xe=u.isPure}}l=S.fail||c}if(!l){let b=Le(a),$=de(a);if(B(f.next,_=>{fe("child",m,_,a,b,$)}),$){N(f,"needFxCounter")&&fe("child",m,$.fxCount,a,b,$),N(f,"storeChange")&&fe("child",m,$.storeChange,a,b,$),N(f,"warnSerialize")&&fe("child",m,$.warnSerializeNode,a,b,$);let _=$.additionalLinks[f.id];_&&B(_,k=>{fe("child",m,k,a,b,$)})}}}He=u.isRoot,J=u.currentPage,C=de(u)}function wr(e,t="combine"){let r=t+"(",n="",o=0;return me(e,s=>{o<25&&(s!=null&&(r+=n,r+=Q(s)?zt(s).fullName:s.toString()),o+=1,n=", ")}),r+")"}function br(e,t){let r,n,o=e;if(t){let s=zt(t);e.length===0?(r=s.path,n=s.fullName):(r=s.path.concat([e]),n=s.fullName.length===0?e:s.fullName+"/"+e)}else r=e.length===0?[]:[e],n=e;return{shortName:o,fullName:n,path:r}}function Te(e,t){let r=t?e:e[0];Ar(r);let n=r.or,o=r.and;if(o){let s=t?o:o[0];if(Y(s)&&"and"in s){let i=Te(o,t);e=i[0],n={...n,...i[1]}}else e=o}return[e,n]}function O(e,...t){let r=Er();if(r){let n=r.handlers[e];if(n)return n(r,...t)}}function y(e,t){let r=Ae({or:t,and:typeof e=="string"?{name:e}:e}),n=(i,...l)=>(ge(!N(n,"derived"),"call of derived event","createEvent"),ge(!Xe,"unit call from pure function","operators like sample"),J?((c,f,p,m)=>{let h=J,u=null;if(f)for(u=J;u&&u.template!==f;)u=le(u);nr(u);let d=c.create(p,m);return nr(h),d})(n,o,i,l):n.create(i,l)),o=Er(),s=Object.assign(n,{graphite:ee({meta:Lr(r.actualOp||"event",n,r),regional:1}),create:i=>(ie({target:n,params:i,scope:C}),i),watch:i=>Nr(n,i),map:i=>vt(n,_e,i,[K()]),filter:i=>vt(n,"filter",i.fn?i:i.fn,[K(Nt,1)]),filterMap:i=>vt(n,"filterMap",i,[K(),X(l=>!D(l),1)]),prepend(i){let l=y("* → "+n.shortName,{parent:le(n)});return O("eventPrepend",H(l)),ue(l,n,[K()],"prepend",i),Fr(n,l),l}});return r!=null&&r.domain&&r.domain.hooks.event(s),G(s,"id",s.graphite.id),Pr(s.graphite),s}function Qt(e,t,r,n){return tt(r,t,"first argument"),j(F(n),"second argument should be a function"),ge(!N(e,"derived"),`${t} in derived store`,`${t} in store created via createStore`),B(Array.isArray(r)?r:[r],o=>{e.off(o),et(e).set(o,zr(Rr(o,e,"on",kn,n)))}),e}function x(e,t){let r=Ae(t),n=ye(e),o=y({named:"updates",derived:1});O("storeBase",n);let s=n.id,i={subscribers:new Map,updates:o,defaultState:e,stateRef:n,getState(){let u,d=n;if(J){let a=J;for(;a&&!a.reg[s];)a=le(a);a&&(u=a)}return!u&&C&&(Ee(C,n,1),u=C),u&&(d=u.reg[s]),Re(d)},setState:u=>ie({target:i,params:u,defer:1,scope:C}),reset:(...u)=>(B(u,d=>Qt(i,".reset",d,()=>i.defaultState)),i),on:(u,d)=>Qt(i,".on",u,d),off(u){let d=et(i).get(u);return d&&(d(),et(i).delete(u)),i},map(u,d){let a,g;Y(u)&&(a=u,u=u.fn),ge(D(d),"second argument of store.map","updateFilter");let v=i.getState();D(v)||(g=u(v,d));let w=x(g,{name:`${i.shortName} → *`,derived:1,and:a}),S=Rr(i,w,_e,Ct,u);return rt(q(w),{type:_e,fn:u,from:n}),q(w).noInit=1,O("storeMap",n,S),w},watch(u,d){if(!d||!Q(u)){let a=Nr(i,u);return O("storeWatch",n,u)||u(i.getState()),a}return j(F(d),"second argument should be a function"),u.watch(a=>d(i.getState(),a))}},l=Lr("store",i,r),c=i.defaultConfig.updateFilter;i.graphite=ee({scope:{state:n,fn:c},node:[X((u,d,a)=>(a.scope&&!a.scope.reg[n.id]&&(a.b=1),u)),Z(n),X((u,d,{a,b:g})=>!D(u)&&(u!==a||g),1),c&&K(Ct,1),W({from:he,target:n})],child:o,meta:{...l,defaultState:e},regional:1}),G(i,"id",i.graphite.id),G(i,"rootStateRefId",s);let f=N(i,"serialize"),p=N(i,"derived"),m=f==="ignore",h=N(i,"sid");return h&&(G(i,"storeChange",1),n.sid=h),h||m||p||G(i,"warnSerialize",1),j(p||!D(e),"current state can't be undefined, use null instead"),Ce(i,[o]),r!=null&&r.domain&&r.domain.hooks.store(i),p||(i.reinit=y({named:"reinit"}),i.reset(i.reinit)),n.meta=i.graphite.meta,Pr(i.graphite),i}function re(...e){let t,r,n;[e,n]=Te(e);let o,s,i,l=e[e.length-1];if(F(l)?(r=e.slice(0,-1),t=l):r=e,r.length===1){let c=r[0];I(c)||(o=c,s=1)}if(!s&&(o=r,t)){i=1;let c=t;t=f=>c(...f)}return j(Y(o),"shape should be an object"),jn(Array.isArray(o),!i,o,n,t)}function $r(){let e={};return e.req=new Promise((t,r)=>{e.rs=t,e.rj=r}),e.req.catch(()=>{}),e}function jt(e,t={}){let r=Ae(F(e)?{handler:e}:e,t),n=y(F(e)?{handler:e}:e,{...t,actualOp:"effect"}),o=H(n);G(o,"op",n.kind="effect"),n.use=u=>(j(F(u),".use argument should be a function"),p.scope.handler=u,n),n.use.getCurrent=()=>p.scope.handler;let s=n.finally=y({named:"finally",derived:1}),i=n.done=s.filterMap({named:"done",fn({status:u,params:d,result:a}){if(u==="done")return{params:d,result:a}}}),l=n.fail=s.filterMap({named:"fail",fn({status:u,params:d,error:a}){if(u==="fail")return{params:d,error:a}}}),c=n.doneData=i.map({named:"doneData",fn:({result:u})=>u}),f=n.failData=l.map({named:"failData",fn:({error:u})=>u}),p=ee({scope:{handler:n.defaultConfig.handler||(()=>j(0,`no handler used in ${n.getType()}`))},node:[X((u,d,a)=>{let g=d.handler,v=de(a);if(v){let w=v.handlers.unitMap.get(n)||v.handlers.sidMap[n.sid];w&&(g=w)}return u.handler=g,u},0,1),X(({params:u,req:d,handler:a,args:g=[u]},v,w)=>{let S=Or(w),b=nt(u,d,1,s,w,S),$=nt(u,d,0,s,w,S),[_,k]=Br(a,$,g);_&&(Y(k)&&F(k.then)?k.then(b,$):b(k))},0,1)],meta:{op:"fx",fx:"runner"}});o.scope.runner=p,U(o.seq,X((u,{runner:d},a)=>{let g=le(a)?{params:u,req:{rs(v){},rj(v){}}}:u;return a.meta||(a.meta={fxID:xn()}),ie({target:d,params:g,defer:1,scope:de(a),meta:a.meta}),g.params},0,1)),n.create=u=>{let d=$r(),a={params:u,req:d};if(C&&!Ve){let g=C;d.req.finally(()=>{En(g)}).catch(()=>{})}return ie({target:n,params:a,scope:C}),d.req};let m=n.inFlight=x(0,{serialize:"ignore",named:(N(n,"name")||n.graphite.id)+".inFlight"}).on(n,u=>u+1).on(s,u=>u-1).map({fn:u=>u,named:"inFlight"});G(s,"needFxCounter","dec"),G(n,"needFxCounter",1);let h=n.pending=m.map({fn:u=>u>0,named:"pending"});return Ce(n,[s,i,l,c,f,h,m]),r!=null&&r.domain&&r.domain.hooks.effect(n),n}function Zt(e){let t;[e,t]=Te(e,1);let{source:r,effect:n,mapParams:o}=e,s=jt(e,t);G(s,"attached",1);let i,{runner:l}=H(s).scope,c=X((p,m,h)=>{let u,{params:d,req:a,handler:g}=p,v=s.finally,w=Or(h),S=nt(d,a,0,v,h,w),b=h.a,$=ke(g),_=1;if(o?[_,u]=Br(o,S,[d,b]):u=r&&$?b:d,_){if(!$)return p.args=[b,u],1;ie({target:g,params:{params:u,req:{rs:nt(d,a,1,v,h,w),rj:S}},page:h.page,defer:1,meta:h.meta})}},1,1);if(r){let p;I(r)?(p=r,Ce(p,[s])):(p=re(r),Ce(s,[p])),i=[Z(q(p)),c]}else i=[c];l.seq.splice(1,0,...i),s.use(n);let f=le(n);return f&&(Object.assign(zt(s),br(s.shortName,f)),s.defaultConfig.parent=f),Fr(n,s,"effect"),s}function Sr(e,t){tt(e,"merge","first argument");let r=y({name:wr(e,"merge"),derived:1,and:t});return ue(e,r,[],"merge"),r}function xr(e,t){let r=0;return B(Nn,n=>{n in e&&(j(e[n]!=null,qr(t,n)),r=1)}),r}function E(...e){let t,r,n,o,[[s,i,l],c]=Te(e),f=1;return D(i)&&Y(s)&&xr(s,"sample")&&(i=s.clock,l=s.fn,f=!s.greedy,o=s.filter,t=s.target,r=s.name,n=s.sid,s=s.source),Bt("sample",i,s,o,t,l,r,c,f,1,0,n)}function Ne(...e){let[[t,r],n]=Te(e);return r||(r=t,t=r.source),xr(r,"guard"),Bt("guard",r.clock,t,r.filter,r.target,null,r.name,n,!r.greedy,0,1)}function gn(e,t,r){if(I(e))return ge(0,"restore($store)"),e;if(_r(e)||ke(e)){let o=le(e),s=x(t,{parent:o,name:e.shortName,and:r});return ue(ke(e)?e.doneData:e,s),o&&o.hooks.store(s),s}let n=Array.isArray(e)?[]:{};return me(e,(o,s)=>n[s]=I(o)?o:x(o,{name:s})),n}function yn(...e){let t,r,n="split",[[o,s],i]=Te(e),l=!s;l&&(t=o.cases,s=o.match,r=o.clock,o=o.source);let c=I(s),f=!Q(s)&&F(s),p=!c&&!f&&Y(s);j(Q(o),"source must be a unit"),t||(t={}),l?me(t,(a,g)=>Mr(n,a,`cases.${g}`)):(j(p,"match should be an object"),me(s,(a,g)=>t[g]=y({derived:1,named:`cases.${g}`,and:i})),t.__=y({derived:1,named:"cases.__",and:i}));let m,h=new Set([].concat(o,r||[],Object.values(t))),u=Object.keys(c||f?t:s);if(c||f)c&&h.add(s),m=[c&&Z(q(s),0,1),Pe({safe:c,filter:1,pure:!c,fn(a,g,v){let w=String(c?v.a:s(a));bt(g,er(u,w)?w:"__",a,v)}})];else if(p){let a=ye({});a.type="shape";let g,v=[];me(s,(w,S)=>{if(Q(w)){g=1,U(v,S),h.add(w);let b=ue(w,[],[Z(a),X(($,_,{a:k})=>k[S]=$)]);if(I(w)){a.current[S]=w.getState();let $=q(w);rt(a,{from:$,field:S,type:"field"}),O("splitMatchStore",$,b)}}}),g&&O("splitBase",a),m=[g&&Z(a,0,1),K((w,S,b)=>{for(let $=0;$<u.length;$++){let _=u[$];if(er(v,_)?b.a[_]:s[_](w))return void bt(S,_,w,b)}bt(S,"__",w,b)},1)]}else j(0,"expect match to be unit, function or object");let d=ee({meta:{op:n},parent:r?[]:o,scope:t,node:m,family:{owners:Array.from(h)},regional:1});if(r&&Bt(n,r,o,null,d,null,n,i,0,0,0),!l)return t}function vn(e,{scope:t,safe:r}={}){j(t||C||r,"scopeBind cannot be called outside of forked .watch");let n=t||C;return ke(e)?o=>{let s=$r();return ie({target:e,params:{params:o,req:s},scope:n}),s.req}:o=>(ie({target:e,params:o,scope:n}),o)}let wn=typeof Symbol<"u"&&Symbol.observable||"@@observable",_e="map",he="stack",H=e=>e.graphite||e,ct=e=>e.family.owners,ut=e=>e.family.links,q=e=>e.stateRef,Le=e=>e.value,et=e=>e.subscribers,le=e=>e.parent,de=e=>e.scope,N=(e,t)=>H(e).meta[t],G=(e,t,r)=>H(e).meta[t]=r,zt=e=>e.compositeName,Q=e=>(F(e)||Y(e))&&"kind"in e;const De=e=>t=>Q(t)&&t.kind===e;let I=De("store"),_r=De("event"),ke=De("effect"),kr=De("domain"),bn=De("scope");var Se={__proto__:null,unit:Q,store:I,event:_r,effect:ke,domain:kr,scope:bn,attached:e=>ke(e)&&N(e,"attached")==1};let er=(e,t)=>e.includes(t),We=(e,t)=>{let r=e.indexOf(t);r!==-1&&e.splice(r,1)},U=(e,t)=>e.push(t),ge=(e,t,r)=>!e&&console.error(`${t} is deprecated${r?`, use ${r} instead`:""}`);const ft=()=>{let e=0;return()=>""+ ++e};let $n=ft(),Cr=ft(),Sn=ft(),xn=ft(),xe=null,Pr=e=>{},Er=()=>xe,_n=e=>(e&&xe&&xe.sidRoot&&(e=`${xe.sidRoot}|${e}`),e),Ce=(e,t)=>{let r=H(e);B(t,n=>{let o=H(n);r.family.type!=="domain"&&(o.family.type="crosslink"),U(ct(o),r),U(ut(r),o)})},Fe=(e=[])=>(Array.isArray(e)?e:[e]).flat().map(H),Y=e=>typeof e=="object"&&e!==null,F=e=>typeof e=="function",D=e=>e===void 0,Ar=e=>j(Y(e)||F(e),"expect first argument be an object");const tr=(e,t,r,n)=>j(!(!Y(e)&&!F(e)||!("family"in e)&&!("graphite"in e)),`${t}: expect ${r} to be a unit (store, event or effect)${n}`);let tt=(e,t,r)=>{Array.isArray(e)?B(e,(n,o)=>tr(n,t,`${o} item of ${r}`,"")):tr(e,t,r," or array of units")},Mr=(e,t,r="target")=>B(Fe(t),n=>ge(!N(n,"derived"),`${e}: derived unit in "${r}"`,"createEvent/createStore")),Ct=(e,{fn:t},{a:r})=>t(e,r),kn=(e,{fn:t},{a:r})=>t(r,e),Nt=(e,{fn:t})=>t(e);const Tr=(e,t,r,n)=>{let o={id:Cr(),type:e,data:t};return r&&(o.order={priority:r},n&&(o.order.barrierID=++Cn)),o};let Cn=0,W=({from:e="store",store:t,target:r,to:n=r?"store":he,batch:o,priority:s})=>Tr("mov",{from:e,store:t,to:n,target:r},s,o),Pe=({fn:e,batch:t,priority:r,safe:n=0,filter:o=0,pure:s=0})=>Tr("compute",{fn:e,safe:n,filter:o,pure:s},r,t),Ft=({fn:e})=>Pe({fn:e,priority:"effect"}),X=(e,t,r)=>Pe({fn:e,safe:1,filter:t,priority:r&&"effect"}),Z=(e,t,r)=>W({store:e,to:t?he:"a",priority:r&&"sampler",batch:1}),K=(e=Nt,t)=>Pe({fn:e,pure:1,filter:t}),gt={mov:W,compute:Pe,filter:({fn:e,pure:t})=>Pe({fn:e,filter:1,pure:t}),run:Ft},ye=e=>({id:Cr(),current:e}),Re=({current:e})=>e,rt=(e,t)=>{e.before||(e.before=[]),U(e.before,t)},$e=null;const Lt=(e,t)=>{if(!e)return t;if(!t)return e;let r;return(e.v.type===t.v.type&&e.v.id>t.v.id||Et(e.v.type)>Et(t.v.type))&&(r=e,e=t,t=r),r=Lt(e.r,t),e.r=e.l,e.l=r,e},Rt=[];let rr=0;for(;rr<6;)U(Rt,{first:null,last:null,size:0}),rr+=1;const Pn=()=>{for(let e=0;e<6;e++){let t=Rt[e];if(t.size>0){if(e===3||e===4){t.size-=1;let n=$e.v;return $e=Lt($e.l,$e.r),n}t.size===1&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},fe=(e,t,r,n,o,s,i)=>Pt(0,{a:null,b:null,node:r,parent:n,value:o,page:t,scope:s,meta:i},e),Pt=(e,t,r,n=0)=>{let o=Et(r),s=Rt[o],i={v:{idx:e,stack:t,type:r,id:n},l:null,r:null};o===3||o===4?$e=Lt($e,i):(s.size===0?s.first=i:s.last.r=i,s.last=i),s.size+=1},Et=e=>{switch(e){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},yt=new Set;let C,He=1,Ve=0,Xe=0,J=null,En=e=>{C=e},nr=e=>{J=e};const jr=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=le(e);if(e)return e}return null};let An=(e,t,r,n,o)=>{let s=jr(e,n.id);return s?s.reg[n.id]:t?(Ee(t,n,o),t.reg[n.id]):n};const Mn=e=>e;let Ee=(e,t,r,n,o)=>{var s;let i=e.reg,l=t.sid,c=t==null||(s=t.meta)===null||s===void 0?void 0:s.serialize,f=e.fromSerialize&&c!=="ignore"&&c?.read||Mn;if(i[t.id])return;let p={id:t.id,current:t.current,meta:t.meta};if(p.id in e.values.idMap)p.current=e.values.idMap[p.id];else if(l&&l in e.values.sidMap&&!(l in e.sidIdMap))p.current=f(e.values.sidMap[l]);else if(t.before&&!o){let m=0,h=r||!t.noInit||n;B(t.before,u=>{switch(u.type){case _e:{let d=u.from;if(d||u.fn){d&&Ee(e,d,r,n);let a=d&&i[d.id].current;h&&(p.current=u.fn?u.fn(a):a)}break}case"field":m||(m=1,p.current=Array.isArray(p.current)?[...p.current]:{...p.current}),Ee(e,u.from,r,n),h&&(p.current[u.field]=i[i[u.from.id].id].current)}})}l&&(e.sidIdMap[l]=t.id),i[t.id]=p};const Tn=(e,t,r)=>{try{return t(Le(r),e.scope,r)}catch(n){console.error(n),e.fail=1,e.failReason=n}};let Ae=(e,t={})=>(Y(e)&&(Ae(e.or,t),me(e,(r,n)=>{D(r)||n==="or"||n==="and"||(t[n]=r)}),Ae(e.and,t)),t);const or=(e,t)=>{We(e.next,t),We(ct(e),t),We(ut(e),t)},At=(e,t,r)=>{let n;e.next.length=0,e.seq.length=0,e.scope=null;let o=ut(e);for(;n=o.pop();)or(n,e),(t||r&&N(e,"op")!=="sample"||n.family.type==="crosslink")&&At(n,t,N(n,"op")!=="on"&&r);for(o=ct(e);n=o.pop();)or(n,e),r&&n.family.type==="crosslink"&&At(n,t,N(n,"op")!=="on"&&r)},ze=e=>e.clear();let Mt=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),I(e))ze(et(e));else if(kr(e)){r=1;let n=e.history;ze(n.events),ze(n.effects),ze(n.stores),ze(n.domains)}At(H(e),!!t,r)},zr=e=>{let t=()=>Mt(e);return t.unsubscribe=t,t},ue=(e,t,r,n,o)=>ee({node:r,parent:e,child:t,scope:{fn:o},meta:{op:n},family:{owners:[e,t],links:t},regional:1}),Nr=(e,t)=>(j(F(t),".watch argument should be a function"),zr(ee({scope:{fn:t},node:[Ft({fn:Nt})],parent:e,meta:{op:"watch"},family:{owners:e},regional:1}))),Fr=(e,t,r="event")=>{le(e)&&le(e).hooks[r](t)},Lr=(e,t,r)=>{let n=Ae(r),o=e==="domain",s=$n(),{sid:i=null,named:l=null,domain:c=null,parent:f=c}=n,p=l||n.name||(o?"":s),m=br(p,f),h={op:t.kind=e,name:t.shortName=p,sid:t.sid=_n(i),named:l,unitId:t.id=s,serialize:n.serialize,derived:n.derived,config:n};return t.parent=f,t.compositeName=m,t.defaultConfig=n,t.thru=u=>(ge(0,"thru","js pipe"),u(t)),t.getType=()=>m.fullName,!o&&(t.subscribe=u=>(Ar(u),t.watch(F(u)?u:d=>u.next&&u.next(d))),t[wn]=()=>t),h};const vt=(e,t,r,n)=>{let o;Y(r)&&(o=r,r=r.fn);let s=y({name:`${e.shortName} → *`,derived:1,and:o});return ue(e,s,n,t,r),s},Rr=(e,t,r,n,o)=>{let s=q(t),i=W({store:s,to:"a",priority:"read"});r===_e&&(i.data.softRead=1);let l=[i,K(n)];return O("storeOnMap",s,l,I(e)&&q(e)),ue(e,t,l,r,o)},jn=(e,t,r,n,o)=>{let s=e?d=>[...d]:d=>({...d}),i=e?[]:{},l=s(i),c=ye(l),f=ye(1);c.type=e?"list":"shape",c.noInit=1,O("combineBase",c,f);let p=x(l,{name:wr(r),derived:1,and:n}),m=q(p);m.noInit=1,G(p,"isCombine",1);let h=Z(c);h.order={priority:"barrier"};let u=[X((d,a,g)=>(g.scope&&!g.scope.reg[c.id]&&(g.c=1),d)),h,W({store:f,to:"b"}),X((d,{key:a},g)=>{if(g.c||d!==g.a[a])return t&&g.b&&(g.a=s(g.a)),g.a[a]=d,1},1),W({from:"a",target:c}),W({from:"value",store:0,target:f}),W({from:"value",store:1,target:f,priority:"barrier",batch:1}),Z(c,1),o&&K()];return me(r,(d,a)=>{if(!I(d))return j(!Q(d)&&!D(d),`combine expects a store in a field ${a}`),void(l[a]=i[a]=d);i[a]=d.defaultState,l[a]=d.getState();let g=ue(d,p,u,"combine",o);g.scope.key=a;let v=q(d);rt(c,{type:"field",field:a,from:v}),O("combineField",v,g)}),p.defaultShape=r,rt(m,{type:_e,from:c,fn:o}),p.defaultState=o?m.current=o(l):i,p};let Br=(e,t,r)=>{try{return[1,e(...r)]}catch(n){return t(n),[0,null]}},Or=e=>{let t=de(e),r={ref:t};return t&&U(t.activeEffects,r),r},nt=(e,t,r,n,o,s)=>i=>{s.ref&&We(s.ref.activeEffects,s),ie({target:[n,zn],params:[r?{status:"done",params:e,result:i}:{status:"fail",params:e,error:i},{value:i,fn:r?t.rs:t.rj}],defer:1,page:o.page,scope:s.ref,meta:o.meta})};const zn=ee({node:[Ft({fn:({fn:e,value:t})=>e(t)})],meta:{op:"fx",fx:"sidechain"}}),Nn=["source","clock","target"],qr=(e,t)=>e+`: ${t} should be defined`;let Bt=(e,t,r,n,o,s,i,l,c,f,p,m)=>{let h=!!o;j(!D(r)||!D(t),qr(e,"either source or clock"));let u=0;D(r)?u=1:Q(r)||(r=re(r)),D(t)?t=r:(tt(t,e,"clock"),Array.isArray(t)&&(t=Sr(t))),u&&(r=t),l||i||(i=r.shortName);let d="none";(p||n)&&(Q(n)?d="unit":(j(F(n),"`filter` should be function or unit"),d="fn")),o?(tt(o,e,"target"),Mr(e,o)):d==="none"&&f&&I(r)&&I(t)?o=x(s?s(Re(q(r)),Re(q(t))):Re(q(r)),{name:i,sid:m,or:l}):(o=y({name:i,derived:1,or:l}),O("sampleTarget",H(o)));let a=ye(),g=[];if(d==="unit"){let[b,$]=sr(n,o,t,a,e);g=[...wt($),...wt(b)]}let[v,w]=sr(r,o,t,a,e),S=ue(t,o,[O("sampleSourceLoader"),W({from:he,target:a}),...wt(w),Z(v,1,c),...g,Z(a),d==="fn"&&K((b,$,{a:_})=>n(b,_),1),s&&K(Ct),O("sampleSourceUpward",h)],e,s);return Ce(r,[S]),Object.assign(S.meta,l,{joint:1}),o};const wt=e=>[Z(e),X((t,r,{a:n})=>n,1)],sr=(e,t,r,n,o)=>{let s=I(e),i=s?q(e):ye(),l=ye(s);return s||ee({parent:e,node:[W({from:he,target:i}),W({from:"value",store:1,target:l})],family:{owners:[e,t,r],links:t},meta:{op:o},regional:1}),O("sampleSource",l,i,n),[i,l]},bt=(e,t,r,n)=>{let o=e[t];o&&ie({target:o,params:Array.isArray(o)?o.map(()=>r):r,defer:1,stack:n})};function Fn(e){return""}function Ln(e){console.warn("TODO saveToLS")}function Rn(e){const[t,r]=e.split("|");return[+t,+r]}function Bn(){try{return(JSON.parse(localStorage.getItem("history")||"null")||[]).map(({fauna:r,name:n})=>{let o=new Map;return r.forEach(([s,i])=>{const[l,c]=Rn(s);o.has(l)||o.set(l,new Map),o.get(l).set(c,i)}),{fauna:o,name:n}})}catch(e){return console.error(e),[]}}function ot(){return{width:window.visualViewport?.width||600,height:window.visualViewport?.height||400}}function ir(e,t,r){return{x:-(e.col*r-t.x),y:-(e.row*r-t.y)}}function On(e){let t=new Map;const r="b",n="o",o="$";let s="",i=0,l=0;for(let c=0;c<e.length;c++){let f=e[c];if(f.charCodeAt(0)>=48&&f.charCodeAt(0)<=57)s+=f;else{let p=+s||1;if(f===r)l+=p;else if(f===n)for(let m=0;m<p;m++)t.has(l)||t.set(l,new Map),t.get(l).set(i,1),l++;else f===o&&(i+=p,l=0);s=""}}return t}function qn(){return{currentBp:x(null)}}const lr="#5583e5",In="#79e555",$t=[1,100],ar=10,be=ot();function Dn(){const e=$t,t=x({size:ar,prevSize:ar}),r=x({width:be.width,height:be.height}),n=t.map(({size:c},f)=>({height:Math.ceil(be.height/c),width:Math.ceil(be.width/c),prevHeight:f&&f.height||Math.ceil(be.height/c),prevWidth:f&&f.width||Math.ceil(be.width/c)})),o=y(),s=y();let i=0;return document.addEventListener("wheel",c=>{i+=c.deltaY,i>20&&(s(),i=0),i<-20&&(o(),i=0)}),t.on(s,({size:c})=>({size:Math.max($t[0],c-1),prevSize:c})).on(o,({size:c})=>({size:Math.max($t[0],c+1),prevSize:c})),{options:e,$cellSize:t,$fieldSize:n,plus:o,minus:s,$viewPortSize:r}}function Hn(){const e=y(),t=y(),r=x(null);return r.on(t,()=>null).on(e,(o,s)=>s),{$hoveredXY:r,fieldMouseLeaved:t,fieldMouseMoved:e}}function Un(e,t){const r=x(null),n=x(null),o=x(null),s=y(),i=y(),l=y(),c=y(),f=y(),p=y(),m=y();function h(){document.addEventListener("mousedown",s),document.addEventListener("mouseup",i)}const u=e.map(a=>a!==null),d=e.map(a=>a==null);return o.on(s,()=>Date.now()),E({source:t,clock:s,filter:u,target:r}),E({source:e,clock:s,filter:u,target:n}),E({source:{currentHovered:e,initHovered:n,startTime:o},clock:i,filter:a=>!!a.initHovered&&!!a.currentHovered&&!!a.startTime,fn:({currentHovered:a,initHovered:g,startTime:v})=>({start:a,finish:g}),target:l}),E({source:{currentHovered:e,initFocus:r,initHovered:n},clock:e,filter:a=>!!a.initHovered&&!!a.initFocus&&!!a.currentHovered,fn:({currentHovered:a,initHovered:g,initFocus:v})=>({x:v.x+(a.x-g.x),y:v.y+(a.y-g.y)}),target:m}),yn({source:l,match:a=>a.start.x===a.finish.x&&a.start.y===a.finish.y?"click":"dragEnd",cases:{click:f,dragEnd:p}}),E({clock:f,fn:a=>({coords:a.start}),target:c}),r.reset(l,d),n.reset(l,d),o.reset(l,d),{focusMoved:m,initEvents:h,clicked:c}}function Ir(e){var{timeout:t,start:r,stop:n,leading:o=!1,trailing:s=!1}=e,i=r??y({name:"setup",sid:"-ajedhm"}),l=n??y({name:"teardown",sid:"-ryi8gr"}),c=y({name:"tick",sid:"-cw8a02"}),f=x(!1,{name:"$isRunning",sid:"-5gspmy"}),p=Wn(t),m=f.map(w=>!w),h=y({name:"saveTimeout",sid:"satd6r"}),u=x(null,{name:"$timeoutId",sid:"hehxq7"}).on(h,(w,S)=>{var{timeoutId:b}=S;return b}),d=x(()=>{},{name:"$rejecter",sid:"-sc3eh9"}).on(h,(w,S)=>{var{reject:b}=S;return b}),a=Zt({and:{source:{timeout:p,running:f},effect:w=>{var{timeout:S,running:b}=w;return b?new Promise(($,_)=>{var k=setTimeout($,S);h({timeoutId:k,reject:_})}):Promise.reject()}},or:{name:"timeoutFx",sid:"-xlxric"}}),g=Zt({and:{source:{timeoutId:u,rejecter:d},effect:w=>{var{timeoutId:S,rejecter:b}=w;b(),S&&clearTimeout(S)}},or:{name:"cleanupFx",sid:"-32ewxw"}});if(Ne({and:[{clock:i,source:p,filter:m,target:a}],or:{sid:"-us95i7"}}),o){var v=Ne({and:[{clock:i,filter:m}],or:{name:"onReady",sid:"farho0"}});E({and:[{clock:v,target:c}],or:{sid:"-ubrbnn"}})}return E({and:[{clock:i,fn:()=>!0,target:f}],or:{sid:"-ua3xxa"}}),Ne({and:[{clock:a.done,source:p,filter:f,target:a}],or:{sid:"6lcmx8"}}),Ne({and:[{clock:a.done,filter:f,target:c.prepend(()=>{})}],or:{sid:"6p772r"}}),s&&E({and:[{clock:l,target:c}],or:{sid:"75p0xb"}}),f.on(l,()=>!1),E({and:[{clock:l,target:g}],or:{sid:"7ln232"}}),{tick:c,isRunning:f,"@@trigger":()=>({setup:i,teardown:l,fired:c})}}function Wn(e){if(Se.store(e,{sid:"8i2x6t"}))return e;if(typeof e=="number")return x(e,{and:{name:"$timeout"},sid:"-jluixv"});throw new TypeError('timeout parameter in interval method should be number or Store. "'.concat(typeof e,'" was passed'))}function cr(e){var{source:t,timeout:r,target:n=y({name:"target",sid:"r328r6"},{name:"target",sid:"r328r6"})}=e;if(!Se.unit(t))throw new TypeError("source must be unit from effector");var o=Vn(r),s=jt(f=>new Promise(p=>setTimeout(p,f)),{name:"timerFx",sid:"-pyjx8k"}),i=x(null,{and:{serialize:"ignore"},name:"$payload",sid:"hinjft"}).on(t,(f,p)=>p),l=y({name:"triggerTick",sid:"-sf8sou"}),c=x(!0,{and:{serialize:"ignore"},name:"$canTick",sid:"-m0cqc"}).on(l,()=>!1).on(n,()=>!0);return Ne({and:[{clock:t,filter:c,target:l}],or:{sid:"-hzhj9b"}}),E({and:[{source:o,clock:l,target:s}],or:{sid:"-hkn38k"}}),E({and:[{source:i,clock:s.done,target:n}],or:{sid:"-hhcboe"}}),n}function Vn(e){if(Se.store(e,{sid:"-h0ap6r"}))return e;if(typeof e=="number"){if(e<0||!Number.isFinite(e))throw new Error('timeout must be positive number or zero. Received: "'.concat(e,'"'));return x(e,{and:{name:"$timeout"},sid:"-h97n10"})}throw new TypeError('timeout parameter should be number or Store. "'.concat(typeof e,'" was passed'))}function Xn(e,t,r){const n=x(0),o=x({prev:0,delta:0}).reset(t),s=y(),i=y(),l=cr({source:s,timeout:100}),c=cr({source:r,timeout:300}),f=Ir({timeout:1e3,start:i});n.on(l,(h,u)=>u),E({source:{stepsPerSec:o,steps:e},clock:f.tick,fn:({stepsPerSec:h,steps:u})=>({prev:u,delta:u-h.prev}),target:o});const p=[];i(),m();function m(){window.requestAnimationFrame(()=>{const h=performance.now();for(;p.length>0&&p[0]<=h-1e3;)p.shift();p.push(h),m()}),s(p.length)}return{$fps:n,$stepsPerSec:o.map(h=>h.delta),$time:gn(c,0)}}function Yn(e,t){const r=y(),n=y(),o=y(),s=y(),i=y(),l=y(),c=x(!1),f=x(0),p=[1,60],m=x(10),h=m.map(v=>1e3/v),u=y(),d=y(),a=x(null),g=Ir({timeout:h,start:n,stop:Sr([s,o,l])});return E({clock:[g.tick,n,i],filter:re(c,t,(v,w)=>v&&!w),target:r}),E({clock:i,target:r}),E({source:e,clock:n,fn:v=>new Map(v),target:a}),c.on(n,()=>!0).on([o,s],()=>!1).reset(l),m.on(u,v=>Math.min(v+5,p[1])).on(d,v=>Math.max(v-5,p[0])).reset(l),a.on(l,()=>null),f.on(r,v=>v+1).on(o,()=>0).reset(l),{$currentStep:f,$expectedStepsPerSec:m,$isRunning:c,$startFauna:a,start:n,stop:o,pause:s,incExpectedStepsPerSec:u,decExpectedStepsPerSec:d,speedRange:p,gameTick:r,reset:l,oneStep:i}}const L=Dn(),Be=Hn();qn();let je=new Map;je.set(0,new Map([[0,1]]));je.set(65,new Map([[29,1],[18,1]]));je.set(61,new Map([[29,1]]));je.set(71,new Map([[29,1],[18,1]]));je.set(76,new Map([[29,1]]));const te=x({fauna:je,time:0,size:0}),Gn=x([{col:0,row:0,label:"0,0"}]),Dr=x(!1),Ot=y(),dt=y();Dr.on(Ot,()=>!0).on(dt,()=>!1);const R=Yn(te.map(e=>e.fauna),Dr),St=Xn(R.$currentStep,R.reset,dt.map(e=>e.time)),ve=x({x:0,y:0}),Kn=y(),Hr=y(),Ur=y(),qt=Un(Be.$hoveredXY,ve);E({source:[ve,Be.$hoveredXY],clock:L.$cellSize,fn:([e,t],{size:r,prevSize:n})=>{if(t){let o={col:Math.floor((t.x-e.x)/n),row:Math.floor((t.y-e.y)/n)};return ir(o,t,r)}else{let o=ot(),s={x:o.width/2,y:o.height/2},i={col:Math.floor((s.x-e.x)/n),row:Math.floor((s.y-e.y)/n)};return ir(i,s,r)}},target:ve});const It=re(L.$fieldSize,te,ve,L.$cellSize,L.$viewPortSize,(e,{fauna:t},r,{size:n},o)=>{const s=[];return t.forEach((i,l)=>{i.forEach((c,f)=>{const p=l*n+r.x,m=f*n+r.y;s.push({col:p,row:m,val:c})})}),s}),Jn=re(It,te,(e,t)=>({fieldCellsAmount:e.length,faunaCellsAmount:t.size})),Qn=re(L.$fieldSize,Gn,ve,({width:e,height:t},r,n)=>{const o=[];return r.forEach(({col:s,row:i,label:l})=>{const c=s+n.x,f=i+n.y;c>=0&&c<e&&f>=0&&f<t&&o.push({col:c,row:f,label:l})}),o}),Zn=re(It,L.$cellSize,(e,t)=>({size:t,field:e})),eo=re(Be.$hoveredXY,L.$cellSize,(e,{size:t})=>e?[{y:Math.floor(e.y/t)*t+"px",x:Math.floor(e.x/t)*t+"px"}]:[]),to=re(Qn,L.$cellSize,(e,{size:t})=>e.map(({row:r,col:n,label:o})=>({y:r*t+"px",x:n*t+"px",label:o})));E({source:te,clock:R.gameTick,fn:e=>e.fauna,target:Ot});te.on(dt,(e,t)=>t).reset(Ur);ve.on(qt.focusMoved,(e,t)=>t).reset(Kn);E({source:{faunaData:te,screenOffsetXY:ve,cellSize:L.$cellSize},clock:qt.clicked,fn:({faunaData:e,screenOffsetXY:t,cellSize:{size:r}},{coords:n})=>{const o=new Map(e.fauna),s=Math.floor((n.x-t.x)/r),i=Math.floor((n.y-t.y)/r);return o.has(s)||o.set(s,new Map),o.get(s).has(i)?o.get(s).delete(i):o.get(s).set(i,1),{...e,fauna:o}},target:te});const Dt=x(""),ro=y(),Wr=y(),Vr=y();Dt.on(ro,(e,t)=>t);const pt=x(Bn()||[]),Ht=x(new Set),Xr=y(),no=y(),oo=y(),Yr=y(),Ut=y(),so=y();Ht.on(no,(e,t)=>{let r=new Set(e);return r.add(t),r}).on(oo,(e,t)=>{let r=new Set(e);return r.delete(t),r});pt.on(Xr,(e,t)=>{let n=(e[e.length-1]?.name||"0").match(/(\d+)/),o=n&&+n[1]||0;return[...e,{fauna:t,name:`save #${o+1}`}]}).on(Yr,(e,t)=>e.filter(r=>!t.includes(r.name)));E({source:pt,target:jt(e=>{Ln()})});window.addEventListener("beforeunload",()=>{Yr([...Ht.getState()])});re(pt,Ht,(e,t)=>e.map(r=>({...r,toRemove:t.has(r.name)})));E({source:te,clock:so,fn:e=>e.fauna,target:Xr});E({source:pt,clock:Ut,fn:(e,t)=>{const r=e.find(o=>o.name===t).fauna;return{fauna:new Map(r),time:0,size:0}},target:te});E({clock:[Ut,Ur,Wr,Vr],target:R.reset});E({clock:Ut,target:Hr});E({source:It,clock:Wr,fn:Fn,target:Dt});E({source:Dt,clock:Vr,fn:e=>({fauna:On(e),time:0,size:0}),target:te});const io="_field_yvjtj_1",lo="_cell_yvjtj_17",ao="_on1_yvjtj_25",co="_on2_yvjtj_28",uo="_hoveredCell_yvjtj_32",fo="_heartMode_yvjtj_36",po="_label_yvjtj_44",Ue={field:io,cell:lo,on1:ao,on2:co,hoveredCell:uo,heartMode:fo,label:po};function Oe(e,t){var r;return((n,o)=>{let s=!Se.unit(n)&&typeof n=="object",i={};n&&"@@unitShape"in n?typeof n["@@unitShape"]=="function"?i=n["@@unitShape"]():xt("expect @@unitShape to be a function"):i=s?n:{unit:n};let l=Array.isArray(i),c=Object.entries(i),f=l?[]:{},p=[],m={},h={};for(let[d,a]of c)if(Se.store(a))if(m[a.graphite.id]){let g=m[a.graphite.id];f[d]=f[g],h[d]=f[g]}else{p.push(a),m[a.graphite.id]=d;let[g,v]=Qr(ur(a,o));f[d]=g,h[d]=v}else Se.unit(a)||xt("expected useUnit argument to be a unit"),f[d]=o?vn(a,{scope:o}):a;let u=[gt.compute({priority:"effect"}),gt.compute({priority:"sampler",batch:1}),gt.run({fn:()=>{en(()=>{for(let d of p)h[m[d.graphite.id]](()=>ur(d,o))})}})];if(o){let d=ee({node:u}),a=o.additionalLinks,g=[];p.forEach(v=>{let w=v.graphite.id,S=a[w]||[];a[w]=S,S.push(d),g.push(S)}),Wt(()=>{g.forEach(v=>{let w=v.indexOf(d);w!==-1&&v.splice(w,1)}),Mt(d)})}else{let d=ee({node:u,parent:p,family:{owners:p}});Wt(()=>{Mt(d)})}return s?f:f.unit})(e,((n=1)=>{let o=nn(mo);return n&&!o&&xt("No scope found, consider adding <Provider> to app root"),o})((r=t?.forceScope)!==null&&r!==void 0?r:0))}let xt=e=>{throw Error(e)};const ur=(e,t)=>t?t.getState(e):e.getState();let mo=rn(null);const ho=ae("<div><canvas>"),fr=ae("<div>");function go(){let e=ot(),[t,r,n]=Oe([eo,to,L.$cellSize]),o;return tn(()=>{requestAnimationFrame(s);function s(){if(!o){console.warn("no canvas");return}let{size:i,field:l}=Zn.getState(),c=o.getContext("2d");if(!c){console.warn("no context");return}let{width:f,height:p}=o.getBoundingClientRect();c.clearRect(0,0,f,p),c.fillStyle=lr,c.beginPath(),l.forEach(u=>{c&&c.rect(u.col,u.row,i.size,i.size)});let{width:m,height:h}=ot();c.roundRect(m/2-6,h/2-6,12,12,10),c.fill(),requestAnimationFrame(s)}}),(()=>{const s=ho(),i=s.firstChild;return pe(s,"mouseleave",Be.fieldMouseLeaved),s.$$mousemove=({clientX:l,clientY:c})=>Be.fieldMouseMoved({x:l,y:c}),s.style.setProperty("--color1",lr),s.style.setProperty("--color2",In),mn(l=>o=l,i),M(s,()=>t().map(l=>(()=>{const c=fr();return V(f=>{const p=l.x,m=l.y,h={[Ue.cell]:!0,[Ue.hoveredCell]:!0};return p!==f._v$5&&((f._v$5=p)!=null?c.style.setProperty("left",p):c.style.removeProperty("left")),m!==f._v$6&&((f._v$6=m)!=null?c.style.setProperty("top",m):c.style.removeProperty("top")),f._v$7=Gt(c,h,f._v$7),f},{_v$5:void 0,_v$6:void 0,_v$7:void 0}),c})()),null),M(s,()=>r().map(l=>(()=>{const c=fr();return M(c,()=>l.label),V(f=>{const p=l.x,m=l.y,h={[Ue.label]:!0};return p!==f._v$8&&((f._v$8=p)!=null?c.style.setProperty("left",p):c.style.removeProperty("left")),m!==f._v$9&&((f._v$9=m)!=null?c.style.setProperty("top",m):c.style.removeProperty("top")),f._v$10=Gt(c,h,f._v$10),f},{_v$8:void 0,_v$9:void 0,_v$10:void 0}),c})()),null),V(l=>{const c=Ue.field,f=n()+"px",p=e.width,m=e.height;return c!==l._v$&&Ie(s,l._v$=c),f!==l._v$2&&((l._v$2=f)!=null?s.style.setProperty("--cellSize",f):s.style.removeProperty("--cellSize")),p!==l._v$3&&Yt(i,"width",l._v$3=p),m!==l._v$4&&Yt(i,"height",l._v$4=m),l},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),s})()}at(["mousemove"]);const yo="_roundBox_hgest_1",vo="_history_hgest_9",wo="_colorBtn_hgest_15",bo="_currentColor_hgest_22",$o="_arrowBtn_hgest_26",So="_whiteBox_hgest_54",st={roundBox:yo,history:vo,colorBtn:wo,currentColor:bo,arrowBtn:$o,whiteBox:So},xo=ae("<div><button>-</button><button>+");function Gr(e){return(()=>{const t=xo(),r=t.firstChild,n=r.nextSibling;return pe(r,"click",e.onMinusClicked,!0),M(t,()=>` ${e.value} `,n),pe(n,"click",e.onPlusClicked,!0),V(o=>{const s=e.class,i=e.value<=e.range[0],l=e.value>=e.range[1];return s!==o._v$&&Ie(t,o._v$=s),i!==o._v$2&&(r.disabled=o._v$2=i),l!==o._v$3&&(n.disabled=o._v$3=l),o},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t})()}at(["click"]);const _o=ae("<div><button>to center</button><div>");function ko(){const[e]=Oe([L.$cellSize]);return qt.initEvents(),(()=>{const t=_o(),r=t.firstChild,n=r.nextSibling;return pe(r,"click",Hr,!0),n.style.setProperty("position","absolute"),n.style.setProperty("right","150px"),n.style.setProperty("bottom","20px"),n.style.setProperty("z-index","1"),M(n,ne(Gr,{get value(){return e().size},get onPlusClicked(){return L.plus},get onMinusClicked(){return L.minus},get range(){return L.options},get class(){return st.roundBox}})),V(()=>Ie(r,st.arrowBtn)),t})()}at(["click"]);const Co=ae("<button>STOP"),Po=ae("<button>START"),Eo=ae("<p><button>Step</button>timer: ");function Ao(){let[e,t]=Oe([R.$isRunning,R.$currentStep]);return(()=>{const r=Eo(),n=r.firstChild;return n.nextSibling,r.style.setProperty("display","flex"),r.style.setProperty("gap","4px"),r.style.setProperty("position","absolute"),pe(n,"click",R.oneStep,!0),M(r,ne(Vt,{get when(){return e()},get children(){const o=Co();return pe(o,"click",R.stop,!0),o.style.setProperty("color","#f8f8f8"),o.style.setProperty("background-color","#de4040"),o.style.setProperty("border","0"),o}}),null),M(r,ne(Vt,{get when(){return!e()},get children(){const o=Po();return pe(o,"click",R.start,!0),o.style.setProperty("color","#f8f8f8"),o.style.setProperty("background-color","#50c40e"),o.style.setProperty("border","0"),o}}),null),M(r,()=>`steps: ${t()}`,null),V(()=>Ie(r,st.whiteBox)),r})()}at(["click"]);const Mo=ae("<div><span>FPS: </span><span>STEPS PER SEC: </span><span>EXPECTED STEPS:</span><span>CALC TIME: <!> msec</span><span>CELLS: </span><span>CELLS ON SCREEN: ");function To(){const[e,t,r]=Oe([St.$stepsPerSec,St.$time,St.$fps]),[n,o]=Oe([Jn,R.$expectedStepsPerSec]);return(()=>{const s=Mo(),i=s.firstChild;i.firstChild;const l=i.nextSibling;l.firstChild;const c=l.nextSibling,f=c.nextSibling,p=f.firstChild,m=p.nextSibling;m.nextSibling;const h=f.nextSibling;h.firstChild;const u=h.nextSibling;return u.firstChild,s.style.setProperty("position","absolute"),s.style.setProperty("display","grid"),s.style.setProperty("bottom","10px"),s.style.setProperty("left","130px"),M(i,r,null),M(l,e,null),M(s,ne(Gr,{get value(){return o()},get onPlusClicked(){return R.incExpectedStepsPerSec},get onMinusClicked(){return R.decExpectedStepsPerSec},get range(){return R.speedRange}}),f),M(f,t,m),M(h,()=>n().faunaCellsAmount,null),M(u,()=>n().fieldCellsAmount,null),V(()=>Ie(s,st.whiteBox)),s})()}const jo=ae("<div><div><h2>TODO</h2><ul><li> ++ navigation</li><li> ++ field</li><li> ++ Progress</li><li> ++ perf</li><li>history</li><li>reset button</li><li>import stuff</li></ul></div><div><h1>Game of Life");function zo(){return(()=>{const e=jo(),t=e.firstChild,r=t.nextSibling;return r.firstChild,t.style.setProperty("position","absolute"),t.style.setProperty("pointer-events","none"),M(e,ne(ko,{}),r),M(e,ne(go,{}),r),r.style.setProperty("position","absolute"),r.style.setProperty("width","100%"),r.style.setProperty("background-color","rgba(255,255,255, 0.9)"),M(r,ne(Ao,{}),null),M(e,ne(To,{}),null),e})()}No();function No(){const e=new Worker("./webworkerGo.js");e.addEventListener("message",t=>{dt(t.data)}),e.addEventListener("error",t=>{console.log("main.error err",t)}),Ot.watch(t=>{e.postMessage(t)})}pn(()=>ne(zo,{}),document.querySelector("#app"));
