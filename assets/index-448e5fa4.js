(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=r(o);fetch(o.href,s)}})();const Qr=(e,t)=>e===t,Ye={equals:Qr};let hr=br;const fe=1,Ge=2,mr={owned:null,cleanups:null,context:null,owner:null};var E=null;let gt=null,A=null,N=null,se=null,it=0;function Zr(e,t){const r=A,n=E,o=e.length===0,s=t===void 0?n:t,i=o?mr:{owned:null,cleanups:null,context:s?s.context:null,owner:s},l=o?e:()=>e(()=>ie(()=>lt(i)));E=i,A=null;try{return Te(l,!0)}finally{A=r,E=n}}function en(e,t){t=t?Object.assign({},Ye,t):Ye;const r={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=o=>(typeof o=="function"&&(o=o(r.value)),yr(r,o));return[gr.bind(r),n]}function H(e,t,r){const n=Tt(e,t,!1,fe);Ie(n)}function tn(e,t,r){hr=un;const n=Tt(e,t,!1,fe);(!r||!r.render)&&(n.user=!0),se?se.push(n):Ie(n)}function Ke(e,t,r){r=r?Object.assign({},Ye,r):Ye;const n=Tt(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=r.equals||void 0,Ie(n),gr.bind(n)}function rn(e){return Te(e,!1)}function ie(e){if(A===null)return e();const t=A;A=null;try{return e()}finally{A=t}}function nn(e){tn(()=>ie(e))}function Xt(e){return E===null||(E.cleanups===null?E.cleanups=[e]:E.cleanups.push(e)),e}function on(e,t){const r=Symbol("context");return{id:r,Provider:dn(r),defaultValue:e}}function sn(e){return E&&E.context&&E.context[e.id]!==void 0?E.context[e.id]:e.defaultValue}function ln(e){const t=Ke(e),r=Ke(()=>_t(t()));return r.toArray=()=>{const n=r();return Array.isArray(n)?n:n!=null?[n]:[]},r}function gr(){if(this.sources&&this.state)if(this.state===fe)Ie(this);else{const e=N;N=null,Te(()=>Qe(this),!1),N=e}if(A){const e=this.observers?this.observers.length:0;A.sources?(A.sources.push(this),A.sourceSlots.push(e)):(A.sources=[this],A.sourceSlots=[e]),this.observers?(this.observers.push(A),this.observerSlots.push(A.sources.length-1)):(this.observers=[A],this.observerSlots=[A.sources.length-1])}return this.value}function yr(e,t,r){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&Te(()=>{for(let o=0;o<e.observers.length;o+=1){const s=e.observers[o],i=gt&&gt.running;i&&gt.disposed.has(s),(i?!s.tState:!s.state)&&(s.pure?N.push(s):se.push(s),s.observers&&vr(s)),i||(s.state=fe)}if(N.length>1e6)throw N=[],new Error},!1)),t}function Ie(e){if(!e.fn)return;lt(e);const t=E,r=A,n=it;A=E=e,an(e,e.value,n),A=r,E=t}function an(e,t,r){let n;try{n=e.fn(t)}catch(o){return e.pure&&(e.state=fe,e.owned&&e.owned.forEach(lt),e.owned=null),e.updatedAt=r+1,$r(o)}(!e.updatedAt||e.updatedAt<=r)&&(e.updatedAt!=null&&"observers"in e?yr(e,n):e.value=n,e.updatedAt=r)}function Tt(e,t,r,n=fe,o){const s={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:E,context:E?E.context:null,pure:r};return E===null||E!==mr&&(E.owned?E.owned.push(s):E.owned=[s]),s}function Je(e){if(e.state===0)return;if(e.state===Ge)return Qe(e);if(e.suspense&&ie(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<it);)e.state&&t.push(e);for(let r=t.length-1;r>=0;r--)if(e=t[r],e.state===fe)Ie(e);else if(e.state===Ge){const n=N;N=null,Te(()=>Qe(e,t[0]),!1),N=n}}function Te(e,t){if(N)return e();let r=!1;t||(N=[]),se?r=!0:se=[],it++;try{const n=e();return cn(r),n}catch(n){r||(se=null),N=null,$r(n)}}function cn(e){if(N&&(br(N),N=null),e)return;const t=se;se=null,t.length&&Te(()=>hr(t),!1)}function br(e){for(let t=0;t<e.length;t++)Je(e[t])}function un(e){let t,r=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[r++]=n:Je(n)}for(t=0;t<r;t++)Je(e[t])}function Qe(e,t){e.state=0;for(let r=0;r<e.sources.length;r+=1){const n=e.sources[r];if(n.sources){const o=n.state;o===fe?n!==t&&(!n.updatedAt||n.updatedAt<it)&&Je(n):o===Ge&&Qe(n,t)}}}function vr(e){for(let t=0;t<e.observers.length;t+=1){const r=e.observers[t];r.state||(r.state=Ge,r.pure?N.push(r):se.push(r),r.observers&&vr(r))}}function lt(e){let t;if(e.sources)for(;e.sources.length;){const r=e.sources.pop(),n=e.sourceSlots.pop(),o=r.observers;if(o&&o.length){const s=o.pop(),i=r.observerSlots.pop();n<o.length&&(s.sourceSlots[i]=n,o[n]=s,r.observerSlots[n]=i)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)lt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function fn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function $r(e,t=E){throw fn(e)}function _t(e){if(typeof e=="function"&&!e.length)return _t(e());if(Array.isArray(e)){const t=[];for(let r=0;r<e.length;r++){const n=_t(e[r]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function dn(e,t){return function(n){let o;return H(()=>o=ie(()=>(E.context={...E.context,[e]:n.value},ln(()=>n.children))),void 0),o}}function oe(e,t){return ie(()=>e(t||{}))}const pn=e=>`Stale read from <${e}>.`;function Yt(e){const t=e.keyed,r=Ke(()=>e.when,void 0,{equals:(n,o)=>t?n===o:!n==!o});return Ke(()=>{const n=r();if(n){const o=e.children;return typeof o=="function"&&o.length>0?ie(()=>o(t?n:()=>{if(!ie(r))throw pn("Show");return e.when})):o}return e.fallback},void 0,void 0)}function hn(e,t,r){let n=r.length,o=t.length,s=n,i=0,l=0,a=t[o-1].nextSibling,f=null;for(;i<o||l<s;){if(t[i]===r[l]){i++,l++;continue}for(;t[o-1]===r[s-1];)o--,s--;if(o===i){const u=s<n?l?r[l-1].nextSibling:r[s-l]:a;for(;l<s;)e.insertBefore(r[l++],u)}else if(s===l)for(;i<o;)(!f||!f.has(t[i]))&&t[i].remove(),i++;else if(t[i]===r[s-1]&&r[l]===t[o-1]){const u=t[--o].nextSibling;e.insertBefore(r[l++],t[i++].nextSibling),e.insertBefore(r[--s],u),t[o]=r[s]}else{if(!f){f=new Map;let h=l;for(;h<s;)f.set(r[h],h++)}const u=f.get(t[i]);if(u!=null)if(l<u&&u<s){let h=i,m=1,d;for(;++h<o&&h<s&&!((d=f.get(t[h]))==null||d!==u+m);)m++;if(m>u-l){const p=t[i];for(;l<u;)e.insertBefore(r[l++],p)}else e.replaceChild(r[l++],t[i++])}else i++;else t[i++].remove()}}}const Gt="_$DX_DELEGATE";function mn(e,t,r,n={}){let o;return Zr(s=>{o=s,t===document?e():M(t,e(),t.firstChild?null:void 0,r)},n.owner),()=>{o(),t.textContent=""}}function ce(e,t,r){let n;const o=()=>{const i=document.createElement("template");return i.innerHTML=e,r?i.content.firstChild.firstChild:i.content.firstChild},s=t?()=>ie(()=>document.importNode(n||(n=o()),!0)):()=>(n||(n=o())).cloneNode(!0);return s.cloneNode=s,s}function Oe(e,t=window.document){const r=t[Gt]||(t[Gt]=new Set);for(let n=0,o=e.length;n<o;n++){const s=e[n];r.has(s)||(r.add(s),t.addEventListener(s,yn))}}function Kt(e,t,r){r==null?e.removeAttribute(t):e.setAttribute(t,r)}function qe(e,t){t==null?e.removeAttribute("class"):e.className=t}function Z(e,t,r,n){if(n)Array.isArray(r)?(e[`$$${t}`]=r[0],e[`$$${t}Data`]=r[1]):e[`$$${t}`]=r;else if(Array.isArray(r)){const o=r[0];e.addEventListener(t,r[0]=s=>o.call(e,r[1],s))}else e.addEventListener(t,r)}function Jt(e,t,r={}){const n=Object.keys(t||{}),o=Object.keys(r);let s,i;for(s=0,i=o.length;s<i;s++){const l=o[s];!l||l==="undefined"||t[l]||(Qt(e,l,!1),delete r[l])}for(s=0,i=n.length;s<i;s++){const l=n[s],a=!!t[l];!l||l==="undefined"||r[l]===a||!a||(Qt(e,l,!0),r[l]=a)}return r}function gn(e,t,r){return ie(()=>e(t,r))}function M(e,t,r,n){if(r!==void 0&&!n&&(n=[]),typeof t!="function")return Ze(e,t,n,r);H(o=>Ze(e,t(),o,r),n)}function Qt(e,t,r){const n=t.trim().split(/\s+/);for(let o=0,s=n.length;o<s;o++)e.classList.toggle(n[o],r)}function yn(e){const t=`$$${e.type}`;let r=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==r&&Object.defineProperty(e,"target",{configurable:!0,value:r}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return r||document}});r;){const n=r[t];if(n&&!r.disabled){const o=r[`${t}Data`];if(o!==void 0?n.call(r,o,e):n.call(r,e),e.cancelBubble)return}r=r._$host||r.parentNode||r.host}}function Ze(e,t,r,n,o){for(;typeof r=="function";)r=r();if(t===r)return r;const s=typeof t,i=n!==void 0;if(e=i&&r[0]&&r[0].parentNode||e,s==="string"||s==="number")if(s==="number"&&(t=t.toString()),i){let l=r[0];l&&l.nodeType===3?l.data=t:l=document.createTextNode(t),r=ve(e,r,n,l)}else r!==""&&typeof r=="string"?r=e.firstChild.data=t:r=e.textContent=t;else if(t==null||s==="boolean")r=ve(e,r,n);else{if(s==="function")return H(()=>{let l=t();for(;typeof l=="function";)l=l();r=Ze(e,l,r,n)}),()=>r;if(Array.isArray(t)){const l=[],a=r&&Array.isArray(r);if(kt(l,t,r,o))return H(()=>r=Ze(e,l,r,n,!0)),()=>r;if(l.length===0){if(r=ve(e,r,n),i)return r}else a?r.length===0?Zt(e,l,n):hn(e,r,l):(r&&ve(e),Zt(e,l));r=l}else if(t.nodeType){if(Array.isArray(r)){if(i)return r=ve(e,r,n,t);ve(e,r,null,t)}else r==null||r===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);r=t}else console.warn("Unrecognized value. Skipped inserting",t)}return r}function kt(e,t,r,n){let o=!1;for(let s=0,i=t.length;s<i;s++){let l=t[s],a=r&&r[s],f;if(!(l==null||l===!0||l===!1))if((f=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))o=kt(e,l,a)||o;else if(f==="function")if(n){for(;typeof l=="function";)l=l();o=kt(e,Array.isArray(l)?l:[l],Array.isArray(a)?a:[a])||o}else e.push(l),o=!0;else{const u=String(l);a&&a.nodeType===3&&a.data===u?e.push(a):e.push(document.createTextNode(u))}}return o}function Zt(e,t,r=null){for(let n=0,o=t.length;n<o;n++)e.insertBefore(t[n],r)}function ve(e,t,r,n){if(r===void 0)return e.textContent="";const o=n||document.createTextNode("");if(t.length){let s=!1;for(let i=t.length-1;i>=0;i--){const l=t[i];if(o!==l){const a=l.parentNode===e;!s&&!i?a?e.replaceChild(o,l):e.insertBefore(o,r):a&&l.remove()}else s=!0}}else e.insertBefore(o,r);return[o]}function me(e,t){for(let r in e)t(e[r],r)}function B(e,t){e.forEach(t)}function z(e,t){if(!e)throw Error(t)}function re({node:e=[],from:t,source:r,parent:n=t||r,to:o,target:s,child:i=o||s,scope:l={},meta:a={},family:f={type:"regular"},regional:u}={}){let h=Fe(n),m=Fe(f.links),d=Fe(f.owners),p=[];B(e,g=>g&&W(p,g));let c={id:_n(),seq:p,next:Fe(i),meta:a,scope:l,family:{type:f.type||"crosslink",links:m,owners:d}};return B(m,g=>W(at(g),c)),B(d,g=>W(ct(g),c)),B(h,g=>W(g.next,c)),u&&xe&&Pe(Le(xe),[c]),c}function le(e,t,r){let n,o=Q,s=null,i=C;if(e.target&&(t=e.params,r=e.defer,n=e.meta,o="page"in e?e.page:o,e.stack&&(s=e.stack),i=he(e)||i,e=e.target),i&&C&&i!==C&&(C=null),Array.isArray(e))for(let p=0;p<e.length;p++)pe("pure",o,U(e[p]),s,t[p],i,n);else pe("pure",o,U(e),s,t,i,n);if(r&&!He)return;let l,a,f,u,h,m,d={isRoot:He,currentPage:Q,scope:C,isWatch:We,isPure:Xe};He=0;e:for(;u=An();){let{idx:p,stack:c,type:g}=u;f=c.node,Q=h=c.page,C=he(c),h?m=h.reg:C&&(m=C.reg);let w=!!h,v=!!C,b={fail:0,scope:f.scope};l=a=0;for(let $=p;$<f.seq.length&&!l;$++){let S=f.seq[$];if(S.order){let{priority:_,barrierID:k}=S.order,T=k?h?`${h.fullID}_${k}`:k:0;if($!==p||g!==_){k?bt.has(T)||(bt.add(T),Ct($,c,_,k)):Ct($,c,_);continue e}k&&bt.delete(T)}switch(S.type){case"mov":{let k,T=S.data;switch(T.from){case ge:k=Le(c);break;case"a":case"b":k=c[T.from];break;case"value":k=T.store;break;case"store":if(m&&!m[T.store.id])if(w){let mt=Nr(h,T.store.id);c.page=h=mt,mt?m=mt.reg:v?(Ee(C,T.store,0,1,T.softRead),m=C.reg):m=void 0}else v&&Ee(C,T.store,0,1,T.softRead);k=Re(m&&m[T.store.id]||T.store)}switch(T.to){case ge:c.value=k;break;case"a":case"b":c[T.to]=k;break;case"store":Tn(h,C,f,T.target).current=k}break}case"compute":let _=S.data;if(_.fn){We=F(f,"op")==="watch",Xe=_.pure;let k=_.safe?(0,_.fn)(Le(c),b.scope,c):jn(b,_.fn,c);_.filter?a=!k:c.value=k,We=d.isWatch,Xe=d.isPure}}l=b.fail||a}if(!l){let $=Le(c),S=he(c);if(B(f.next,_=>{pe("child",h,_,c,$,S)}),S){F(f,"needFxCounter")&&pe("child",h,S.fxCount,c,$,S),F(f,"storeChange")&&pe("child",h,S.storeChange,c,$,S),F(f,"warnSerialize")&&pe("child",h,S.warnSerializeNode,c,$,S);let _=S.additionalLinks[f.id];_&&B(_,k=>{pe("child",h,k,c,$,S)})}}}He=d.isRoot,Q=d.currentPage,C=he(d)}function wr(e,t="combine"){let r=t+"(",n="",o=0;return me(e,s=>{o<25&&(s!=null&&(r+=n,r+=ee(s)?jt(s).fullName:s.toString()),o+=1,n=", ")}),r+")"}function Sr(e,t){let r,n,o=e;if(t){let s=jt(t);e.length===0?(r=s.path,n=s.fullName):(r=s.path.concat([e]),n=s.fullName.length===0?e:s.fullName+"/"+e)}else r=e.length===0?[]:[e],n=e;return{shortName:o,fullName:n,path:r}}function ze(e,t){let r=t?e:e[0];Tr(r);let n=r.or,o=r.and;if(o){let s=t?o:o[0];if(G(s)&&"and"in s){let i=ze(o,t);e=i[0],n={...n,...i[1]}}else e=o}return[e,n]}function I(e,...t){let r=Mr();if(r){let n=r.handlers[e];if(n)return n(r,...t)}}function y(e,t){let r=Ae({or:t,and:typeof e=="string"?{name:e}:e}),n=(i,...l)=>(ye(!F(n,"derived"),"call of derived event","createEvent"),ye(!Xe,"unit call from pure function","operators like sample"),Q?((a,f,u,h)=>{let m=Q,d=null;if(f)for(d=Q;d&&d.template!==f;)d=ae(d);sr(d);let p=a.create(u,h);return sr(m),p})(n,o,i,l):n.create(i,l)),o=Mr(),s=Object.assign(n,{graphite:re({meta:Br(r.actualOp||"event",n,r),regional:1}),create:i=>(le({target:n,params:i,scope:C}),i),watch:i=>Lr(n,i),map:i=>vt(n,_e,i,[J()]),filter:i=>vt(n,"filter",i.fn?i:i.fn,[J(Nt,1)]),filterMap:i=>vt(n,"filterMap",i,[J(),Y(l=>!D(l),1)]),prepend(i){let l=y("* → "+n.shortName,{parent:ae(n)});return I("eventPrepend",U(l)),de(l,n,[J()],"prepend",i),Rr(n,l),l}});return r!=null&&r.domain&&r.domain.hooks.event(s),K(s,"id",s.graphite.id),Ar(s.graphite),s}function er(e,t,r,n){return tt(r,t,"first argument"),z(L(n),"second argument should be a function"),ye(!F(e,"derived"),`${t} in derived store`,`${t} in store created via createStore`),B(Array.isArray(r)?r:[r],o=>{e.off(o),et(e).set(o,Fr(Ir(o,e,"on",Cn,n)))}),e}function x(e,t){let r=Ae(t),n=be(e),o=y({named:"updates",derived:1});I("storeBase",n);let s=n.id,i={subscribers:new Map,updates:o,defaultState:e,stateRef:n,getState(){let d,p=n;if(Q){let c=Q;for(;c&&!c.reg[s];)c=ae(c);c&&(d=c)}return!d&&C&&(Ee(C,n,1),d=C),d&&(p=d.reg[s]),Re(p)},setState:d=>le({target:i,params:d,defer:1,scope:C}),reset:(...d)=>(B(d,p=>er(i,".reset",p,()=>i.defaultState)),i),on:(d,p)=>er(i,".on",d,p),off(d){let p=et(i).get(d);return p&&(p(),et(i).delete(d)),i},map(d,p){let c,g;G(d)&&(c=d,d=d.fn),ye(D(p),"second argument of store.map","updateFilter");let w=i.getState();D(w)||(g=d(w,p));let v=x(g,{name:`${i.shortName} → *`,derived:1,and:c}),b=Ir(i,v,_e,Pt,d);return rt(O(v),{type:_e,fn:d,from:n}),O(v).noInit=1,I("storeMap",n,b),v},watch(d,p){if(!p||!ee(d)){let c=Lr(i,d);return I("storeWatch",n,d)||d(i.getState()),c}return z(L(p),"second argument should be a function"),d.watch(c=>p(i.getState(),c))}},l=Br("store",i,r),a=i.defaultConfig.updateFilter;i.graphite=re({scope:{state:n,fn:a},node:[Y((d,p,c)=>(c.scope&&!c.scope.reg[n.id]&&(c.b=1),d)),te(n),Y((d,p,{a:c,b:g})=>!D(d)&&(d!==c||g),1),a&&J(Pt,1),X({from:ge,target:n})],child:o,meta:{...l,defaultState:e},regional:1}),K(i,"id",i.graphite.id),K(i,"rootStateRefId",s);let f=F(i,"serialize"),u=F(i,"derived"),h=f==="ignore",m=F(i,"sid");return m&&(K(i,"storeChange",1),n.sid=m),m||h||u||K(i,"warnSerialize",1),z(u||!D(e),"current state can't be undefined, use null instead"),Pe(i,[o]),r!=null&&r.domain&&r.domain.hooks.store(i),u||(i.reinit=y({named:"reinit"}),i.reset(i.reinit)),n.meta=i.graphite.meta,Ar(i.graphite),i}function ne(...e){let t,r,n;[e,n]=ze(e);let o,s,i,l=e[e.length-1];if(L(l)?(r=e.slice(0,-1),t=l):r=e,r.length===1){let a=r[0];q(a)||(o=a,s=1)}if(!s&&(o=r,t)){i=1;let a=t;t=f=>a(...f)}return z(G(o),"shape should be an object"),Nn(Array.isArray(o),!i,o,n,t)}function xr(){let e={};return e.req=new Promise((t,r)=>{e.rs=t,e.rj=r}),e.req.catch(()=>{}),e}function zt(e,t={}){let r=Ae(L(e)?{handler:e}:e,t),n=y(L(e)?{handler:e}:e,{...t,actualOp:"effect"}),o=U(n);K(o,"op",n.kind="effect"),n.use=d=>(z(L(d),".use argument should be a function"),u.scope.handler=d,n),n.use.getCurrent=()=>u.scope.handler;let s=n.finally=y({named:"finally",derived:1}),i=n.done=s.filterMap({named:"done",fn({status:d,params:p,result:c}){if(d==="done")return{params:p,result:c}}}),l=n.fail=s.filterMap({named:"fail",fn({status:d,params:p,error:c}){if(d==="fail")return{params:p,error:c}}}),a=n.doneData=i.map({named:"doneData",fn:({result:d})=>d}),f=n.failData=l.map({named:"failData",fn:({error:d})=>d}),u=re({scope:{handler:n.defaultConfig.handler||(()=>z(0,`no handler used in ${n.getType()}`))},node:[Y((d,p,c)=>{let g=p.handler,w=he(c);if(w){let v=w.handlers.unitMap.get(n)||w.handlers.sidMap[n.sid];v&&(g=v)}return d.handler=g,d},0,1),Y(({params:d,req:p,handler:c,args:g=[d]},w,v)=>{let b=qr(v),$=nt(d,p,1,s,v,b),S=nt(d,p,0,s,v,b),[_,k]=Or(c,S,g);_&&(G(k)&&L(k.then)?k.then($,S):$(k))},0,1)],meta:{op:"fx",fx:"runner"}});o.scope.runner=u,W(o.seq,Y((d,{runner:p},c)=>{let g=ae(c)?{params:d,req:{rs(w){},rj(w){}}}:d;return c.meta||(c.meta={fxID:kn()}),le({target:p,params:g,defer:1,scope:he(c),meta:c.meta}),g.params},0,1)),n.create=d=>{let p=xr(),c={params:d,req:p};if(C&&!We){let g=C;p.req.finally(()=>{Mn(g)}).catch(()=>{})}return le({target:n,params:c,scope:C}),p.req};let h=n.inFlight=x(0,{serialize:"ignore",named:(F(n,"name")||n.graphite.id)+".inFlight"}).on(n,d=>d+1).on(s,d=>d-1).map({fn:d=>d,named:"inFlight"});K(s,"needFxCounter","dec"),K(n,"needFxCounter",1);let m=n.pending=h.map({fn:d=>d>0,named:"pending"});return Pe(n,[s,i,l,a,f,m,h]),r!=null&&r.domain&&r.domain.hooks.effect(n),n}function tr(e){let t;[e,t]=ze(e,1);let{source:r,effect:n,mapParams:o}=e,s=zt(e,t);K(s,"attached",1);let i,{runner:l}=U(s).scope,a=Y((u,h,m)=>{let d,{params:p,req:c,handler:g}=u,w=s.finally,v=qr(m),b=nt(p,c,0,w,m,v),$=m.a,S=ke(g),_=1;if(o?[_,d]=Or(o,b,[p,$]):d=r&&S?$:p,_){if(!S)return u.args=[$,d],1;le({target:g,params:{params:d,req:{rs:nt(p,c,1,w,m,v),rj:b}},page:m.page,defer:1,meta:m.meta})}},1,1);if(r){let u;q(r)?(u=r,Pe(u,[s])):(u=ne(r),Pe(s,[u])),i=[te(O(u)),a]}else i=[a];l.seq.splice(1,0,...i),s.use(n);let f=ae(n);return f&&(Object.assign(jt(s),Sr(s.shortName,f)),s.defaultConfig.parent=f),Rr(n,s,"effect"),s}function _r(e,t){tt(e,"merge","first argument");let r=y({name:wr(e,"merge"),derived:1,and:t});return de(e,r,[],"merge"),r}function kr(e,t){let r=0;return B(Ln,n=>{n in e&&(z(e[n]!=null,Dr(t,n)),r=1)}),r}function P(...e){let t,r,n,o,[[s,i,l],a]=ze(e),f=1;return D(i)&&G(s)&&kr(s,"sample")&&(i=s.clock,l=s.fn,f=!s.greedy,o=s.filter,t=s.target,r=s.name,n=s.sid,s=s.source),Bt("sample",i,s,o,t,l,r,a,f,1,0,n)}function Ne(...e){let[[t,r],n]=ze(e);return r||(r=t,t=r.source),kr(r,"guard"),Bt("guard",r.clock,t,r.filter,r.target,null,r.name,n,!r.greedy,0,1)}function bn(e,t,r){if(q(e))return ye(0,"restore($store)"),e;if(Pr(e)||ke(e)){let o=ae(e),s=x(t,{parent:o,name:e.shortName,and:r});return de(ke(e)?e.doneData:e,s),o&&o.hooks.store(s),s}let n=Array.isArray(e)?[]:{};return me(e,(o,s)=>n[s]=q(o)?o:x(o,{name:s})),n}function vn(...e){let t,r,n="split",[[o,s],i]=ze(e),l=!s;l&&(t=o.cases,s=o.match,r=o.clock,o=o.source);let a=q(s),f=!ee(s)&&L(s),u=!a&&!f&&G(s);z(ee(o),"source must be a unit"),t||(t={}),l?me(t,(c,g)=>zr(n,c,`cases.${g}`)):(z(u,"match should be an object"),me(s,(c,g)=>t[g]=y({derived:1,named:`cases.${g}`,and:i})),t.__=y({derived:1,named:"cases.__",and:i}));let h,m=new Set([].concat(o,r||[],Object.values(t))),d=Object.keys(a||f?t:s);if(a||f)a&&m.add(s),h=[a&&te(O(s),0,1),Ce({safe:a,filter:1,pure:!a,fn(c,g,w){let v=String(a?w.a:s(c));wt(g,rr(d,v)?v:"__",c,w)}})];else if(u){let c=be({});c.type="shape";let g,w=[];me(s,(v,b)=>{if(ee(v)){g=1,W(w,b),m.add(v);let $=de(v,[],[te(c),Y((S,_,{a:k})=>k[b]=S)]);if(q(v)){c.current[b]=v.getState();let S=O(v);rt(c,{from:S,field:b,type:"field"}),I("splitMatchStore",S,$)}}}),g&&I("splitBase",c),h=[g&&te(c,0,1),J((v,b,$)=>{for(let S=0;S<d.length;S++){let _=d[S];if(rr(w,_)?$.a[_]:s[_](v))return void wt(b,_,v,$)}wt(b,"__",v,$)},1)]}else z(0,"expect match to be unit, function or object");let p=re({meta:{op:n},parent:r?[]:o,scope:t,node:h,family:{owners:Array.from(m)},regional:1});if(r&&Bt(n,r,o,null,p,null,n,i,0,0,0),!l)return t}function $n(e,{scope:t,safe:r}={}){z(t||C||r,"scopeBind cannot be called outside of forked .watch");let n=t||C;return ke(e)?o=>{let s=xr();return le({target:e,params:{params:o,req:s},scope:n}),s.req}:o=>(le({target:e,params:o,scope:n}),o)}let wn=typeof Symbol<"u"&&Symbol.observable||"@@observable",_e="map",ge="stack",U=e=>e.graphite||e,at=e=>e.family.owners,ct=e=>e.family.links,O=e=>e.stateRef,Le=e=>e.value,et=e=>e.subscribers,ae=e=>e.parent,he=e=>e.scope,F=(e,t)=>U(e).meta[t],K=(e,t,r)=>U(e).meta[t]=r,jt=e=>e.compositeName,ee=e=>(L(e)||G(e))&&"kind"in e;const De=e=>t=>ee(t)&&t.kind===e;let q=De("store"),Pr=De("event"),ke=De("effect"),Cr=De("domain"),Sn=De("scope");var Se={__proto__:null,unit:ee,store:q,event:Pr,effect:ke,domain:Cr,scope:Sn,attached:e=>ke(e)&&F(e,"attached")==1};let rr=(e,t)=>e.includes(t),Ve=(e,t)=>{let r=e.indexOf(t);r!==-1&&e.splice(r,1)},W=(e,t)=>e.push(t),ye=(e,t,r)=>!e&&console.error(`${t} is deprecated${r?`, use ${r} instead`:""}`);const ut=()=>{let e=0;return()=>""+ ++e};let xn=ut(),Er=ut(),_n=ut(),kn=ut(),xe=null,Ar=e=>{},Mr=()=>xe,Pn=e=>(e&&xe&&xe.sidRoot&&(e=`${xe.sidRoot}|${e}`),e),Pe=(e,t)=>{let r=U(e);B(t,n=>{let o=U(n);r.family.type!=="domain"&&(o.family.type="crosslink"),W(at(o),r),W(ct(r),o)})},Fe=(e=[])=>(Array.isArray(e)?e:[e]).flat().map(U),G=e=>typeof e=="object"&&e!==null,L=e=>typeof e=="function",D=e=>e===void 0,Tr=e=>z(G(e)||L(e),"expect first argument be an object");const nr=(e,t,r,n)=>z(!(!G(e)&&!L(e)||!("family"in e)&&!("graphite"in e)),`${t}: expect ${r} to be a unit (store, event or effect)${n}`);let tt=(e,t,r)=>{Array.isArray(e)?B(e,(n,o)=>nr(n,t,`${o} item of ${r}`,"")):nr(e,t,r," or array of units")},zr=(e,t,r="target")=>B(Fe(t),n=>ye(!F(n,"derived"),`${e}: derived unit in "${r}"`,"createEvent/createStore")),Pt=(e,{fn:t},{a:r})=>t(e,r),Cn=(e,{fn:t},{a:r})=>t(r,e),Nt=(e,{fn:t})=>t(e);const jr=(e,t,r,n)=>{let o={id:Er(),type:e,data:t};return r&&(o.order={priority:r},n&&(o.order.barrierID=++En)),o};let En=0,X=({from:e="store",store:t,target:r,to:n=r?"store":ge,batch:o,priority:s})=>jr("mov",{from:e,store:t,to:n,target:r},s,o),Ce=({fn:e,batch:t,priority:r,safe:n=0,filter:o=0,pure:s=0})=>jr("compute",{fn:e,safe:n,filter:o,pure:s},r,t),Ft=({fn:e})=>Ce({fn:e,priority:"effect"}),Y=(e,t,r)=>Ce({fn:e,safe:1,filter:t,priority:r&&"effect"}),te=(e,t,r)=>X({store:e,to:t?ge:"a",priority:r&&"sampler",batch:1}),J=(e=Nt,t)=>Ce({fn:e,pure:1,filter:t}),yt={mov:X,compute:Ce,filter:({fn:e,pure:t})=>Ce({fn:e,filter:1,pure:t}),run:Ft},be=e=>({id:Er(),current:e}),Re=({current:e})=>e,rt=(e,t)=>{e.before||(e.before=[]),W(e.before,t)},we=null;const Lt=(e,t)=>{if(!e)return t;if(!t)return e;let r;return(e.v.type===t.v.type&&e.v.id>t.v.id||Et(e.v.type)>Et(t.v.type))&&(r=e,e=t,t=r),r=Lt(e.r,t),e.r=e.l,e.l=r,e},Rt=[];let or=0;for(;or<6;)W(Rt,{first:null,last:null,size:0}),or+=1;const An=()=>{for(let e=0;e<6;e++){let t=Rt[e];if(t.size>0){if(e===3||e===4){t.size-=1;let n=we.v;return we=Lt(we.l,we.r),n}t.size===1&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},pe=(e,t,r,n,o,s,i)=>Ct(0,{a:null,b:null,node:r,parent:n,value:o,page:t,scope:s,meta:i},e),Ct=(e,t,r,n=0)=>{let o=Et(r),s=Rt[o],i={v:{idx:e,stack:t,type:r,id:n},l:null,r:null};o===3||o===4?we=Lt(we,i):(s.size===0?s.first=i:s.last.r=i,s.last=i),s.size+=1},Et=e=>{switch(e){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},bt=new Set;let C,He=1,We=0,Xe=0,Q=null,Mn=e=>{C=e},sr=e=>{Q=e};const Nr=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=ae(e);if(e)return e}return null};let Tn=(e,t,r,n,o)=>{let s=Nr(e,n.id);return s?s.reg[n.id]:t?(Ee(t,n,o),t.reg[n.id]):n};const zn=e=>e;let Ee=(e,t,r,n,o)=>{var s;let i=e.reg,l=t.sid,a=t==null||(s=t.meta)===null||s===void 0?void 0:s.serialize,f=e.fromSerialize&&a!=="ignore"&&a?.read||zn;if(i[t.id])return;let u={id:t.id,current:t.current,meta:t.meta};if(u.id in e.values.idMap)u.current=e.values.idMap[u.id];else if(l&&l in e.values.sidMap&&!(l in e.sidIdMap))u.current=f(e.values.sidMap[l]);else if(t.before&&!o){let h=0,m=r||!t.noInit||n;B(t.before,d=>{switch(d.type){case _e:{let p=d.from;if(p||d.fn){p&&Ee(e,p,r,n);let c=p&&i[p.id].current;m&&(u.current=d.fn?d.fn(c):c)}break}case"field":h||(h=1,u.current=Array.isArray(u.current)?[...u.current]:{...u.current}),Ee(e,d.from,r,n),m&&(u.current[d.field]=i[i[d.from.id].id].current)}})}l&&(e.sidIdMap[l]=t.id),i[t.id]=u};const jn=(e,t,r)=>{try{return t(Le(r),e.scope,r)}catch(n){console.error(n),e.fail=1,e.failReason=n}};let Ae=(e,t={})=>(G(e)&&(Ae(e.or,t),me(e,(r,n)=>{D(r)||n==="or"||n==="and"||(t[n]=r)}),Ae(e.and,t)),t);const ir=(e,t)=>{Ve(e.next,t),Ve(at(e),t),Ve(ct(e),t)},At=(e,t,r)=>{let n;e.next.length=0,e.seq.length=0,e.scope=null;let o=ct(e);for(;n=o.pop();)ir(n,e),(t||r&&F(e,"op")!=="sample"||n.family.type==="crosslink")&&At(n,t,F(n,"op")!=="on"&&r);for(o=at(e);n=o.pop();)ir(n,e),r&&n.family.type==="crosslink"&&At(n,t,F(n,"op")!=="on"&&r)},je=e=>e.clear();let Mt=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),q(e))je(et(e));else if(Cr(e)){r=1;let n=e.history;je(n.events),je(n.effects),je(n.stores),je(n.domains)}At(U(e),!!t,r)},Fr=e=>{let t=()=>Mt(e);return t.unsubscribe=t,t},de=(e,t,r,n,o)=>re({node:r,parent:e,child:t,scope:{fn:o},meta:{op:n},family:{owners:[e,t],links:t},regional:1}),Lr=(e,t)=>(z(L(t),".watch argument should be a function"),Fr(re({scope:{fn:t},node:[Ft({fn:Nt})],parent:e,meta:{op:"watch"},family:{owners:e},regional:1}))),Rr=(e,t,r="event")=>{ae(e)&&ae(e).hooks[r](t)},Br=(e,t,r)=>{let n=Ae(r),o=e==="domain",s=xn(),{sid:i=null,named:l=null,domain:a=null,parent:f=a}=n,u=l||n.name||(o?"":s),h=Sr(u,f),m={op:t.kind=e,name:t.shortName=u,sid:t.sid=Pn(i),named:l,unitId:t.id=s,serialize:n.serialize,derived:n.derived,config:n};return t.parent=f,t.compositeName=h,t.defaultConfig=n,t.thru=d=>(ye(0,"thru","js pipe"),d(t)),t.getType=()=>h.fullName,!o&&(t.subscribe=d=>(Tr(d),t.watch(L(d)?d:p=>d.next&&d.next(p))),t[wn]=()=>t),m};const vt=(e,t,r,n)=>{let o;G(r)&&(o=r,r=r.fn);let s=y({name:`${e.shortName} → *`,derived:1,and:o});return de(e,s,n,t,r),s},Ir=(e,t,r,n,o)=>{let s=O(t),i=X({store:s,to:"a",priority:"read"});r===_e&&(i.data.softRead=1);let l=[i,J(n)];return I("storeOnMap",s,l,q(e)&&O(e)),de(e,t,l,r,o)},Nn=(e,t,r,n,o)=>{let s=e?p=>[...p]:p=>({...p}),i=e?[]:{},l=s(i),a=be(l),f=be(1);a.type=e?"list":"shape",a.noInit=1,I("combineBase",a,f);let u=x(l,{name:wr(r),derived:1,and:n}),h=O(u);h.noInit=1,K(u,"isCombine",1);let m=te(a);m.order={priority:"barrier"};let d=[Y((p,c,g)=>(g.scope&&!g.scope.reg[a.id]&&(g.c=1),p)),m,X({store:f,to:"b"}),Y((p,{key:c},g)=>{if(g.c||p!==g.a[c])return t&&g.b&&(g.a=s(g.a)),g.a[c]=p,1},1),X({from:"a",target:a}),X({from:"value",store:0,target:f}),X({from:"value",store:1,target:f,priority:"barrier",batch:1}),te(a,1),o&&J()];return me(r,(p,c)=>{if(!q(p))return z(!ee(p)&&!D(p),`combine expects a store in a field ${c}`),void(l[c]=i[c]=p);i[c]=p.defaultState,l[c]=p.getState();let g=de(p,u,d,"combine",o);g.scope.key=c;let w=O(p);rt(a,{type:"field",field:c,from:w}),I("combineField",w,g)}),u.defaultShape=r,rt(h,{type:_e,from:a,fn:o}),u.defaultState=o?h.current=o(l):i,u};let Or=(e,t,r)=>{try{return[1,e(...r)]}catch(n){return t(n),[0,null]}},qr=e=>{let t=he(e),r={ref:t};return t&&W(t.activeEffects,r),r},nt=(e,t,r,n,o,s)=>i=>{s.ref&&Ve(s.ref.activeEffects,s),le({target:[n,Fn],params:[r?{status:"done",params:e,result:i}:{status:"fail",params:e,error:i},{value:i,fn:r?t.rs:t.rj}],defer:1,page:o.page,scope:s.ref,meta:o.meta})};const Fn=re({node:[Ft({fn:({fn:e,value:t})=>e(t)})],meta:{op:"fx",fx:"sidechain"}}),Ln=["source","clock","target"],Dr=(e,t)=>e+`: ${t} should be defined`;let Bt=(e,t,r,n,o,s,i,l,a,f,u,h)=>{let m=!!o;z(!D(r)||!D(t),Dr(e,"either source or clock"));let d=0;D(r)?d=1:ee(r)||(r=ne(r)),D(t)?t=r:(tt(t,e,"clock"),Array.isArray(t)&&(t=_r(t))),d&&(r=t),l||i||(i=r.shortName);let p="none";(u||n)&&(ee(n)?p="unit":(z(L(n),"`filter` should be function or unit"),p="fn")),o?(tt(o,e,"target"),zr(e,o)):p==="none"&&f&&q(r)&&q(t)?o=x(s?s(Re(O(r)),Re(O(t))):Re(O(r)),{name:i,sid:h,or:l}):(o=y({name:i,derived:1,or:l}),I("sampleTarget",U(o)));let c=be(),g=[];if(p==="unit"){let[$,S]=lr(n,o,t,c,e);g=[...$t(S),...$t($)]}let[w,v]=lr(r,o,t,c,e),b=de(t,o,[I("sampleSourceLoader"),X({from:ge,target:c}),...$t(v),te(w,1,a),...g,te(c),p==="fn"&&J(($,S,{a:_})=>n($,_),1),s&&J(Pt),I("sampleSourceUpward",m)],e,s);return Pe(r,[b]),Object.assign(b.meta,l,{joint:1}),o};const $t=e=>[te(e),Y((t,r,{a:n})=>n,1)],lr=(e,t,r,n,o)=>{let s=q(e),i=s?O(e):be(),l=be(s);return s||re({parent:e,node:[X({from:ge,target:i}),X({from:"value",store:1,target:l})],family:{owners:[e,t,r],links:t},meta:{op:o},regional:1}),I("sampleSource",l,i,n),[i,l]},wt=(e,t,r,n)=>{let o=e[t];o&&le({target:o,params:Array.isArray(o)?o.map(()=>r):r,defer:1,stack:n})};function It(){return{width:window.visualViewport?.width||600,height:window.visualViewport?.height||400}}function ar(e,t,r){return{x:t.x-e.col*r,y:t.y-e.row*r}}function Rn(e){let t=new Map;return e.forEach(({col:r,row:n})=>{t.has(r)||t.set(r,new Map),t.get(r).set(n,1)}),t}function Bn(e){let t=0,r=0,n=0;return e.size===0?{col:t,row:r}:(e.forEach((o,s)=>{n+=o.size,o.forEach((i,l)=>{t+=s,r+=l})}),{col:Math.round(t/n),row:Math.round(r/n)})}function Hr(e,t){try{let r=localStorage.getItem(e);return r===null?t:r}catch(r){return console.error(r),t}}function Ur(e,t){try{localStorage.setItem(e,t)}catch(r){console.error(r)}}function In(){return{currentBp:x(null)}}const $e=It();function On(){const e="cellSize",t=[1,100];let r=+Hr(e,"10")||10;const n=x({size:r,prevSize:r}),o=x({width:$e.width,height:$e.height}),s=n.map(({size:u},h)=>({height:Math.ceil($e.height/u),width:Math.ceil($e.width/u),prevHeight:h&&h.height||Math.ceil($e.height/u),prevWidth:h&&h.width||Math.ceil($e.width/u)})),i=y(),l=y();let a=0;return document.addEventListener("wheel",u=>{a+=u.deltaY,a>20&&(l(),a=0),a<-20&&(i(),a=0)}),n.on(l,({size:u})=>({size:Math.max(t[0],u-1),prevSize:u})).on(i,({size:u})=>({size:Math.max(t[0],u+1),prevSize:u})),n.watch(u=>{Ur(e,String(u.size))}),{options:t,$cellSize:n,$fieldSize:s,plus:i,minus:l,$viewPortSize:o}}function qn(){const e=y(),t=y(),r=x(null);return r.on(t,()=>null).on(e,(o,s)=>s),{$hoveredXY:r,fieldMouseLeaved:t,fieldMouseMoved:e}}function Dn(e,t){const r=x(null),n=x(null),o=x(null),s=y(),i=y(),l=y(),a=y(),f=y(),u=y(),h=y();function m(){document.addEventListener("mousedown",s),document.addEventListener("mouseup",i)}const d=e.map(c=>c!==null),p=e.map(c=>c==null);return o.on(s,()=>Date.now()),P({source:t,clock:s,filter:d,target:r}),P({source:e,clock:s,filter:d,target:n}),P({source:{currentHovered:e,initHovered:n,startTime:o},clock:i,filter:c=>!!c.initHovered&&!!c.currentHovered&&!!c.startTime,fn:({currentHovered:c,initHovered:g,startTime:w})=>({start:c,finish:g}),target:l}),P({source:{currentHovered:e,initFocus:r,initHovered:n},clock:e,filter:c=>!!c.initHovered&&!!c.initFocus&&!!c.currentHovered,fn:({currentHovered:c,initHovered:g,initFocus:w})=>({x:w.x+(c.x-g.x),y:w.y+(c.y-g.y)}),target:h}),vn({source:l,match:c=>c.start.x===c.finish.x&&c.start.y===c.finish.y?"click":"dragEnd",cases:{click:f,dragEnd:u}}),P({clock:f,fn:c=>({coords:c.start}),target:a}),r.reset(l,p),n.reset(l,p),o.reset(l,p),{focusMoved:h,initEvents:m,clicked:a}}function Vr(e){var{timeout:t,start:r,stop:n,leading:o=!1,trailing:s=!1}=e,i=r??y({name:"setup",sid:"-ajedhm"}),l=n??y({name:"teardown",sid:"-ryi8gr"}),a=y({name:"tick",sid:"-cw8a02"}),f=x(!1,{name:"$isRunning",sid:"-5gspmy"}),u=Hn(t),h=f.map(v=>!v),m=y({name:"saveTimeout",sid:"satd6r"}),d=x(null,{name:"$timeoutId",sid:"hehxq7"}).on(m,(v,b)=>{var{timeoutId:$}=b;return $}),p=x(()=>{},{name:"$rejecter",sid:"-sc3eh9"}).on(m,(v,b)=>{var{reject:$}=b;return $}),c=tr({and:{source:{timeout:u,running:f},effect:v=>{var{timeout:b,running:$}=v;return $?new Promise((S,_)=>{var k=setTimeout(S,b);m({timeoutId:k,reject:_})}):Promise.reject()}},or:{name:"timeoutFx",sid:"-xlxric"}}),g=tr({and:{source:{timeoutId:d,rejecter:p},effect:v=>{var{timeoutId:b,rejecter:$}=v;$(),b&&clearTimeout(b)}},or:{name:"cleanupFx",sid:"-32ewxw"}});if(Ne({and:[{clock:i,source:u,filter:h,target:c}],or:{sid:"-us95i7"}}),o){var w=Ne({and:[{clock:i,filter:h}],or:{name:"onReady",sid:"farho0"}});P({and:[{clock:w,target:a}],or:{sid:"-ubrbnn"}})}return P({and:[{clock:i,fn:()=>!0,target:f}],or:{sid:"-ua3xxa"}}),Ne({and:[{clock:c.done,source:u,filter:f,target:c}],or:{sid:"6lcmx8"}}),Ne({and:[{clock:c.done,filter:f,target:a.prepend(()=>{})}],or:{sid:"6p772r"}}),s&&P({and:[{clock:l,target:a}],or:{sid:"75p0xb"}}),f.on(l,()=>!1),P({and:[{clock:l,target:g}],or:{sid:"7ln232"}}),{tick:a,isRunning:f,"@@trigger":()=>({setup:i,teardown:l,fired:a})}}function Hn(e){if(Se.store(e,{sid:"8i2x6t"}))return e;if(typeof e=="number")return x(e,{and:{name:"$timeout"},sid:"-jluixv"});throw new TypeError('timeout parameter in interval method should be number or Store. "'.concat(typeof e,'" was passed'))}function cr(e){var{source:t,timeout:r,target:n=y({name:"target",sid:"r328r6"},{name:"target",sid:"r328r6"})}=e;if(!Se.unit(t))throw new TypeError("source must be unit from effector");var o=Un(r),s=zt(f=>new Promise(u=>setTimeout(u,f)),{name:"timerFx",sid:"-pyjx8k"}),i=x(null,{and:{serialize:"ignore"},name:"$payload",sid:"hinjft"}).on(t,(f,u)=>u),l=y({name:"triggerTick",sid:"-sf8sou"}),a=x(!0,{and:{serialize:"ignore"},name:"$canTick",sid:"-m0cqc"}).on(l,()=>!1).on(n,()=>!0);return Ne({and:[{clock:t,filter:a,target:l}],or:{sid:"-hzhj9b"}}),P({and:[{source:o,clock:l,target:s}],or:{sid:"-hkn38k"}}),P({and:[{source:i,clock:s.done,target:n}],or:{sid:"-hhcboe"}}),n}function Un(e){if(Se.store(e,{sid:"-h0ap6r"}))return e;if(typeof e=="number"){if(e<0||!Number.isFinite(e))throw new Error('timeout must be positive number or zero. Received: "'.concat(e,'"'));return x(e,{and:{name:"$timeout"},sid:"-h97n10"})}throw new TypeError('timeout parameter should be number or Store. "'.concat(typeof e,'" was passed'))}function Vn(e,t,r){const n=x(0),o=x({prev:0,delta:0}).reset(t),s=y(),i=y(),l=cr({source:s,timeout:100}),a=cr({source:r,timeout:300}),f=Vr({timeout:1e3,start:i});n.on(l,(m,d)=>d),P({source:{stepsPerSec:o,steps:e},clock:f.tick,fn:({stepsPerSec:m,steps:d})=>({prev:d,delta:d-m.prev}),target:o});const u=[];i(),h();function h(){window.requestAnimationFrame(()=>{const m=performance.now();for(;u.length>0&&u[0]<=m-1e3;)u.shift();u.push(m),h()}),s(u.length)}return{$fps:n,$stepsPerSec:o.map(m=>m.delta),$time:bn(a,0)}}function Wn(e,t){const r="expectedStepsPerSec";let n=+Hr(r,"10")||10;const o=y(),s=y(),i=y(),l=y(),a=y(),f=y(),u=x(!1),h=x(0),m=[1,200],d=x(n),p=d.map(b=>1e3/b),c=y(),g=y(),w=x(null),v=Vr({timeout:p,start:s,stop:_r([l,i,f])});return P({clock:[v.tick,s,a],filter:ne(u,t,(b,$)=>b&&!$),target:o}),P({clock:a,target:o}),P({source:e,clock:s,fn:b=>new Map(b),target:w}),u.on(s,()=>!0).on([i,l],()=>!1).reset(f),d.on(c,b=>{if(b===1)return 5;let $=b+5;return $>m[1]?m[1]:$}).on(g,b=>{let $=b-5;return $<1?1:$}),w.on(f,()=>null),h.on(o,b=>b+1).on(i,()=>0).reset(f),d.watch(b=>{Ur(r,String(b))}),{$currentStep:h,$expectedStepsPerSec:d,$isRunning:u,$startFauna:w,start:s,stop:i,pause:l,incExpectedStepsPerSec:c,decExpectedStepsPerSec:g,speedRange:m,gameTick:o,reset:f,oneStep:a}}const j=On(),Be=qn();In();const V=x({fauna:Rn([]),time:0,size:0}),Xn=x([]),Wr=x(!1),Ot=y(),ft=y();Wr.on(Ot,()=>!0).on(ft,()=>!1);const R=Wn(V.map(e=>e.fauna),Wr),St=Vn(R.$currentStep,R.reset,ft.map(e=>e.time)),ue=x({x:0,y:0}),Yn=y(),qt=y(),Dt=y(),Ht=Dn(Be.$hoveredXY,ue);P({source:[ue,Be.$hoveredXY],clock:j.$cellSize,fn:([e,t],{size:r,prevSize:n})=>{if(t){let o={col:(t.x-e.x)/n,row:(t.y-e.y)/n};return ar(o,t,r)}else{let o=It(),s={x:o.width/2,y:o.height/2},i={col:(s.x-e.x)/n,row:(s.y-e.y)/n};return ar(i,s,r)}},target:ue});const Xr=ne(V,ue,j.$cellSize,j.$viewPortSize,({fauna:e},t,{size:r},n)=>{const o=[];return e.forEach((s,i)=>{s.forEach((l,a)=>{const f=i*r+t.x,u=a*r+t.y;f>=0&&f<n.width&&u>=0&&u<n.height&&o.push([f,u])})}),o}),Gn=ne(Xr,V,(e,t)=>({fieldCellsAmount:e.length,faunaCellsAmount:t.size})),Kn=ne(Xn,j.$fieldSize,j.$cellSize,ue,(e,{width:t,height:r},{size:n},o)=>{const s=[];return e.forEach(({col:i,row:l,label:a})=>{const f=i+o.x/n,u=l+o.y/n;f>=0&&f<t&&u>=0&&u<r&&s.push({col:f,row:u,label:a})}),s}),Jn=ne(Xr,j.$cellSize,(e,t)=>({size:t,field:e})),Qn=ne(Be.$hoveredXY,j.$cellSize,(e,{size:t})=>e?[{y:Math.floor(e.y/t)*t+"px",x:Math.floor(e.x/t)*t+"px"}]:[]),Zn=ne(Kn,j.$cellSize,(e,{size:t})=>e.map(({row:r,col:n,label:o})=>({y:r*t+"px",x:n*t+"px",label:o})));P({source:V,clock:R.gameTick,fn:e=>e.fauna,target:Ot});V.on(ft,(e,t)=>t).reset(Dt);ue.on(Ht.focusMoved,(e,t)=>t).reset(Yn);P({source:{faunaData:V,fieldSize:j.$fieldSize,cellSize:j.$cellSize},clock:qt,fn:({faunaData:e,fieldSize:t,cellSize:r})=>{const n=Bn(e.fauna);return{x:(t.width/2-n.col)*r.size,y:(t.height/2-n.row)*r.size}},target:ue});P({source:{faunaData:V,screenOffsetXY:ue,cellSize:j.$cellSize},clock:Ht.clicked,fn:({faunaData:e,screenOffsetXY:t,cellSize:{size:r}},{coords:n})=>{const o=new Map(e.fauna),s=Math.floor((n.x-t.x)/r),i=Math.floor((n.y-t.y)/r);return o.has(s)||o.set(s,new Map),o.get(s).has(i)?o.get(s).delete(i):o.get(s).set(i,1),{...e,fauna:o}},target:V});const dt=x(`48b2o$48b2o4$27bo$27b3o10bo9b2o$21bo8bo7b3o8b2o$21b3o5b2o6bo11bo4bo$
24bo12b2o11bo3bo$13b2o8b2o18b3o7b2o$13b2o30bo$30b2o$30bobo8bo21b2o$32b
obo6b2obo11b2o5b2o$32bo9b2o11bob2o$15b2o41bo$14b2o$14bo4bo34bo$15bo3bo
8bob2o2b2o9b2o7b3o$8b3o7b2o9b2o2b2obo8bo3bo$10bo34bo4bo$49b2o$6bo41b2o
$6b2obo11b2o9bo$2o5b2o11bob2o6bobo$2o21bo8bobo$33b2o$19bo30b2o$10b2o7b
3o28b2o$10bo3bo11b2o$10bo4bo11bo6b2o$14b2o8b3o7bo$13b2o9bo10b3o$37bo4$
15b2o$15b2o!`),Yr=y(),Ut=y(),pt=y();y();y();dt.on(Yr,(e,t)=>t);function eo(e){console.warn("TODO saveToLS")}function to(e){const[t,r]=e.split("|");return[+t,+r]}function ro(){try{return(JSON.parse(localStorage.getItem("history")||"null")||[]).map(({fauna:r,name:n})=>{let o=new Map;return r.forEach(([s,i])=>{const[l,a]=to(s);o.has(l)||o.set(l,new Map),o.get(l).set(a,i)}),{fauna:o,name:n}})}catch(e){return console.error(e),[]}}const no="b",ur="o";function oo(e){let t=new Map;const r="b",n="o",o="$";let s="",i=0,l=0;for(let a=0;a<e.length;a++){let f=e[a];if(f.charCodeAt(0)>=48&&f.charCodeAt(0)<=57)s+=f;else{let u=+s||1;if(f===r)l+=u;else if(f===n)for(let h=0;h<u;h++)t.has(l)||t.set(l,new Map),t.get(l).set(i,1),l++;else f===o&&(i+=u,l=0);s=""}}return t}function ot(e){return Array.from(e.keys()).sort((t,r)=>t-r).map(t=>[e.get(t),t])}function so(e){let t=1/0,r=-1/0,n=1/0,o=-1/0;for(let[s,i]of ot(e))for(let[l,a]of ot(s))l&&(i<n&&(n=i),i>o&&(o=i),a<t&&(t=a),a>r&&(r=a));return{top:t,bottom:r,left:n,right:o}}function io(e){let t=so(e),r=t.right-t.left+1,n=t.bottom-t.top+1,o=Array(n).fill(0).map(()=>Array(r).fill(0));for(let[l,a]of ot(e))for(let[f,u]of ot(l))o[u-t.top][a-t.left]=1;return lo(o.map(l=>i(l)).join("$"))+"!";function i(l){let a="",f=l[0],u=1;for(let h=1;h<l.length;h++){let m=l[h];if(f===m){u++;continue}u>1&&(a+=u),a+=f===0?no:ur,f=m,u=1}return f===1&&(u>1&&(a+=u),a+=ur),a}}function lo(e){let t="",r=0;for(let n=0;n<e.length;n++){let o=e[n];o!="$"?(r===1&&(t+="$"),r>1&&(t+=r+"$"),t+=o,r=0):r++}return t}const ht=x(ro()||[]),Vt=x(new Set),Gr=y(),ao=y(),co=y(),Kr=y(),Wt=y(),uo=y();Vt.on(ao,(e,t)=>{let r=new Set(e);return r.add(t),r}).on(co,(e,t)=>{let r=new Set(e);return r.delete(t),r});ht.on(Gr,(e,t)=>{let n=(e[e.length-1]?.name||"0").match(/(\d+)/),o=n&&+n[1]||0;return[...e,{fauna:t,name:`save #${o+1}`}]}).on(Kr,(e,t)=>e.filter(r=>!t.includes(r.name)));P({source:ht,target:zt(e=>{eo()})});window.addEventListener("beforeunload",()=>{Kr([...Vt.getState()])});ne(ht,Vt,(e,t)=>e.map(r=>({...r,toRemove:t.has(r.name)})));P({source:V,clock:uo,fn:e=>e.fauna,target:Gr});P({source:ht,clock:Wt,fn:(e,t)=>{const r=e.find(o=>o.name===t).fauna;return{fauna:new Map(r),time:0,size:0}},target:V});P({clock:[Wt,Dt,Ut,pt],target:R.reset});P({source:V,clock:Ut,fn:({fauna:e})=>io(e),target:dt});P({source:dt,clock:pt,fn:e=>({fauna:oo(e),time:0,size:0}),target:V});P({clock:[Wt,pt],target:qt});const fr="#5583e5",fo="_field_yvjtj_1",po="_cell_yvjtj_17",ho="_on1_yvjtj_25",mo="_on2_yvjtj_28",go="_hoveredCell_yvjtj_32",yo="_heartMode_yvjtj_36",bo="_label_yvjtj_44",Ue={field:fo,cell:po,on1:ho,on2:mo,hoveredCell:go,heartMode:yo,label:bo};function Me(e,t){var r;return((n,o)=>{let s=!Se.unit(n)&&typeof n=="object",i={};n&&"@@unitShape"in n?typeof n["@@unitShape"]=="function"?i=n["@@unitShape"]():xt("expect @@unitShape to be a function"):i=s?n:{unit:n};let l=Array.isArray(i),a=Object.entries(i),f=l?[]:{},u=[],h={},m={};for(let[p,c]of a)if(Se.store(c))if(h[c.graphite.id]){let g=h[c.graphite.id];f[p]=f[g],m[p]=f[g]}else{u.push(c),h[c.graphite.id]=p;let[g,w]=en(dr(c,o));f[p]=g,m[p]=w}else Se.unit(c)||xt("expected useUnit argument to be a unit"),f[p]=o?$n(c,{scope:o}):c;let d=[yt.compute({priority:"effect"}),yt.compute({priority:"sampler",batch:1}),yt.run({fn:()=>{rn(()=>{for(let p of u)m[h[p.graphite.id]](()=>dr(p,o))})}})];if(o){let p=re({node:d}),c=o.additionalLinks,g=[];u.forEach(w=>{let v=w.graphite.id,b=c[v]||[];c[v]=b,b.push(p),g.push(b)}),Xt(()=>{g.forEach(w=>{let v=w.indexOf(p);v!==-1&&w.splice(v,1)}),Mt(p)})}else{let p=re({node:d,parent:u,family:{owners:u}});Xt(()=>{Mt(p)})}return s?f:f.unit})(e,((n=1)=>{let o=sn(vo);return n&&!o&&xt("No scope found, consider adding <Provider> to app root"),o})((r=t?.forceScope)!==null&&r!==void 0?r:0))}let xt=e=>{throw Error(e)};const dr=(e,t)=>t?t.getState(e):e.getState();let vo=on(null);const $o=ce("<div><canvas>"),pr=ce("<div>");function wo(){let e=It(),[t,r,n]=Me([Qn,Zn,j.$cellSize]),o;return nn(()=>{requestAnimationFrame(s);function s(){if(!o){console.warn("no canvas");return}let{size:{size:i},field:l}=Jn.getState();const a=o.getContext("2d");if(!a){console.warn("no context");return}let{width:f,height:u}=o.getBoundingClientRect();a.clearRect(0,0,f,u),a.fillStyle=fr,a.beginPath(),i>10?l.forEach(h=>{a.rect(h[0]+1,h[1]+1,i-1,i-1)}):l.forEach(h=>{a.rect(h[0],h[1],i,i)}),a.fill(),requestAnimationFrame(s)}}),(()=>{const s=$o(),i=s.firstChild;return Z(s,"mouseleave",Be.fieldMouseLeaved),s.$$mousemove=({clientX:l,clientY:a})=>Be.fieldMouseMoved({x:l,y:a}),s.style.setProperty("--color1",fr),gn(l=>o=l,i),M(s,()=>t().map(l=>(()=>{const a=pr();return H(f=>{const u=l.x,h=l.y,m={[Ue.cell]:!0,[Ue.hoveredCell]:!0};return u!==f._v$5&&((f._v$5=u)!=null?a.style.setProperty("left",u):a.style.removeProperty("left")),h!==f._v$6&&((f._v$6=h)!=null?a.style.setProperty("top",h):a.style.removeProperty("top")),f._v$7=Jt(a,m,f._v$7),f},{_v$5:void 0,_v$6:void 0,_v$7:void 0}),a})()),null),M(s,()=>r().map(l=>(()=>{const a=pr();return M(a,()=>l.label),H(f=>{const u=l.x,h=l.y,m={[Ue.label]:!0};return u!==f._v$8&&((f._v$8=u)!=null?a.style.setProperty("left",u):a.style.removeProperty("left")),h!==f._v$9&&((f._v$9=h)!=null?a.style.setProperty("top",h):a.style.removeProperty("top")),f._v$10=Jt(a,m,f._v$10),f},{_v$8:void 0,_v$9:void 0,_v$10:void 0}),a})()),null),H(l=>{const a=Ue.field,f=n().size+"px",u=e.width,h=e.height;return a!==l._v$&&qe(s,l._v$=a),f!==l._v$2&&((l._v$2=f)!=null?s.style.setProperty("--cellSize",f):s.style.removeProperty("--cellSize")),u!==l._v$3&&Kt(i,"width",l._v$3=u),h!==l._v$4&&Kt(i,"height",l._v$4=h),l},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),s})()}Oe(["mousemove"]);const So="_roundBox_hgest_1",xo="_history_hgest_9",_o="_colorBtn_hgest_15",ko="_currentColor_hgest_22",Po="_arrowBtn_hgest_26",Co="_whiteBox_hgest_54",st={roundBox:So,history:xo,colorBtn:_o,currentColor:ko,arrowBtn:Po,whiteBox:Co},Eo=ce("<div><button>-</button><button>+");function Jr(e){return(()=>{const t=Eo(),r=t.firstChild,n=r.nextSibling;return Z(r,"click",e.onMinusClicked,!0),M(t,()=>` ${e.value} `,n),Z(n,"click",e.onPlusClicked,!0),H(o=>{const s=e.class,i=e.value<=e.range[0],l=e.value>=e.range[1];return s!==o._v$&&qe(t,o._v$=s),i!==o._v$2&&(r.disabled=o._v$2=i),l!==o._v$3&&(n.disabled=o._v$3=l),o},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t})()}Oe(["click"]);const Ao=ce("<div><button>to center</button><div>");function Mo(){const[e]=Me([j.$cellSize]);return Ht.initEvents(),(()=>{const t=Ao(),r=t.firstChild,n=r.nextSibling;return Z(r,"click",qt,!0),n.style.setProperty("position","absolute"),n.style.setProperty("right","150px"),n.style.setProperty("bottom","20px"),n.style.setProperty("z-index","1"),M(n,oe(Jr,{get value(){return e().size},get onPlusClicked(){return j.plus},get onMinusClicked(){return j.minus},get range(){return j.options},get class(){return st.roundBox}})),H(()=>qe(r,st.arrowBtn)),t})()}Oe(["click"]);const To=ce("<button>STOP"),zo=ce("<button>START"),jo=ce("<p><button>Step</button>timer: ");function No(){let[e,t]=Me([R.$isRunning,R.$currentStep]);return(()=>{const r=jo(),n=r.firstChild;return n.nextSibling,r.style.setProperty("display","flex"),r.style.setProperty("gap","4px"),r.style.setProperty("position","absolute"),Z(n,"click",R.oneStep,!0),M(r,oe(Yt,{get when(){return e()},get children(){const o=To();return Z(o,"click",R.stop,!0),o.style.setProperty("color","#f8f8f8"),o.style.setProperty("background-color","#de4040"),o.style.setProperty("border","0"),o}}),null),M(r,oe(Yt,{get when(){return!e()},get children(){const o=zo();return Z(o,"click",R.start,!0),o.style.setProperty("color","#f8f8f8"),o.style.setProperty("background-color","#50c40e"),o.style.setProperty("border","0"),o}}),null),M(r,()=>`steps: ${t()}`,null),H(()=>qe(r,st.whiteBox)),r})()}Oe(["click"]);const Fo=ce("<div><span>FPS: </span><span>STEPS PER SEC: </span><span>EXPECTED STEPS:</span><span>CALC TIME: <!> msec</span><span>CELLS: </span><span>CELLS ON SCREEN: ");function Lo(){const[e,t,r]=Me([St.$stepsPerSec,St.$time,St.$fps]),[n,o]=Me([Gn,R.$expectedStepsPerSec]);return(()=>{const s=Fo(),i=s.firstChild;i.firstChild;const l=i.nextSibling;l.firstChild;const a=l.nextSibling,f=a.nextSibling,u=f.firstChild,h=u.nextSibling;h.nextSibling;const m=f.nextSibling;m.firstChild;const d=m.nextSibling;return d.firstChild,s.style.setProperty("position","absolute"),s.style.setProperty("display","grid"),s.style.setProperty("top","10px"),s.style.setProperty("right","10px"),M(i,r,null),M(l,e,null),M(s,oe(Jr,{get value(){return o()},get onPlusClicked(){return R.incExpectedStepsPerSec},get onMinusClicked(){return R.decExpectedStepsPerSec},get range(){return R.speedRange}}),f),M(f,t,h),M(m,()=>n().faunaCellsAmount,null),M(d,()=>n().fieldCellsAmount,null),H(()=>qe(s,st.whiteBox)),s})()}const Ro=ce("<div><div><h1>Game of Life</h1></div><button>Reset</button><div><button>Export</button><button>Import</button><br><textarea>");function Bo(){let[e]=Me([dt]);return(()=>{const t=Ro(),r=t.firstChild;r.firstChild;const n=r.nextSibling,o=n.nextSibling,s=o.firstChild,i=s.nextSibling,l=i.nextSibling,a=l.nextSibling;return M(t,oe(Mo,{}),r),M(t,oe(wo,{}),r),r.style.setProperty("position","absolute"),r.style.setProperty("width","100%"),r.style.setProperty("background-color","rgba(255,255,255, 0.9)"),r.style.setProperty("border-bottom","1px solid #ccc"),M(r,oe(No,{}),null),M(t,oe(Lo,{}),n),Z(n,"click",Dt,!0),n.style.setProperty("position","absolute"),n.style.setProperty("bottom","20px"),n.style.setProperty("left","20px"),o.style.setProperty("position","absolute"),o.style.setProperty("bottom","50px"),o.style.setProperty("left","20px"),Z(s,"click",Ut,!0),Z(i,"click",pt,!0),a.addEventListener("change",f=>Yr(f.target.value)),a.style.setProperty("font-size","8px"),a.style.setProperty("width","100%"),a.style.setProperty("height","100px"),a.style.setProperty("line-height","1"),H(()=>a.value=e()),t})()}Io();function Io(){const e=new Worker("./webworkerGo.js");e.addEventListener("message",t=>{ft(t.data)}),e.addEventListener("error",t=>{console.log("main.error err",t)}),Ot.watch(t=>{e.postMessage(t)})}mn(()=>oe(Bo,{}),document.querySelector("#app"));Oe(["click"]);
