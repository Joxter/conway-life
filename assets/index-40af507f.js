(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const Jn=(e,t)=>e===t,Ve={equals:Jn};let cn=pn;const ce=1,Xe=2,un={owned:null,cleanups:null,context:null,owner:null};var P=null;let pt=null,A=null,z=null,oe=null,ot=0;function Qn(e,t){const n=A,r=P,o=e.length===0,s=t===void 0?r:t,i=o?un:{owned:null,cleanups:null,context:s?s.context:null,owner:s},l=o?e:()=>e(()=>se(()=>st(i)));P=i,A=null;try{return Ae(l,!0)}finally{A=n,P=r}}function Zn(e,t){t=t?Object.assign({},Ve,t):Ve;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=o=>(typeof o=="function"&&(o=o(n.value)),dn(n,o));return[fn.bind(n),r]}function V(e,t,n){const r=At(e,t,!1,ce);Be(r)}function er(e,t,n){cn=ar;const r=At(e,t,!1,ce);(!n||!n.render)&&(r.user=!0),oe?oe.push(r):Be(r)}function Ye(e,t,n){n=n?Object.assign({},Ve,n):Ve;const r=At(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,Be(r),fn.bind(r)}function tr(e){return Ae(e,!1)}function se(e){if(A===null)return e();const t=A;A=null;try{return e()}finally{A=t}}function nr(e){er(()=>se(e))}function Ht(e){return P===null||(P.cleanups===null?P.cleanups=[e]:P.cleanups.push(e)),e}function rr(e,t){const n=Symbol("context");return{id:n,Provider:ur(n),defaultValue:e}}function or(e){return P&&P.context&&P.context[e.id]!==void 0?P.context[e.id]:e.defaultValue}function sr(e){const t=Ye(e),n=Ye(()=>St(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}function fn(){if(this.sources&&this.state)if(this.state===ce)Be(this);else{const e=z;z=null,Ae(()=>Ke(this),!1),z=e}if(A){const e=this.observers?this.observers.length:0;A.sources?(A.sources.push(this),A.sourceSlots.push(e)):(A.sources=[this],A.sourceSlots=[e]),this.observers?(this.observers.push(A),this.observerSlots.push(A.sources.length-1)):(this.observers=[A],this.observerSlots=[A.sources.length-1])}return this.value}function dn(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&Ae(()=>{for(let o=0;o<e.observers.length;o+=1){const s=e.observers[o],i=pt&&pt.running;i&&pt.disposed.has(s),(i?!s.tState:!s.state)&&(s.pure?z.push(s):oe.push(s),s.observers&&mn(s)),i||(s.state=ce)}if(z.length>1e6)throw z=[],new Error},!1)),t}function Be(e){if(!e.fn)return;st(e);const t=P,n=A,r=ot;A=P=e,ir(e,e.value,r),A=n,P=t}function ir(e,t,n){let r;try{r=e.fn(t)}catch(o){return e.pure&&(e.state=ce,e.owned&&e.owned.forEach(st),e.owned=null),e.updatedAt=n+1,hn(o)}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?dn(e,r):e.value=r,e.updatedAt=n)}function At(e,t,n,r=ce,o){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:P,context:P?P.context:null,pure:n};return P===null||P!==un&&(P.owned?P.owned.push(s):P.owned=[s]),s}function Ge(e){if(e.state===0)return;if(e.state===Xe)return Ke(e);if(e.suspense&&se(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<ot);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===ce)Be(e);else if(e.state===Xe){const r=z;z=null,Ae(()=>Ke(e,t[0]),!1),z=r}}function Ae(e,t){if(z)return e();let n=!1;t||(z=[]),oe?n=!0:oe=[],ot++;try{const r=e();return lr(n),r}catch(r){n||(oe=null),z=null,hn(r)}}function lr(e){if(z&&(pn(z),z=null),e)return;const t=oe;oe=null,t.length&&Ae(()=>cn(t),!1)}function pn(e){for(let t=0;t<e.length;t++)Ge(e[t])}function ar(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:Ge(r)}for(t=0;t<n;t++)Ge(e[t])}function Ke(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const o=r.state;o===ce?r!==t&&(!r.updatedAt||r.updatedAt<ot)&&Ge(r):o===Xe&&Ke(r,t)}}}function mn(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=Xe,n.pure?z.push(n):oe.push(n),n.observers&&mn(n))}}function st(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),o=n.observers;if(o&&o.length){const s=o.pop(),i=n.observerSlots.pop();r<o.length&&(s.sourceSlots[i]=r,o[r]=s,n.observerSlots[r]=i)}}if(e.owned){for(t=e.owned.length-1;t>=0;t--)st(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function cr(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function hn(e,t=P){throw cr(e)}function St(e){if(typeof e=="function"&&!e.length)return St(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=St(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function ur(e,t){return function(r){let o;return V(()=>o=se(()=>(P.context={...P.context,[e]:r.value},sr(()=>r.children))),void 0),o}}function re(e,t){return se(()=>e(t||{}))}const fr=e=>`Stale read from <${e}>.`;function Ut(e){const t=e.keyed,n=Ye(()=>e.when,void 0,{equals:(r,o)=>t?r===o:!r==!o});return Ye(()=>{const r=n();if(r){const o=e.children;return typeof o=="function"&&o.length>0?se(()=>o(t?r:()=>{if(!se(n))throw fr("Show");return e.when})):o}return e.fallback},void 0,void 0)}function dr(e,t,n){let r=n.length,o=t.length,s=r,i=0,l=0,a=t[o-1].nextSibling,d=null;for(;i<o||l<s;){if(t[i]===n[l]){i++,l++;continue}for(;t[o-1]===n[s-1];)o--,s--;if(o===i){const p=s<r?l?n[l-1].nextSibling:n[s-l]:a;for(;l<s;)e.insertBefore(n[l++],p)}else if(s===l)for(;i<o;)(!d||!d.has(t[i]))&&t[i].remove(),i++;else if(t[i]===n[s-1]&&n[l]===t[o-1]){const p=t[--o].nextSibling;e.insertBefore(n[l++],t[i++].nextSibling),e.insertBefore(n[--s],p),t[o]=n[s]}else{if(!d){d=new Map;let m=l;for(;m<s;)d.set(n[m],m++)}const p=d.get(t[i]);if(p!=null)if(l<p&&p<s){let m=i,g=1,c;for(;++m<o&&m<s&&!((c=d.get(t[m]))==null||c!==p+g);)g++;if(g>p-l){const u=t[i];for(;l<p;)e.insertBefore(n[l++],u)}else e.replaceChild(n[l++],t[i++])}else i++;else t[i++].remove()}}}const Wt="_$DX_DELEGATE";function pr(e,t,n,r={}){let o;return Qn(s=>{o=s,t===document?e():M(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{o(),t.textContent=""}}function ae(e,t,n){let r;const o=()=>{const i=document.createElement("template");return i.innerHTML=e,n?i.content.firstChild.firstChild:i.content.firstChild},s=t?()=>se(()=>document.importNode(r||(r=o()),!0)):()=>(r||(r=o())).cloneNode(!0);return s.cloneNode=s,s}function it(e,t=window.document){const n=t[Wt]||(t[Wt]=new Set);for(let r=0,o=e.length;r<o;r++){const s=e[r];n.has(s)||(n.add(s),t.addEventListener(s,hr))}}function Vt(e,t,n){n==null?e.removeAttribute(t):e.setAttribute(t,n)}function Oe(e,t){t==null?e.removeAttribute("class"):e.className=t}function pe(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const o=n[0];e.addEventListener(t,n[0]=s=>o.call(e,n[1],s))}else e.addEventListener(t,n)}function Xt(e,t,n={}){const r=Object.keys(t||{}),o=Object.keys(n);let s,i;for(s=0,i=o.length;s<i;s++){const l=o[s];!l||l==="undefined"||t[l]||(Yt(e,l,!1),delete n[l])}for(s=0,i=r.length;s<i;s++){const l=r[s],a=!!t[l];!l||l==="undefined"||n[l]===a||!a||(Yt(e,l,!0),n[l]=a)}return n}function mr(e,t,n){return se(()=>e(t,n))}function M(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Je(e,t,r,n);V(o=>Je(e,t(),o,n),r)}function Yt(e,t,n){const r=t.trim().split(/\s+/);for(let o=0,s=r.length;o<s;o++)e.classList.toggle(r[o],n)}function hr(e){const t=`$$${e.type}`;let n=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==n&&Object.defineProperty(e,"target",{configurable:!0,value:n}),Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return n||document}});n;){const r=n[t];if(r&&!n.disabled){const o=n[`${t}Data`];if(o!==void 0?r.call(n,o,e):r.call(n,e),e.cancelBubble)return}n=n._$host||n.parentNode||n.host}}function Je(e,t,n,r,o){for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,i=r!==void 0;if(e=i&&n[0]&&n[0].parentNode||e,s==="string"||s==="number")if(s==="number"&&(t=t.toString()),i){let l=n[0];l&&l.nodeType===3?l.data=t:l=document.createTextNode(t),n=ve(e,n,r,l)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t;else if(t==null||s==="boolean")n=ve(e,n,r);else{if(s==="function")return V(()=>{let l=t();for(;typeof l=="function";)l=l();n=Je(e,l,n,r)}),()=>n;if(Array.isArray(t)){const l=[],a=n&&Array.isArray(n);if(xt(l,t,n,o))return V(()=>n=Je(e,l,n,r,!0)),()=>n;if(l.length===0){if(n=ve(e,n,r),i)return n}else a?n.length===0?Gt(e,l,r):dr(e,n,l):(n&&ve(e),Gt(e,l));n=l}else if(t.nodeType){if(Array.isArray(n)){if(i)return n=ve(e,n,r,t);ve(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}else console.warn("Unrecognized value. Skipped inserting",t)}return n}function xt(e,t,n,r){let o=!1;for(let s=0,i=t.length;s<i;s++){let l=t[s],a=n&&n[s],d;if(!(l==null||l===!0||l===!1))if((d=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))o=xt(e,l,a)||o;else if(d==="function")if(r){for(;typeof l=="function";)l=l();o=xt(e,Array.isArray(l)?l:[l],Array.isArray(a)?a:[a])||o}else e.push(l),o=!0;else{const p=String(l);a&&a.nodeType===3&&a.data===p?e.push(a):e.push(document.createTextNode(p))}}return o}function Gt(e,t,n=null){for(let r=0,o=t.length;r<o;r++)e.insertBefore(t[r],n)}function ve(e,t,n,r){if(n===void 0)return e.textContent="";const o=r||document.createTextNode("");if(t.length){let s=!1;for(let i=t.length-1;i>=0;i--){const l=t[i];if(o!==l){const a=l.parentNode===e;!s&&!i?a?e.replaceChild(o,l):e.insertBefore(o,n):a&&l.remove()}else s=!0}}else e.insertBefore(o,n);return[o]}function me(e,t){for(let n in e)t(e[n],n)}function O(e,t){e.forEach(t)}function N(e,t){if(!e)throw Error(t)}function te({node:e=[],from:t,source:n,parent:r=t||n,to:o,target:s,child:i=o||s,scope:l={},meta:a={},family:d={type:"regular"},regional:p}={}){let m=ze(r),g=ze(d.links),c=ze(d.owners),u=[];O(e,h=>h&&U(u,h));let f={id:Sr(),seq:u,next:ze(i),meta:a,scope:l,family:{type:d.type||"crosslink",links:g,owners:c}};return O(g,h=>U(lt(h),f)),O(c,h=>U(at(h),f)),O(m,h=>U(h.next,f)),p&&Se&&ke(Fe(Se),[f]),f}function ie(e,t,n){let r,o=Q,s=null,i=C;if(e.target&&(t=e.params,n=e.defer,r=e.meta,o="page"in e?e.page:o,e.stack&&(s=e.stack),i=de(e)||i,e=e.target),i&&C&&i!==C&&(C=null),Array.isArray(e))for(let u=0;u<e.length;u++)fe("pure",o,H(e[u]),s,t[u],i,r);else fe("pure",o,H(e),s,t,i,r);if(n&&!De)return;let l,a,d,p,m,g,c={isRoot:De,currentPage:Q,scope:C,isWatch:Ue,isPure:We};De=0;e:for(;p=Pr();){let{idx:u,stack:f,type:h}=p;d=f.node,Q=m=f.page,C=de(f),m?g=m.reg:C&&(g=C.reg);let b=!!m,v=!!C,S={fail:0,scope:d.scope};l=a=0;for(let w=u;w<d.seq.length&&!l;w++){let $=d.seq[w];if($.order){let{priority:_,barrierID:k}=$.order,T=k?m?`${m.fullID}_${k}`:k:0;if(w!==u||h!==_){k?ht.has(T)||(ht.add(T),kt(w,f,_,k)):kt(w,f,_);continue e}k&&ht.delete(T)}switch($.type){case"mov":{let k,T=$.data;switch(T.from){case he:k=Fe(f);break;case"a":case"b":k=f[T.from];break;case"value":k=T.store;break;case"store":if(g&&!g[T.store.id])if(b){let dt=An(m,T.store.id);f.page=m=dt,dt?g=dt.reg:v?(Pe(C,T.store,0,1,T.softRead),g=C.reg):g=void 0}else v&&Pe(C,T.store,0,1,T.softRead);k=Le(g&&g[T.store.id]||T.store)}switch(T.to){case he:f.value=k;break;case"a":case"b":f[T.to]=k;break;case"store":Ar(m,C,d,T.target).current=k}break}case"compute":let _=$.data;if(_.fn){Ue=F(d,"op")==="watch",We=_.pure;let k=_.safe?(0,_.fn)(Fe(f),S.scope,f):Tr(S,_.fn,f);_.filter?a=!k:f.value=k,Ue=c.isWatch,We=c.isPure}}l=S.fail||a}if(!l){let w=Fe(f),$=de(f);if(O(d.next,_=>{fe("child",m,_,f,w,$)}),$){F(d,"needFxCounter")&&fe("child",m,$.fxCount,f,w,$),F(d,"storeChange")&&fe("child",m,$.storeChange,f,w,$),F(d,"warnSerialize")&&fe("child",m,$.warnSerializeNode,f,w,$);let _=$.additionalLinks[d.id];_&&O(_,k=>{fe("child",m,k,f,w,$)})}}}De=c.isRoot,Q=c.currentPage,C=de(c)}function gn(e,t="combine"){let n=t+"(",r="",o=0;return me(e,s=>{o<25&&(s!=null&&(n+=r,n+=Z(s)?Tt(s).fullName:s.toString()),o+=1,r=", ")}),n+")"}function yn(e,t){let n,r,o=e;if(t){let s=Tt(t);e.length===0?(n=s.path,r=s.fullName):(n=s.path.concat([e]),r=s.fullName.length===0?e:s.fullName+"/"+e)}else n=e.length===0?[]:[e],r=e;return{shortName:o,fullName:r,path:n}}function Me(e,t){let n=t?e:e[0];Cn(n);let r=n.or,o=n.and;if(o){let s=t?o:o[0];if(G(s)&&"and"in s){let i=Me(o,t);e=i[0],r={...r,...i[1]}}else e=o}return[e,r]}function R(e,...t){let n=kn();if(n){let r=n.handlers[e];if(r)return r(n,...t)}}function y(e,t){let n=Ee({or:t,and:typeof e=="string"?{name:e}:e}),r=(i,...l)=>(ge(!F(r,"derived"),"call of derived event","createEvent"),ge(!We,"unit call from pure function","operators like sample"),Q?((a,d,p,m)=>{let g=Q,c=null;if(d)for(c=Q;c&&c.template!==d;)c=le(c);tn(c);let u=a.create(p,m);return tn(g),u})(r,o,i,l):r.create(i,l)),o=kn(),s=Object.assign(r,{graphite:te({meta:zn(n.actualOp||"event",r,n),regional:1}),create:i=>(ie({target:r,params:i,scope:C}),i),watch:i=>Tn(r,i),map:i=>gt(r,xe,i,[J()]),filter:i=>gt(r,"filter",i.fn?i:i.fn,[J(Nt,1)]),filterMap:i=>gt(r,"filterMap",i,[J(),X(l=>!I(l),1)]),prepend(i){let l=y("* → "+r.shortName,{parent:le(r)});return R("eventPrepend",H(l)),ue(l,r,[J()],"prepend",i),Nn(r,l),l}});return n!=null&&n.domain&&n.domain.hooks.event(s),K(s,"id",s.graphite.id),_n(s.graphite),s}function Kt(e,t,n,r){return Ze(n,t,"first argument"),N(L(r),"second argument should be a function"),ge(!F(e,"derived"),`${t} in derived store`,`${t} in store created via createStore`),O(Array.isArray(n)?n:[n],o=>{e.off(o),Qe(e).set(o,Mn(Fn(o,e,"on",kr,r)))}),e}function x(e,t){let n=Ee(t),r=ye(e),o=y({named:"updates",derived:1});R("storeBase",r);let s=r.id,i={subscribers:new Map,updates:o,defaultState:e,stateRef:r,getState(){let c,u=r;if(Q){let f=Q;for(;f&&!f.reg[s];)f=le(f);f&&(c=f)}return!c&&C&&(Pe(C,r,1),c=C),c&&(u=c.reg[s]),Le(u)},setState:c=>ie({target:i,params:c,defer:1,scope:C}),reset:(...c)=>(O(c,u=>Kt(i,".reset",u,()=>i.defaultState)),i),on:(c,u)=>Kt(i,".on",c,u),off(c){let u=Qe(i).get(c);return u&&(u(),Qe(i).delete(c)),i},map(c,u){let f,h;G(c)&&(f=c,c=c.fn),ge(I(u),"second argument of store.map","updateFilter");let b=i.getState();I(b)||(h=c(b,u));let v=x(h,{name:`${i.shortName} → *`,derived:1,and:f}),S=Fn(i,v,xe,_t,c);return et(q(v),{type:xe,fn:c,from:r}),q(v).noInit=1,R("storeMap",r,S),v},watch(c,u){if(!u||!Z(c)){let f=Tn(i,c);return R("storeWatch",r,c)||c(i.getState()),f}return N(L(u),"second argument should be a function"),c.watch(f=>u(i.getState(),f))}},l=zn("store",i,n),a=i.defaultConfig.updateFilter;i.graphite=te({scope:{state:r,fn:a},node:[X((c,u,f)=>(f.scope&&!f.scope.reg[r.id]&&(f.b=1),c)),ee(r),X((c,u,{a:f,b:h})=>!I(c)&&(c!==f||h),1),a&&J(_t,1),W({from:he,target:r})],child:o,meta:{...l,defaultState:e},regional:1}),K(i,"id",i.graphite.id),K(i,"rootStateRefId",s);let d=F(i,"serialize"),p=F(i,"derived"),m=d==="ignore",g=F(i,"sid");return g&&(K(i,"storeChange",1),r.sid=g),g||m||p||K(i,"warnSerialize",1),N(p||!I(e),"current state can't be undefined, use null instead"),ke(i,[o]),n!=null&&n.domain&&n.domain.hooks.store(i),p||(i.reinit=y({named:"reinit"}),i.reset(i.reinit)),r.meta=i.graphite.meta,_n(i.graphite),i}function Y(...e){let t,n,r;[e,r]=Me(e);let o,s,i,l=e[e.length-1];if(L(l)?(n=e.slice(0,-1),t=l):n=e,n.length===1){let a=n[0];D(a)||(o=a,s=1)}if(!s&&(o=n,t)){i=1;let a=t;t=d=>a(...d)}return N(G(o),"shape should be an object"),Nr(Array.isArray(o),!i,o,r,t)}function vn(){let e={};return e.req=new Promise((t,n)=>{e.rs=t,e.rj=n}),e.req.catch(()=>{}),e}function Mt(e,t={}){let n=Ee(L(e)?{handler:e}:e,t),r=y(L(e)?{handler:e}:e,{...t,actualOp:"effect"}),o=H(r);K(o,"op",r.kind="effect"),r.use=c=>(N(L(c),".use argument should be a function"),p.scope.handler=c,r),r.use.getCurrent=()=>p.scope.handler;let s=r.finally=y({named:"finally",derived:1}),i=r.done=s.filterMap({named:"done",fn({status:c,params:u,result:f}){if(c==="done")return{params:u,result:f}}}),l=r.fail=s.filterMap({named:"fail",fn({status:c,params:u,error:f}){if(c==="fail")return{params:u,error:f}}}),a=r.doneData=i.map({named:"doneData",fn:({result:c})=>c}),d=r.failData=l.map({named:"failData",fn:({error:c})=>c}),p=te({scope:{handler:r.defaultConfig.handler||(()=>N(0,`no handler used in ${r.getType()}`))},node:[X((c,u,f)=>{let h=u.handler,b=de(f);if(b){let v=b.handlers.unitMap.get(r)||b.handlers.sidMap[r.sid];v&&(h=v)}return c.handler=h,c},0,1),X(({params:c,req:u,handler:f,args:h=[c]},b,v)=>{let S=jn(v),w=tt(c,u,1,s,v,S),$=tt(c,u,0,s,v,S),[_,k]=Ln(f,$,h);_&&(G(k)&&L(k.then)?k.then(w,$):w(k))},0,1)],meta:{op:"fx",fx:"runner"}});o.scope.runner=p,U(o.seq,X((c,{runner:u},f)=>{let h=le(f)?{params:c,req:{rs(b){},rj(b){}}}:c;return f.meta||(f.meta={fxID:xr()}),ie({target:u,params:h,defer:1,scope:de(f),meta:f.meta}),h.params},0,1)),r.create=c=>{let u=vn(),f={params:c,req:u};if(C&&!Ue){let h=C;u.req.finally(()=>{Er(h)}).catch(()=>{})}return ie({target:r,params:f,scope:C}),u.req};let m=r.inFlight=x(0,{serialize:"ignore",named:(F(r,"name")||r.graphite.id)+".inFlight"}).on(r,c=>c+1).on(s,c=>c-1).map({fn:c=>c,named:"inFlight"});K(s,"needFxCounter","dec"),K(r,"needFxCounter",1);let g=r.pending=m.map({fn:c=>c>0,named:"pending"});return ke(r,[s,i,l,a,d,g,m]),n!=null&&n.domain&&n.domain.hooks.effect(r),r}function Jt(e){let t;[e,t]=Me(e,1);let{source:n,effect:r,mapParams:o}=e,s=Mt(e,t);K(s,"attached",1);let i,{runner:l}=H(s).scope,a=X((p,m,g)=>{let c,{params:u,req:f,handler:h}=p,b=s.finally,v=jn(g),S=tt(u,f,0,b,g,v),w=g.a,$=_e(h),_=1;if(o?[_,c]=Ln(o,S,[u,w]):c=n&&$?w:u,_){if(!$)return p.args=[w,c],1;ie({target:h,params:{params:c,req:{rs:tt(u,f,1,b,g,v),rj:S}},page:g.page,defer:1,meta:g.meta})}},1,1);if(n){let p;D(n)?(p=n,ke(p,[s])):(p=Y(n),ke(s,[p])),i=[ee(q(p)),a]}else i=[a];l.seq.splice(1,0,...i),s.use(r);let d=le(r);return d&&(Object.assign(Tt(s),yn(s.shortName,d)),s.defaultConfig.parent=d),Nn(r,s,"effect"),s}function bn(e,t){Ze(e,"merge","first argument");let n=y({name:gn(e,"merge"),derived:1,and:t});return ue(e,n,[],"merge"),n}function wn(e,t){let n=0;return O(Fr,r=>{r in e&&(N(e[r]!=null,Bn(t,r)),n=1)}),n}function E(...e){let t,n,r,o,[[s,i,l],a]=Me(e),d=1;return I(i)&&G(s)&&wn(s,"sample")&&(i=s.clock,l=s.fn,d=!s.greedy,o=s.filter,t=s.target,n=s.name,r=s.sid,s=s.source),jt("sample",i,s,o,t,l,n,a,d,1,0,r)}function Ne(...e){let[[t,n],r]=Me(e);return n||(n=t,t=n.source),wn(n,"guard"),jt("guard",n.clock,t,n.filter,n.target,null,n.name,r,!n.greedy,0,1)}function gr(e,t,n){if(D(e))return ge(0,"restore($store)"),e;if($n(e)||_e(e)){let o=le(e),s=x(t,{parent:o,name:e.shortName,and:n});return ue(_e(e)?e.doneData:e,s),o&&o.hooks.store(s),s}let r=Array.isArray(e)?[]:{};return me(e,(o,s)=>r[s]=D(o)?o:x(o,{name:s})),r}function yr(...e){let t,n,r="split",[[o,s],i]=Me(e),l=!s;l&&(t=o.cases,s=o.match,n=o.clock,o=o.source);let a=D(s),d=!Z(s)&&L(s),p=!a&&!d&&G(s);N(Z(o),"source must be a unit"),t||(t={}),l?me(t,(f,h)=>Pn(r,f,`cases.${h}`)):(N(p,"match should be an object"),me(s,(f,h)=>t[h]=y({derived:1,named:`cases.${h}`,and:i})),t.__=y({derived:1,named:"cases.__",and:i}));let m,g=new Set([].concat(o,n||[],Object.values(t))),c=Object.keys(a||d?t:s);if(a||d)a&&g.add(s),m=[a&&ee(q(s),0,1),Ce({safe:a,filter:1,pure:!a,fn(f,h,b){let v=String(a?b.a:s(f));vt(h,Qt(c,v)?v:"__",f,b)}})];else if(p){let f=ye({});f.type="shape";let h,b=[];me(s,(v,S)=>{if(Z(v)){h=1,U(b,S),g.add(v);let w=ue(v,[],[ee(f),X(($,_,{a:k})=>k[S]=$)]);if(D(v)){f.current[S]=v.getState();let $=q(v);et(f,{from:$,field:S,type:"field"}),R("splitMatchStore",$,w)}}}),h&&R("splitBase",f),m=[h&&ee(f,0,1),J((v,S,w)=>{for(let $=0;$<c.length;$++){let _=c[$];if(Qt(b,_)?w.a[_]:s[_](v))return void vt(S,_,v,w)}vt(S,"__",v,w)},1)]}else N(0,"expect match to be unit, function or object");let u=te({meta:{op:r},parent:n?[]:o,scope:t,node:m,family:{owners:Array.from(g)},regional:1});if(n&&jt(r,n,o,null,u,null,r,i,0,0,0),!l)return t}function vr(e,{scope:t,safe:n}={}){N(t||C||n,"scopeBind cannot be called outside of forked .watch");let r=t||C;return _e(e)?o=>{let s=vn();return ie({target:e,params:{params:o,req:s},scope:r}),s.req}:o=>(ie({target:e,params:o,scope:r}),o)}let br=typeof Symbol<"u"&&Symbol.observable||"@@observable",xe="map",he="stack",H=e=>e.graphite||e,lt=e=>e.family.owners,at=e=>e.family.links,q=e=>e.stateRef,Fe=e=>e.value,Qe=e=>e.subscribers,le=e=>e.parent,de=e=>e.scope,F=(e,t)=>H(e).meta[t],K=(e,t,n)=>H(e).meta[t]=n,Tt=e=>e.compositeName,Z=e=>(L(e)||G(e))&&"kind"in e;const Re=e=>t=>Z(t)&&t.kind===e;let D=Re("store"),$n=Re("event"),_e=Re("effect"),Sn=Re("domain"),wr=Re("scope");var $e={__proto__:null,unit:Z,store:D,event:$n,effect:_e,domain:Sn,scope:wr,attached:e=>_e(e)&&F(e,"attached")==1};let Qt=(e,t)=>e.includes(t),He=(e,t)=>{let n=e.indexOf(t);n!==-1&&e.splice(n,1)},U=(e,t)=>e.push(t),ge=(e,t,n)=>!e&&console.error(`${t} is deprecated${n?`, use ${n} instead`:""}`);const ct=()=>{let e=0;return()=>""+ ++e};let $r=ct(),xn=ct(),Sr=ct(),xr=ct(),Se=null,_n=e=>{},kn=()=>Se,_r=e=>(e&&Se&&Se.sidRoot&&(e=`${Se.sidRoot}|${e}`),e),ke=(e,t)=>{let n=H(e);O(t,r=>{let o=H(r);n.family.type!=="domain"&&(o.family.type="crosslink"),U(lt(o),n),U(at(n),o)})},ze=(e=[])=>(Array.isArray(e)?e:[e]).flat().map(H),G=e=>typeof e=="object"&&e!==null,L=e=>typeof e=="function",I=e=>e===void 0,Cn=e=>N(G(e)||L(e),"expect first argument be an object");const Zt=(e,t,n,r)=>N(!(!G(e)&&!L(e)||!("family"in e)&&!("graphite"in e)),`${t}: expect ${n} to be a unit (store, event or effect)${r}`);let Ze=(e,t,n)=>{Array.isArray(e)?O(e,(r,o)=>Zt(r,t,`${o} item of ${n}`,"")):Zt(e,t,n," or array of units")},Pn=(e,t,n="target")=>O(ze(t),r=>ge(!F(r,"derived"),`${e}: derived unit in "${n}"`,"createEvent/createStore")),_t=(e,{fn:t},{a:n})=>t(e,n),kr=(e,{fn:t},{a:n})=>t(n,e),Nt=(e,{fn:t})=>t(e);const En=(e,t,n,r)=>{let o={id:xn(),type:e,data:t};return n&&(o.order={priority:n},r&&(o.order.barrierID=++Cr)),o};let Cr=0,W=({from:e="store",store:t,target:n,to:r=n?"store":he,batch:o,priority:s})=>En("mov",{from:e,store:t,to:r,target:n},s,o),Ce=({fn:e,batch:t,priority:n,safe:r=0,filter:o=0,pure:s=0})=>En("compute",{fn:e,safe:r,filter:o,pure:s},n,t),zt=({fn:e})=>Ce({fn:e,priority:"effect"}),X=(e,t,n)=>Ce({fn:e,safe:1,filter:t,priority:n&&"effect"}),ee=(e,t,n)=>W({store:e,to:t?he:"a",priority:n&&"sampler",batch:1}),J=(e=Nt,t)=>Ce({fn:e,pure:1,filter:t}),mt={mov:W,compute:Ce,filter:({fn:e,pure:t})=>Ce({fn:e,filter:1,pure:t}),run:zt},ye=e=>({id:xn(),current:e}),Le=({current:e})=>e,et=(e,t)=>{e.before||(e.before=[]),U(e.before,t)},we=null;const Ft=(e,t)=>{if(!e)return t;if(!t)return e;let n;return(e.v.type===t.v.type&&e.v.id>t.v.id||Ct(e.v.type)>Ct(t.v.type))&&(n=e,e=t,t=n),n=Ft(e.r,t),e.r=e.l,e.l=n,e},Lt=[];let en=0;for(;en<6;)U(Lt,{first:null,last:null,size:0}),en+=1;const Pr=()=>{for(let e=0;e<6;e++){let t=Lt[e];if(t.size>0){if(e===3||e===4){t.size-=1;let r=we.v;return we=Ft(we.l,we.r),r}t.size===1&&(t.last=null);let n=t.first;return t.first=n.r,t.size-=1,n.v}}},fe=(e,t,n,r,o,s,i)=>kt(0,{a:null,b:null,node:n,parent:r,value:o,page:t,scope:s,meta:i},e),kt=(e,t,n,r=0)=>{let o=Ct(n),s=Lt[o],i={v:{idx:e,stack:t,type:n,id:r},l:null,r:null};o===3||o===4?we=Ft(we,i):(s.size===0?s.first=i:s.last.r=i,s.last=i),s.size+=1},Ct=e=>{switch(e){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},ht=new Set;let C,De=1,Ue=0,We=0,Q=null,Er=e=>{C=e},tn=e=>{Q=e};const An=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=le(e);if(e)return e}return null};let Ar=(e,t,n,r,o)=>{let s=An(e,r.id);return s?s.reg[r.id]:t?(Pe(t,r,o),t.reg[r.id]):r};const Mr=e=>e;let Pe=(e,t,n,r,o)=>{var s;let i=e.reg,l=t.sid,a=t==null||(s=t.meta)===null||s===void 0?void 0:s.serialize,d=e.fromSerialize&&a!=="ignore"&&a?.read||Mr;if(i[t.id])return;let p={id:t.id,current:t.current,meta:t.meta};if(p.id in e.values.idMap)p.current=e.values.idMap[p.id];else if(l&&l in e.values.sidMap&&!(l in e.sidIdMap))p.current=d(e.values.sidMap[l]);else if(t.before&&!o){let m=0,g=n||!t.noInit||r;O(t.before,c=>{switch(c.type){case xe:{let u=c.from;if(u||c.fn){u&&Pe(e,u,n,r);let f=u&&i[u.id].current;g&&(p.current=c.fn?c.fn(f):f)}break}case"field":m||(m=1,p.current=Array.isArray(p.current)?[...p.current]:{...p.current}),Pe(e,c.from,n,r),g&&(p.current[c.field]=i[i[c.from.id].id].current)}})}l&&(e.sidIdMap[l]=t.id),i[t.id]=p};const Tr=(e,t,n)=>{try{return t(Fe(n),e.scope,n)}catch(r){console.error(r),e.fail=1,e.failReason=r}};let Ee=(e,t={})=>(G(e)&&(Ee(e.or,t),me(e,(n,r)=>{I(n)||r==="or"||r==="and"||(t[r]=n)}),Ee(e.and,t)),t);const nn=(e,t)=>{He(e.next,t),He(lt(e),t),He(at(e),t)},Pt=(e,t,n)=>{let r;e.next.length=0,e.seq.length=0,e.scope=null;let o=at(e);for(;r=o.pop();)nn(r,e),(t||n&&F(e,"op")!=="sample"||r.family.type==="crosslink")&&Pt(r,t,F(r,"op")!=="on"&&n);for(o=lt(e);r=o.pop();)nn(r,e),n&&r.family.type==="crosslink"&&Pt(r,t,F(r,"op")!=="on"&&n)},Te=e=>e.clear();let Et=(e,{deep:t}={})=>{let n=0;if(e.ownerSet&&e.ownerSet.delete(e),D(e))Te(Qe(e));else if(Sn(e)){n=1;let r=e.history;Te(r.events),Te(r.effects),Te(r.stores),Te(r.domains)}Pt(H(e),!!t,n)},Mn=e=>{let t=()=>Et(e);return t.unsubscribe=t,t},ue=(e,t,n,r,o)=>te({node:n,parent:e,child:t,scope:{fn:o},meta:{op:r},family:{owners:[e,t],links:t},regional:1}),Tn=(e,t)=>(N(L(t),".watch argument should be a function"),Mn(te({scope:{fn:t},node:[zt({fn:Nt})],parent:e,meta:{op:"watch"},family:{owners:e},regional:1}))),Nn=(e,t,n="event")=>{le(e)&&le(e).hooks[n](t)},zn=(e,t,n)=>{let r=Ee(n),o=e==="domain",s=$r(),{sid:i=null,named:l=null,domain:a=null,parent:d=a}=r,p=l||r.name||(o?"":s),m=yn(p,d),g={op:t.kind=e,name:t.shortName=p,sid:t.sid=_r(i),named:l,unitId:t.id=s,serialize:r.serialize,derived:r.derived,config:r};return t.parent=d,t.compositeName=m,t.defaultConfig=r,t.thru=c=>(ge(0,"thru","js pipe"),c(t)),t.getType=()=>m.fullName,!o&&(t.subscribe=c=>(Cn(c),t.watch(L(c)?c:u=>c.next&&c.next(u))),t[br]=()=>t),g};const gt=(e,t,n,r)=>{let o;G(n)&&(o=n,n=n.fn);let s=y({name:`${e.shortName} → *`,derived:1,and:o});return ue(e,s,r,t,n),s},Fn=(e,t,n,r,o)=>{let s=q(t),i=W({store:s,to:"a",priority:"read"});n===xe&&(i.data.softRead=1);let l=[i,J(r)];return R("storeOnMap",s,l,D(e)&&q(e)),ue(e,t,l,n,o)},Nr=(e,t,n,r,o)=>{let s=e?u=>[...u]:u=>({...u}),i=e?[]:{},l=s(i),a=ye(l),d=ye(1);a.type=e?"list":"shape",a.noInit=1,R("combineBase",a,d);let p=x(l,{name:gn(n),derived:1,and:r}),m=q(p);m.noInit=1,K(p,"isCombine",1);let g=ee(a);g.order={priority:"barrier"};let c=[X((u,f,h)=>(h.scope&&!h.scope.reg[a.id]&&(h.c=1),u)),g,W({store:d,to:"b"}),X((u,{key:f},h)=>{if(h.c||u!==h.a[f])return t&&h.b&&(h.a=s(h.a)),h.a[f]=u,1},1),W({from:"a",target:a}),W({from:"value",store:0,target:d}),W({from:"value",store:1,target:d,priority:"barrier",batch:1}),ee(a,1),o&&J()];return me(n,(u,f)=>{if(!D(u))return N(!Z(u)&&!I(u),`combine expects a store in a field ${f}`),void(l[f]=i[f]=u);i[f]=u.defaultState,l[f]=u.getState();let h=ue(u,p,c,"combine",o);h.scope.key=f;let b=q(u);et(a,{type:"field",field:f,from:b}),R("combineField",b,h)}),p.defaultShape=n,et(m,{type:xe,from:a,fn:o}),p.defaultState=o?m.current=o(l):i,p};let Ln=(e,t,n)=>{try{return[1,e(...n)]}catch(r){return t(r),[0,null]}},jn=e=>{let t=de(e),n={ref:t};return t&&U(t.activeEffects,n),n},tt=(e,t,n,r,o,s)=>i=>{s.ref&&He(s.ref.activeEffects,s),ie({target:[r,zr],params:[n?{status:"done",params:e,result:i}:{status:"fail",params:e,error:i},{value:i,fn:n?t.rs:t.rj}],defer:1,page:o.page,scope:s.ref,meta:o.meta})};const zr=te({node:[zt({fn:({fn:e,value:t})=>e(t)})],meta:{op:"fx",fx:"sidechain"}}),Fr=["source","clock","target"],Bn=(e,t)=>e+`: ${t} should be defined`;let jt=(e,t,n,r,o,s,i,l,a,d,p,m)=>{let g=!!o;N(!I(n)||!I(t),Bn(e,"either source or clock"));let c=0;I(n)?c=1:Z(n)||(n=Y(n)),I(t)?t=n:(Ze(t,e,"clock"),Array.isArray(t)&&(t=bn(t))),c&&(n=t),l||i||(i=n.shortName);let u="none";(p||r)&&(Z(r)?u="unit":(N(L(r),"`filter` should be function or unit"),u="fn")),o?(Ze(o,e,"target"),Pn(e,o)):u==="none"&&d&&D(n)&&D(t)?o=x(s?s(Le(q(n)),Le(q(t))):Le(q(n)),{name:i,sid:m,or:l}):(o=y({name:i,derived:1,or:l}),R("sampleTarget",H(o)));let f=ye(),h=[];if(u==="unit"){let[w,$]=rn(r,o,t,f,e);h=[...yt($),...yt(w)]}let[b,v]=rn(n,o,t,f,e),S=ue(t,o,[R("sampleSourceLoader"),W({from:he,target:f}),...yt(v),ee(b,1,a),...h,ee(f),u==="fn"&&J((w,$,{a:_})=>r(w,_),1),s&&J(_t),R("sampleSourceUpward",g)],e,s);return ke(n,[S]),Object.assign(S.meta,l,{joint:1}),o};const yt=e=>[ee(e),X((t,n,{a:r})=>r,1)],rn=(e,t,n,r,o)=>{let s=D(e),i=s?q(e):ye(),l=ye(s);return s||te({parent:e,node:[W({from:he,target:i}),W({from:"value",store:1,target:l})],family:{owners:[e,t,n],links:t},meta:{op:o},regional:1}),R("sampleSource",l,i,r),[i,l]},vt=(e,t,n,r)=>{let o=e[t];o&&ie({target:o,params:Array.isArray(o)?o.map(()=>n):n,defer:1,stack:r})};function Lr(){return{currentBp:x(null)}}const on="#5583e5",jr="#79e555",bt=[1,40],Br=5;function Or(e){return""}function Rr(e){console.warn("TODO saveToLS")}function qr(e){const[t,n]=e.split("|");return[+t,+n]}function Dr(){try{return(JSON.parse(localStorage.getItem("history")||"null")||[]).map(({fauna:n,name:r})=>{let o=new Map;return n.forEach(([s,i])=>{const[l,a]=qr(s);o.has(l)||o.set(l,new Map),o.get(l).set(a,i)}),{fauna:o,name:r}})}catch(e){return console.error(e),[]}}function On(){return{width:window.visualViewport?.width||600,height:window.visualViewport?.height||400}}function Ir(e){let t=new Map;const n="b",r="o",o="$";let s="",i=0,l=0;for(let a=0;a<e.length;a++){let d=e[a];if(d.charCodeAt(0)>=48&&d.charCodeAt(0)<=57)s+=d;else{let p=+s||1;if(d===n)l+=p;else if(d===r)for(let m=0;m<p;m++)t.has(l)||t.set(l,new Map),t.get(l).set(i,1),l++;else d===o&&(i+=p,l=0);s=""}}return t}const be=On();function Hr(){const e=bt,t=x(Br),n=x({width:be.width,height:be.height}),r=t.map((a,d)=>({height:Math.ceil(be.height/a),width:Math.ceil(be.width/a),prevHeight:d&&d.height||Math.ceil(be.height/a),prevWidth:d&&d.width||Math.ceil(be.width/a)})),o=y(),s=y();let i=0;return document.addEventListener("wheel",a=>{i+=a.deltaY,i>20&&(o(),i=0),i<-20&&(s(),i=0)}),t.on(s,a=>Math.max(bt[0],a-1)).on(o,a=>Math.min(bt[1],a+1)),{options:e,$cellSize:t,$fieldSize:r,plus:o,minus:s,$viewPortSize:n}}function Ur(){const e=x(!1),t=y();return e.on(t,(r,o)=>o),{$isOn:e,changed:t}}function Wr(e){const t=y(),n=y(),r=x(null);return r.on(n,()=>null).on(t,(s,i)=>i),{$hoveredXY:r,fieldMouseLeaved:n,fieldMouseMoved:t}}function Vr(e,t){const n=x(null),r=x(null),o=x(null),s=y(),i=y(),l=y(),a=y(),d=y(),p=y();function m(){document.addEventListener("mousedown",s),document.addEventListener("mouseup",i)}const g=e.map(u=>u!==null),c=e.map(u=>u==null);return o.on(s,()=>Date.now()),E({source:t,clock:s,filter:g,target:n}),E({source:e,clock:s,filter:g,target:r}),E({source:{currentHovered:e,initHovered:r,startTime:o},clock:i,filter:u=>!!u.initHovered&&!!u.currentHovered&&!!u.startTime,fn:({currentHovered:u,initHovered:f,startTime:h})=>({start:{x:u.x,y:u.y},finish:f,duration:Date.now()-h}),target:l}),E({source:{currentHovered:e,initFocus:n,initHovered:r},clock:e,filter:u=>!!u.initHovered&&!!u.initFocus&&!!u.currentHovered,fn:({currentHovered:u,initHovered:f,initFocus:h})=>({x:h.x+(u.x-f.x),y:h.y+(u.y-f.y)}),target:p}),yr({source:l,match:u=>u.start.x===u.finish.x&&u.start.y===u.finish.y?"click":"dragEnd",cases:{click:a,dragEnd:d}}),n.reset(l,c),r.reset(l,c),o.reset(l,c),{focusMoved:p,initEvents:m,clicked:a}}function Rn(e){var{timeout:t,start:n,stop:r,leading:o=!1,trailing:s=!1}=e,i=n??y({name:"setup",sid:"-ajedhm"}),l=r??y({name:"teardown",sid:"-ryi8gr"}),a=y({name:"tick",sid:"-cw8a02"}),d=x(!1,{name:"$isRunning",sid:"-5gspmy"}),p=Xr(t),m=d.map(v=>!v),g=y({name:"saveTimeout",sid:"satd6r"}),c=x(null,{name:"$timeoutId",sid:"hehxq7"}).on(g,(v,S)=>{var{timeoutId:w}=S;return w}),u=x(()=>{},{name:"$rejecter",sid:"-sc3eh9"}).on(g,(v,S)=>{var{reject:w}=S;return w}),f=Jt({and:{source:{timeout:p,running:d},effect:v=>{var{timeout:S,running:w}=v;return w?new Promise(($,_)=>{var k=setTimeout($,S);g({timeoutId:k,reject:_})}):Promise.reject()}},or:{name:"timeoutFx",sid:"-xlxric"}}),h=Jt({and:{source:{timeoutId:c,rejecter:u},effect:v=>{var{timeoutId:S,rejecter:w}=v;w(),S&&clearTimeout(S)}},or:{name:"cleanupFx",sid:"-32ewxw"}});if(Ne({and:[{clock:i,source:p,filter:m,target:f}],or:{sid:"-us95i7"}}),o){var b=Ne({and:[{clock:i,filter:m}],or:{name:"onReady",sid:"farho0"}});E({and:[{clock:b,target:a}],or:{sid:"-ubrbnn"}})}return E({and:[{clock:i,fn:()=>!0,target:d}],or:{sid:"-ua3xxa"}}),Ne({and:[{clock:f.done,source:p,filter:d,target:f}],or:{sid:"6lcmx8"}}),Ne({and:[{clock:f.done,filter:d,target:a.prepend(()=>{})}],or:{sid:"6p772r"}}),s&&E({and:[{clock:l,target:a}],or:{sid:"75p0xb"}}),d.on(l,()=>!1),E({and:[{clock:l,target:h}],or:{sid:"7ln232"}}),{tick:a,isRunning:d,"@@trigger":()=>({setup:i,teardown:l,fired:a})}}function Xr(e){if($e.store(e,{sid:"8i2x6t"}))return e;if(typeof e=="number")return x(e,{and:{name:"$timeout"},sid:"-jluixv"});throw new TypeError('timeout parameter in interval method should be number or Store. "'.concat(typeof e,'" was passed'))}function sn(e){var{source:t,timeout:n,target:r=y({name:"target",sid:"r328r6"},{name:"target",sid:"r328r6"})}=e;if(!$e.unit(t))throw new TypeError("source must be unit from effector");var o=Yr(n),s=Mt(d=>new Promise(p=>setTimeout(p,d)),{name:"timerFx",sid:"-pyjx8k"}),i=x(null,{and:{serialize:"ignore"},name:"$payload",sid:"hinjft"}).on(t,(d,p)=>p),l=y({name:"triggerTick",sid:"-sf8sou"}),a=x(!0,{and:{serialize:"ignore"},name:"$canTick",sid:"-m0cqc"}).on(l,()=>!1).on(r,()=>!0);return Ne({and:[{clock:t,filter:a,target:l}],or:{sid:"-hzhj9b"}}),E({and:[{source:o,clock:l,target:s}],or:{sid:"-hkn38k"}}),E({and:[{source:i,clock:s.done,target:r}],or:{sid:"-hhcboe"}}),r}function Yr(e){if($e.store(e,{sid:"-h0ap6r"}))return e;if(typeof e=="number"){if(e<0||!Number.isFinite(e))throw new Error('timeout must be positive number or zero. Received: "'.concat(e,'"'));return x(e,{and:{name:"$timeout"},sid:"-h97n10"})}throw new TypeError('timeout parameter should be number or Store. "'.concat(typeof e,'" was passed'))}function Gr(e,t,n){const r=x(0),o=x({prev:0,delta:0}).reset(t),s=y(),i=y(),l=sn({source:s,timeout:100}),a=sn({source:n,timeout:300}),d=Rn({timeout:1e3,start:i});r.on(l,(g,c)=>c),E({source:{stepsPerSec:o,steps:e},clock:d.tick,fn:({stepsPerSec:g,steps:c})=>({prev:c,delta:c-g.prev}),target:o});const p=[];i(),m();function m(){window.requestAnimationFrame(()=>{const g=performance.now();for(;p.length>0&&p[0]<=g-1e3;)p.shift();p.push(g),m()}),s(p.length)}return{$fps:r,$stepsPerSec:o.map(g=>g.delta),$time:gr(a,0)}}function Kr(e,t){const n=y(),r=y(),o=y(),s=y(),i=y(),l=y(),a=x(!1),d=x(0),p=[1,60],m=x(10),g=m.map(b=>1e3/b),c=y(),u=y(),f=x(null),h=Rn({timeout:g,start:r,stop:bn([s,o,l])});return E({clock:[h.tick,r,i],filter:Y(a,t,(b,v)=>b&&!v),target:n}),E({clock:i,target:n}),E({source:e,clock:r,fn:b=>new Map(b),target:f}),a.on(r,()=>!0).on([o,s],()=>!1).reset(l),m.on(c,b=>Math.min(b+5,p[1])).on(u,b=>Math.max(b-5,p[0])).reset(l),f.on(l,()=>null),d.on(n,b=>b+1).on(o,()=>0).reset(l),{$currentStep:d,$expectedStepsPerSec:m,$isRunning:a,$startFauna:f,start:r,stop:o,pause:s,incExpectedStepsPerSec:c,decExpectedStepsPerSec:u,speedRange:p,gameTick:n,reset:l,oneStep:i}}const j=Hr(),Jr=Ur(),nt=Wr(j.$cellSize),qn=Lr();let Dn=new Map;Dn.set(0,new Map([[0,1]]));const ne=x({fauna:Dn,time:0,size:0}),Qr=x([{col:0,row:0,label:"0,0"}]),In=x(!1),Bt=y(),ut=y();In.on(Bt,()=>!0).on(ut,()=>!1);const B=Kr(ne.map(e=>e.fauna),In),wt=Gr(B.$currentStep,B.reset,ut.map(e=>e.time)),qe=x({x:0,y:0}),Zr=y(),Hn=y(),Un=x(1),eo=y();Un.on(eo,(e,t)=>t);const Wn=y(),Ot=Vr(nt.$hoveredXY,qe);Y(Jr.$isOn,j.$cellSize,(e,t)=>e?"elsa":t);const Rt=Y(j.$fieldSize,ne,qe,j.$cellSize,j.$viewPortSize,(e,{fauna:t},n,r,o)=>{const s=[];return t.forEach((i,l)=>{i.forEach((a,d)=>{const p=l+n.x/r,m=d+n.y/r;s.push({col:p,row:m,val:a})})}),s}),to=Y(Rt,ne,(e,t)=>({fieldCellsAmount:e.length,faunaCellsAmount:t.size})),no=Y(j.$fieldSize,Qr,qe,({width:e,height:t},n,r)=>{const o=[];return n.forEach(({col:s,row:i,label:l})=>{const a=s+r.x,d=i+r.y;a>=0&&a<e&&d>=0&&d<t&&o.push({col:a,row:d,label:l})}),o}),ro=Y(Rt,j.$cellSize,(e,t)=>({size:t,field:e})),oo=Y(nt.$hoveredXY,j.$cellSize,qn.currentBp,(e,t,n)=>e?[{y:e.y*t+"px",x:e.x*t+"px"}]:[]),so=Y(no,j.$cellSize,(e,t)=>e.map(({row:n,col:r,label:o})=>({y:n*t+"px",x:r*t+"px",label:o})));E({source:ne,clock:B.gameTick,fn:e=>e.fauna,target:Bt});ne.on(ut,(e,t)=>t).reset(Wn);qe.on(Ot.focusMoved,(e,t)=>t).reset(Zr);E({source:{faunaData:ne,color:Un,focus:qe,currentBp:qn.currentBp},clock:Ot.clicked,fn:({color:e,faunaData:t,focus:n,currentBp:r},{start:o})=>{const s=new Map(t.fauna);if(!r){const i=o.x-n.x,l=o.y-n.y;s.has(i)||s.set(i,new Map),s.get(i).get(l)===e?s.get(i).delete(l):s.get(i).set(l,e)}return{...t,fauna:s}},target:ne});const qt=x(""),io=y(),Vn=y(),Xn=y();qt.on(io,(e,t)=>t);const ft=x(Dr()||[]),Dt=x(new Set),Yn=y(),lo=y(),ao=y(),Gn=y(),It=y(),co=y();Dt.on(lo,(e,t)=>{let n=new Set(e);return n.add(t),n}).on(ao,(e,t)=>{let n=new Set(e);return n.delete(t),n});ft.on(Yn,(e,t)=>{let r=(e[e.length-1]?.name||"0").match(/(\d+)/),o=r&&+r[1]||0;return[...e,{fauna:t,name:`save #${o+1}`}]}).on(Gn,(e,t)=>e.filter(n=>!t.includes(n.name)));E({source:ft,target:Mt(e=>{Rr()})});window.addEventListener("beforeunload",()=>{Gn([...Dt.getState()])});Y(ft,Dt,(e,t)=>e.map(n=>({...n,toRemove:t.has(n.name)})));E({source:ne,clock:co,fn:e=>e.fauna,target:Yn});E({source:ft,clock:It,fn:(e,t)=>{const n=e.find(o=>o.name===t).fauna;return{fauna:new Map(n),time:0,size:0}},target:ne});E({clock:[It,Wn,Vn,Xn],target:B.reset});E({clock:It,target:Hn});E({source:Rt,clock:Vn,fn:Or,target:qt});E({source:qt,clock:Xn,fn:e=>({fauna:Ir(e),time:0,size:0}),target:ne});const uo="_field_1g0a6_1",fo="_cell_1g0a6_22",po="_on1_1g0a6_30",mo="_on2_1g0a6_33",ho="_hoveredCell_1g0a6_37",go="_heartMode_1g0a6_41",yo="_label_1g0a6_49",Ie={field:uo,cell:fo,on1:po,on2:mo,hoveredCell:ho,heartMode:go,label:yo};function je(e,t){var n;return((r,o)=>{let s=!$e.unit(r)&&typeof r=="object",i={};r&&"@@unitShape"in r?typeof r["@@unitShape"]=="function"?i=r["@@unitShape"]():$t("expect @@unitShape to be a function"):i=s?r:{unit:r};let l=Array.isArray(i),a=Object.entries(i),d=l?[]:{},p=[],m={},g={};for(let[u,f]of a)if($e.store(f))if(m[f.graphite.id]){let h=m[f.graphite.id];d[u]=d[h],g[u]=d[h]}else{p.push(f),m[f.graphite.id]=u;let[h,b]=Zn(ln(f,o));d[u]=h,g[u]=b}else $e.unit(f)||$t("expected useUnit argument to be a unit"),d[u]=o?vr(f,{scope:o}):f;let c=[mt.compute({priority:"effect"}),mt.compute({priority:"sampler",batch:1}),mt.run({fn:()=>{tr(()=>{for(let u of p)g[m[u.graphite.id]](()=>ln(u,o))})}})];if(o){let u=te({node:c}),f=o.additionalLinks,h=[];p.forEach(b=>{let v=b.graphite.id,S=f[v]||[];f[v]=S,S.push(u),h.push(S)}),Ht(()=>{h.forEach(b=>{let v=b.indexOf(u);v!==-1&&b.splice(v,1)}),Et(u)})}else{let u=te({node:c,parent:p,family:{owners:p}});Ht(()=>{Et(u)})}return s?d:d.unit})(e,((r=1)=>{let o=or(vo);return r&&!o&&$t("No scope found, consider adding <Provider> to app root"),o})((n=t?.forceScope)!==null&&n!==void 0?n:0))}let $t=e=>{throw Error(e)};const ln=(e,t)=>t?t.getState(e):e.getState();let vo=rr(null);const bo=ae("<div><canvas>"),an=ae("<div>");function wo(){let e=On(),[t,n]=je([oo,so]),r;return nr(()=>{requestAnimationFrame(o);function o(){if(!r){console.warn("no canvas");return}let{size:s,field:i}=ro.getState(),l=r.getContext("2d");if(!l){console.warn("no context");return}let{width:a,height:d}=r.getBoundingClientRect();l.clearRect(0,0,a,d),l.fillStyle=on,l.beginPath(),i.forEach(p=>{l&&l.rect(p.col*s,p.row*s,s,s)}),l.fill(),requestAnimationFrame(o)}}),(()=>{const o=bo(),s=o.firstChild;return pe(o,"mouseleave",nt.fieldMouseLeaved),o.$$mousemove=({clientX:i,clientY:l})=>nt.fieldMouseMoved({x:i,y:l}),o.style.setProperty("--color1",on),o.style.setProperty("--color2",jr),mr(i=>r=i,s),M(o,()=>t().map(i=>(()=>{const l=an();return V(a=>{const d=i.x,p=i.y,m={[Ie.cell]:!0,[Ie.hoveredCell]:!0};return d!==a._v$5&&((a._v$5=d)!=null?l.style.setProperty("left",d):l.style.removeProperty("left")),p!==a._v$6&&((a._v$6=p)!=null?l.style.setProperty("top",p):l.style.removeProperty("top")),a._v$7=Xt(l,m,a._v$7),a},{_v$5:void 0,_v$6:void 0,_v$7:void 0}),l})()),null),M(o,()=>n().map(i=>(()=>{const l=an();return M(l,()=>i.label),V(a=>{const d=i.x,p=i.y,m={[Ie.label]:!0};return d!==a._v$8&&((a._v$8=d)!=null?l.style.setProperty("left",d):l.style.removeProperty("left")),p!==a._v$9&&((a._v$9=p)!=null?l.style.setProperty("top",p):l.style.removeProperty("top")),a._v$10=Xt(l,m,a._v$10),a},{_v$8:void 0,_v$9:void 0,_v$10:void 0}),l})()),null),V(i=>{const l=Ie.field,a=j.$cellSize.map(m=>m+"px"),d=e.width,p=e.height;return l!==i._v$&&Oe(o,i._v$=l),a!==i._v$2&&((i._v$2=a)!=null?o.style.setProperty("--cellSize",a):o.style.removeProperty("--cellSize")),d!==i._v$3&&Vt(s,"width",i._v$3=d),p!==i._v$4&&Vt(s,"height",i._v$4=p),i},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),o})()}it(["mousemove"]);const $o="_roundBox_hgest_1",So="_history_hgest_9",xo="_colorBtn_hgest_15",_o="_currentColor_hgest_22",ko="_arrowBtn_hgest_26",Co="_whiteBox_hgest_54",rt={roundBox:$o,history:So,colorBtn:xo,currentColor:_o,arrowBtn:ko,whiteBox:Co},Po=ae("<div><button>-</button><button>+");function Kn(e){return(()=>{const t=Po(),n=t.firstChild,r=n.nextSibling;return pe(n,"click",e.onMinusClicked,!0),M(t,()=>` ${e.value} `,r),pe(r,"click",e.onPlusClicked,!0),V(o=>{const s=e.class,i=e.value<=e.range[0],l=e.value>=e.range[1];return s!==o._v$&&Oe(t,o._v$=s),i!==o._v$2&&(n.disabled=o._v$2=i),l!==o._v$3&&(r.disabled=o._v$3=l),o},{_v$:void 0,_v$2:void 0,_v$3:void 0}),t})()}it(["click"]);const Eo=ae("<div><button>to center</button><div>");function Ao(){const[e]=je([j.$cellSize]);return Ot.initEvents(),(()=>{const t=Eo(),n=t.firstChild,r=n.nextSibling;return pe(n,"click",Hn,!0),r.style.setProperty("position","absolute"),r.style.setProperty("right","150px"),r.style.setProperty("bottom","20px"),r.style.setProperty("z-index","1"),M(r,re(Kn,{get value(){return e()},get onPlusClicked(){return j.plus},get onMinusClicked(){return j.minus},get range(){return j.options},get class(){return rt.roundBox}})),V(()=>Oe(n,rt.arrowBtn)),t})()}it(["click"]);const Mo=ae("<button>STOP"),To=ae("<button>START"),No=ae("<p><button>Step</button>timer: ");function zo(){let[e,t]=je([B.$isRunning,B.$currentStep]);return(()=>{const n=No(),r=n.firstChild;return r.nextSibling,n.style.setProperty("display","flex"),n.style.setProperty("gap","4px"),n.style.setProperty("position","absolute"),pe(r,"click",B.oneStep,!0),M(n,re(Ut,{get when(){return e()},get children(){const o=Mo();return pe(o,"click",B.stop,!0),o.style.setProperty("color","#f8f8f8"),o.style.setProperty("background-color","#de4040"),o.style.setProperty("border","0"),o}}),null),M(n,re(Ut,{get when(){return!e()},get children(){const o=To();return pe(o,"click",B.start,!0),o.style.setProperty("color","#f8f8f8"),o.style.setProperty("background-color","#50c40e"),o.style.setProperty("border","0"),o}}),null),M(n,()=>`steps: ${t()}`,null),V(()=>Oe(n,rt.whiteBox)),n})()}it(["click"]);const Fo=ae("<div><span>FPS: </span><span>STEPS PER SEC: </span><span>EXPECTED STEPS:</span><span>CALC TIME: <!> msec</span><span>CELLS: </span><span>CELLS ON SCREEN: ");function Lo(){const[e,t,n]=je([wt.$stepsPerSec,wt.$time,wt.$fps]),[r,o]=je([to,B.$expectedStepsPerSec]);return(()=>{const s=Fo(),i=s.firstChild;i.firstChild;const l=i.nextSibling;l.firstChild;const a=l.nextSibling,d=a.nextSibling,p=d.firstChild,m=p.nextSibling;m.nextSibling;const g=d.nextSibling;g.firstChild;const c=g.nextSibling;return c.firstChild,s.style.setProperty("position","absolute"),s.style.setProperty("display","grid"),s.style.setProperty("bottom","10px"),s.style.setProperty("left","130px"),M(i,n,null),M(l,e,null),M(s,re(Kn,{get value(){return o()},get onPlusClicked(){return B.incExpectedStepsPerSec},get onMinusClicked(){return B.decExpectedStepsPerSec},get range(){return B.speedRange}}),d),M(d,t,m),M(g,()=>r().faunaCellsAmount,null),M(c,()=>r().fieldCellsAmount,null),V(()=>Oe(s,rt.whiteBox)),s})()}const jo=ae("<div><div><h2>TODO</h2><ul><li> ++ navigation</li><li> ++ field</li><li> ++ Progress</li><li> ++ perf</li><li>history</li><li>reset button</li><li>import stuff</li></ul></div><div><h1>Game of Life");function Bo(){return(()=>{const e=jo(),t=e.firstChild,n=t.nextSibling;return n.firstChild,t.style.setProperty("position","absolute"),t.style.setProperty("pointer-events","none"),M(e,re(Ao,{}),n),M(e,re(wo,{}),n),n.style.setProperty("position","absolute"),n.style.setProperty("width","100%"),n.style.setProperty("background-color","rgba(255,255,255, 0.9)"),M(n,re(zo,{}),null),M(e,re(Lo,{}),null),e})()}Oo();function Oo(){const e=new Worker("./webworkerGo.js");e.addEventListener("message",t=>{ut(t.data)}),e.addEventListener("error",t=>{console.log("main.error err",t)}),Bt.watch(t=>{e.postMessage(t)})}pr(()=>re(Bo,{}),document.querySelector("#app"));
