const _n=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}};_n();function Ie(e,t){for(let r in e)t(e[r],r)}function P(e,t){e.forEach(t)}function A(e,t){if(!e)throw Error(t)}function $r(e,t){N={parent:N,value:e,template:F(e,"template")||Pe(),sidRoot:F(e,"sidRoot")||N&&N.sidRoot};try{return t()}finally{N=ie(N)}}function ve({node:e=[],from:t,source:r,parent:a=t||r,to:n,target:l,child:i=n||l,scope:s={},meta:g={},family:y={type:"regular"},regional:h}={}){let p=Ve(a),d=Ve(y.links),u=Ve(y.owners),o=[];P(e,f=>f&&ne(o,f));let v={id:On(),seq:o,next:Ve(i),meta:g,scope:s,family:{type:y.type||"crosslink",links:d,owners:u}};return P(d,f=>ne(Tt(f),v)),P(u,f=>ne(qt(f),v)),P(p,f=>ne(f.next,v)),h&&N&&Fe(He(N),[v]),v}function T(e,t,r){let a=le,n=null,l=q;if(e.target&&(t=e.params,r=e.defer,a="page"in e?e.page:a,e.stack&&(n=e.stack),l=de(e)||l,e=e.target),l&&q&&l!==q&&(q=null),Array.isArray(e))for(let u=0;u<e.length;u++)$e("pure",a,G(e[u]),n,t[u],l);else $e("pure",a,G(e),n,t,l);if(r&&!it)return;let i,s,g,y,h,p,d={isRoot:it,currentPage:le,scope:q,isWatch:ft,isPure:mt};it=0;e:for(;y=Bn();){let{idx:u,stack:o,type:v}=y;g=o.node,le=h=o.page,q=de(o),h?p=h.reg:q&&(p=q.reg);let f=!!h,c=!!q,m={fail:0,scope:g.scope};i=s=0;for(let b=u;b<g.seq.length&&!i;b++){let w=g.seq[b];if(w.order){let{priority:k,barrierID:x}=w.order,S=x?h?`${h.fullID}_${x}`:x:0;if(b!==u||v!==k){x?Bt.has(S)||(Bt.add(S),Yt(b,o,k,x)):Yt(b,o,k);continue e}x&&Bt.delete(S)}switch(w.type){case"mov":{let x,S=w.data;switch(S.from){case Me:x=He(o);break;case"a":case"b":x=o[S.from];break;case"value":x=S.store;break;case"store":if(p&&!p[S.store.id])if(f){let D=en(h,S.store.id);o.page=h=D,D?p=D.reg:c?(Oe(q,S.store,0,1,S.softRead),p=q.reg):p=void 0}else c&&Oe(q,S.store,0,1,S.softRead);x=Ge(p&&p[S.store.id]||S.store)}switch(S.to){case Me:o.value=x;break;case"a":case"b":o[S.to]=x;break;case"store":jn(h,q,g,S.target).current=x}break}case"compute":let k=w.data;if(k.fn){ft=F(g,"op")==="watch",mt=k.pure;let x=k.safe?(0,k.fn)(He(o),m.scope,o):Vn(m,k.fn,o);k.filter?s=!x:o.value=x,ft=d.isWatch,mt=d.isPure}}i=m.fail||s}if(!i){let b=He(o);P(g.next,k=>{$e("child",h,k,o,b,de(o))});let w=de(o);if(w){F(g,"needFxCounter")&&$e("child",h,w.fxCount,o,b,w),F(g,"storeChange")&&$e("child",h,w.storeChange,o,b,w),F(g,"warnSerialize")&&$e("child",h,w.warnSerializeNode,o,b,w);let k=w.additionalLinks[g.id];k&&P(k,x=>{$e("child",h,x,o,b,w)})}}}it=d.isRoot,le=d.currentPage,q=de(d)}function Hr(e,t="combine"){let r=t+"(",a="",n=0;return Ie(e,l=>{n<25&&(l!=null&&(r+=a,r+=ge(l)?ir(l).fullName:l.toString()),n+=1,a=", ")}),r+")"}function Gr(e,t){let r,a,n=e;if(t){let l=ir(t);e.length===0?(r=l.path,a=l.fullName):(r=l.path.concat([e]),a=l.fullName.length===0?e:l.fullName+"/"+e)}else r=e.length===0?[]:[e],a=e;return{shortName:n,fullName:a,path:r}}function Ne(e,t){let r=t?e:e[0];Yr(r);let a=r.or,n=r.and;if(n){let l=t?n:n[0];if(Z(l)&&"and"in l){let i=Ne(n,t);e=i[0],a={...a,...i[1]}}else e=n}return[e,a]}function B(e,...t){let r=Pe();if(r){let a=r.handlers[e];if(a)return a(r,...t)}}function $(e,t){let r=(n,...l)=>(De(!F(r,"derived"),"call of derived event","createEvent"),De(!mt,"unit call from pure function","operators like sample"),le?((i,s,g,y)=>{let h=le,p=null;if(s)for(p=le;p&&p.template!==s;)p=ie(p);Dr(p);let d=i.create(g,y);return Dr(h),d})(r,a,n,l):r.create(n,l)),a=Pe();return Object.assign(r,{graphite:ve({meta:an("event",r,e,t),regional:1}),create:n=>(T({target:r,params:n,scope:q}),n),watch:n=>rn(r,n),map:n=>zt(r,Re,n,[ae()]),filter:n=>zt(r,"filter",n.fn?n:n.fn,[ae(cr,1)]),filterMap:n=>zt(r,"filterMap",n,[ae(),Y(l=>!V(l),1)]),prepend(n){let l=$("* \u2192 "+r.shortName,{parent:ie(r)});return B("eventPrepend",G(l)),we(l,r,[ae()],"prepend",n),nn(r,l),l}})}function M(e,t){let r=_e(e),a=$({named:"updates",derived:1});B("storeBase",r);let n=r.id,l={subscribers:new Map,updates:a,defaultState:e,stateRef:r,getState(){let p,d=r;if(le){let u=le;for(;u&&!u.reg[n];)u=ie(u);u&&(p=u)}return!p&&q&&(Oe(q,r,1),p=q),p&&(d=p.reg[n]),Ge(d)},setState:p=>T({target:l,params:p,defer:1,scope:q}),reset:(...p)=>(P(p,d=>l.on(d,()=>l.defaultState)),l),on:(p,d)=>(kt(p,".on","first argument"),De(!F(l,"derived"),".on in derived store","createStore"),P(Array.isArray(p)?p:[p],u=>{l.off(u),dt(l).set(u,tn(Tr(u,l,"on",Nn,d)))}),l),off(p){let d=dt(l).get(p);return d&&(d(),dt(l).delete(p)),l},map(p,d){let u,o;Z(p)&&(u=p,p=p.fn),De(V(d),"second argument of store.map","updateFilter");let v=l.getState();Pe()?o=null:V(v)||(o=p(v,d));let f=M(o,{name:`${l.shortName} \u2192 *`,derived:1,and:u}),c=Tr(l,f,Re,Xt,p);return wt(z(f),{type:Re,fn:p,from:r}),z(f).noInit=1,B("storeMap",r,c),f},watch(p,d){if(!d||!ge(p)){let u=rn(l,p);return B("storeWatch",r,p)||p(l.getState()),u}return A(H(d),"second argument should be a function"),p.watch(u=>d(l.getState(),u))}},i=an("store",l,t),s=l.defaultConfig.updateFilter;l.graphite=ve({scope:{state:r,fn:s},node:[Y((p,d,u)=>(u.scope&&!u.scope.reg[r.id]&&(u.b=1),p)),oe(r),Y((p,d,{a:u,b:o})=>!V(p)&&(p!==u||o),1),s&&ae(Xt,1),X({from:Me,target:r})],child:a,meta:i,regional:1});let g=F(l,"derived"),y=F(l,"serialize")==="ignore",h=F(l,"sid");return h&&(y||Ce(l,"storeChange",1),r.sid=h),h||y||g||Ce(l,"warnSerialize",1),A(g||!V(e),"current state can't be undefined, use null instead"),Fe(l,[a]),l}function Q(...e){let t,r,a;[e,a]=Ne(e);let n,l,i,s=e[e.length-1];if(H(s)?(r=e.slice(0,-1),t=s):r=e,r.length===1){let g=r[0];j(g)||(n=g,l=1)}if(!l&&(n=r,t)){i=1;let g=t;t=y=>g(...y)}return A(Z(n),"shape should be an object"),Hn(Array.isArray(n),!i,n,a,t)}function Tn(){let e={};return e.req=new Promise((t,r)=>{e.rs=t,e.rj=r}),e.req.catch(()=>{}),e}function nt(e,t){let r=$(H(e)?{handler:e}:e,t),a=G(r);Ce(a,"op",r.kind="effect"),r.use=d=>(A(H(d),".use argument should be a function"),y.scope.handler=d,r),r.use.getCurrent=()=>y.scope.handler;let n=r.finally=$({named:"finally",derived:1}),l=r.done=n.filterMap({named:"done",fn({status:d,params:u,result:o}){if(d==="done")return{params:u,result:o}}}),i=r.fail=n.filterMap({named:"fail",fn({status:d,params:u,error:o}){if(d==="fail")return{params:u,error:o}}}),s=r.doneData=l.map({named:"doneData",fn:({result:d})=>d}),g=r.failData=i.map({named:"failData",fn:({error:d})=>d}),y=ve({scope:{handlerId:F(a,"sid"),handler:r.defaultConfig.handler||(()=>A(0,`no handler used in ${r.getType()}`))},node:[Y((d,u,o)=>{let v=u,f=v.handler;if(de(o)){let c=de(o).handlers[v.handlerId];c&&(f=c)}return d.handler=f,d},0,1),Y(({params:d,req:u,handler:o,args:v=[d]},f,c)=>{let m=xt(d,u,1,n,c),b=xt(d,u,0,n,c),[w,k]=ln(o,b,v);w&&(Z(k)&&H(k.then)?k.then(m,b):m(k))},0,1)],meta:{op:"fx",fx:"runner"}});a.scope.runner=y,ne(a.seq,Y((d,{runner:u},o)=>{let v=ie(o)?{params:d,req:{rs(f){},rj(f){}}}:d;return T({target:u,params:v,defer:1,scope:de(o)}),v.params},0,1)),r.create=d=>{let u=Tn(),o={params:d,req:u};if(q){if(!ft){let v=q;u.req.finally(()=>{zn(v)}).catch(()=>{})}T({target:r,params:o,scope:q})}else T(r,o);return u.req};let h=r.inFlight=M(0,{serialize:"ignore"}).on(r,d=>d+1).on(n,d=>d-1).map({fn:d=>d,named:"inFlight"});Ce(n,"needFxCounter","dec"),Ce(r,"needFxCounter",1);let p=r.pending=h.map({fn:d=>d>0,named:"pending"});return Fe(r,[n,l,i,s,g,p,h]),r}function qn(e){let t;[e,t]=Ne(e,1);let{source:r,effect:a,mapParams:n}=e,l=nt(e,t);Ce(l,"attached",1);let i,{runner:s}=G(l).scope,g=Y((h,p,d)=>{let u,{params:o,req:v,handler:f}=h,c=l.finally,m=xt(o,v,0,c,d),b=d.a,w=yt(f),k=1;if(n?[k,u]=ln(n,m,[o,b]):u=r&&w?b:o,k){if(!w)return h.args=[b,u],1;T({target:f,params:{params:u,req:{rs:xt(o,v,1,c,d),rj:m}},page:d.page,defer:1})}},1,1);if(r){let h;j(r)?(h=r,Fe(h,[l])):(h=Q(r),Fe(l,[h])),i=[oe(z(h)),g]}else i=[g];s.seq.splice(1,0,...i),l.use(a);let y=ie(a);return y&&(Object.assign(ir(l),Gr(l.shortName,y)),l.defaultConfig.parent=y),nn(a,l,"effect"),l}function Je(e,t){kt(e,"merge","first argument");let r=$({name:Hr(e,"merge"),derived:1,and:t});return we(e,r,[],"merge"),r}function Wr(e,t){let r=0;return P(Wn,a=>{a in e&&(A(e[a]!=null,on(t,a)),r=1)}),r}function C(...e){let t,r,a,n,[[l,i,s],g]=Ne(e),y=1;return V(i)&&Z(l)&&Wr(l,"sample")&&(i=l.clock,s=l.fn,y=!l.greedy,n=l.filter,t=l.target,r=l.name,a=l.sid,l=l.source),fr("sample",i,l,n,t,s,r,g,y,1,0,a)}function pt(...e){let[[t,r],a]=Ne(e);return r||(r=t,t=r.source),Wr(r,"guard"),fr("guard",r.clock,t,r.filter,r.target,null,r.name,a,!r.greedy,0,1)}function Kt(e,t,r){if(j(e))return De(0,"restore($store)"),e;if(Qr(e)||yt(e)){let n=ie(e),l=M(t,{parent:n,name:e.shortName,and:r});return we(yt(e)?e.doneData:e,l),n&&n.hooks.store(l),l}let a=Array.isArray(e)?[]:{};return Ie(e,(n,l)=>a[l]=j(n)?n:M(n,{name:l})),a}function Ln(...e){let t,r,a="split",[[n,l],i]=Ne(e),s=!l;s&&(t=n.cases,l=n.match,r=n.clock,n=n.source);let g=j(l),y=!ge(l)&&H(l),h=!g&&!y&&Z(l);t||(t={}),s?Ie(t,(v,f)=>Jr(a,v,`cases.${f}`)):(A(h,"match should be an object"),Ie(l,(v,f)=>t[f]=$({derived:1,and:i})),t.__=$({derived:1,and:i}));let p,d=new Set([].concat(n,r||[],Object.values(t))),u=Object.keys(g||y?t:l);if(g||y)g&&d.add(l),p=[g&&oe(z(l),0,1),Ee({safe:g,filter:1,pure:!g,fn(v,f,c){let m=String(g?c.a:l(v));Vt(f,Sr(u,m)?m:"__",v,c)}})];else if(h){let v=_e({});v.type="shape";let f,c=[];Ie(l,(m,b)=>{if(ge(m)){f=1,ne(c,b),d.add(m);let w=we(m,[],[oe(v),Y((k,x,{a:S})=>S[b]=k)]);if(j(m)){v.current[b]=m.getState();let k=z(m);wt(v,{from:k,field:b,type:"field"}),B("splitMatchStore",k,w)}}}),f&&B("splitBase",v),p=[f&&oe(v,0,1),ae((m,b,w)=>{for(let k=0;k<u.length;k++){let x=u[k];if(Sr(c,x)?w.a[x]:l[x](m))return void Vt(b,x,m,w)}Vt(b,"__",m,w)},1)]}else A(0,"expect match to be unit, function or object");let o=ve({meta:{op:a},parent:r?[]:n,scope:t,node:p,family:{owners:Array.from(d)},regional:1});if(r&&fr(a,r,n,null,o,null,a,i,0,0,0),!s)return t}let Rn=typeof Symbol<"u"&&Symbol.observable||"@@observable",Re="map",Me="stack",ge=e=>(H(e)||Z(e))&&"kind"in e;const at=e=>t=>ge(t)&&t.kind===e;let j=at("store"),Qr=at("event"),yt=at("effect"),Kr=at("domain"),Fn=at("scope");var R={__proto__:null,unit:ge,store:j,event:Qr,effect:yt,domain:Kr,scope:Fn};let Sr=(e,t)=>e.includes(t),Pt=(e,t)=>{let r=e.indexOf(t);r!==-1&&e.splice(r,1)},ne=(e,t)=>e.push(t),De=(e,t,r)=>!e&&console.error(`${t} is deprecated${r?`, use ${r} instead`:""}`),G=e=>e.graphite||e,Tt=e=>e.family.owners,qt=e=>e.family.links,z=e=>e.stateRef,He=e=>e.value,dt=e=>e.subscribers,ie=e=>e.parent,de=e=>e.scope,F=(e,t)=>G(e).meta[t],Ce=(e,t,r)=>G(e).meta[t]=r,ir=e=>e.compositeName;const sr=()=>{let e=0;return()=>""+ ++e};let En=sr(),Xr=sr(),On=sr(),N=null,Pe=()=>N&&N.template,An=e=>(e&&N&&N.sidRoot&&(e=`${N.sidRoot}|${e}`),e),Fe=(e,t)=>{let r=G(e);P(t,a=>{let n=G(a);r.family.type!=="domain"&&(n.family.type="crosslink"),ne(Tt(n),r),ne(qt(r),n)})},Ve=(e=[])=>(Array.isArray(e)?e:[e]).flat().map(G),Z=e=>typeof e=="object"&&e!==null,H=e=>typeof e=="function",V=e=>e===void 0,Yr=e=>A(Z(e)||H(e),"expect first argument be an object");const Ir=(e,t,r,a)=>A(!(!Z(e)&&!H(e)||!("family"in e)&&!("graphite"in e)),`${t}: expect ${r} to be a unit (store, event or effect)${a}`);let kt=(e,t,r)=>{Array.isArray(e)?P(e,(a,n)=>Ir(a,t,`${n} item of ${r}`,"")):Ir(e,t,r," or array of units")},Jr=(e,t,r="target")=>P(Ve(t),a=>De(!F(a,"derived"),`${e}: derived unit in "${r}"`,"createEvent/createStore")),Xt=(e,{fn:t},{a:r})=>t(e,r),Nn=(e,{fn:t},{a:r})=>t(r,e),cr=(e,{fn:t})=>t(e);const Zr=(e,t,r,a)=>{let n={id:Xr(),type:e,data:t};return r&&(n.order={priority:r},a&&(n.order.barrierID=++Pn)),n};let Pn=0,X=({from:e="store",store:t,target:r,to:a=r?"store":Me,batch:n,priority:l})=>Zr("mov",{from:e,store:t,to:a,target:r},l,n),Ee=({fn:e,batch:t,priority:r,safe:a=0,filter:n=0,pure:l=0})=>Zr("compute",{fn:e,safe:a,filter:n,pure:l},r,t),ur=({fn:e})=>Ee({fn:e,priority:"effect"}),Y=(e,t,r)=>Ee({fn:e,safe:1,filter:t,priority:r&&"effect"}),oe=(e,t,r)=>X({store:e,to:t?Me:"a",priority:r&&"sampler",batch:1}),ae=(e=cr,t)=>Ee({fn:e,pure:1,filter:t}),Cr={mov:X,compute:Ee,filter:({fn:e,pure:t})=>Ee({fn:e,filter:1,pure:t}),run:ur},_e=e=>({id:Xr(),current:e}),Ge=({current:e})=>e,wt=(e,t)=>{e.before||(e.before=[]),ne(e.before,t)},Te=null;const pr=(e,t)=>{if(!e)return t;if(!t)return e;let r;return(e.v.type===t.v.type&&e.v.id>t.v.id||Jt(e.v.type)>Jt(t.v.type))&&(r=e,e=t,t=r),r=pr(e.r,t),e.r=e.l,e.l=r,e},dr=[];let Mr=0;for(;Mr<6;)ne(dr,{first:null,last:null,size:0}),Mr+=1;const Bn=()=>{for(let e=0;e<6;e++){let t=dr[e];if(t.size>0){if(e===3||e===4){t.size-=1;let a=Te.v;return Te=pr(Te.l,Te.r),a}t.size===1&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},$e=(e,t,r,a,n,l)=>Yt(0,{a:null,b:null,node:r,parent:a,value:n,page:t,scope:l},e),Yt=(e,t,r,a=0)=>{let n=Jt(r),l=dr[n],i={v:{idx:e,stack:t,type:r,id:a},l:null,r:null};n===3||n===4?Te=pr(Te,i):(l.size===0?l.first=i:l.last.r=i,l.last=i),l.size+=1},Jt=e=>{switch(e){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},Bt=new Set;let q,it=1,ft=0,mt=0,le=null,zn=e=>{q=e},Dr=e=>{le=e};const en=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=ie(e);if(e)return e}return null};let jn=(e,t,r,a,n)=>{let l=en(e,a.id);return l?l.reg[a.id]:t?(Oe(t,a,n),t.reg[a.id]):a},Oe=(e,t,r,a,n)=>{let l=e.reg,i=t.sid;if(l[t.id])return;let s={id:t.id,current:t.current};if(i&&i in e.sidValuesMap&&!(i in e.sidIdMap))s.current=e.sidValuesMap[i];else if(t.before&&!n){let g=0,y=r||!t.noInit||a;P(t.before,h=>{switch(h.type){case Re:{let p=h.from;if(p||h.fn){p&&Oe(e,p,r,a);let d=p&&l[p.id].current;y&&(s.current=h.fn?h.fn(d):d)}break}case"field":g||(g=1,s.current=Array.isArray(s.current)?[...s.current]:{...s.current}),Oe(e,h.from,r,a),y&&(s.current[h.field]=l[l[h.from.id].id].current)}})}i&&(e.sidIdMap[i]=t.id),l[t.id]=s};const Vn=(e,t,r)=>{try{return t(He(r),e.scope,r)}catch(a){console.error(a),e.fail=1}};let Zt=(e,t={})=>(Z(e)&&(Zt(e.or,t),Ie(e,(r,a)=>{V(r)||a==="or"||a==="and"||(t[a]=r)}),Zt(e.and,t)),t);const _r=(e,t)=>{Pt(e.next,t),Pt(Tt(e),t),Pt(qt(e),t)},er=(e,t,r)=>{let a;e.next.length=0,e.seq.length=0,e.scope=null;let n=qt(e);for(;a=n.pop();)_r(a,e),(t||r&&F(e,"op")!=="sample"||a.family.type==="crosslink")&&er(a,t,F(a,"op")!=="on"&&r);for(n=Tt(e);a=n.pop();)_r(a,e),r&&a.family.type==="crosslink"&&er(a,t,F(a,"op")!=="on"&&r)},ze=e=>e.clear();let Un=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),j(e))ze(dt(e));else if(Kr(e)){r=1;let a=e.history;ze(a.events),ze(a.effects),ze(a.stores),ze(a.domains)}er(G(e),!!t,r)},tn=e=>{let t=()=>Un(e);return t.unsubscribe=t,t},we=(e,t,r,a,n)=>ve({node:r,parent:e,child:t,scope:{fn:n},meta:{op:a},family:{owners:[e,t],links:t},regional:1}),rn=(e,t)=>(A(H(t),".watch argument should be a function"),tn(ve({scope:{fn:t},node:[ur({fn:cr})],parent:e,meta:{op:"watch"},family:{owners:e},regional:1}))),nn=(e,t,r="event")=>{ie(e)&&ie(e).hooks[r](t)},an=(e,t,r,a)=>{let n=e==="domain",l=En(),i=Zt({or:a,and:typeof r=="string"?{name:r}:r}),{parent:s=null,sid:g=null,named:y=null}=i,h=y||i.name||(n?"":l),p=Gr(h,s),d={op:t.kind=e,name:t.shortName=h,sid:t.sid=An(g),named:y,unitId:t.id=l,serialize:i.serialize,derived:i.derived,config:i};if(t.parent=s,t.compositeName=p,t.defaultConfig=i,t.thru=u=>(De(0,"thru","js pipe"),u(t)),t.getType=()=>p.fullName,!n){t.subscribe=o=>(Yr(o),t.watch(H(o)?o:v=>o.next&&o.next(v))),t[Rn]=()=>t;let u=Pe();u&&(d.nativeTemplate=u)}return d};const zt=(e,t,r,a)=>{let n;Z(r)&&(n=r,r=r.fn);let l=$({name:`${e.shortName} \u2192 *`,derived:1,and:n});return we(e,l,a,t,r),l},Tr=(e,t,r,a,n)=>{let l=z(t),i=X({store:l,to:"a",priority:"read"});r===Re&&(i.data.softRead=1);let s=[i,ae(a)];return B("storeOnMap",l,s,j(e)&&z(e)),we(e,t,s,r,n)},Hn=(e,t,r,a,n)=>{let l=e?o=>o.slice():o=>({...o}),i=e?[]:{},s=l(i),g=_e(s),y=_e(1);g.type=e?"list":"shape",g.noInit=1,B("combineBase",g,y);let h=M(s,{name:Hr(r),derived:1,and:a}),p=z(h);p.noInit=1,Ce(h,"isCombine",1);let d=oe(g);d.order={priority:"barrier"};let u=[Y((o,v,f)=>(f.scope&&!f.scope.reg[g.id]&&(f.c=1),o)),d,X({store:y,to:"b"}),Y((o,{key:v},f)=>{if(f.c||o!==f.a[v])return t&&f.b&&(f.a=l(f.a)),f.a[v]=o,1},1),X({from:"a",target:g}),X({from:"value",store:0,target:y}),X({from:"value",store:1,target:y,priority:"barrier",batch:1}),oe(g,1),n&&ae()];return Ie(r,(o,v)=>{if(!j(o))return A(!ge(o)&&!V(o),`combine expects a store in a field ${v}`),void(s[v]=i[v]=o);i[v]=o.defaultState,s[v]=o.getState();let f=we(o,h,u,"combine",n);f.scope.key=v;let c=z(o);wt(g,{type:"field",field:v,from:c}),B("combineField",c,f)}),h.defaultShape=r,wt(p,{type:Re,from:g,fn:n}),Pe()||(h.defaultState=n?p.current=n(s):i),h};let ln=(e,t,r)=>{try{return[1,e(...r)]}catch(a){return t(a),[0,null]}},xt=(e,t,r,a,n)=>l=>T({target:[a,Gn],params:[r?{status:"done",params:e,result:l}:{status:"fail",params:e,error:l},{value:l,fn:r?t.rs:t.rj}],defer:1,page:n.page,scope:de(n)});const Gn=ve({node:[ur({fn:({fn:e,value:t})=>e(t)})],meta:{op:"fx",fx:"sidechain"}}),Wn=["source","clock","target"],on=(e,t)=>e+`: ${t} should be defined`;let fr=(e,t,r,a,n,l,i,s,g,y,h,p)=>{let d=!!n;A(!V(r)||!V(t),on(e,"either source or clock"));let u=0;V(r)?u=1:ge(r)||(r=Q(r)),V(t)?t=r:(kt(t,e,"clock"),Array.isArray(t)&&(t=Je(t))),u&&(r=t),s||i||(i=r.shortName);let o="none";(h||a)&&(ge(a)?o="unit":(A(H(a),"`filter` should be function or unit"),o="fn")),n?(kt(n,e,"target"),Jr(e,n)):o==="none"&&y&&j(r)&&j(t)?n=M(l?l(Ge(z(r)),Ge(z(t))):Ge(z(r)),{name:i,sid:p,or:s}):(n=$({name:i,derived:1,or:s}),B("sampleTarget",G(n)));let v=_e(),f=[];if(o==="unit"){let[b,w]=qr(a,n,t,v,e);f=[...jt(w),...jt(b)]}let[c,m]=qr(r,n,t,v,e);return Fe(r,[we(t,n,[B("sampleSourceLoader"),X({from:Me,target:v}),...jt(m),oe(c,1,g),...f,oe(v),o==="fn"&&ae((b,w,{a:k})=>a(b,k),1),l&&ae(Xt),B("sampleSourceUpward",d)],e,l)]),n};const jt=e=>[oe(e),Y((t,r,{a})=>a,1)],qr=(e,t,r,a,n)=>{let l=j(e),i=l?z(e):_e(),s=_e(l);return l||ve({parent:e,node:[X({from:Me,target:i}),X({from:"value",store:1,target:s})],family:{owners:[e,t,r],links:t},meta:{op:n},regional:1}),B("sampleSource",s,i,a),[i,s]},Vt=(e,t,r,a)=>{let n=e[t];n&&T({target:n,params:Array.isArray(n)?n.map(()=>r):r,defer:1,stack:a})};function ht(e,t){e.cursor[t].prev&&(e.cursor[t].prev.cursor[t].next=e.cursor[t].next),e.cursor[t].next&&(e.cursor[t].next.cursor[t].prev=e.cursor[t].prev),e.queue[t].last===e&&(e.queue[t].last=e.cursor[t].prev),e.queue[t].first===e&&(e.queue[t].first=e.cursor[t].next),e.cursor[t].prev=null,e.cursor[t].next=null}function We(e){var t,r;e.status="active",t=gt(e),(r=e).cursor.prev&&(r.cursor.prev.cursor.next=r.cursor.next),r.cursor.next&&(r.cursor.next.cursor.prev=r.cursor.prev),t.last===r&&(t.last=r.cursor.prev),t.first===r&&(t.first=r.cursor.next),r.cursor.prev=null,r.cursor.next=null}function gt(e){return e.group.activeChilds[e.priority]}function Lr(e,t){t.value.active=t.value.pending=e,t.status!=="active"&&We(t)}function U(e,t){if(t.value.active===e)return t.value.pending=e,void(t.status==="pending"&&(We(t),gt(t).first||ht(t.group,t.priority)));var r,a,n,l;t.status==="active"&&(t.status="pending",gt(t).first||((n=t.group).queue[l=t.priority].last?(n.cursor[l].prev=n.queue[l].last,n.queue[l].last.cursor[l].next=n,n.queue[l].last=n):n.queue[l].first=n.queue[l].last=n),a=t,(r=gt(t)).last?(a.cursor.prev=r.last,r.last.cursor.next=a,r.last=a):r.first=r.last=a),t.value.pending=e,t.group.queue.rafID||(t.group.queue.rafID=vn(t.group.queue.execQueue))}function Qn(e){Se("execQueue");let t,r,a=ke(),n=0;e:for(;e.props.first||e.tree.first||e.data.first;){if(ke()-a>=1e3){n=1;break e}let l=!!e.props.first;for(l&&Se("props");t=e.props.first;){for(;r=t.activeChilds.props.first;){if(ke()-a>=1e3){n=1,re("props");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,We(r)}ht(t,"props")}l&&re("props");let i=!!e.tree.first;for(i&&Se("tree");t=e.tree.first;){for(;r=t.activeChilds.tree.first;){if(ke()-a>=1e3){n=1,re("tree");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,We(r)}ht(t,"tree")}i&&re("tree");let s=!!e.data.first;for(s&&Se("data");t=e.data.first;){for(;r=t.activeChilds.data.first;){if(ke()-a>=1e3){n=1,re("data");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,We(r)}ht(t,"data")}s&&re("data")}if(re("execQueue"),n)e.rafID=vn(e.execQueue);else if(e.rafID=null,e.onDrain){let l=e.onDrain;e.onDrain=null,l()}}function Qe({value:e,runOp:t,group:r,priority:a}){return{value:{active:e,pending:e},runOp:t,status:"active",priority:a,group:r,cursor:{prev:null,next:null}}}function Kn({onComplete:e}){let t={props:{first:null,last:null},tree:{first:null,last:null},data:{first:null,last:null},rafID:null,execQueue(){},onDrain:e};return t.execQueue=Qn.bind(null,t),t}function Ze(e){return{ops:[],queue:e,activeChilds:{props:{first:null,last:null},tree:{first:null,last:null},data:{first:null,last:null}},cursor:{props:{prev:null,next:null},tree:{prev:null,next:null},data:{prev:null,next:null}}}}function Xn({value:e,group:t,onInit:r,onChange:a}){let n=Qe({value:e,group:t,runOp(i){l.status="A",a(i)},priority:"data"}),l={status:"IA",value:n.value,ops:{init:Qe({value:0,group:t,runOp(i){l.status="A",r(l.value.active)},priority:"data"}),change:n,terminate:Qe({value:0,group:t,runOp(i){l.status="T"},priority:"data"})}};return U(1,l.ops.init),l}function Yn(e){switch(e.status){case"I":case"T":case"AT":return;case"A":e.status="AT",U(1,e.ops.terminate);break;case"AA":e.status="AT",U(1,e.ops.terminate),U(e.value.active,e.ops.change);break;case"IA":e.status="T",U(0,e.ops.init)}}function Jn(e,t){switch(t.status){case"I":case"T":return;case"A":t.value.active!==e&&(t.status="AA",U(e,t.ops.change));break;case"AA":t.value.active===e?(t.status="A",U(e,t.ops.change)):t.value.pending!==e&&(t.value.pending=e);break;case"IA":t.value.active=t.value.pending=e}}function Zn(e){switch(e=String(e)){case"__proto__":case"__defineGetter__":case"__defineSetter__":case"constructor":case"prototype":case"hasOwnProperty":case"toString":case"valueOf":case"setProperty":case"removeProperty":return"forbidden";default:return e.replace(/[^a-zA-Z0-9\-_]/g,"")}}function sn(e,t){for(let r=0;r<t.length;r++){let{type:a,field:n,value:l}=t[r];la[a](e,n,l)}}function Lt(e){return e!==""&&e!==0&&e!=="0"&&(e==0||e==null)}function cn(e,t,r){Lt(r)?e.style.removeProperty(`--${t}`):e.style.setProperty(`--${t}`,`${r}`)}function un(e,t,r){Lt(r)?delete e.style[t]:e.style[t]=`${r}`}function pn(e,t,r){t&&t.trim().length>0&&(r?e.classList.add(t):(e.classList.remove(t),e.classList.length===0&&e.removeAttribute("class")))}function dn(e,t,r){Lt(r)?delete e.dataset[t]:e.dataset[t]=`${r}`}function fn(e,t,r){if(Lt(r)){switch(t){case"value":delete e.value;break;case"checked":e.checked=0;break;case"spellcheck":if(r==0)return void e.setAttribute("spellcheck","false")}e.removeAttribute(t)}else{switch(t){case"value":e.value=`${r}`;break;case"checked":e.checked=`${r}`}e.setAttribute(t,`${r}`)}}function tr(e,t){e.replaceData(0,(e.textContent||"").length,String(t))}function Ae({fn:e,state:t={},defer:r=0,name:a="",draft:n,isSvgRoot:l,namespace:i,env:s,isBlock:g=0}){let y=_,h={id:++ia,name:a,plain:[],watch:[],nameMap:{},pages:[],closure:[],childTemplates:[],handlers:oa,upward:Cr.filter({fn(d,u,o){if(!o.page){if(!o.parent||!o.parent.page)return 1;o.page=o.parent.page}if(!o.page.root.activeSpawns.has(o.page.fullID))return console.count("inactive page upward"),0;let v=[o.page.template],f=[o.page];{let c=o.page.parent;for(;c;)f.push(c),v.push(c.template),c=c.parent}return o.node.next.forEach(c=>{let m=c.meta.nativeTemplate;if(m)if(v.includes(m)){let b=f[v.indexOf(m)];T({target:c,params:d,defer:1,page:b,stack:o,scope:o.scope})}else console.error("context drift",{stack:o,node:c});else T({target:c,params:d,defer:1,page:o.page,stack:o,scope:o.scope})}),0}}),loader:Cr.filter({fn(d,u,o){if(o.parent){let v=o.scope?o.scope.graphite.id:null;if(o.page){if(!o.page.root.activeSpawns.has(o.page.fullID))return console.count("inactive page loader"),0;if(o.page.template===h)return 1;if(o.page.root.childSpawns[o.page.fullID][h.id])o.page.root.childSpawns[o.page.fullID][h.id].forEach(f=>{(!v||f.root.scope&&v===f.root.scope.graphite.id)&&T({params:d,target:o.node,page:f,defer:1,scope:o.scope})});else{let f=o.page.fullID,c=o.page.template.name==="rec";h.pages.forEach(m=>{if(!v||m.root.scope&&v===m.root.scope.graphite.id)if(m.fullID===f||m.fullID.startsWith(`${f}_`)){let b=1;if(c){let w=o.page.template.id,k=m.parent;for(;k&&k!==o.page;){if(k.template.id===w){b=0;break}k=k.parent}}b&&T({params:d,target:o.node,page:m,defer:1,scope:o.scope})}else f.startsWith(`${m.fullID}_`)&&T({params:d,target:o.node,page:o.page,defer:1,scope:o.scope})})}}else h.pages.forEach(f=>{(!v||f.root.scope&&v===f.root.scope.graphite.id)&&T({params:d,target:o.node,page:f,defer:1,scope:o.scope})});return 0}return 1}}),parent:y,node:null,api:null,trigger:{mount:$({named:"mount"})},draft:n,isSvgRoot:l,namespace:i,env:s,isBlock:g||!(!y||!y.isBlock)};y&&y.childTemplates.push(h);let p=ve({meta:{template:h}});return h.node=p,_=h,r?h.deferredInit=()=>{let d=_;_=h,h.deferredInit=null;try{$r(p,()=>{let u=Kt(t);h.api=e(u,h.trigger),h.nameMap=u})}finally{_=d}}:$r(p,()=>{let d=Kt(t);h.api=e(d,h.trigger),h.nameMap=d}),_=y,h}function ea(e,t){let r;switch(r=t?t.getState(e):e.current,e.type){case"list":return[...r];case"shape":return{...r};default:return r}}function mn(e,t,r){let a=t;for(;a&&!tt(a,e);)a=a.parent;return a?tt(a,e):r?(r.getState(e),r.reg[e.id]):e}function Ut(e,t){tt(t,e)||(t.reg[e.id]=mn(e,t.parent,t.root.scope))}function Rr(e,t,r){t in r||(r[t]=[]),r[t].push(...e)}function $t(e,{values:t={},parentLeaf:r,mountNode:a,svgRoot:n,leafData:l,opGroup:i,domSubtree:s,hydration:g,root:y}){function h(f){if(f.before)for(let c=0;c<f.before.length;c++){let m=f.before[c];switch(m.type){case"map":{let b,w=m.from;if(!m.fn&&!w)break;w&&(Ut(w,u),b=d[w.id].current),d[f.id].current=m.fn?m.fn(b):b;break}case"field":{let b=m.from;Ut(b,u),d[f.id].current[m.field]=d[b.id].current;break}case"closure":Ut(m.of,u)}}}function p(f,c,m){let b;c.stop=1;try{for(;c.i<f.length;)b=f[c.i],c.i++,b.fn(m[b.of.id]?m[b.of.id].current:mn(b.of,u.parent,u.root.scope).current)}catch(w){console.error(w),c.stop=0}}let d={},u={draft:e.draft,svgRoot:n,data:l,parent:r,hydration:g,mountNode:a,root:y,id:++sa,fullID:"",reg:d,template:e};e.pages.push(u);let o=Le;Le=u,r&&Rr([u],e.id,y.childSpawns[r.fullID]),u.fullID=r?`${r.fullID}_${u.id}`:`${u.id}`,y.childSpawns[u.fullID]={},y.activeSpawns.add(u.fullID),y.leafOps[u.fullID]={group:i,domSubtree:s};for(let f=0;f<e.closure.length;f++){let c=e.closure[f],m=c,b=u.parent;e:for(;b;){if(tt(b,c)){m=tt(b,c);break e}b=b.parent}!b&&y.scope&&(y.scope.getState(c),m=y.scope.reg[c.id]),d[c.id]=m}for(let f=0;f<e.plain.length;f++){let c=e.plain[f],m={id:c.id,current:ea(c,y.scope)};d[c.id]=m}for(let f in t){let c=e.nameMap[f].stateRef.id;d[c]={id:c,current:t[f]}}e.closure.forEach(h),e.plain.forEach(h);let v={i:0,stop:0};for(;!v.stop;)p(e.watch,v,d);if(r)for(let f in y.childSpawns[u.fullID])Rr(y.childSpawns[u.fullID][f],f,y.childSpawns[r.fullID]);if(pe)pe.steps.push({target:e.trigger.mount,params:u,defer:1,page:u,scope:y.scope});else{let f;pe={parent:pe,steps:[{target:e.trigger.mount,params:u,defer:1,page:u,scope:y.scope}]};do for(;f=pe.steps.shift();)pe={parent:pe,steps:[]},T(f);while(pe=pe.parent)}return Le=o,u}function St(e){let t=e.parent;for(;t.type!=="element"&&t.type!=="using";)t=t.parent;return t?t.value:null}function It(e){if(!e.visible)return null;switch(e.type){case"text":case"element":return e;case"LF":case"route":case"rec":case"recItem":case"block":case"blockItem":for(let t=e.child.length-1;t>=0;t--){let r=It(e.child[t]);if(r)return r}return null;case"list":{let t=e.lastChild;if(!t)return null;for(;t;){let r=It(t);if(r)return r;t=t.left}return null}default:return null}}function Ct(e){switch(e.type){case"using":return null;case"LF":{let t=e.left;for(;t;){let r=It(t);if(r)return r;t=t.left}return Ct(e.parent)}case"element":case"text":case"route":case"rec":case"recItem":case"block":case"blockItem":case"list":{let t=e.parent;for(let r=e.index-1;r>=0;r--){let a=t.child[r];if(!a)continue;let n=It(a);if(n)return n}switch(t.type){case"element":case"using":return null}return Ct(t)}default:return null}}function rr(e){let t=Ct(e);return t?t.value:null}function et(e,t){if(!e)throw Error(t)}function lt(e,t){if(!e)throw Error(`${t}() called outside from using() closure`)}function Mt(e){if(!_)return;let{draft:t}=e;if(t.type!=="listItem"&&t.type!=="rec")switch(_.draft.type){case"element":case"using":case"route":case"list":case"rec":case"recItem":case"block":case"blockItem":t.inParentIndex=_.draft.childCount,_.draft.childCount+=1,_.draft.childTemplates.push(e);break;default:console.warn(`unexpected currentTemplate type ${_.draft.type}`)}}function fe(e,{parentBlockFragment:t,leaf:r,node:a,svgRoot:n,values:l}){e.childTemplates.forEach(i=>{mr({parentBlockFragment:t,leaf:r,node:a,svgRoot:n,values:l,actor:i})})}function mr({parentBlockFragment:e,leaf:t,node:r=t.mountNode,actor:a,svgRoot:n,values:l}){let i;et(ca.includes(e.type),`incorrect parent ${e.type}`);let{draft:s}=a,{queue:g}=t.root.leafOps[t.fullID].group,y=Ze(g),h=t.root.leafOps[t.fullID].domSubtree,p=h;switch(s.type){case"route":{let u={type:"route",parent:e,child:[],visible:0,index:s.inParentIndex};e.child[s.inParentIndex]=u,i={type:"route",block:u,ops:{},initialized:0,pendingInit:null};break}case"element":{let u;if(a.isBlock){let v,f,c=t;for(;c&&(!f||!v);){c.template.env&&(v=c.template.env);let{draft:m}=c;m.type==="element"&&(m.tag==="svg"?f="svg":m.tag==="foreignObject"&&(f="html")),c=c.parent}f||(f="html"),v&&(u=f==="svg"?v.document.createElementNS("http://www.w3.org/2000/svg",s.tag):v.document.createElement(s.tag),sn(u,s.staticSeq))}else u=s.stencil.cloneNode();let o={type:"element",parent:e,child:[],value:u,visible:0,index:s.inParentIndex};e.child[s.inParentIndex]=o,i={type:"element",block:o,ops:{visible:Qe({value:0,priority:"tree",runOp(v){if(v){hn(o);let f=i;f.needToCallNode&&(f.needToCallNode=0,T({target:Dt,params:{element:o.value,fns:s.node},page:d,scope:t.root.scope})),o.visible=1}else o.value.remove(),o.visible=0},group:h})},needToCallNode:s.node.length>0},p=Ze(g);break}case"list":{let u={type:"list",parent:e,child:[],lastChild:null,visible:1,index:s.inParentIndex};e.child[s.inParentIndex]=u,i={type:"list",draft:s,block:u,records:[],pendingUpdate:null};break}case"using":case"listItem":break;case"rec":{let u={type:"rec",parent:e,child:[],visible:1,index:s.inParentIndex};e.child[s.inParentIndex]=u,i={type:"rec",block:u};break}case"recItem":{let u={type:"recItem",parent:e,child:[],visible:1,index:s.inParentIndex};e.child[s.inParentIndex]=u,i={type:"rec item",block:u};break}case"block":{let u={type:"block",parent:e,child:[],visible:1,index:s.inParentIndex};e.child[s.inParentIndex]=u,i={type:"block",block:u};break}case"blockItem":{let u={type:"blockItem",parent:e,child:[],visible:1,index:s.inParentIndex};e.child[s.inParentIndex]=u,i={type:"block item",block:u};break}default:console.warn(`unexpected draft type ${s.type}`)}let d=$t(a,{values:l,parentLeaf:t,mountNode:r,svgRoot:n||t.svgRoot,leafData:i,opGroup:y,domSubtree:p,hydration:t.hydration,root:t.root})}function hn(e){let t=rr(e);t?t.after(e.value):St(e).prepend(e.value),e.visible=1}function qe({mount:e,state:t,onMount:r,onState:a}){return{onMount:C({source:t,clock:e,fn:r,greedy:1}),onState:C({source:e,clock:t,fn:a,greedy:1})}}function Ke(e,t){for(let r in e)t(e[r],r)}function Fr(e,t){if(!_)return;let r=_.draft;et(r.type==="element",`"handler" extension can be used only with element nodes, got "${r.type}"`),t===void 0&&(t=e,e={});for(let s in t)et(R.unit(t[s]),`handler for "${s}" should be event`);let{passive:a=0,capture:n=0,prevent:l=0,stop:i=0}=e;r.handler.push({options:{prevent:l,stop:i},domConfig:{passive:l?0:a,capture:n},map:t})}function J(e){lt(_,"spec");let t=_.draft;switch(t.type){case"list":return void(e.visible&&(t.itemVisible=e.visible));case"listItem":case"using":case"route":case"rec":case"recItem":case"block":case"blockItem":return}if(e.attr&&t.attr.push(e.attr),e.data&&t.data.push(e.data),"text"in e){let n=e.text,l=t.childCount;Array.isArray(n)?(t.text.push(...n.map((i,s)=>({index:s+l,value:i}))),t.childCount+=n.length):(t.text.push({index:l,value:n}),t.childCount+=1)}if(e.style){let n={};for(let l in e.style)n[Zn(l)]=e.style[l];t.style.push(n)}var r,a;if(e.classList&&(r=e.classList,a=n=>t.classList.push(n),Array.isArray(r)?r.forEach(n=>{let l=typeof n=="string"?n:n.map(s=>s||""),i=typeof n=="string"?1:n.map(s=>s!==null);a({name:l,enabled:i})}):Ke(r,(n,l)=>{a({name:l,enabled:n})})),e.styleVar&&t.styleVar.push(e.styleVar),e.visible&&(t.visible=e.visible),e.handler){let n=e.handler;typeof n.on=="object"?Fr(n.config||{},n.on):Fr(n)}e.\u0254&&J(e.\u0254)}function Ht(e,{initCtx:t,runOp:r,hooks:{onMount:a,onState:n}}){let l=e.opsAmount++;a.watch(({value:i,leaf:s})=>{let g=t(i,s),y=Qe({value:i,priority:"props",runOp(h){r(h,g)},group:s.root.leafOps[s.fullID].group});s.root.leafOps[s.fullID].group.ops[l]=y}),n.watch(({value:i,leaf:s})=>{U(i,s.root.leafOps[s.fullID].group.ops[l])})}function st(e,t,r){e[t].forEach(a=>{Ke(a,(n,l)=>{switch(t){case"data":case"styleVar":r[t][l]=n;break;case"attr":r.attr[l==="xlink:href"?"href":l]=n;break;case"style":l.startsWith("--")?r.styleVar[l.slice(2)]=n:r.style[l]=n}})})}function Er(e,t,r){let a=e.data.block,n={type:"text",parent:a,visible:0,index:r,value:null};if(a.child[r]=n,e.hydration){let l=Ct(n);if(l)switch(l.type){case"text":n.value=e.root.env.document.createTextNode(t),l.value.after(n.value);break;case"element":n.value=l.value.nextSibling,tr(n.value,t)}else{let i=St(n);n.value=i.firstChild,tr(n.value,t)}n.visible=1}else n.value=e.root.env.document.createTextNode(t),hn(n);return n}function je(e){let t=e.stateRef,r=_;r.plain.includes(t)||r.closure.includes(t)||r.closure.push(t)}function I(e,t){let r,a=0,n=0;typeof t=="function"?(a=1,r=t):t&&(n=1,t.fn&&(a=1,r=t.fn),t.\u0254&&(typeof t.\u0254=="function"?(a=1,r=t.\u0254):typeof t.\u0254.fn=="function"&&(a=1,r=t.\u0254.fn))),lt(_,"h");let l,i=_.env,s=_.namespace,g=s,y="html";g=y=s==="svg"?"svg":"html",e==="svg"&&(y="svg",g="svg"),_.isBlock||(l=y==="svg"?i.document.createElementNS("http://www.w3.org/2000/svg",e):i.document.createElement(e));let h=l,p={type:"element",tag:e,attr:[],data:[],text:[],style:[],styleVar:[],classList:[],handler:[],stencil:h,seq:[],staticSeq:[],childTemplates:[],childCount:0,inParentIndex:-1,opsAmount:1,node:[]};s==="foreignObject"?(p.attr.push({xmlns:"http://www.w3.org/1999/xhtml"}),g="html"):e==="svg"?(p.attr.push({xmlns:"http://www.w3.org/2000/svg"}),g="svg"):e==="foreignObject"&&(g="foreignObject");let d=Ae({name:"element",draft:p,isSvgRoot:e==="svg",namespace:g,fn(u,{mount:o}){let v=$({named:"domElementCreated"});a&&r(),n&&J(t),R.unit(p.visible)&&(p.seq.push({type:"visible",value:p.visible}),je(p.visible));let f={attr:{},data:{},style:{},styleVar:{}};st(p,"attr",f),st(p,"data",f),st(p,"style",f),st(p,"styleVar",f),Ke(f,(c,m)=>{Ke(c,(b,w)=>{R.unit(b)?(p.seq.push({type:m,field:w,value:b}),je(b)):p.staticSeq.push({type:m,field:w,value:b})})}),p.classList.forEach(c=>{if(R.unit(c.name)||R.unit(c.enabled)){let m=R.unit(c.name)?c.name:M(c.name),b=R.unit(c.enabled)?c.enabled:M(c.enabled);p.seq.push({type:"classList",field:m,value:b}),je(m),je(b)}else R.unit(c.name)||p.staticSeq.push({type:"classList",field:c.name,value:c.enabled})}),p.text.forEach(c=>{c.value!==null&&(R.unit(c.value)?(p.seq.push({type:"dynamicText",value:c.value,childIndex:c.index}),je(c.value)):p.seq.push({type:"staticText",value:String(c.value),childIndex:c.index}))}),p.handler.forEach(c=>{Ke(c.map,(m,b)=>{p.seq.push({type:"handler",for:b,handler:m,options:c.options,domConfig:c.domConfig})})}),h&&sn(h,p.staticSeq),p.seq.forEach(c=>{switch(c.type){case"visible":{let{onMount:m,onState:b}=qe({mount:o,state:c.value,onMount:(w,k)=>({leaf:k,value:w,hydration:k.hydration}),onState:(w,k)=>({leaf:w,value:k,hydration:0})});m.watch(({leaf:w,value:k,hydration:x})=>{let S=w.data,D=S.block;if(x&&(Lr(k,S.ops.visible),k)){let L,O=rr(D);if(L=O?O.nextSibling:St(D).firstChild,L.nodeName==="#text"){let se=L;L=L.nextSibling,se.remove()}D.value=L,D.visible=1}fe(p,{parentBlockFragment:D,leaf:w,node:D.value,svgRoot:d.isSvgRoot?D.value:null}),k&&S.needToCallNode&&(S.needToCallNode=0,T({target:Dt,params:{element:S.block.value,fns:p.node},page:w,defer:1,scope:w.root.scope})),T({target:v,params:w,defer:1,page:w,scope:w.root.scope})}),Je([b,m]).watch(({leaf:w,value:k,hydration:x})=>{x||U(k,w.data.ops.visible)});break}case"attr":case"data":case"style":case"styleVar":{let m=Br[c.type],b=ua.some(({type:k,field:x})=>c.type===k&&c.field===x),w=qe({mount:v,state:c.value,onMount:(k,x)=>({leaf:x,value:k}),onState:(k,x)=>({leaf:k,value:x})});b?Je([w.onState,w.onMount]).watch(({leaf:k,value:x})=>{m(ct(k),c.field,x)}):Ht(p,{initCtx(k,x){let S=ct(x);return m(S,c.field,k),S},runOp(k,x){m(x,c.field,k)},hooks:w});break}case"classList":{let m=Br.classList,b=M({prev:"",curr:c.field.getState()}).on(c.field,({curr:k},x)=>({prev:k,curr:x})),w=qe({mount:v,state:Q({name:b,enabled:c.value}),onMount:(k,x)=>({leaf:x,value:k}),onState:(k,x)=>({leaf:k,value:x})});Ht(p,{initCtx(k,x){let S=ct(x);return m(S,k.name.curr,k.enabled),S},runOp(k,x){k.name.prev!==k.name.curr&&m(x,k.name.prev,0),m(x,k.name.curr,k.enabled)},hooks:w});break}case"dynamicText":Ht(p,{initCtx:(m,b)=>Er(b,m,c.childIndex),runOp(m,b){tr(b.value,m)},hooks:qe({mount:v,state:c.value,onMount:(m,b)=>({leaf:b,value:String(m)}),onState:(m,b)=>({leaf:m,value:String(b)})})});break;case"staticText":v.watch(m=>{Er(m,c.value,c.childIndex)});break;case"handler":{let m=c.handler.graphite.meta.nativeTemplate||null;v.watch(b=>{let w=null;if(m){let k=0,x=b;for(;!k&&x;)x.template===m?(k=1,w=x):x=x.parent}else w=null;ct(b).addEventListener(c.for,k=>{c.options.prevent&&k.preventDefault(),c.options.stop&&k.stopPropagation(),T({target:c.handler,params:k,page:w,scope:b.root.scope})},c.domConfig)});break}}}),o.watch(c=>{let m=c.data;if(!p.visible){let b=m.ops.visible,w=m.block;if(c.hydration){Lr(1,b);let k,x=rr(w);if(k=x?x.nextSibling:St(w).firstChild,k.nodeName==="#text"){let S=k;k=k.nextSibling,S.remove()}w.value=k,w.visible=1}fe(p,{parentBlockFragment:w,leaf:c,node:w.value,svgRoot:d.isSvgRoot?w.value:null}),T({target:v,params:c,defer:1,page:c,scope:c.root.scope}),c.hydration?m.needToCallNode&&(m.needToCallNode=0,T({target:Dt,params:{element:m.block.value,fns:p.node},page:c,defer:1,scope:c.root.scope})):U(1,b)}})},env:i});Mt(d)}function Or(){if(typeof document<"u")return{document};throw Error("your environment has no document")}function ta(e,t){let r,a,n,l,i,s;if(typeof t=="function")r=t,n=Or(),l=0;else{if(!t)throw Error("using() second argument is missing");r=t.fn,n=t.env?t.env:Or(),l=t.hydrate,a=t.onComplete,i=t.onRoot,s=t.scope}et(e,"using() first argument is missing");let g={scope:s,env:n,activeSpawns:new Set,childSpawns:{},leafOps:{}},y=e.namespaceURI,h=e.tagName.toLowerCase(),p={type:"using",childTemplates:[],childCount:0,inParentIndex:-1},d=Ae({name:"using",draft:p,isSvgRoot:h==="svg",namespace:y==="http://www.w3.org/2000/svg"?"svg":h==="foreignobject"?"foreignObject":"html",fn(f,{mount:c}){r(),c.watch(gr.using)},env:n}),u={type:"using",child:[],value:e},o=Kn({onComplete:a}),v=$t(d,{parentLeaf:Le||null,mountNode:e,svgRoot:d.isSvgRoot?e:Le?Le.svgRoot:null,leafData:{type:"using",draft:p,element:e,block:u},opGroup:Ze(o),domSubtree:Ze(o),hydration:l,root:g});if(i&&i({template:d,leaf:v}),o.onDrain&&!o.rafID){let f=o.onDrain;o.onDrain=null,f()}}function nr(e,t){let r=e.root.childSpawns[e.fullID];for(let a in r){let n=r[a];for(let l=0;l<n.length;l++)t(n[l])}}function gn(e,t){let r=a=>{let n=a.data;if(e&&n.type==="list"&&n.pendingUpdate){let l=n.pendingUpdate;n.pendingUpdate=null,T({target:a.template.api.pendingUpdate,params:l,defer:1,page:a,scope:a.root.scope})}if(e&&n.type==="route"){if(n.pendingInit){let l=n.pendingInit.value;n.pendingInit=null,T({target:a.template.api.pendingInit,params:l,defer:1,page:a,scope:a.root.scope})}else if(!n.block.visible)return}switch(n.type){case"element":U(e,n.ops.visible);break;case"route":case"list":case"list item":nr(a,r);break;default:console.log("unsupported type",n.type)}};nr(t,r)}function Gt(e){e.root.activeSpawns.delete(e.fullID),nr(e,hr)}function Wt(e){Xe(e,e.root.childSpawns[e.parent.fullID][e.template.id]),Xe(e,e.template.pages)}function hr(e){let{data:t,root:r}=e;switch(t.type){case"element":Xe(e,r.childSpawns[e.parent.fullID][e.template.id]),function a(n){r.activeSpawns.delete(n.fullID);let l=r.childSpawns[n.fullID];delete r.childSpawns[n.fullID],delete r.leafOps[n.fullID],Xe(n,n.template.pages);for(let i in l)l[i].forEach(a)}(e),U(0,t.ops.visible);break;case"list":{let a=t.records;for(let n=0;n<a.length;n++){let l=a[n];l.instance&&hr(l.instance),l.active=0}e.root.activeSpawns.delete(e.fullID),Wt(e);break}case"list item":{let a=t.block;Xe(a,a.parent.child);let n=a.left,l=a.right;n&&(n.right=l,l||a.parent.lastChild!==a||(a.parent.lastChild=n)),l&&(l.left=n),n||l||a.parent.lastChild!==a||(a.parent.lastChild=null),a.left=null,a.right=null,Gt(e),Wt(e);break}case"route":Gt(e),Wt(e);break;case"block":case"block item":case"rec":case"rec item":Gt(e)}delete r.childSpawns[e.fullID],delete r.leafOps[e.fullID]}function Xe(e,t){if(!t)return;let r=t.indexOf(e);r!==-1&&t.splice(r,1)}function ra(e,t){if(Array.isArray(t))return t.map(r=>e.map(a=>a[r]));if(typeof t=="object"&&t!==null){let r={};for(let a in t){let n=t[a];r[a]=e.map(typeof n=="function"?l=>n(l):l=>l[n])}return r}return e.map(r=>r[t])}function vt(e,t){lt(_,"list"),typeof t=="function"&&(R.unit(e)?e={source:e,fn:t}:e.fn=t);let{fn:r,key:a,source:n,fields:l=[]}=e,i=a!==void 0?typeof a=="function"?a:h=>h[a]:(h,p)=>p,s={type:"list",key:R.store(e)?{type:"index"}:{type:"key",key:e.key},childTemplates:[],childCount:0,inParentIndex:-1},{env:g,namespace:y}=_;Mt(Ae({name:"list",draft:s,isSvgRoot:0,namespace:y,fn(h,{mount:p}){let d=Ae({name:"list item",state:{id:-1,store:null},draft:s,isSvgRoot:0,namespace:y,fn({id:m,store:b},{mount:w}){r({store:b,key:m,fields:ra(b,l)});let k=$({named:"itemUpdater"});if(b.on(k,(x,S)=>S),s.itemVisible){let{onMount:x,onState:S}=qe({mount:w,state:s.itemVisible,onMount:(D,L)=>({visible:D,leaf:L}),onState:(D,L)=>({visible:L,leaf:D})});x.watch(({visible:D,leaf:L})=>{let O=L.data.block;O.visible=D,O.childInitialized=D,D&&fe(s,{parentBlockFragment:O,leaf:L})}),S.watch(({visible:D,leaf:L})=>{let O=L.data.block;O.visible=D,O.childInitialized?gn(D,L):D&&(O.childInitialized=1,fe(s,{parentBlockFragment:O,leaf:L}))})}else w.watch(gr.listItem);return{itemUpdater:k}},env:g}),u=M([]),o=n.map(m=>m),v=C({source:n,clock:p,fn:(m,b)=>({updates:m,leaf:b,hydration:b.hydration}),greedy:1}),f=$(),c=C({source:v,clock:[o,f],fn:({leaf:m},b)=>({updates:b,leaf:m,hydration:0}),greedy:1});return C({source:u,clock:[v,c],greedy:1,fn(m,{updates:b,leaf:w,hydration:k}){let x=w.data,S=w;for(;S;){if(S.data.type==="route"&&!S.data.block.visible)return void(x.pendingUpdate=b);S=S.parent}let D=x.block;Se("list update ["+n.shortName+"]");let L=Array(b.length).fill(0),O=b.map(i),se=[];for(let ce=0;ce<m.length;ce++){let ee=m[ce],be=O.indexOf(ee.key);be!==-1?(se.push(ee),L[be]=1,Jn(b[be],ee.asyncValue)):(ee.active=0,ee.instance&&hr(ee.instance),Yn(ee.asyncValue))}for(let ce=0;ce<b.length;ce++){if(L[ce])continue;let ee=b[ce],be=O[ce],At=Ze(w.root.leafOps[w.fullID].group.queue),ye={type:"LF",parent:D,child:[],childInitialized:0,visible:0,left:null,right:null},te={type:"listItem",key:be,index:be,active:1,leafData:{type:"list item",block:ye,listDraft:s},asyncValue:Xn({value:ee,group:At,onChange(xe){te.instance&&T({target:te.instance.template.api.itemUpdater,params:xe,defer:1,page:te.instance,scope:te.instance.root.scope})},onInit(xe){te.active&&(k||(te.instance=$t(d,{values:{id:be,store:xe},parentLeaf:w,mountNode:w.mountNode,svgRoot:w.svgRoot,leafData:te.leafData,opGroup:At,domSubtree:w.root.leafOps[w.fullID].domSubtree,hydration:k,root:w.root})))}})},wr=se.length;se.push(te);let xr=wr>0?se[wr-1].leafData:null;if(D.child.push(ye),xr){let xe=xr.block;ye.left=xe;let Nt=xe.right;Nt?(Nt.left=ye,ye.right=Nt):D.lastChild=ye,xe.right=ye}else D.lastChild=ye;k&&(te.instance=$t(d,{values:{id:be,store:ee},parentLeaf:w,mountNode:w.mountNode,svgRoot:w.svgRoot,leafData:te.leafData,opGroup:At,domSubtree:w.root.leafOps[w.fullID].domSubtree,hydration:k,root:w.root}))}return re("list update ["+n.shortName+"]"),se.length===0&&(D.lastChild=null),x.records=se,se},target:u}),{pendingUpdate:f}},env:g}))}function Ar({source:e,visible:t,fn:r}){lt(_,"route");let{env:a,namespace:n}=_,l=Ae({name:"route",isSvgRoot:0,namespace:n,env:a,draft:{type:"route",childTemplates:[],childCount:0,inParentIndex:-1},fn(i,{mount:s}){let g;if(R.store(t))g=Q({value:e,visible:t});else{let o=t;g=e.map(v=>({value:v,visible:o(v)}))}let y=Ae({name:"route item",isSvgRoot:0,namespace:n,env:a,draft:{type:"route",childTemplates:[],childCount:0,inParentIndex:-1},state:{store:null},fn({store:o},{mount:v}){let f=$({named:"itemUpdater"});o.on(f,(m,b)=>b),r({store:o});let c=C({source:v,clock:g,fn:(m,{visible:b,value:w})=>({leaf:m,visible:b,value:w}),greedy:1});v.watch(gr.routeItem),c.watch(({leaf:m,visible:b,value:w})=>{if(m.data.block.visible=b,b&&T({target:f,params:w,defer:1,page:m,scope:m.root.scope}),b){let k=m.parent;for(;k;){if(k.data.type==="route"&&!k.data.block.visible)return;k=k.parent}}gn(b,m)})}});Mt(y);let{onMount:h,onState:p}=qe({mount:s,state:g,onMount:({visible:o,value:v},f)=>({leaf:f,visible:o,value:v}),onState:(o,{visible:v,value:f})=>({leaf:o,visible:v,value:f})}),d=$(),u=C({source:s,clock:d,greedy:1,fn:(o,v)=>({leaf:o,value:v,visible:1})});return Je([h,p,u]).watch(({leaf:o,visible:v,value:f})=>{let c=o.data;if(c.block.visible=v,v||c.initialized||!c.pendingInit){if(v&&!c.initialized){let m=o.parent;for(;m;){if(m.data.type==="route"&&!m.data.block.visible)return void(c.pendingInit={value:f});m=m.parent}}v&&!c.initialized&&(mr({parentBlockFragment:c.block,leaf:o,actor:y,values:{store:f}}),c.initialized=1)}else c.pendingInit=null}),{pendingInit:d}}});Mt(l)}function na({source:e,cases:t,key:r}){let a;lt(_,"variant"),et(R.unit(e),"variant({source}) should be unit"),a=typeof r=="function"?r:r==null?l=>String(l):l=>String(l[r]);let n=0;for(let l in t)l!=="__"?Ar({source:e,visible:i=>a(i)===l,fn:t[l]}):n=1;if(n){let l=Object.keys(t);Ar({source:e,visible:i=>!l.includes(a(i)),fn:t.__})}}function aa(e,t){if(t.length===0)return e;let r=[e[0]];for(let a=0;a<t.length;a++)r.push(t[a],e[a+1]);return r}function he(e,...t){Array.isArray(e)?J({text:aa(e,t)}):J({text:e})}let ke;ke=typeof performance<"u"&&performance.now?()=>performance.now():typeof process<"u"&&process.hrtime?()=>{let e=process.hrtime();return(1e9*e[0]+e[1])/1e6}:()=>Date.now();let ar=new Map;const Ue=[],Nr=e=>{let t=ar.get(e);t||(t={calls:0,time:0,label:e,childTime:0},ar.set(e,t)),t.calls+=1,Ue.push({bucket:t,pendingStart:ke()})},Pr=e=>{let t=ar.get(e),r=Ue.pop().pendingStart,a=ke()-r;t.time+=a,Ue.length>0&&(Ue[Ue.length-1].bucket.childTime+=a)};let Se,re;typeof performance<"u"&&performance.mark?(Se=e=>{performance.mark("\u2604\uFE0F "+e+" start"),Nr(e)},re=e=>{Pr(e);try{performance.measure("\u2604\uFE0F "+e,"\u2604\uFE0F "+e+" start")}catch{}performance.clearMarks("\u2604\uFE0F "+e+" start"),performance.clearMeasures("\u2604\uFE0F "+e)}):(Se=e=>{Nr(e)},re=e=>{Pr(e)});let vn=typeof requestAnimationFrame<"u"?requestAnimationFrame:e=>setTimeout(e,0);const la={attr:fn,data:dn,style:un,styleVar:cn,classList:pn},ue=(e,t)=>e.includes(t);let oa={storeBase(e,t){e.plain.push(t)},storeOnMap(e,t,r,a){var n,l;r.unshift(e.loader),r.push(e.upward),a&&(ue(e.plain,a)||(ue(e.closure,a)||e.closure.push(a),l={type:"closure",of:a},(n=t).before||(n.before=[]),n.before.push(l)))},storeMap(e,t,r){ue(e.plain,t)||ue(r.seq,e.loader)||r.seq.unshift(e.loader)},storeWatch:(e,t,r)=>(e.watch.push({of:t,fn:r}),1),eventPrepend(e,t){t.seq.push(e.upward)},combineBase(e,t,r){e.plain.push(t,r)},combineField(e,t,r){ue(e.plain,t)||r.seq.unshift(e.loader)},splitBase(e,t){e.plain.push(t)},splitMatchStore(e,t,r){ue(e.plain,t)||r.seq.unshift(e.loader)},sampleSource(e,t,r,a){t.current?ue(e.plain,r)||ue(e.closure,r)||e.closure.push(r):e.plain.push(r),e.plain.push(t),ue(e.plain,a)||e.plain.push(a)},sampleTarget(e,t){t.seq.push(e.loader)},sampleSourceLoader:e=>e.loader,sampleSourceUpward:(e,t)=>t&&e.upward},ia=0,sa=0,_=null,Le=null;const tt=(e,t)=>e.reg[t.id];let pe=null;const ca=["LF","using","element","recItem","rec","block","blockItem","route"];let Dt=$({named:"onMount"});Dt.watch(({fns:e,element:t})=>{e.forEach(r=>{r(t)})});const ua=[{type:"attr",field:"value"},{type:"attr",field:"checked"},{type:"attr",field:"min"},{type:"attr",field:"max"}],Br={attr:fn,data:dn,style:un,styleVar:cn,classList:pn},ct=e=>e.data.block.value;let gr={using(e){let t=e.data;fe(t.draft,{parentBlockFragment:t.block,leaf:e})},routeItem(e){let t=e.draft,r=e.data;r.block.visible=1,fe(t,{parentBlockFragment:r.block,leaf:e})},block(e){fe(e.draft,{parentBlockFragment:e.data.block,leaf:e})},blockItem(e){mr({parentBlockFragment:e.data.block,leaf:e,actor:e.draft.itemOf})},rec(e){fe(e.draft,{parentBlockFragment:e.data.block,leaf:e})},listItem(e){let t=e.data,r=t.block;r.visible=1,r.childInitialized=1,fe(t.listDraft,{parentBlockFragment:r,leaf:e})}};const lr="#5583e5",bn="#79e555",zr=[1,35],pa=2;function da(e){let t=Date.now(),r=new Map,a=new Map;return e.forEach((n,l)=>{n.forEach((i,s)=>{fa(a,[l,s],i)})}),a.forEach((n,l)=>{r.set(l,new Map),n.forEach(([i,s],g)=>{let y=e.get(l)&&e.get(l).get(g)||0,h=i+s;y===0&&h==3?r.get(l).set(g,i>s?1:2):y!==0&&(h===2||h===3)&&r.get(l).set(g,y)})}),{fauna:r,time:Date.now()-t}}function fa(e,[t,r],a){let n=[[t-1,r-1],[t-1,r],[t-1,r+1],[t,r-1],[t,r+1],[t+1,r-1],[t+1,r],[t+1,r+1]];return e.has(t-1)||e.set(t-1,new Map),e.has(t)||e.set(t,new Map),e.has(t+1)||e.set(t+1,new Map),n.forEach(l=>{const i=e.get(l[0]);i.has(l[1])||i.set(l[1],[0,0]),a===1?i.get(l[1])[0]++:i.get(l[1])[1]++}),e}function ma(e,t){let r=Math.floor(e.clientY/t),a=Math.floor(e.clientX/t);return{row:r,col:a,shift:e.shiftKey}}function ha(e){return""}function ga(e){console.warn("TODO saveToLS")}function va(e){const[t,r]=e.split("|");return[+t,+r]}function ba(){try{return(JSON.parse(localStorage.getItem("history")||"null")||[]).map(({fauna:r,name:a})=>{let n=new Map;return r.forEach(([l,i])=>{const[s,g]=va(l);n.has(s)||n.set(s,new Map),n.get(s).set(g,i)}),{fauna:n,name:a}})}catch(e){return console.error(e),[]}}function yn(){return{width:window.visualViewport.width,height:window.visualViewport.height}}function ya(e){let t=0,r=0,a=0;return e.size===0?{col:t,row:r}:(e.forEach((n,l)=>{a+=n.size,n.forEach((i,s)=>{t+=l,r+=s})}),{col:Math.round(t/a),row:Math.round(r/a)})}function ka(e){return console.warn("TODO makeFaunaFromLexicon"),new Map}function wa(e){let t=new Map;const r="b",a="o",n="$";let l="",i=0,s=0;for(let g=0;g<e.length;g++){let y=e[g];if(y.charCodeAt(0)>=48&&y.charCodeAt(0)<=57)l+=y;else{let h=+l||1;if(y===r)s+=h;else if(y===a)for(let p=0;p<h;p++)t.has(s)||t.set(s,new Map),t.get(s).set(i,1),s++;else y===n&&(i+=h,s=0);l=""}}return t}function xa(){return{currentBp:M(null)}}const jr=yn();function $a(){const e=zr,t=M(pa),r=t.map(i=>({height:Math.ceil(jr.height/i),width:Math.ceil(jr.width/i)})),a=$(),n=$();return t.on(n,i=>{let s=i-1;return Math.max(zr[0],s)}).on(a,i=>i+1),{options:e,$cellSize:t,$fieldSize:r,plus:a,minus:n}}function Sa(){const e=M(!1),t=$();return e.on(t,(a,n)=>n),{$isOn:e,changed:t}}function Ia(e){const t=$(),r=$(),a=M(null,{updateFilter:(l,i)=>!(l&&i&&l.row===i.row&&l.col===i.col)});return a.on(r,()=>null),C({source:e,clock:t,fn:(l,i)=>ma(i,l),target:a}),{$cell:a,fieldMouseLeaved:r,fieldMouseMoved:t}}function Ca(e,t){const r=M(null),a=M(null),n=M(null),l=$(),i=$(),s=$(),g=$(),y=$(),h=$();function p(){document.addEventListener("mousedown",l),document.addEventListener("mouseup",i)}const d=e.map(o=>o!==null),u=e.map(o=>o==null);return n.on(l,()=>Date.now()),C({source:t,clock:l,filter:d,target:r}),C({source:e,clock:l,filter:d,target:a}),C({source:{currentHovered:e,initHovered:a,startTime:n},clock:i,filter:o=>!!o.initHovered&&!!o.currentHovered&&!!o.startTime,fn:({currentHovered:o,initHovered:v,startTime:f})=>({start:{col:o.col,row:o.row},finish:v,duration:Date.now()-f}),target:s}),C({source:{currentHovered:e,initFocus:r,initHovered:a},clock:e,filter:o=>!!o.initHovered&&!!o.initFocus&&!!o.currentHovered,fn:({currentHovered:o,initHovered:v,initFocus:f})=>({col:f.col+(o.col-v.col),row:f.row+(o.row-v.row)}),target:h}),Ln({source:s,match:o=>o.start.col===o.finish.col&&o.start.row===o.finish.row?"click":"dragEnd",cases:{click:g,dragEnd:y}}),r.reset(s,u),a.reset(s,u),n.reset(s,u),{focusMoved:h,initEvents:p,clicked:g}}function kn(e){var{timeout:t,start:r,stop:a,leading:n=!1,trailing:l=!1}=e,i=$({name:"tick",sid:"uo9p3s"}),s=M(!1,{name:"$isRunning",sid:"-wxesi8"}),g=Ma(t),y=s.map(f=>!f),h=$({name:"saveTimeout",sid:"as5clk"}),p=M(null,{name:"$timeoutId",sid:"-bh90bo"}).on(h,(f,c)=>c),d=$({name:"saveReject",sid:"-64swis"}),u=M(()=>{},{name:"$rejecter",sid:"eabbu7"}).on(d,(f,c)=>c),o=nt(f=>new Promise((c,m)=>{var b=setTimeout(c,f);h(b),d(m)}),{name:"timeoutFx",sid:"7lc3mj"}),v=qn({and:{source:[p,u],effect:f=>{var[c,m]=f;m(),c&&clearTimeout(c)}},or:{name:"cleanupFx",sid:"pcn5jq"}});return pt({and:[{clock:r,source:g,filter:y,target:o}],or:{sid:"-w5qmwp"}}),n&&pt({and:[{clock:r,filter:y,target:i}],or:{sid:"-vpslni"}}),C({and:[{clock:r,fn:()=>!0,target:s}],or:{sid:"-vaed34"}}),pt({and:[{clock:o.done,source:g,filter:s,target:o}],or:{sid:"-v73liy"}}),C({and:[{clock:o.done,fn:()=>{},target:i}],or:{sid:"-urpcwu"}}),a&&(l&&C({and:[{clock:a,target:i}],or:{sid:"-uanqf7"}}),s.on(a,()=>!1),C({and:[{clock:a,target:v}],or:{sid:"6lcmyy"}})),{tick:i,isRunning:s}}function Ma(e){if(R.store(e,{sid:"6p7767"}))return e;if(typeof e=="number")return M(e,{and:{name:"$timeout"},sid:"5hw6se"});throw new TypeError('timeout parameter in interval method should be number or Store. "'.concat(typeof e,'" was passed'))}function Vr(e){var{source:t,timeout:r,target:a=$({name:"target",sid:"r328r6"},{name:"target",sid:"r328r6"})}=e;if(!R.unit(t))throw new TypeError("source must be unit from effector");var n=Da(r),l=nt(s=>new Promise(g=>setTimeout(g,s)),{name:"timerFx",sid:"-pyjx8k"}),i=pt({and:[{clock:t,filter:l.pending.map(s=>!s)}],or:{name:"start",sid:"-p67kgr"}});return C({and:[{source:n,clock:i,target:l}],or:{sid:"-ievrvf"}}),C({and:[{source:t,clock:l.done,target:a}],or:{sid:"-i01buo"}}),a}function Da(e){if(R.store(e,{sid:"-hl6vqh"}))return e;if(typeof e=="number"){if(e<0||!Number.isFinite(e))throw new Error('timeout must be positive number or zero. Received: "'.concat(e,'"'));return M(e,{and:{name:"$timeout"},sid:"pu8pon"})}throw new TypeError('timeout parameter should be number or Store. "'.concat(typeof e,'" was passed'))}function _a(e,t,r){const a=M(0),n=M({prev:0,delta:0}).reset(t),l=$(),i=$(),s=Vr({source:l,timeout:100}),g=Vr({source:r,timeout:1e3}),y=kn({timeout:1e3,start:i});a.on(s,(d,u)=>u),C({source:{stepsPerSec:n,steps:e},clock:y.tick,fn:({stepsPerSec:d,steps:u})=>({prev:u,delta:u-d.prev}),target:n});const h=[];i(),p();function p(){window.requestAnimationFrame(()=>{const d=performance.now();for(;h.length>0&&h[0]<=d-1e3;)h.shift();h.push(d),p()}),l(h.length)}return{$fps:a,$stepsPerSec:n.map(d=>d.delta),$time:Kt(g.map(d=>d.time),0)}}function Ta(e,t){const r=$(),a=$(),n=$(),l=$(),i=$(),s=$(),g=M(0),y=M(50),h=$(),p=M(null),d=kn({timeout:y,start:a,stop:Je([l,n,s])});return C({clock:[d.tick,a,i],target:r}),C({source:e,clock:a,fn:u=>new Map(u),target:p}),y.on(h,(u,o)=>o).reset(s),p.on(s,()=>null),g.on(r,u=>u+1).on(n,()=>0).reset(s),{$currentStep:g,$currentSpeed:y,$isRunning:d.isRunning,$startFauna:p,start:a,stop:n,pause:l,changeSpeed:h,gameTick:r,reset:s,oneStep:i}}const E=$a(),or=Sa(),_t=Ia(E.$cellSize),wn=xa(),W=M(new Map),qa=M([]),Rt=nt(e=>da(e)),me=Ta(W,Rt.doneData),Qt=_a(me.$currentStep,me.reset,Rt.doneData),Be=M({col:0,row:0}),La=$(),vr=$(),Ye=M(1),bt=$();Ye.on(bt,(e,t)=>t);const br=$(),yr=Ca(_t.$cell,Be),Ra=Q(or.$isOn,E.$cellSize,(e,t)=>e?"elsa":t),kr=Q(E.$fieldSize,W,Be,({width:e,height:t},r,a)=>{const n=[];return r.forEach((l,i)=>{l.forEach((s,g)=>{const y=i+a.col,h=g+a.row;y>=0&&y<e&&h>=0&&h<t&&n.push({col:y,row:h,val:s})})}),n}),Ur=Q(kr,W,(e,t)=>({fieldCellsAmount:e.length,faunaCellsAmount:t.size})),Fa=Q(E.$fieldSize,qa,Be,({width:e,height:t},r,a)=>{const n=[];return r.forEach(({col:l,row:i,label:s})=>{const g=l+a.col,y=i+a.row;g>=0&&g<e&&y>=0&&y<t&&n.push({col:g,row:y,label:s})}),n}),Ea=Q(kr,E.$cellSize,(e,t)=>e.map(({val:r,col:a,row:n})=>({val:r,y:n*t,x:a*t}))),Oa=Q(_t.$cell,E.$cellSize,wn.currentBp,(e,t,r)=>e?[{y:e.row*t+"px",x:e.col*t+"px"}]:[]),Aa=Q(Fa,E.$cellSize,(e,t)=>e.map(({row:r,col:a,label:n})=>({y:r*t+"px",x:a*t+"px",label:n})));C({source:W,clock:me.gameTick,target:Rt});W.on(br,()=>new Map).on(Rt.doneData,(e,t)=>t.fauna);Be.on(yr.focusMoved,(e,t)=>t).reset(La);C({source:{fauna:W,fieldSize:E.$fieldSize},clock:vr,fn:({fauna:e,fieldSize:t})=>{const r=ya(e);return{col:Math.round(t.width/2-r.col),row:Math.round(t.height/2-r.row)}},target:Be});C({source:{fauna:W,color:Ye,focus:Be,currentBp:wn.currentBp},clock:yr.clicked,fn:({color:e,fauna:t,focus:r,currentBp:a},{start:{col:n,row:l}})=>{const i=new Map(t);if(!a){const s=n-r.col,g=l-r.row;i.has(s)||i.set(s,new Map),i.get(s).get(g)===e?i.get(s).delete(g):i.get(s).set(g,e)}return i},target:W});function Na(e){I("label",{text:e.label,fn:()=>{I("input",{attr:{type:"checkbox",checked:e.value},handler:{change:e.onChange.prepend(t=>t.target.checked)}})}})}const Pa="_roundBox_hgest_1",Ba="_history_hgest_9",za="_colorBtn_hgest_15",ja="_currentColor_hgest_22",Va="_arrowBtn_hgest_26",Ua="_whiteBox_hgest_54",K={roundBox:Pa,history:Ba,colorBtn:za,currentColor:ja,arrowBtn:Va,whiteBox:Ua};function Ha(){Na({label:"Elsa",value:or.$isOn,onChange:or.changed}),I("div",{style:{display:"flex",gap:"8px"},fn(){I("button",{classList:{[K.colorBtn]:!0,[K.currentColor]:Ye.map(e=>e===1)},style:{backgroundColor:lr},handler:{click:bt.prepend(()=>1)}}),I("button",{classList:{[K.colorBtn]:!0,[K.currentColor]:Ye.map(e=>e===2)},style:{backgroundColor:bn},handler:{click:bt.prepend(()=>2)}}),I("button",{classList:{[K.colorBtn]:!0,[K.currentColor]:Ye.map(e=>!e)},handler:{click:bt.prepend(()=>0)}})}})}const Ga=""+new URL("heart-line-icon.ca853df2.svg",import.meta.url).href,Wa="_field_oqxfw_1",Qa="_cell_oqxfw_13",Ka="_on1_oqxfw_21",Xa="_on2_oqxfw_24",Ya="_hoveredCell_oqxfw_28",Ja="_heartMode_oqxfw_32",Za="_label_oqxfw_40",ut={field:Wa,cell:Qa,on1:Ka,on2:Xa,hoveredCell:Ya,heartMode:Ja,label:Za};function el(e){const t=`
<svg viewBox='0 0 ${e} ${e}' xmlns='http://www.w3.org/2000/svg'>
<line x1='0' y1='0' x2='0' y2='${e}' stroke='#b4b6b8' />
<line x1='0' y1='0' x2='${e}' y2='0' stroke='#b4b6b8' />
</svg>`;return"data:image/svg+xml;base64,"+btoa(t.replace(/\n/g,""))}function tl(){I("div",{classList:[ut.field],styleVar:{cellSize:E.$cellSize.map(e=>e+"px"),color1:lr,color2:bn},style:{backgroundImage:Ra.map(e=>`url("${e==="elsa"?Ga:el(e)}")`),backgroundSize:E.$cellSize.map(e=>`${e}px ${e}px`)},handler:{mousemove:_t.fieldMouseMoved,mouseleave:_t.fieldMouseLeaved},fn(){const e=yn();I("svg",{attr:{width:e.width,height:e.height,viewBox:`0 0 ${e.width} ${e.height}`,xmlns:"http://www.w3.org/2000/svg"},fn:()=>{vt(Ea,({store:t})=>{I("rect",{attr:{x:t.map(r=>r.x),y:t.map(r=>r.y),width:E.$cellSize,height:E.$cellSize,fill:lr}})})}}),vt(Oa,({store:t})=>{I("div",{style:{left:t.map(r=>r?r.x:"-100px"),top:t.map(r=>r?r.y:"-100px")},classList:[ut.cell,ut.hoveredCell]})}),vt(Aa,({store:t})=>{I("div",{style:{left:t.map(r=>r.x),top:t.map(r=>r.y)},text:t.map(r=>r.label),classList:[ut.label]})})}})}const Ft=M(ba()||[]),rt=M(new Set),xn=$(),$n=$(),Sn=$(),In=$(),Et=$(),Cn=$();rt.on($n,(e,t)=>{let r=new Set(e);return r.add(t),r}).on(Sn,(e,t)=>{let r=new Set(e);return r.delete(t),r});Ft.on(xn,(e,t)=>{let a=(e[e.length-1]?.name||"0").match(/(\d+)/),n=a&&+a[1]||0;return[...e,{fauna:t,name:`save #${n+1}`}]}).on(In,(e,t)=>e.filter(r=>!t.includes(r.name)));C({source:Ft,target:nt(e=>{ga()})});window.addEventListener("beforeunload",()=>{In([...rt.getState()])});const rl=Q(Ft,rt,(e,t)=>e.map(r=>({...r,toRemove:t.has(r.name)})));function nl(){I("div",{classList:[K.history],fn(){I("p",{text:"History: ",style:{margin:"0"}}),vt(rl,({store:e})=>{const t=$(),r=$();C({source:{historyEl:e,itemsToRemove:rt},clock:t,filter:({historyEl:a,itemsToRemove:n})=>n.has(a.name),fn:({historyEl:a})=>a.name,target:Sn}),C({source:{historyEl:e,itemsToRemove:rt},clock:t,filter:({historyEl:a,itemsToRemove:n})=>!n.has(a.name),fn:({historyEl:a})=>a.name,target:Et}),C({clock:r,source:e.map(a=>a.name),target:$n}),I("div",()=>{I("button",()=>{J({handler:{click:t}}),he`${e.map(a=>a.toRemove?`restore (${a.name})`:a.name)}`}),I("button",()=>{J({handler:{click:r}}),he`x`})})}),I("button",{style:{marginLeft:"auto"},text:"Save",handler:{click:Cn}})}})}function al(e){const[t,r]=e.range;I("div",()=>{J({classList:e.classList}),I("button",{handler:{click:e.onMinusClicked},text:"-",attr:{disabled:e.value.map(a=>a<=t)}}),he` ${e.value} `,I("button",{handler:{click:e.onPlusClicked},text:"+",attr:{disabled:e.value.map(a=>a>=r)}})})}function ll(){yr.initEvents(),I("button",{classList:[K.arrowBtn],handler:{click:vr},text:"to center"}),I("div",()=>{J({style:{position:"absolute",right:"150px",bottom:"20px",zIndex:1}}),al({value:E.$cellSize,onPlusClicked:E.plus,onMinusClicked:E.minus,range:E.options,classList:[K.roundBox]})})}function ol(){I("div",()=>{J({classList:[K.whiteBox],style:{position:"absolute",display:"grid",bottom:"10px",left:"130px"}}),I("span",()=>{he`FPS: ${Qt.$fps}`}),I("span",()=>{he`STEPS PER SEC: ${Qt.$stepsPerSec}`}),I("span",()=>{he`CALC TIME: ${Qt.$time} msec`})})}function il(){I("p",()=>{J({classList:[K.whiteBox],style:{position:"absolute",display:"flex",gap:"8px"}}),I("button",{text:"Step",handler:{click:me.oneStep}}),he` timer: `,na({source:me.$isRunning.map(e=>({show:e?"1":"0"})),key:"show",cases:{1:()=>{I("button",{text:"Stop",style:{color:"#f8f8f8",backgroundColor:"#de4040",border:"0"},handler:{click:me.pause}})},0:()=>{I("button",{text:"Start",style:{color:"#f8f8f8",backgroundColor:"#50c40e",border:"0"},handler:{click:me.start}})}}}),he`steps: ${me.$currentStep}`,he` (population: ${Ur.map(({fieldCellsAmount:e})=>e)} / ${Ur.map(({faunaCellsAmount:e})=>e)}) `})}const ot=M(""),Mn=$(),Dn=$(),Ot=$();ot.on(Mn,(e,t)=>t);C({source:W,clock:Cn,target:xn});C({source:Ft,clock:Et,fn:(e,t)=>{const r=e.find(n=>n.name===t).fauna;return new Map(r)},target:W});C({source:ot,clock:Ot,fn:ka,target:W});C({clock:[Et,br,Dn,Ot],target:me.reset});C({clock:Et,target:vr});C({source:kr,clock:Dn,fn:ha,target:ot});C({source:ot,clock:Ot,fn:wa,target:W});function sl(){I("div",()=>{ll(),tl(),I("div",{style:{position:"absolute",width:"100%",backgroundColor:"rgba(255,255,255, 0.9)"},fn(){I("h1",{text:"Game of Life"}),nl(),Ha(),il()}}),ol(),I("button",{text:"Reset",style:{position:"absolute",bottom:"20px",left:"20px"},handler:{click:br}}),I("div",()=>{J({style:{position:"absolute",bottom:"50px",left:"20px"}}),I("button",{text:"Import",handler:{click:Ot}}),I("br",{}),I("textarea",{style:{fontSize:"8px",width:"100%",height:"100px",lineHeight:1},text:ot,handler:{change:Mn.prepend(e=>e.target.value)}})})})}ta(document.querySelector("#app"),sl);
