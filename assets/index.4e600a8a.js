const In=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerpolicy&&(l.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?l.credentials="include":n.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(n){if(n.ep)return;n.ep=!0;const l=r(n);fetch(n.href,l)}};In();function Ie(e,t){for(let r in e)t(e[r],r)}function B(e,t){e.forEach(t)}function N(e,t){if(!e)throw Error(t)}function kr(e,t){E={parent:E,value:e,template:L(e,"template")||Pe(),sidRoot:L(e,"sidRoot")||E&&E.sidRoot};try{return t()}finally{E=ae(E)}}function ge({node:e=[],from:t,source:r,parent:a=t||r,to:n,target:l,child:i=n||l,scope:c={},meta:y={},family:k={type:"regular"},regional:g}={}){let p=Ue(a),f=Ue(k.links),d=Ue(k.owners),o=[];B(e,u=>u&&ee(o,u));let h={id:Tn(),seq:o,next:Ue(i),meta:y,scope:c,family:{type:k.type||"crosslink",links:f,owners:d}};return B(f,u=>ee(Dt(u),h)),B(d,u=>ee(qt(u),h)),B(p,u=>ee(u.next,h)),g&&E&&Oe(Ge(E),[h]),h}function q(e,t,r){let a=re,n=null,l=R;if(e.target&&(t=e.params,r=e.defer,a="page"in e?e.page:a,e.stack&&(n=e.stack),l=de(e)||l,e=e.target),l&&R&&l!==R&&(R=null),Array.isArray(e))for(let d=0;d<e.length;d++)xe("pure",a,G(e[d]),n,t[d],l);else xe("pure",a,G(e),n,t,l);if(r&&!it)return;let i,c,y,k,g,p,f={isRoot:it,currentPage:re,scope:R,isWatch:pt,isPure:dt};it=0;e:for(;k=Fn();){let{idx:d,stack:o,type:h}=k;y=o.node,re=g=o.page,R=de(o),g?p=g.reg:R&&(p=R.reg);let u=!!g,s=!!R,m={fail:0,scope:y.scope};i=c=0;for(let v=d;v<y.seq.length&&!i;v++){let w=y.seq[v];if(w.order){let{priority:b,barrierID:x}=w.order,S=x?g?`${g.fullID}_${x}`:x:0;if(v!==d||h!==b){x?Bt.has(S)||(Bt.add(S),Qt(v,o,b,x)):Qt(v,o,b);continue e}x&&Bt.delete(S)}switch(w.type){case"mov":{let x,S=w.data;switch(S.from){case Me:x=Ge(o);break;case"a":case"b":x=o[S.from];break;case"value":x=S.store;break;case"store":if(p&&!p[S.store.id])if(u){let _=Jr(g,S.store.id);o.page=g=_,_?p=_.reg:s?(Ne(R,S.store,0,1,S.softRead),p=R.reg):p=void 0}else s&&Ne(R,S.store,0,1,S.softRead);x=We(p&&p[S.store.id]||S.store)}switch(S.to){case Me:o.value=x;break;case"a":case"b":o[S.to]=x;break;case"store":En(g,R,y,S.target).current=x}break}case"compute":let b=w.data;if(b.fn){pt=L(y,"op")==="watch",dt=b.pure;let x=b.safe?(0,b.fn)(Ge(o),m.scope,o):Bn(m,b.fn,o);b.filter?c=!x:o.value=x,pt=f.isWatch,dt=f.isPure}}i=m.fail||c}if(!i){let v=Ge(o);B(y.next,b=>{xe("child",g,b,o,v,de(o))});let w=de(o);if(w){L(y,"needFxCounter")&&xe("child",g,w.fxCount,o,v,w),L(y,"storeChange")&&xe("child",g,w.storeChange,o,v,w),L(y,"warnSerialize")&&xe("child",g,w.warnSerializeNode,o,v,w);let b=w.additionalLinks[y.id];b&&B(b,x=>{xe("child",g,x,o,v,w)})}}}it=f.isRoot,re=f.currentPage,R=de(f)}function jr(e,t="combine"){let r=t+"(",a="",n=0;return Ie(e,l=>{n<25&&(l!=null&&(r+=a,r+=me(l)?ar(l).fullName:l.toString()),n+=1,a=", ")}),r+")"}function Vr(e,t){let r,a,n=e;if(t){let l=ar(t);e.length===0?(r=l.path,a=l.fullName):(r=l.path.concat([e]),a=l.fullName.length===0?e:l.fullName+"/"+e)}else r=e.length===0?[]:[e],a=e;return{shortName:n,fullName:a,path:r}}function Be(e,t){let r=t?e:e[0];Qr(r);let a=r.or,n=r.and;if(n){let l=t?n:n[0];if(Y(l)&&"and"in l){let i=Be(n,t);e=i[0],a={...a,...i[1]}}else e=n}return[e,a]}function P(e,...t){let r=Pe();if(r){let a=r.handlers[e];if(a)return a(r,...t)}}function $(e,t){let r=(n,...l)=>(_e(!L(r,"derived"),"call of derived event","createEvent"),_e(!dt,"unit call from pure function","operators like sample"),re?((i,c,y,k)=>{let g=re,p=null;if(c)for(p=re;p&&p.template!==c;)p=ae(p);Cr(p);let f=i.create(y,k);return Cr(g),f})(r,a,n,l):r.create(n,l)),a=Pe();return Object.assign(r,{graphite:ge({meta:tn("event",r,e,t),regional:1}),create:n=>(q({target:r,params:n,scope:R}),n),watch:n=>Zr(r,n),map:n=>Pt(r,Ae,n,[te()]),filter:n=>Pt(r,"filter",n.fn?n:n.fn,[te(or,1)]),filterMap:n=>Pt(r,"filterMap",n,[te(),X(l=>!V(l),1)]),prepend(n){let l=$("* \u2192 "+r.shortName,{parent:ae(r)});return P("eventPrepend",G(l)),ke(l,r,[te()],"prepend",n),en(r,l),l}})}function C(e,t){let r=De(e),a=$({named:"updates",derived:1});P("storeBase",r);let n=r.id,l={subscribers:new Map,updates:a,defaultState:e,stateRef:r,getState(){let p,f=r;if(re){let d=re;for(;d&&!d.reg[n];)d=ae(d);d&&(p=d)}return!p&&R&&(Ne(R,r,1),p=R),p&&(f=p.reg[n]),We(f)},setState:p=>q({target:l,params:p,defer:1,scope:R}),reset:(...p)=>(B(p,f=>l.on(f,()=>l.defaultState)),l),on:(p,f)=>(bt(p,".on","first argument"),_e(!L(l,"derived"),".on in derived store","createStore"),B(Array.isArray(p)?p:[p],d=>{l.off(d),ut(l).set(d,Kr(_r(d,l,"on",An,f)))}),l),off(p){let f=ut(l).get(p);return f&&(f(),ut(l).delete(p)),l},map(p,f){let d,o;Y(p)&&(d=p,p=p.fn),_e(V(f),"second argument of store.map","updateFilter");let h=l.getState();Pe()?o=null:V(h)||(o=p(h,f));let u=C(o,{name:`${l.shortName} \u2192 *`,derived:1,and:d}),s=_r(l,u,Ae,Wt,p);return yt(z(u),{type:Ae,fn:p,from:r}),z(u).noInit=1,P("storeMap",r,s),u},watch(p,f){if(!f||!me(p)){let d=Zr(l,p);return P("storeWatch",r,p)||p(l.getState()),d}return N(H(f),"second argument should be a function"),p.watch(d=>f(l.getState(),d))}},i=tn("store",l,t),c=l.defaultConfig.updateFilter;l.graphite=ge({scope:{state:r,fn:c},node:[X((p,f,d)=>(d.scope&&!d.scope.reg[r.id]&&(d.b=1),p)),ne(r),X((p,f,{a:d,b:o})=>!V(p)&&(p!==d||o),1),c&&te(Wt,1),Q({from:Me,target:r})],child:a,meta:i,regional:1});let y=L(l,"derived"),k=L(l,"serialize")==="ignore",g=L(l,"sid");return g&&(k||Ce(l,"storeChange",1),r.sid=g),g||k||y||Ce(l,"warnSerialize",1),N(y||!V(e),"current state can't be undefined, use null instead"),Oe(l,[a]),l}function W(...e){let t,r,a;[e,a]=Be(e);let n,l,i,c=e[e.length-1];if(H(c)?(r=e.slice(0,-1),t=c):r=e,r.length===1){let y=r[0];j(y)||(n=y,l=1)}if(!l&&(n=r,t)){i=1;let y=t;t=k=>y(...k)}return N(Y(n),"shape should be an object"),zn(Array.isArray(n),!i,n,a,t)}function Cn(){let e={};return e.req=new Promise((t,r)=>{e.rs=t,e.rj=r}),e.req.catch(()=>{}),e}function nr(e,t){let r=$(H(e)?{handler:e}:e,t),a=G(r);Ce(a,"op",r.kind="effect"),r.use=f=>(N(H(f),".use argument should be a function"),k.scope.handler=f,r),r.use.getCurrent=()=>k.scope.handler;let n=r.finally=$({named:"finally",derived:1}),l=r.done=n.filterMap({named:"done",fn({status:f,params:d,result:o}){if(f==="done")return{params:d,result:o}}}),i=r.fail=n.filterMap({named:"fail",fn({status:f,params:d,error:o}){if(f==="fail")return{params:d,error:o}}}),c=r.doneData=l.map({named:"doneData",fn:({result:f})=>f}),y=r.failData=i.map({named:"failData",fn:({error:f})=>f}),k=ge({scope:{handlerId:L(a,"sid"),handler:r.defaultConfig.handler||(()=>N(0,`no handler used in ${r.getType()}`))},node:[X((f,d,o)=>{let h=d,u=h.handler;if(de(o)){let s=de(o).handlers[h.handlerId];s&&(u=s)}return f.handler=u,f},0,1),X(({params:f,req:d,handler:o,args:h=[f]},u,s)=>{let m=kt(f,d,1,n,s),v=kt(f,d,0,n,s),[w,b]=rn(o,v,h);w&&(Y(b)&&H(b.then)?b.then(m,v):m(b))},0,1)],meta:{op:"fx",fx:"runner"}});a.scope.runner=k,ee(a.seq,X((f,{runner:d},o)=>{let h=ae(o)?{params:f,req:{rs(u){},rj(u){}}}:f;return q({target:d,params:h,defer:1,scope:de(o)}),h.params},0,1)),r.create=f=>{let d=Cn(),o={params:f,req:d};if(R){if(!pt){let h=R;d.req.finally(()=>{Nn(h)}).catch(()=>{})}q({target:r,params:o,scope:R})}else q(r,o);return d.req};let g=r.inFlight=C(0,{serialize:"ignore"}).on(r,f=>f+1).on(n,f=>f-1).map({fn:f=>f,named:"inFlight"});Ce(n,"needFxCounter","dec"),Ce(r,"needFxCounter",1);let p=r.pending=g.map({fn:f=>f>0,named:"pending"});return Oe(r,[n,l,i,c,y,p,g]),r}function Mn(e){let t;[e,t]=Be(e,1);let{source:r,effect:a,mapParams:n}=e,l=nr(e,t);Ce(l,"attached",1);let i,{runner:c}=G(l).scope,y=X((g,p,f)=>{let d,{params:o,req:h,handler:u}=g,s=l.finally,m=kt(o,h,0,s,f),v=f.a,w=vt(u),b=1;if(n?[b,d]=rn(n,m,[o,v]):d=r&&w?v:o,b){if(!w)return g.args=[v,d],1;q({target:u,params:{params:d,req:{rs:kt(o,h,1,s,f),rj:m}},page:f.page,defer:1})}},1,1);if(r){let g;j(r)?(g=r,Oe(g,[l])):(g=W(r),Oe(l,[g])),i=[ne(z(g)),y]}else i=[y];c.seq.splice(1,0,...i),l.use(a);let k=ae(a);return k&&(Object.assign(ar(l),Vr(l.shortName,k)),l.defaultConfig.parent=k),en(a,l,"effect"),l}function Ze(e,t){bt(e,"merge","first argument");let r=$({name:jr(e,"merge"),derived:1,and:t});return ke(e,r,[],"merge"),r}function Ur(e,t){let r=0;return B(Vn,a=>{a in e&&(N(e[a]!=null,nn(t,a)),r=1)}),r}function M(...e){let t,r,a,n,[[l,i,c],y]=Be(e),k=1;return V(i)&&Y(l)&&Ur(l,"sample")&&(i=l.clock,c=l.fn,k=!l.greedy,n=l.filter,t=l.target,r=l.name,a=l.sid,l=l.source),ur("sample",i,l,n,t,c,r,y,k,1,0,a)}function Nt(...e){let[[t,r],a]=Be(e);return r||(r=t,t=r.source),Ur(r,"guard"),ur("guard",r.clock,t,r.filter,r.target,null,r.name,a,!r.greedy,0,1)}function wr(e,t,r){if(j(e))return _e(0,"restore($store)"),e;if(Hr(e)||vt(e)){let n=ae(e),l=C(t,{parent:n,name:e.shortName,and:r});return ke(vt(e)?e.doneData:e,l),n&&n.hooks.store(l),l}let a=Array.isArray(e)?[]:{};return Ie(e,(n,l)=>a[l]=j(n)?n:C(n,{name:l})),a}function _n(...e){let t,r,a="split",[[n,l],i]=Be(e),c=!l;c&&(t=n.cases,l=n.match,r=n.clock,n=n.source);let y=j(l),k=!me(l)&&H(l),g=!y&&!k&&Y(l);t||(t={}),c?Ie(t,(h,u)=>Xr(a,h,`cases.${u}`)):(N(g,"match should be an object"),Ie(l,(h,u)=>t[u]=$({derived:1,and:i})),t.__=$({derived:1,and:i}));let p,f=new Set([].concat(n,r||[],Object.values(t))),d=Object.keys(y||k?t:l);if(y||k)y&&f.add(l),p=[y&&ne(z(l),0,1),Fe({safe:y,filter:1,pure:!y,fn(h,u,s){let m=String(y?s.a:l(h));jt(u,xr(d,m)?m:"__",h,s)}})];else if(g){let h=De({});h.type="shape";let u,s=[];Ie(l,(m,v)=>{if(me(m)){u=1,ee(s,v),f.add(m);let w=ke(m,[],[ne(h),X((b,x,{a:S})=>S[v]=b)]);if(j(m)){h.current[v]=m.getState();let b=z(m);yt(h,{from:b,field:v,type:"field"}),P("splitMatchStore",b,w)}}}),u&&P("splitBase",h),p=[u&&ne(h,0,1),te((m,v,w)=>{for(let b=0;b<d.length;b++){let x=d[b];if(xr(s,x)?w.a[x]:l[x](m))return void jt(v,x,m,w)}jt(v,"__",m,w)},1)]}else N(0,"expect match to be unit, function or object");let o=ge({meta:{op:a},parent:r?[]:n,scope:t,node:p,family:{owners:Array.from(f)},regional:1});if(r&&ur(a,r,n,null,o,null,a,i,0,0,0),!c)return t}let Dn=typeof Symbol<"u"&&Symbol.observable||"@@observable",Ae="map",Me="stack",me=e=>(H(e)||Y(e))&&"kind"in e;const at=e=>t=>me(t)&&t.kind===e;let j=at("store"),Hr=at("event"),vt=at("effect"),Gr=at("domain"),qn=at("scope");var O={__proto__:null,unit:me,store:j,event:Hr,effect:vt,domain:Gr,scope:qn};let xr=(e,t)=>e.includes(t),Et=(e,t)=>{let r=e.indexOf(t);r!==-1&&e.splice(r,1)},ee=(e,t)=>e.push(t),_e=(e,t,r)=>!e&&console.error(`${t} is deprecated${r?`, use ${r} instead`:""}`),G=e=>e.graphite||e,Dt=e=>e.family.owners,qt=e=>e.family.links,z=e=>e.stateRef,Ge=e=>e.value,ut=e=>e.subscribers,ae=e=>e.parent,de=e=>e.scope,L=(e,t)=>G(e).meta[t],Ce=(e,t,r)=>G(e).meta[t]=r,ar=e=>e.compositeName;const lr=()=>{let e=0;return()=>""+ ++e};let Rn=lr(),Wr=lr(),Tn=lr(),E=null,Pe=()=>E&&E.template,Ln=e=>(e&&E&&E.sidRoot&&(e=`${E.sidRoot}|${e}`),e),Oe=(e,t)=>{let r=G(e);B(t,a=>{let n=G(a);r.family.type!=="domain"&&(n.family.type="crosslink"),ee(Dt(n),r),ee(qt(r),n)})},Ue=(e=[])=>(Array.isArray(e)?e:[e]).flat().map(G),Y=e=>typeof e=="object"&&e!==null,H=e=>typeof e=="function",V=e=>e===void 0,Qr=e=>N(Y(e)||H(e),"expect first argument be an object");const $r=(e,t,r,a)=>N(!(!Y(e)&&!H(e)||!("family"in e)&&!("graphite"in e)),`${t}: expect ${r} to be a unit (store, event or effect)${a}`);let bt=(e,t,r)=>{Array.isArray(e)?B(e,(a,n)=>$r(a,t,`${n} item of ${r}`,"")):$r(e,t,r," or array of units")},Xr=(e,t,r="target")=>B(Ue(t),a=>_e(!L(a,"derived"),`${e}: derived unit in "${r}"`,"createEvent/createStore")),Wt=(e,{fn:t},{a:r})=>t(e,r),An=(e,{fn:t},{a:r})=>t(r,e),or=(e,{fn:t})=>t(e);const Yr=(e,t,r,a)=>{let n={id:Wr(),type:e,data:t};return r&&(n.order={priority:r},a&&(n.order.barrierID=++On)),n};let On=0,Q=({from:e="store",store:t,target:r,to:a=r?"store":Me,batch:n,priority:l})=>Yr("mov",{from:e,store:t,to:a,target:r},l,n),Fe=({fn:e,batch:t,priority:r,safe:a=0,filter:n=0,pure:l=0})=>Yr("compute",{fn:e,safe:a,filter:n,pure:l},r,t),ir=({fn:e})=>Fe({fn:e,priority:"effect"}),X=(e,t,r)=>Fe({fn:e,safe:1,filter:t,priority:r&&"effect"}),ne=(e,t,r)=>Q({store:e,to:t?Me:"a",priority:r&&"sampler",batch:1}),te=(e=or,t)=>Fe({fn:e,pure:1,filter:t}),Sr={mov:Q,compute:Fe,filter:({fn:e,pure:t})=>Fe({fn:e,filter:1,pure:t}),run:ir},De=e=>({id:Wr(),current:e}),We=({current:e})=>e,yt=(e,t)=>{e.before||(e.before=[]),ee(e.before,t)},qe=null;const sr=(e,t)=>{if(!e)return t;if(!t)return e;let r;return(e.v.type===t.v.type&&e.v.id>t.v.id||Xt(e.v.type)>Xt(t.v.type))&&(r=e,e=t,t=r),r=sr(e.r,t),e.r=e.l,e.l=r,e},cr=[];let Ir=0;for(;Ir<6;)ee(cr,{first:null,last:null,size:0}),Ir+=1;const Fn=()=>{for(let e=0;e<6;e++){let t=cr[e];if(t.size>0){if(e===3||e===4){t.size-=1;let a=qe.v;return qe=sr(qe.l,qe.r),a}t.size===1&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},xe=(e,t,r,a,n,l)=>Qt(0,{a:null,b:null,node:r,parent:a,value:n,page:t,scope:l},e),Qt=(e,t,r,a=0)=>{let n=Xt(r),l=cr[n],i={v:{idx:e,stack:t,type:r,id:a},l:null,r:null};n===3||n===4?qe=sr(qe,i):(l.size===0?l.first=i:l.last.r=i,l.last=i),l.size+=1},Xt=e=>{switch(e){case"child":return 0;case"pure":return 1;case"read":return 2;case"barrier":return 3;case"sampler":return 4;case"effect":return 5;default:return-1}},Bt=new Set;let R,it=1,pt=0,dt=0,re=null,Nn=e=>{R=e},Cr=e=>{re=e};const Jr=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=ae(e);if(e)return e}return null};let En=(e,t,r,a,n)=>{let l=Jr(e,a.id);return l?l.reg[a.id]:t?(Ne(t,a,n),t.reg[a.id]):a},Ne=(e,t,r,a,n)=>{let l=e.reg,i=t.sid;if(l[t.id])return;let c={id:t.id,current:t.current};if(i&&i in e.sidValuesMap&&!(i in e.sidIdMap))c.current=e.sidValuesMap[i];else if(t.before&&!n){let y=0,k=r||!t.noInit||a;B(t.before,g=>{switch(g.type){case Ae:{let p=g.from;if(p||g.fn){p&&Ne(e,p,r,a);let f=p&&l[p.id].current;k&&(c.current=g.fn?g.fn(f):f)}break}case"field":y||(y=1,c.current=Array.isArray(c.current)?[...c.current]:{...c.current}),Ne(e,g.from,r,a),k&&(c.current[g.field]=l[l[g.from.id].id].current)}})}i&&(e.sidIdMap[i]=t.id),l[t.id]=c};const Bn=(e,t,r)=>{try{return t(Ge(r),e.scope,r)}catch(a){console.error(a),e.fail=1}};let Yt=(e,t={})=>(Y(e)&&(Yt(e.or,t),Ie(e,(r,a)=>{V(r)||a==="or"||a==="and"||(t[a]=r)}),Yt(e.and,t)),t);const Mr=(e,t)=>{Et(e.next,t),Et(Dt(e),t),Et(qt(e),t)},Jt=(e,t,r)=>{let a;e.next.length=0,e.seq.length=0,e.scope=null;let n=qt(e);for(;a=n.pop();)Mr(a,e),(t||r&&L(e,"op")!=="sample"||a.family.type==="crosslink")&&Jt(a,t,L(a,"op")!=="on"&&r);for(n=Dt(e);a=n.pop();)Mr(a,e),r&&a.family.type==="crosslink"&&Jt(a,t,L(a,"op")!=="on"&&r)},je=e=>e.clear();let Pn=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),j(e))je(ut(e));else if(Gr(e)){r=1;let a=e.history;je(a.events),je(a.effects),je(a.stores),je(a.domains)}Jt(G(e),!!t,r)},Kr=e=>{let t=()=>Pn(e);return t.unsubscribe=t,t},ke=(e,t,r,a,n)=>ge({node:r,parent:e,child:t,scope:{fn:n},meta:{op:a},family:{owners:[e,t],links:t},regional:1}),Zr=(e,t)=>(N(H(t),".watch argument should be a function"),Kr(ge({scope:{fn:t},node:[ir({fn:or})],parent:e,meta:{op:"watch"},family:{owners:e},regional:1}))),en=(e,t,r="event")=>{ae(e)&&ae(e).hooks[r](t)},tn=(e,t,r,a)=>{let n=e==="domain",l=Rn(),i=Yt({or:a,and:typeof r=="string"?{name:r}:r}),{parent:c=null,sid:y=null,named:k=null}=i,g=k||i.name||(n?"":l),p=Vr(g,c),f={op:t.kind=e,name:t.shortName=g,sid:t.sid=Ln(y),named:k,unitId:t.id=l,serialize:i.serialize,derived:i.derived,config:i};if(t.parent=c,t.compositeName=p,t.defaultConfig=i,t.thru=d=>(_e(0,"thru","js pipe"),d(t)),t.getType=()=>p.fullName,!n){t.subscribe=o=>(Qr(o),t.watch(H(o)?o:h=>o.next&&o.next(h))),t[Dn]=()=>t;let d=Pe();d&&(f.nativeTemplate=d)}return f};const Pt=(e,t,r,a)=>{let n;Y(r)&&(n=r,r=r.fn);let l=$({name:`${e.shortName} \u2192 *`,derived:1,and:n});return ke(e,l,a,t,r),l},_r=(e,t,r,a,n)=>{let l=z(t),i=Q({store:l,to:"a",priority:"read"});r===Ae&&(i.data.softRead=1);let c=[i,te(a)];return P("storeOnMap",l,c,j(e)&&z(e)),ke(e,t,c,r,n)},zn=(e,t,r,a,n)=>{let l=e?o=>o.slice():o=>({...o}),i=e?[]:{},c=l(i),y=De(c),k=De(1);y.type=e?"list":"shape",y.noInit=1,P("combineBase",y,k);let g=C(c,{name:jr(r),derived:1,and:a}),p=z(g);p.noInit=1,Ce(g,"isCombine",1);let f=ne(y);f.order={priority:"barrier"};let d=[X((o,h,u)=>(u.scope&&!u.scope.reg[y.id]&&(u.c=1),o)),f,Q({store:k,to:"b"}),X((o,{key:h},u)=>{if(u.c||o!==u.a[h])return t&&u.b&&(u.a=l(u.a)),u.a[h]=o,1},1),Q({from:"a",target:y}),Q({from:"value",store:0,target:k}),Q({from:"value",store:1,target:k,priority:"barrier",batch:1}),ne(y,1),n&&te()];return Ie(r,(o,h)=>{if(!j(o))return N(!me(o)&&!V(o),`combine expects a store in a field ${h}`),void(c[h]=i[h]=o);i[h]=o.defaultState,c[h]=o.getState();let u=ke(o,g,d,"combine",n);u.scope.key=h;let s=z(o);yt(y,{type:"field",field:h,from:s}),P("combineField",s,u)}),g.defaultShape=r,yt(p,{type:Ae,from:y,fn:n}),Pe()||(g.defaultState=n?p.current=n(c):i),g};let rn=(e,t,r)=>{try{return[1,e(...r)]}catch(a){return t(a),[0,null]}},kt=(e,t,r,a,n)=>l=>q({target:[a,jn],params:[r?{status:"done",params:e,result:l}:{status:"fail",params:e,error:l},{value:l,fn:r?t.rs:t.rj}],defer:1,page:n.page,scope:de(n)});const jn=ge({node:[ir({fn:({fn:e,value:t})=>e(t)})],meta:{op:"fx",fx:"sidechain"}}),Vn=["source","clock","target"],nn=(e,t)=>e+`: ${t} should be defined`;let ur=(e,t,r,a,n,l,i,c,y,k,g,p)=>{let f=!!n;N(!V(r)||!V(t),nn(e,"either source or clock"));let d=0;V(r)?d=1:me(r)||(r=W(r)),V(t)?t=r:(bt(t,e,"clock"),Array.isArray(t)&&(t=Ze(t))),d&&(r=t),c||i||(i=r.shortName);let o="none";(g||a)&&(me(a)?o="unit":(N(H(a),"`filter` should be function or unit"),o="fn")),n?(bt(n,e,"target"),Xr(e,n)):o==="none"&&k&&j(r)&&j(t)?n=C(l?l(We(z(r)),We(z(t))):We(z(r)),{name:i,sid:p,or:c}):(n=$({name:i,derived:1,or:c}),P("sampleTarget",G(n)));let h=De(),u=[];if(o==="unit"){let[v,w]=Dr(a,n,t,h,e);u=[...zt(w),...zt(v)]}let[s,m]=Dr(r,n,t,h,e);return Oe(r,[ke(t,n,[P("sampleSourceLoader"),Q({from:Me,target:h}),...zt(m),ne(s,1,y),...u,ne(h),o==="fn"&&te((v,w,{a:b})=>a(v,b),1),l&&te(Wt),P("sampleSourceUpward",f)],e,l)]),n};const zt=e=>[ne(e),X((t,r,{a})=>a,1)],Dr=(e,t,r,a,n)=>{let l=j(e),i=l?z(e):De(),c=De(l);return l||ge({parent:e,node:[Q({from:Me,target:i}),Q({from:"value",store:1,target:c})],family:{owners:[e,t,r],links:t},meta:{op:n},regional:1}),P("sampleSource",c,i,a),[i,c]},jt=(e,t,r,a)=>{let n=e[t];n&&q({target:n,params:Array.isArray(n)?n.map(()=>r):r,defer:1,stack:a})};function ft(e,t){e.cursor[t].prev&&(e.cursor[t].prev.cursor[t].next=e.cursor[t].next),e.cursor[t].next&&(e.cursor[t].next.cursor[t].prev=e.cursor[t].prev),e.queue[t].last===e&&(e.queue[t].last=e.cursor[t].prev),e.queue[t].first===e&&(e.queue[t].first=e.cursor[t].next),e.cursor[t].prev=null,e.cursor[t].next=null}function Qe(e){var t,r;e.status="active",t=mt(e),(r=e).cursor.prev&&(r.cursor.prev.cursor.next=r.cursor.next),r.cursor.next&&(r.cursor.next.cursor.prev=r.cursor.prev),t.last===r&&(t.last=r.cursor.prev),t.first===r&&(t.first=r.cursor.next),r.cursor.prev=null,r.cursor.next=null}function mt(e){return e.group.activeChilds[e.priority]}function qr(e,t){t.value.active=t.value.pending=e,t.status!=="active"&&Qe(t)}function U(e,t){if(t.value.active===e)return t.value.pending=e,void(t.status==="pending"&&(Qe(t),mt(t).first||ft(t.group,t.priority)));var r,a,n,l;t.status==="active"&&(t.status="pending",mt(t).first||((n=t.group).queue[l=t.priority].last?(n.cursor[l].prev=n.queue[l].last,n.queue[l].last.cursor[l].next=n,n.queue[l].last=n):n.queue[l].first=n.queue[l].last=n),a=t,(r=mt(t)).last?(a.cursor.prev=r.last,r.last.cursor.next=a,r.last=a):r.first=r.last=a),t.value.pending=e,t.group.queue.rafID||(t.group.queue.rafID=mn(t.group.queue.execQueue))}function Un(e){Se("execQueue");let t,r,a=ye(),n=0;e:for(;e.props.first||e.tree.first||e.data.first;){if(ye()-a>=1e3){n=1;break e}let l=!!e.props.first;for(l&&Se("props");t=e.props.first;){for(;r=t.activeChilds.props.first;){if(ye()-a>=1e3){n=1,Z("props");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,Qe(r)}ft(t,"props")}l&&Z("props");let i=!!e.tree.first;for(i&&Se("tree");t=e.tree.first;){for(;r=t.activeChilds.tree.first;){if(ye()-a>=1e3){n=1,Z("tree");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,Qe(r)}ft(t,"tree")}i&&Z("tree");let c=!!e.data.first;for(c&&Se("data");t=e.data.first;){for(;r=t.activeChilds.data.first;){if(ye()-a>=1e3){n=1,Z("data");break e}r.runOp(r.value.pending),r.value.active=r.value.pending,Qe(r)}ft(t,"data")}c&&Z("data")}if(Z("execQueue"),n)e.rafID=mn(e.execQueue);else if(e.rafID=null,e.onDrain){let l=e.onDrain;e.onDrain=null,l()}}function Xe({value:e,runOp:t,group:r,priority:a}){return{value:{active:e,pending:e},runOp:t,status:"active",priority:a,group:r,cursor:{prev:null,next:null}}}function Hn({onComplete:e}){let t={props:{first:null,last:null},tree:{first:null,last:null},data:{first:null,last:null},rafID:null,execQueue(){},onDrain:e};return t.execQueue=Un.bind(null,t),t}function et(e){return{ops:[],queue:e,activeChilds:{props:{first:null,last:null},tree:{first:null,last:null},data:{first:null,last:null}},cursor:{props:{prev:null,next:null},tree:{prev:null,next:null},data:{prev:null,next:null}}}}function Gn({value:e,group:t,onInit:r,onChange:a}){let n=Xe({value:e,group:t,runOp(i){l.status="A",a(i)},priority:"data"}),l={status:"IA",value:n.value,ops:{init:Xe({value:0,group:t,runOp(i){l.status="A",r(l.value.active)},priority:"data"}),change:n,terminate:Xe({value:0,group:t,runOp(i){l.status="T"},priority:"data"})}};return U(1,l.ops.init),l}function Wn(e){switch(e.status){case"I":case"T":case"AT":return;case"A":e.status="AT",U(1,e.ops.terminate);break;case"AA":e.status="AT",U(1,e.ops.terminate),U(e.value.active,e.ops.change);break;case"IA":e.status="T",U(0,e.ops.init)}}function Qn(e,t){switch(t.status){case"I":case"T":return;case"A":t.value.active!==e&&(t.status="AA",U(e,t.ops.change));break;case"AA":t.value.active===e?(t.status="A",U(e,t.ops.change)):t.value.pending!==e&&(t.value.pending=e);break;case"IA":t.value.active=t.value.pending=e}}function Xn(e){switch(e=String(e)){case"__proto__":case"__defineGetter__":case"__defineSetter__":case"constructor":case"prototype":case"hasOwnProperty":case"toString":case"valueOf":case"setProperty":case"removeProperty":return"forbidden";default:return e.replace(/[^a-zA-Z0-9\-_]/g,"")}}function an(e,t){for(let r=0;r<t.length;r++){let{type:a,field:n,value:l}=t[r];ta[a](e,n,l)}}function Rt(e){return e!==""&&e!==0&&e!=="0"&&(e==0||e==null)}function ln(e,t,r){Rt(r)?e.style.removeProperty(`--${t}`):e.style.setProperty(`--${t}`,`${r}`)}function on(e,t,r){Rt(r)?delete e.style[t]:e.style[t]=`${r}`}function sn(e,t,r){t&&t.trim().length>0&&(r?e.classList.add(t):(e.classList.remove(t),e.classList.length===0&&e.removeAttribute("class")))}function cn(e,t,r){Rt(r)?delete e.dataset[t]:e.dataset[t]=`${r}`}function un(e,t,r){if(Rt(r)){switch(t){case"value":delete e.value;break;case"checked":e.checked=0;break;case"spellcheck":if(r==0)return void e.setAttribute("spellcheck","false")}e.removeAttribute(t)}else{switch(t){case"value":e.value=`${r}`;break;case"checked":e.checked=`${r}`}e.setAttribute(t,`${r}`)}}function Kt(e,t){e.replaceData(0,(e.textContent||"").length,String(t))}function Ee({fn:e,state:t={},defer:r=0,name:a="",draft:n,isSvgRoot:l,namespace:i,env:c,isBlock:y=0}){let k=D,g={id:++na,name:a,plain:[],watch:[],nameMap:{},pages:[],closure:[],childTemplates:[],handlers:ra,upward:Sr.filter({fn(f,d,o){if(!o.page){if(!o.parent||!o.parent.page)return 1;o.page=o.parent.page}if(!o.page.root.activeSpawns.has(o.page.fullID))return console.count("inactive page upward"),0;let h=[o.page.template],u=[o.page];{let s=o.page.parent;for(;s;)u.push(s),h.push(s.template),s=s.parent}return o.node.next.forEach(s=>{let m=s.meta.nativeTemplate;if(m)if(h.includes(m)){let v=u[h.indexOf(m)];q({target:s,params:f,defer:1,page:v,stack:o,scope:o.scope})}else console.error("context drift",{stack:o,node:s});else q({target:s,params:f,defer:1,page:o.page,stack:o,scope:o.scope})}),0}}),loader:Sr.filter({fn(f,d,o){if(o.parent){let h=o.scope?o.scope.graphite.id:null;if(o.page){if(!o.page.root.activeSpawns.has(o.page.fullID))return console.count("inactive page loader"),0;if(o.page.template===g)return 1;if(o.page.root.childSpawns[o.page.fullID][g.id])o.page.root.childSpawns[o.page.fullID][g.id].forEach(u=>{(!h||u.root.scope&&h===u.root.scope.graphite.id)&&q({params:f,target:o.node,page:u,defer:1,scope:o.scope})});else{let u=o.page.fullID,s=o.page.template.name==="rec";g.pages.forEach(m=>{if(!h||m.root.scope&&h===m.root.scope.graphite.id)if(m.fullID===u||m.fullID.startsWith(`${u}_`)){let v=1;if(s){let w=o.page.template.id,b=m.parent;for(;b&&b!==o.page;){if(b.template.id===w){v=0;break}b=b.parent}}v&&q({params:f,target:o.node,page:m,defer:1,scope:o.scope})}else u.startsWith(`${m.fullID}_`)&&q({params:f,target:o.node,page:o.page,defer:1,scope:o.scope})})}}else g.pages.forEach(u=>{(!h||u.root.scope&&h===u.root.scope.graphite.id)&&q({params:f,target:o.node,page:u,defer:1,scope:o.scope})});return 0}return 1}}),parent:k,node:null,api:null,trigger:{mount:$({named:"mount"})},draft:n,isSvgRoot:l,namespace:i,env:c,isBlock:y||!(!k||!k.isBlock)};k&&k.childTemplates.push(g);let p=ge({meta:{template:g}});return g.node=p,D=g,r?g.deferredInit=()=>{let f=D;D=g,g.deferredInit=null;try{kr(p,()=>{let d=wr(t);g.api=e(d,g.trigger),g.nameMap=d})}finally{D=f}}:kr(p,()=>{let f=wr(t);g.api=e(f,g.trigger),g.nameMap=f}),D=k,g}function Yn(e,t){let r;switch(r=t?t.getState(e):e.current,e.type){case"list":return[...r];case"shape":return{...r};default:return r}}function pn(e,t,r){let a=t;for(;a&&!rt(a,e);)a=a.parent;return a?rt(a,e):r?(r.getState(e),r.reg[e.id]):e}function Vt(e,t){rt(t,e)||(t.reg[e.id]=pn(e,t.parent,t.root.scope))}function Rr(e,t,r){t in r||(r[t]=[]),r[t].push(...e)}function wt(e,{values:t={},parentLeaf:r,mountNode:a,svgRoot:n,leafData:l,opGroup:i,domSubtree:c,hydration:y,root:k}){function g(u){if(u.before)for(let s=0;s<u.before.length;s++){let m=u.before[s];switch(m.type){case"map":{let v,w=m.from;if(!m.fn&&!w)break;w&&(Vt(w,d),v=f[w.id].current),f[u.id].current=m.fn?m.fn(v):v;break}case"field":{let v=m.from;Vt(v,d),f[u.id].current[m.field]=f[v.id].current;break}case"closure":Vt(m.of,d)}}}function p(u,s,m){let v;s.stop=1;try{for(;s.i<u.length;)v=u[s.i],s.i++,v.fn(m[v.of.id]?m[v.of.id].current:pn(v.of,d.parent,d.root.scope).current)}catch(w){console.error(w),s.stop=0}}let f={},d={draft:e.draft,svgRoot:n,data:l,parent:r,hydration:y,mountNode:a,root:k,id:++aa,fullID:"",reg:f,template:e};e.pages.push(d);let o=Le;Le=d,r&&Rr([d],e.id,k.childSpawns[r.fullID]),d.fullID=r?`${r.fullID}_${d.id}`:`${d.id}`,k.childSpawns[d.fullID]={},k.activeSpawns.add(d.fullID),k.leafOps[d.fullID]={group:i,domSubtree:c};for(let u=0;u<e.closure.length;u++){let s=e.closure[u],m=s,v=d.parent;e:for(;v;){if(rt(v,s)){m=rt(v,s);break e}v=v.parent}!v&&k.scope&&(k.scope.getState(s),m=k.scope.reg[s.id]),f[s.id]=m}for(let u=0;u<e.plain.length;u++){let s=e.plain[u],m={id:s.id,current:Yn(s,k.scope)};f[s.id]=m}for(let u in t){let s=e.nameMap[u].stateRef.id;f[s]={id:s,current:t[u]}}e.closure.forEach(g),e.plain.forEach(g);let h={i:0,stop:0};for(;!h.stop;)p(e.watch,h,f);if(r)for(let u in k.childSpawns[d.fullID])Rr(k.childSpawns[d.fullID][u],u,k.childSpawns[r.fullID]);if(ue)ue.steps.push({target:e.trigger.mount,params:d,defer:1,page:d,scope:k.scope});else{let u;ue={parent:ue,steps:[{target:e.trigger.mount,params:d,defer:1,page:d,scope:k.scope}]};do for(;u=ue.steps.shift();)ue={parent:ue,steps:[]},q(u);while(ue=ue.parent)}return Le=o,d}function xt(e){let t=e.parent;for(;t.type!=="element"&&t.type!=="using";)t=t.parent;return t?t.value:null}function $t(e){if(!e.visible)return null;switch(e.type){case"text":case"element":return e;case"LF":case"route":case"rec":case"recItem":case"block":case"blockItem":for(let t=e.child.length-1;t>=0;t--){let r=$t(e.child[t]);if(r)return r}return null;case"list":{let t=e.lastChild;if(!t)return null;for(;t;){let r=$t(t);if(r)return r;t=t.left}return null}default:return null}}function St(e){switch(e.type){case"using":return null;case"LF":{let t=e.left;for(;t;){let r=$t(t);if(r)return r;t=t.left}return St(e.parent)}case"element":case"text":case"route":case"rec":case"recItem":case"block":case"blockItem":case"list":{let t=e.parent;for(let r=e.index-1;r>=0;r--){let a=t.child[r];if(!a)continue;let n=$t(a);if(n)return n}switch(t.type){case"element":case"using":return null}return St(t)}default:return null}}function Zt(e){let t=St(e);return t?t.value:null}function tt(e,t){if(!e)throw Error(t)}function lt(e,t){if(!e)throw Error(`${t}() called outside from using() closure`)}function It(e){if(!D)return;let{draft:t}=e;if(t.type!=="listItem"&&t.type!=="rec")switch(D.draft.type){case"element":case"using":case"route":case"list":case"rec":case"recItem":case"block":case"blockItem":t.inParentIndex=D.draft.childCount,D.draft.childCount+=1,D.draft.childTemplates.push(e);break;default:console.warn(`unexpected currentTemplate type ${D.draft.type}`)}}function fe(e,{parentBlockFragment:t,leaf:r,node:a,svgRoot:n,values:l}){e.childTemplates.forEach(i=>{pr({parentBlockFragment:t,leaf:r,node:a,svgRoot:n,values:l,actor:i})})}function pr({parentBlockFragment:e,leaf:t,node:r=t.mountNode,actor:a,svgRoot:n,values:l}){let i;tt(la.includes(e.type),`incorrect parent ${e.type}`);let{draft:c}=a,{queue:y}=t.root.leafOps[t.fullID].group,k=et(y),g=t.root.leafOps[t.fullID].domSubtree,p=g;switch(c.type){case"route":{let d={type:"route",parent:e,child:[],visible:0,index:c.inParentIndex};e.child[c.inParentIndex]=d,i={type:"route",block:d,ops:{},initialized:0,pendingInit:null};break}case"element":{let d;if(a.isBlock){let h,u,s=t;for(;s&&(!u||!h);){s.template.env&&(h=s.template.env);let{draft:m}=s;m.type==="element"&&(m.tag==="svg"?u="svg":m.tag==="foreignObject"&&(u="html")),s=s.parent}u||(u="html"),h&&(d=u==="svg"?h.document.createElementNS("http://www.w3.org/2000/svg",c.tag):h.document.createElement(c.tag),an(d,c.staticSeq))}else d=c.stencil.cloneNode();let o={type:"element",parent:e,child:[],value:d,visible:0,index:c.inParentIndex};e.child[c.inParentIndex]=o,i={type:"element",block:o,ops:{visible:Xe({value:0,priority:"tree",runOp(h){if(h){dn(o);let u=i;u.needToCallNode&&(u.needToCallNode=0,q({target:Ct,params:{element:o.value,fns:c.node},page:f,scope:t.root.scope})),o.visible=1}else o.value.remove(),o.visible=0},group:g})},needToCallNode:c.node.length>0},p=et(y);break}case"list":{let d={type:"list",parent:e,child:[],lastChild:null,visible:1,index:c.inParentIndex};e.child[c.inParentIndex]=d,i={type:"list",draft:c,block:d,records:[],pendingUpdate:null};break}case"using":case"listItem":break;case"rec":{let d={type:"rec",parent:e,child:[],visible:1,index:c.inParentIndex};e.child[c.inParentIndex]=d,i={type:"rec",block:d};break}case"recItem":{let d={type:"recItem",parent:e,child:[],visible:1,index:c.inParentIndex};e.child[c.inParentIndex]=d,i={type:"rec item",block:d};break}case"block":{let d={type:"block",parent:e,child:[],visible:1,index:c.inParentIndex};e.child[c.inParentIndex]=d,i={type:"block",block:d};break}case"blockItem":{let d={type:"blockItem",parent:e,child:[],visible:1,index:c.inParentIndex};e.child[c.inParentIndex]=d,i={type:"block item",block:d};break}default:console.warn(`unexpected draft type ${c.type}`)}let f=wt(a,{values:l,parentLeaf:t,mountNode:r,svgRoot:n||t.svgRoot,leafData:i,opGroup:k,domSubtree:p,hydration:t.hydration,root:t.root})}function dn(e){let t=Zt(e);t?t.after(e.value):xt(e).prepend(e.value),e.visible=1}function Re({mount:e,state:t,onMount:r,onState:a}){return{onMount:M({source:t,clock:e,fn:r,greedy:1}),onState:M({source:e,clock:t,fn:a,greedy:1})}}function Ye(e,t){for(let r in e)t(e[r],r)}function Tr(e,t){if(!D)return;let r=D.draft;tt(r.type==="element",`"handler" extension can be used only with element nodes, got "${r.type}"`),t===void 0&&(t=e,e={});for(let c in t)tt(O.unit(t[c]),`handler for "${c}" should be event`);let{passive:a=0,capture:n=0,prevent:l=0,stop:i=0}=e;r.handler.push({options:{prevent:l,stop:i},domConfig:{passive:l?0:a,capture:n},map:t})}function le(e){lt(D,"spec");let t=D.draft;switch(t.type){case"list":return void(e.visible&&(t.itemVisible=e.visible));case"listItem":case"using":case"route":case"rec":case"recItem":case"block":case"blockItem":return}if(e.attr&&t.attr.push(e.attr),e.data&&t.data.push(e.data),"text"in e){let n=e.text,l=t.childCount;Array.isArray(n)?(t.text.push(...n.map((i,c)=>({index:c+l,value:i}))),t.childCount+=n.length):(t.text.push({index:l,value:n}),t.childCount+=1)}if(e.style){let n={};for(let l in e.style)n[Xn(l)]=e.style[l];t.style.push(n)}var r,a;if(e.classList&&(r=e.classList,a=n=>t.classList.push(n),Array.isArray(r)?r.forEach(n=>{let l=typeof n=="string"?n:n.map(c=>c||""),i=typeof n=="string"?1:n.map(c=>c!==null);a({name:l,enabled:i})}):Ye(r,(n,l)=>{a({name:l,enabled:n})})),e.styleVar&&t.styleVar.push(e.styleVar),e.visible&&(t.visible=e.visible),e.handler){let n=e.handler;typeof n.on=="object"?Tr(n.config||{},n.on):Tr(n)}e.\u0254&&le(e.\u0254)}function Ut(e,{initCtx:t,runOp:r,hooks:{onMount:a,onState:n}}){let l=e.opsAmount++;a.watch(({value:i,leaf:c})=>{let y=t(i,c),k=Xe({value:i,priority:"props",runOp(g){r(g,y)},group:c.root.leafOps[c.fullID].group});c.root.leafOps[c.fullID].group.ops[l]=k}),n.watch(({value:i,leaf:c})=>{U(i,c.root.leafOps[c.fullID].group.ops[l])})}function st(e,t,r){e[t].forEach(a=>{Ye(a,(n,l)=>{switch(t){case"data":case"styleVar":r[t][l]=n;break;case"attr":r.attr[l==="xlink:href"?"href":l]=n;break;case"style":l.startsWith("--")?r.styleVar[l.slice(2)]=n:r.style[l]=n}})})}function Lr(e,t,r){let a=e.data.block,n={type:"text",parent:a,visible:0,index:r,value:null};if(a.child[r]=n,e.hydration){let l=St(n);if(l)switch(l.type){case"text":n.value=e.root.env.document.createTextNode(t),l.value.after(n.value);break;case"element":n.value=l.value.nextSibling,Kt(n.value,t)}else{let i=xt(n);n.value=i.firstChild,Kt(n.value,t)}n.visible=1}else n.value=e.root.env.document.createTextNode(t),dn(n);return n}function Ve(e){let t=e.stateRef,r=D;r.plain.includes(t)||r.closure.includes(t)||r.closure.push(t)}function I(e,t){let r,a=0,n=0;typeof t=="function"?(a=1,r=t):t&&(n=1,t.fn&&(a=1,r=t.fn),t.\u0254&&(typeof t.\u0254=="function"?(a=1,r=t.\u0254):typeof t.\u0254.fn=="function"&&(a=1,r=t.\u0254.fn))),lt(D,"h");let l,i=D.env,c=D.namespace,y=c,k="html";y=k=c==="svg"?"svg":"html",e==="svg"&&(k="svg",y="svg"),D.isBlock||(l=k==="svg"?i.document.createElementNS("http://www.w3.org/2000/svg",e):i.document.createElement(e));let g=l,p={type:"element",tag:e,attr:[],data:[],text:[],style:[],styleVar:[],classList:[],handler:[],stencil:g,seq:[],staticSeq:[],childTemplates:[],childCount:0,inParentIndex:-1,opsAmount:1,node:[]};c==="foreignObject"?(p.attr.push({xmlns:"http://www.w3.org/1999/xhtml"}),y="html"):e==="svg"?(p.attr.push({xmlns:"http://www.w3.org/2000/svg"}),y="svg"):e==="foreignObject"&&(y="foreignObject");let f=Ee({name:"element",draft:p,isSvgRoot:e==="svg",namespace:y,fn(d,{mount:o}){let h=$({named:"domElementCreated"});a&&r(),n&&le(t),O.unit(p.visible)&&(p.seq.push({type:"visible",value:p.visible}),Ve(p.visible));let u={attr:{},data:{},style:{},styleVar:{}};st(p,"attr",u),st(p,"data",u),st(p,"style",u),st(p,"styleVar",u),Ye(u,(s,m)=>{Ye(s,(v,w)=>{O.unit(v)?(p.seq.push({type:m,field:w,value:v}),Ve(v)):p.staticSeq.push({type:m,field:w,value:v})})}),p.classList.forEach(s=>{if(O.unit(s.name)||O.unit(s.enabled)){let m=O.unit(s.name)?s.name:C(s.name),v=O.unit(s.enabled)?s.enabled:C(s.enabled);p.seq.push({type:"classList",field:m,value:v}),Ve(m),Ve(v)}else O.unit(s.name)||p.staticSeq.push({type:"classList",field:s.name,value:s.enabled})}),p.text.forEach(s=>{s.value!==null&&(O.unit(s.value)?(p.seq.push({type:"dynamicText",value:s.value,childIndex:s.index}),Ve(s.value)):p.seq.push({type:"staticText",value:String(s.value),childIndex:s.index}))}),p.handler.forEach(s=>{Ye(s.map,(m,v)=>{p.seq.push({type:"handler",for:v,handler:m,options:s.options,domConfig:s.domConfig})})}),g&&an(g,p.staticSeq),p.seq.forEach(s=>{switch(s.type){case"visible":{let{onMount:m,onState:v}=Re({mount:o,state:s.value,onMount:(w,b)=>({leaf:b,value:w,hydration:b.hydration}),onState:(w,b)=>({leaf:w,value:b,hydration:0})});m.watch(({leaf:w,value:b,hydration:x})=>{let S=w.data,_=S.block;if(x&&(qr(b,S.ops.visible),b)){let T,A=Zt(_);if(T=A?A.nextSibling:xt(_).firstChild,T.nodeName==="#text"){let ie=T;T=T.nextSibling,ie.remove()}_.value=T,_.visible=1}fe(p,{parentBlockFragment:_,leaf:w,node:_.value,svgRoot:f.isSvgRoot?_.value:null}),b&&S.needToCallNode&&(S.needToCallNode=0,q({target:Ct,params:{element:S.block.value,fns:p.node},page:w,defer:1,scope:w.root.scope})),q({target:h,params:w,defer:1,page:w,scope:w.root.scope})}),Ze([v,m]).watch(({leaf:w,value:b,hydration:x})=>{x||U(b,w.data.ops.visible)});break}case"attr":case"data":case"style":case"styleVar":{let m=Er[s.type],v=oa.some(({type:b,field:x})=>s.type===b&&s.field===x),w=Re({mount:h,state:s.value,onMount:(b,x)=>({leaf:x,value:b}),onState:(b,x)=>({leaf:b,value:x})});v?Ze([w.onState,w.onMount]).watch(({leaf:b,value:x})=>{m(ct(b),s.field,x)}):Ut(p,{initCtx(b,x){let S=ct(x);return m(S,s.field,b),S},runOp(b,x){m(x,s.field,b)},hooks:w});break}case"classList":{let m=Er.classList,v=C({prev:"",curr:s.field.getState()}).on(s.field,({curr:b},x)=>({prev:b,curr:x})),w=Re({mount:h,state:W({name:v,enabled:s.value}),onMount:(b,x)=>({leaf:x,value:b}),onState:(b,x)=>({leaf:b,value:x})});Ut(p,{initCtx(b,x){let S=ct(x);return m(S,b.name.curr,b.enabled),S},runOp(b,x){b.name.prev!==b.name.curr&&m(x,b.name.prev,0),m(x,b.name.curr,b.enabled)},hooks:w});break}case"dynamicText":Ut(p,{initCtx:(m,v)=>Lr(v,m,s.childIndex),runOp(m,v){Kt(v.value,m)},hooks:Re({mount:h,state:s.value,onMount:(m,v)=>({leaf:v,value:String(m)}),onState:(m,v)=>({leaf:m,value:String(v)})})});break;case"staticText":h.watch(m=>{Lr(m,s.value,s.childIndex)});break;case"handler":{let m=s.handler.graphite.meta.nativeTemplate||null;h.watch(v=>{let w=null;if(m){let b=0,x=v;for(;!b&&x;)x.template===m?(b=1,w=x):x=x.parent}else w=null;ct(v).addEventListener(s.for,b=>{s.options.prevent&&b.preventDefault(),s.options.stop&&b.stopPropagation(),q({target:s.handler,params:b,page:w,scope:v.root.scope})},s.domConfig)});break}}}),o.watch(s=>{let m=s.data;if(!p.visible){let v=m.ops.visible,w=m.block;if(s.hydration){qr(1,v);let b,x=Zt(w);if(b=x?x.nextSibling:xt(w).firstChild,b.nodeName==="#text"){let S=b;b=b.nextSibling,S.remove()}w.value=b,w.visible=1}fe(p,{parentBlockFragment:w,leaf:s,node:w.value,svgRoot:f.isSvgRoot?w.value:null}),q({target:h,params:s,defer:1,page:s,scope:s.root.scope}),s.hydration?m.needToCallNode&&(m.needToCallNode=0,q({target:Ct,params:{element:m.block.value,fns:p.node},page:s,defer:1,scope:s.root.scope})):U(1,v)}})},env:i});It(f)}function Ar(){if(typeof document<"u")return{document};throw Error("your environment has no document")}function Jn(e,t){let r,a,n,l,i,c;if(typeof t=="function")r=t,n=Ar(),l=0;else{if(!t)throw Error("using() second argument is missing");r=t.fn,n=t.env?t.env:Ar(),l=t.hydrate,a=t.onComplete,i=t.onRoot,c=t.scope}tt(e,"using() first argument is missing");let y={scope:c,env:n,activeSpawns:new Set,childSpawns:{},leafOps:{}},k=e.namespaceURI,g=e.tagName.toLowerCase(),p={type:"using",childTemplates:[],childCount:0,inParentIndex:-1},f=Ee({name:"using",draft:p,isSvgRoot:g==="svg",namespace:k==="http://www.w3.org/2000/svg"?"svg":g==="foreignobject"?"foreignObject":"html",fn(u,{mount:s}){r(),s.watch(fr.using)},env:n}),d={type:"using",child:[],value:e},o=Hn({onComplete:a}),h=wt(f,{parentLeaf:Le||null,mountNode:e,svgRoot:f.isSvgRoot?e:Le?Le.svgRoot:null,leafData:{type:"using",draft:p,element:e,block:d},opGroup:et(o),domSubtree:et(o),hydration:l,root:y});if(i&&i({template:f,leaf:h}),o.onDrain&&!o.rafID){let u=o.onDrain;o.onDrain=null,u()}}function er(e,t){let r=e.root.childSpawns[e.fullID];for(let a in r){let n=r[a];for(let l=0;l<n.length;l++)t(n[l])}}function fn(e,t){let r=a=>{let n=a.data;if(e&&n.type==="list"&&n.pendingUpdate){let l=n.pendingUpdate;n.pendingUpdate=null,q({target:a.template.api.pendingUpdate,params:l,defer:1,page:a,scope:a.root.scope})}if(e&&n.type==="route"){if(n.pendingInit){let l=n.pendingInit.value;n.pendingInit=null,q({target:a.template.api.pendingInit,params:l,defer:1,page:a,scope:a.root.scope})}else if(!n.block.visible)return}switch(n.type){case"element":U(e,n.ops.visible);break;case"route":case"list":case"list item":er(a,r);break;default:console.log("unsupported type",n.type)}};er(t,r)}function Ht(e){e.root.activeSpawns.delete(e.fullID),er(e,dr)}function Gt(e){Je(e,e.root.childSpawns[e.parent.fullID][e.template.id]),Je(e,e.template.pages)}function dr(e){let{data:t,root:r}=e;switch(t.type){case"element":Je(e,r.childSpawns[e.parent.fullID][e.template.id]),function a(n){r.activeSpawns.delete(n.fullID);let l=r.childSpawns[n.fullID];delete r.childSpawns[n.fullID],delete r.leafOps[n.fullID],Je(n,n.template.pages);for(let i in l)l[i].forEach(a)}(e),U(0,t.ops.visible);break;case"list":{let a=t.records;for(let n=0;n<a.length;n++){let l=a[n];l.instance&&dr(l.instance),l.active=0}e.root.activeSpawns.delete(e.fullID),Gt(e);break}case"list item":{let a=t.block;Je(a,a.parent.child);let n=a.left,l=a.right;n&&(n.right=l,l||a.parent.lastChild!==a||(a.parent.lastChild=n)),l&&(l.left=n),n||l||a.parent.lastChild!==a||(a.parent.lastChild=null),a.left=null,a.right=null,Ht(e),Gt(e);break}case"route":Ht(e),Gt(e);break;case"block":case"block item":case"rec":case"rec item":Ht(e)}delete r.childSpawns[e.fullID],delete r.leafOps[e.fullID]}function Je(e,t){if(!t)return;let r=t.indexOf(e);r!==-1&&t.splice(r,1)}function Kn(e,t){if(Array.isArray(t))return t.map(r=>e.map(a=>a[r]));if(typeof t=="object"&&t!==null){let r={};for(let a in t){let n=t[a];r[a]=e.map(typeof n=="function"?l=>n(l):l=>l[n])}return r}return e.map(r=>r[t])}function gt(e,t){lt(D,"list"),typeof t=="function"&&(O.unit(e)?e={source:e,fn:t}:e.fn=t);let{fn:r,key:a,source:n,fields:l=[]}=e,i=a!==void 0?typeof a=="function"?a:g=>g[a]:(g,p)=>p,c={type:"list",key:O.store(e)?{type:"index"}:{type:"key",key:e.key},childTemplates:[],childCount:0,inParentIndex:-1},{env:y,namespace:k}=D;It(Ee({name:"list",draft:c,isSvgRoot:0,namespace:k,fn(g,{mount:p}){let f=Ee({name:"list item",state:{id:-1,store:null},draft:c,isSvgRoot:0,namespace:k,fn({id:m,store:v},{mount:w}){r({store:v,key:m,fields:Kn(v,l)});let b=$({named:"itemUpdater"});if(v.on(b,(x,S)=>S),c.itemVisible){let{onMount:x,onState:S}=Re({mount:w,state:c.itemVisible,onMount:(_,T)=>({visible:_,leaf:T}),onState:(_,T)=>({visible:T,leaf:_})});x.watch(({visible:_,leaf:T})=>{let A=T.data.block;A.visible=_,A.childInitialized=_,_&&fe(c,{parentBlockFragment:A,leaf:T})}),S.watch(({visible:_,leaf:T})=>{let A=T.data.block;A.visible=_,A.childInitialized?fn(_,T):_&&(A.childInitialized=1,fe(c,{parentBlockFragment:A,leaf:T}))})}else w.watch(fr.listItem);return{itemUpdater:b}},env:y}),d=C([]),o=n.map(m=>m),h=M({source:n,clock:p,fn:(m,v)=>({updates:m,leaf:v,hydration:v.hydration}),greedy:1}),u=$(),s=M({source:h,clock:[o,u],fn:({leaf:m},v)=>({updates:v,leaf:m,hydration:0}),greedy:1});return M({source:d,clock:[h,s],greedy:1,fn(m,{updates:v,leaf:w,hydration:b}){let x=w.data,S=w;for(;S;){if(S.data.type==="route"&&!S.data.block.visible)return void(x.pendingUpdate=v);S=S.parent}let _=x.block;Se("list update ["+n.shortName+"]");let T=Array(v.length).fill(0),A=v.map(i),ie=[];for(let se=0;se<m.length;se++){let J=m[se],he=A.indexOf(J.key);he!==-1?(ie.push(J),T[he]=1,Qn(v[he],J.asyncValue)):(J.active=0,J.instance&&dr(J.instance),Wn(J.asyncValue))}for(let se=0;se<v.length;se++){if(T[se])continue;let J=v[se],he=A[se],Ot=et(w.root.leafOps[w.fullID].group.queue),ve={type:"LF",parent:_,child:[],childInitialized:0,visible:0,left:null,right:null},K={type:"listItem",key:he,index:he,active:1,leafData:{type:"list item",block:ve,listDraft:c},asyncValue:Gn({value:J,group:Ot,onChange(we){K.instance&&q({target:K.instance.template.api.itemUpdater,params:we,defer:1,page:K.instance,scope:K.instance.root.scope})},onInit(we){K.active&&(b||(K.instance=wt(f,{values:{id:he,store:we},parentLeaf:w,mountNode:w.mountNode,svgRoot:w.svgRoot,leafData:K.leafData,opGroup:Ot,domSubtree:w.root.leafOps[w.fullID].domSubtree,hydration:b,root:w.root})))}})},br=ie.length;ie.push(K);let yr=br>0?ie[br-1].leafData:null;if(_.child.push(ve),yr){let we=yr.block;ve.left=we;let Ft=we.right;Ft?(Ft.left=ve,ve.right=Ft):_.lastChild=ve,we.right=ve}else _.lastChild=ve;b&&(K.instance=wt(f,{values:{id:he,store:J},parentLeaf:w,mountNode:w.mountNode,svgRoot:w.svgRoot,leafData:K.leafData,opGroup:Ot,domSubtree:w.root.leafOps[w.fullID].domSubtree,hydration:b,root:w.root}))}return Z("list update ["+n.shortName+"]"),ie.length===0&&(_.lastChild=null),x.records=ie,ie},target:d}),{pendingUpdate:u}},env:y}))}function Or({source:e,visible:t,fn:r}){lt(D,"route");let{env:a,namespace:n}=D,l=Ee({name:"route",isSvgRoot:0,namespace:n,env:a,draft:{type:"route",childTemplates:[],childCount:0,inParentIndex:-1},fn(i,{mount:c}){let y;if(O.store(t))y=W({value:e,visible:t});else{let o=t;y=e.map(h=>({value:h,visible:o(h)}))}let k=Ee({name:"route item",isSvgRoot:0,namespace:n,env:a,draft:{type:"route",childTemplates:[],childCount:0,inParentIndex:-1},state:{store:null},fn({store:o},{mount:h}){let u=$({named:"itemUpdater"});o.on(u,(m,v)=>v),r({store:o});let s=M({source:h,clock:y,fn:(m,{visible:v,value:w})=>({leaf:m,visible:v,value:w}),greedy:1});h.watch(fr.routeItem),s.watch(({leaf:m,visible:v,value:w})=>{if(m.data.block.visible=v,v&&q({target:u,params:w,defer:1,page:m,scope:m.root.scope}),v){let b=m.parent;for(;b;){if(b.data.type==="route"&&!b.data.block.visible)return;b=b.parent}}fn(v,m)})}});It(k);let{onMount:g,onState:p}=Re({mount:c,state:y,onMount:({visible:o,value:h},u)=>({leaf:u,visible:o,value:h}),onState:(o,{visible:h,value:u})=>({leaf:o,visible:h,value:u})}),f=$(),d=M({source:c,clock:f,greedy:1,fn:(o,h)=>({leaf:o,value:h,visible:1})});return Ze([g,p,d]).watch(({leaf:o,visible:h,value:u})=>{let s=o.data;if(s.block.visible=h,h||s.initialized||!s.pendingInit){if(h&&!s.initialized){let m=o.parent;for(;m;){if(m.data.type==="route"&&!m.data.block.visible)return void(s.pendingInit={value:u});m=m.parent}}h&&!s.initialized&&(pr({parentBlockFragment:s.block,leaf:o,actor:k,values:{store:u}}),s.initialized=1)}else s.pendingInit=null}),{pendingInit:f}}});It(l)}function Zn({source:e,cases:t,key:r}){let a;lt(D,"variant"),tt(O.unit(e),"variant({source}) should be unit"),a=typeof r=="function"?r:r==null?l=>String(l):l=>String(l[r]);let n=0;for(let l in t)l!=="__"?Or({source:e,visible:i=>a(i)===l,fn:t[l]}):n=1;if(n){let l=Object.keys(t);Or({source:e,visible:i=>!l.includes(a(i)),fn:t.__})}}function ea(e,t){if(t.length===0)return e;let r=[e[0]];for(let a=0;a<t.length;a++)r.push(t[a],e[a+1]);return r}function Te(e,...t){Array.isArray(e)?le({text:ea(e,t)}):le({text:e})}let ye;ye=typeof performance<"u"&&performance.now?()=>performance.now():typeof process<"u"&&process.hrtime?()=>{let e=process.hrtime();return(1e9*e[0]+e[1])/1e6}:()=>Date.now();let tr=new Map;const He=[],Fr=e=>{let t=tr.get(e);t||(t={calls:0,time:0,label:e,childTime:0},tr.set(e,t)),t.calls+=1,He.push({bucket:t,pendingStart:ye()})},Nr=e=>{let t=tr.get(e),r=He.pop().pendingStart,a=ye()-r;t.time+=a,He.length>0&&(He[He.length-1].bucket.childTime+=a)};let Se,Z;typeof performance<"u"&&performance.mark?(Se=e=>{performance.mark("\u2604\uFE0F "+e+" start"),Fr(e)},Z=e=>{Nr(e);try{performance.measure("\u2604\uFE0F "+e,"\u2604\uFE0F "+e+" start")}catch{}performance.clearMarks("\u2604\uFE0F "+e+" start"),performance.clearMeasures("\u2604\uFE0F "+e)}):(Se=e=>{Fr(e)},Z=e=>{Nr(e)});let mn=typeof requestAnimationFrame<"u"?requestAnimationFrame:e=>setTimeout(e,0);const ta={attr:un,data:cn,style:on,styleVar:ln,classList:sn},ce=(e,t)=>e.includes(t);let ra={storeBase(e,t){e.plain.push(t)},storeOnMap(e,t,r,a){var n,l;r.unshift(e.loader),r.push(e.upward),a&&(ce(e.plain,a)||(ce(e.closure,a)||e.closure.push(a),l={type:"closure",of:a},(n=t).before||(n.before=[]),n.before.push(l)))},storeMap(e,t,r){ce(e.plain,t)||ce(r.seq,e.loader)||r.seq.unshift(e.loader)},storeWatch:(e,t,r)=>(e.watch.push({of:t,fn:r}),1),eventPrepend(e,t){t.seq.push(e.upward)},combineBase(e,t,r){e.plain.push(t,r)},combineField(e,t,r){ce(e.plain,t)||r.seq.unshift(e.loader)},splitBase(e,t){e.plain.push(t)},splitMatchStore(e,t,r){ce(e.plain,t)||r.seq.unshift(e.loader)},sampleSource(e,t,r,a){t.current?ce(e.plain,r)||ce(e.closure,r)||e.closure.push(r):e.plain.push(r),e.plain.push(t),ce(e.plain,a)||e.plain.push(a)},sampleTarget(e,t){t.seq.push(e.loader)},sampleSourceLoader:e=>e.loader,sampleSourceUpward:(e,t)=>t&&e.upward},na=0,aa=0,D=null,Le=null;const rt=(e,t)=>e.reg[t.id];let ue=null;const la=["LF","using","element","recItem","rec","block","blockItem","route"];let Ct=$({named:"onMount"});Ct.watch(({fns:e,element:t})=>{e.forEach(r=>{r(t)})});const oa=[{type:"attr",field:"value"},{type:"attr",field:"checked"},{type:"attr",field:"min"},{type:"attr",field:"max"}],Er={attr:un,data:cn,style:on,styleVar:ln,classList:sn},ct=e=>e.data.block.value;let fr={using(e){let t=e.data;fe(t.draft,{parentBlockFragment:t.block,leaf:e})},routeItem(e){let t=e.draft,r=e.data;r.block.visible=1,fe(t,{parentBlockFragment:r.block,leaf:e})},block(e){fe(e.draft,{parentBlockFragment:e.data.block,leaf:e})},blockItem(e){pr({parentBlockFragment:e.data.block,leaf:e,actor:e.draft.itemOf})},rec(e){fe(e.draft,{parentBlockFragment:e.data.block,leaf:e})},listItem(e){let t=e.data,r=t.block;r.visible=1,r.childInitialized=1,fe(t.listDraft,{parentBlockFragment:r,leaf:e})}};function ia(e){let t=new Map,r=new Map;return e.forEach((a,n)=>{sa(r,n,a)}),r.forEach(([a,n],l)=>{let i=e.get(l)||0;i&&a+n<2||i&&a+n>3||(!i&&a+n==3?t.set(l,a>n?1:2):i&&t.set(l,i))}),t}function sa(e,t,r){const[a,n]=ot(t);return[`${a-1}|${n-1}`,`${a-1}|${n}`,`${a-1}|${n+1}`,`${a}|${n-1}`,`${a}|${n+1}`,`${a+1}|${n-1}`,`${a+1}|${n}`,`${a+1}|${n+1}`].forEach(i=>{e.has(i)||e.set(i,[0,0]);let[c,y]=e.get(i);r===1?e.set(i,[c+1,y]):e.set(i,[c,y+1])}),e}function ot(e){const[t,r]=e.split("|");return[+t,+r]}function rr([e,t]){return`${e}|${t}`}function ca(e,t){let r=Math.floor(e.clientY/t),a=Math.floor(e.clientX/t);return{row:r,col:a,shift:e.shiftKey}}function ua(e){return""}function pa(e){let t=e.map(({name:r,fauna:a})=>({fauna:[...a.entries()],name:r}));localStorage.setItem("history",JSON.stringify(t))}function da(){try{return(JSON.parse(localStorage.getItem("history")||"null")||[]).map(({fauna:r,name:a})=>({fauna:new Map(r),name:a}))}catch(e){return console.error(e),[]}}function fa(){return{width:window.visualViewport.width,height:window.visualViewport.height}}function ma(e){let t=0,r=0;return e.size===0?{col:t,row:r}:(e.forEach((a,n)=>{const[l,i]=ot(n);t+=l,r+=i}),{col:Math.round(t/e.size),row:Math.round(r/e.size)})}function ga(e){let t=new Map;return e.split(`
`).forEach((r,a)=>{r=r.trim();for(let n=0;n<r.length;n++)r[n]==="O"&&t.set(rr([n,a]),1)}),t}function ha(){return{currentBp:C(null)}}const gn="#5583e5",hn="#79e555",Br=[1,35],va=20,Pr=fa();function ba(){const e=Br,t=C(va),r=t.map(i=>({height:Math.ceil(Pr.height/i),width:Math.ceil(Pr.width/i)})),a=$(),n=$();return t.on(n,i=>{let c=i-1;return Math.max(Br[0],c)}).on(a,i=>i+1),{options:e,$cellSize:t,$fieldSize:r,plus:a,minus:n}}function ya(){const e=C(!1),t=$();return e.on(t,(a,n)=>n),{$isOn:e,changed:t}}function ka(e){const t=$(),r=$(),a=C(null,{updateFilter:(l,i)=>!(l&&i&&l.row===i.row&&l.col===i.col)});return a.on(r,()=>null),M({source:e,clock:t,fn:(l,i)=>ca(i,l),target:a}),{$cell:a,fieldMouseLeaved:r,fieldMouseMoved:t}}function wa(e,t){const r=C(null),a=C(null),n=C(null),l=$(),i=$(),c=$(),y=$(),k=$(),g=$();function p(){document.addEventListener("mousedown",l),document.addEventListener("mouseup",i)}const f=e.map(o=>o!==null),d=e.map(o=>o==null);return n.on(l,()=>Date.now()),M({source:t,clock:l,filter:f,target:r}),M({source:e,clock:l,filter:f,target:a}),M({source:{currentHovered:e,initHovered:a,startTime:n},clock:i,filter:o=>!!o.initHovered&&!!o.currentHovered&&!!o.startTime,fn:({currentHovered:o,initHovered:h,startTime:u})=>({start:{col:o.col,row:o.row},finish:h,duration:Date.now()-u}),target:c}),M({source:{currentHovered:e,initFocus:r,initHovered:a},clock:e,filter:o=>!!o.initHovered&&!!o.initFocus&&!!o.currentHovered,fn:({currentHovered:o,initHovered:h,initFocus:u})=>({col:u.col+(o.col-h.col),row:u.row+(o.row-h.row)}),target:g}),_n({source:c,match:o=>o.start.col===o.finish.col&&o.start.row===o.finish.row?"click":"dragEnd",cases:{click:y,dragEnd:k}}),r.reset(c,d),a.reset(c,d),n.reset(c,d),{focusMoved:g,initEvents:p,clicked:y}}function xa(e){var{timeout:t,start:r,stop:a,leading:n=!1,trailing:l=!1}=e,i=$({name:"tick",sid:"uo9p3s"}),c=C(!1,{name:"$isRunning",sid:"-wxesi8"}),y=$a(t),k=c.map(u=>!u),g=$({name:"saveTimeout",sid:"as5clk"}),p=C(null,{name:"$timeoutId",sid:"-bh90bo"}).on(g,(u,s)=>s),f=$({name:"saveReject",sid:"-64swis"}),d=C(()=>{},{name:"$rejecter",sid:"eabbu7"}).on(f,(u,s)=>s),o=nr(u=>new Promise((s,m)=>{var v=setTimeout(s,u);g(v),f(m)}),{name:"timeoutFx",sid:"7lc3mj"}),h=Mn({and:{source:[p,d],effect:u=>{var[s,m]=u;m(),s&&clearTimeout(s)}},or:{name:"cleanupFx",sid:"pcn5jq"}});return Nt({and:[{clock:r,source:y,filter:k,target:o}],or:{sid:"-w5qmwp"}}),n&&Nt({and:[{clock:r,filter:k,target:i}],or:{sid:"-vpslni"}}),M({and:[{clock:r,fn:()=>!0,target:c}],or:{sid:"-vaed34"}}),Nt({and:[{clock:o.done,source:y,filter:c,target:o}],or:{sid:"-v73liy"}}),M({and:[{clock:o.done,fn:()=>{},target:i}],or:{sid:"-urpcwu"}}),a&&(l&&M({and:[{clock:a,target:i}],or:{sid:"-uanqf7"}}),c.on(a,()=>!1),M({and:[{clock:a,target:h}],or:{sid:"6lcmyy"}})),{tick:i,isRunning:c}}function $a(e){if(O.store(e,{sid:"6p7767"}))return e;if(typeof e=="number")return C(e,{and:{name:"$timeout"},sid:"5hw6se"});throw new TypeError('timeout parameter in interval method should be number or Store. "'.concat(typeof e,'" was passed'))}function Sa(e){const t=$(),r=$(),a=$(),n=$(),l=$();$();const i=$(),c=C(0),y=C(50),k=$(),g=C(null),p=xa({timeout:y,start:r,stop:Ze([n,a,i])});return M({clock:[p.tick,r,l],target:t}),M({source:e,clock:r,fn:f=>new Map(f),target:g}),y.on(k,(f,d)=>d).reset(i),g.on(i,()=>null),c.on(t,f=>f+1).on(a,()=>0).reset(i),{$currentStep:c,$isRunning:p.isRunning,$startFauna:g,start:r,stop:a,pause:n,changeSpeed:k,gameTick:t,reset:i,oneStep:l}}const F=ba(),Mt=ya(),_t=ka(F.$cellSize),vn=ha(),oe=C(new Map),Ia=C([]),$e=Sa(oe),ze=C({col:0,row:0}),Ca=$(),mr=$(),Ke=C(1),ht=$();Ke.on(ht,(e,t)=>t);const gr=$(),hr=wa(_t.$cell,ze),Ma=W(Mt.$isOn,F.$cellSize,(e,t)=>e?"elsa":t),vr=W(F.$fieldSize,oe,ze,({width:e,height:t},r,a)=>{const n=[];return r.forEach((l,i)=>{const[c,y]=ot(i),k=c+a.col,g=y+a.row;k>=0&&k<e&&g>=0&&g<t&&n.push({col:k,row:g,val:l})}),n}),zr=W(vr,oe,(e,t)=>({fieldCellsAmount:e.length,faunaCellsAmount:t.size})),_a=W(F.$fieldSize,Ia,ze,({width:e,height:t},r,a)=>{const n=[];return r.forEach(({col:l,row:i,label:c})=>{const y=l+a.col,k=i+a.row;y>=0&&y<e&&k>=0&&k<t&&n.push({col:y,row:k,label:c})}),n}),Da=W(vr,F.$cellSize,(e,t)=>e.map(({val:r,col:a,row:n})=>({val:r,y:n*t+"px",x:a*t+"px"}))),qa=W(_t.$cell,F.$cellSize,vn.currentBp,(e,t,r)=>e&&r?[...r].map(([a])=>{const[n,l]=ot(a);return{y:(e.row+l)*t+"px",x:(e.col+n)*t+"px"}}):e?[{y:e.row*t+"px",x:e.col*t+"px"}]:[]),Ra=W(_a,F.$cellSize,(e,t)=>e.map(({row:r,col:a,label:n})=>({y:r*t+"px",x:a*t+"px",label:n})));oe.on(gr,()=>new Map).on($e.gameTick,e=>ia(e));ze.on(hr.focusMoved,(e,t)=>t).reset(Ca);M({source:{fauna:oe,fieldSize:F.$fieldSize},clock:mr,fn:({fauna:e,fieldSize:t})=>{const r=ma(e);return{col:Math.round(t.width/2-r.col),row:Math.round(t.height/2-r.row)}},target:ze});M({source:{fauna:oe,color:Ke,focus:ze,currentBp:vn.currentBp},clock:hr.clicked,fn:({color:e,fauna:t,focus:r,currentBp:a},{start:{col:n,row:l}})=>{const i=new Map(t);if(a)a.forEach((c,y)=>{const[k,g]=ot(y),p=n-r.col+k,f=l-r.row+g;i.set(rr([p,f]),c)});else{const c=n-r.col,y=l-r.row,k=rr([c,y]);i.get(k)===e?i.delete(k):i.set(k,e)}return i},target:oe});function Ta(e){I("label",{text:e.label,fn:()=>{I("input",{attr:{type:"checkbox",checked:e.value},handler:{change:e.onChange.prepend(t=>t.target.checked)}})}})}const La="_roundBox_kgff4_1",Aa="_history_kgff4_9",Oa="_colorBtn_kgff4_15",Fa="_currentColor_kgff4_22",Na="_arrowBtn_kgff4_26",pe={roundBox:La,history:Aa,colorBtn:Oa,currentColor:Fa,arrowBtn:Na};function Ea(){Ta({label:"Elsa",value:Mt.$isOn,onChange:Mt.changed}),I("div",{style:{display:"flex",gap:"8px"},fn(){I("button",{classList:{[pe.colorBtn]:!0,[pe.currentColor]:Ke.map(e=>e===1)},style:{backgroundColor:gn},handler:{click:ht.prepend(()=>1)}}),I("button",{classList:{[pe.colorBtn]:!0,[pe.currentColor]:Ke.map(e=>e===2)},style:{backgroundColor:hn},handler:{click:ht.prepend(()=>2)}}),I("button",{classList:{[pe.colorBtn]:!0,[pe.currentColor]:Ke.map(e=>!e)},handler:{click:ht.prepend(()=>0)}})}})}const Ba=""+new URL("heart-line-icon.ca853df2.svg",import.meta.url).href,Pa="_field_oqxfw_1",za="_cell_oqxfw_13",ja="_on1_oqxfw_21",Va="_on2_oqxfw_24",Ua="_hoveredCell_oqxfw_28",Ha="_heartMode_oqxfw_32",Ga="_label_oqxfw_40",be={field:Pa,cell:za,on1:ja,on2:Va,hoveredCell:Ua,heartMode:Ha,label:Ga};function Wa(e){const t=`
<svg viewBox='0 0 ${e} ${e}' xmlns='http://www.w3.org/2000/svg'>
<line x1='0' y1='0' x2='0' y2='${e}' stroke='#b4b6b8' />
<line x1='0' y1='0' x2='${e}' y2='0' stroke='#b4b6b8' />
</svg>`;return"data:image/svg+xml;base64,"+btoa(t.replace(/\n/g,""))}function Qa(){I("div",{classList:[be.field],styleVar:{cellSize:F.$cellSize.map(e=>e+"px"),color1:gn,color2:hn},style:{backgroundImage:Ma.map(e=>`url("${e==="elsa"?Ba:Wa(e)}")`),backgroundSize:F.$cellSize.map(e=>`${e}px ${e}px`)},handler:{mousemove:_t.fieldMouseMoved,mouseleave:_t.fieldMouseLeaved},fn(){gt(Da,({store:e})=>{I("div",{style:{left:e.map(t=>t.x),top:e.map(t=>t.y)},classList:{[be.heartMode]:Mt.$isOn,[be.cell]:!0,[be.on1]:e.map(t=>t.val===1),[be.on2]:e.map(t=>t.val===2)}})}),gt(qa,({store:e})=>{I("div",{style:{left:e.map(t=>t?t.x:"-100px"),top:e.map(t=>t?t.y:"-100px")},classList:[be.cell,be.hoveredCell]})}),gt(Ra,({store:e})=>{I("div",{style:{left:e.map(t=>t.x),top:e.map(t=>t.y)},text:e.map(t=>t.label),classList:[be.label]})})}})}const Tt=C(da()||[]),nt=C(new Set),bn=$(),yn=$(),kn=$(),wn=$(),Lt=$(),xn=$();nt.on(yn,(e,t)=>{let r=new Set(e);return r.add(t),r}).on(kn,(e,t)=>{let r=new Set(e);return r.delete(t),r});Tt.on(bn,(e,t)=>{let a=(e[e.length-1]?.name||"0").match(/(\d+)/),n=a&&+a[1]||0;return[...e,{fauna:t,name:`save #${n+1}`}]}).on(wn,(e,t)=>e.filter(r=>!t.includes(r.name)));M({source:Tt,target:nr(e=>{pa(e)})});window.addEventListener("beforeunload",()=>{wn([...nt.getState()])});const Xa=W(Tt,nt,(e,t)=>e.map(r=>({...r,toRemove:t.has(r.name)})));function Ya(){I("div",{classList:[pe.history],fn(){I("p",{text:"History: ",style:{margin:"0"}}),gt(Xa,({store:e})=>{const t=$(),r=$();M({source:{historyEl:e,itemsToRemove:nt},clock:t,filter:({historyEl:a,itemsToRemove:n})=>n.has(a.name),fn:({historyEl:a})=>a.name,target:kn}),M({source:{historyEl:e,itemsToRemove:nt},clock:t,filter:({historyEl:a,itemsToRemove:n})=>!n.has(a.name),fn:({historyEl:a})=>a.name,target:Lt}),M({clock:r,source:e.map(a=>a.name),target:yn}),I("div",()=>{I("button",()=>{le({handler:{click:t}}),Te`${e.map(a=>a.toRemove?`restore (${a.name})`:a.name)}`}),I("button",()=>{le({handler:{click:r}}),Te`x`})})}),I("button",{style:{marginLeft:"auto"},text:"Save",handler:{click:xn}})}})}function Ja(e){const[t,r]=e.range;I("div",()=>{le({classList:e.classList}),I("button",{handler:{click:e.onMinusClicked},text:"-",attr:{disabled:e.value.map(a=>a<=t)}}),Te` ${e.value} `,I("button",{handler:{click:e.onPlusClicked},text:"+",attr:{disabled:e.value.map(a=>a>=r)}})})}function Ka(){hr.initEvents(),I("button",{classList:[pe.arrowBtn],handler:{click:mr},text:"to center"}),I("div",()=>{le({style:{position:"absolute",right:"150px",bottom:"20px",zIndex:1}}),Ja({value:F.$cellSize,onPlusClicked:F.plus,onMinusClicked:F.minus,range:F.options,classList:[pe.roundBox]})})}function Za(){I("p",()=>{le({style:{position:"absolute",backgroundColor:"rgba(255,255,255, 0.9)",padding:"8px",borderRadius:"4px",border:"1px solid #aaa",display:"flex",gap:"8px"}}),I("button",{text:"Step",handler:{click:$e.oneStep}}),Te` timer: `,Zn({source:$e.$isRunning.map(e=>({show:e?"1":"0"})),key:"show",cases:{1:()=>{I("button",{text:"Stop",style:{color:"#f8f8f8",backgroundColor:"#de4040",border:"0"},handler:{click:$e.pause}})},0:()=>{I("button",{text:"Start",style:{color:"#f8f8f8",backgroundColor:"#50c40e",border:"0"},handler:{click:$e.start}})}}}),Te`steps: ${$e.$currentStep}`,Te` || population: ${zr.map(({fieldCellsAmount:e})=>e)} / ${zr.map(({faunaCellsAmount:e})=>e)}`})}const At=C(""),$n=$(),el=$(),Sn=$();At.on($n,(e,t)=>t);M({source:oe,clock:xn,target:bn});M({source:Tt,clock:Lt,fn:(e,t)=>{const r=e.find(n=>n.name===t).fauna;return new Map(r)},target:oe});M({source:At,clock:Sn,fn:ga,target:oe});M({clock:[Lt,gr],target:$e.reset});M({clock:Lt,target:mr});M({source:vr,clock:el,fn:ua,target:At});function tl(){I("div",()=>{Ka(),Qa(),I("div",{style:{position:"absolute",width:"100%",backgroundColor:"rgba(255,255,255, 0.9)"},fn(){I("h1",{text:"Game of Life"}),Ya(),Ea(),Za()}}),I("button",{text:"Reset",style:{position:"absolute",bottom:"20px",left:"20px"},handler:{click:gr}}),I("div",()=>{le({style:{position:"absolute",bottom:"50px",left:"20px"}}),I("button",{text:"Import",handler:{click:Sn}}),I("br",{}),I("textarea",{style:{fontSize:"8px",width:"100%",height:"100px",lineHeight:1},text:At,handler:{change:$n.prepend(e=>e.target.value)}})})})}Jn(document.querySelector("#app"),tl);
